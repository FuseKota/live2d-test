// Auto-generated by build-viewer.sh - DO NOT EDIT
export const LIVE2D_VIEWER_HTML: string = "<!DOCTYPE html>\n<html lang=\"ja\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=no\" />\n    <title>Live2D Viewer</title>\n    <style>\n      * {\n        margin: 0;\n        padding: 0;\n        box-sizing: border-box;\n      }\n      html, body {\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n        background: transparent;\n      }\n      #canvas {\n        display: block;\n        width: 100%;\n        height: 100%;\n      }\n    </style>\n    <script>\n      // Safety net: track whether READY was sent by the module\n      window.__readySent = false;\n      window.__cubismCoreLoaded = false;\n\n      // Global error handler\n      window.onerror = function(msg, url, line, col, error) {\n        console.error('[Live2D Viewer] Global error:', msg);\n      };\n    </script>\n    <!-- Cubism Core SDK: MUST load before pixi-live2d-display -->\n    <script\n      src=\"https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js\"\n      onload=\"window.__cubismCoreLoaded = true; console.log('[Cubism Core] Loaded');\"\n      onerror=\"console.error('[Cubism Core] CDN load failed'); window.__cubismCoreLoaded = false;\"\n    ></script>\n    <script type=\"module\" crossorigin>var Zp=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var pE=Zp((He,Xe)=>{(function(){const t=document.createElement(\"link\").relList;if(t&&t.supports&&t.supports(\"modulepreload\"))return;for(const s of document.querySelectorAll('link[rel=\"modulepreload\"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type===\"childList\")for(const a of n.addedNodes)a.tagName===\"LINK\"&&a.rel===\"modulepreload\"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin===\"use-credentials\"?n.credentials=\"include\":s.crossOrigin===\"anonymous\"?n.credentials=\"omit\":n.credentials=\"same-origin\",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();var ui=(r=>(r[r.WEBGL_LEGACY=0]=\"WEBGL_LEGACY\",r[r.WEBGL=1]=\"WEBGL\",r[r.WEBGL2=2]=\"WEBGL2\",r))(ui||{}),ch=(r=>(r[r.UNKNOWN=0]=\"UNKNOWN\",r[r.WEBGL=1]=\"WEBGL\",r[r.CANVAS=2]=\"CANVAS\",r))(ch||{}),gn=(r=>(r[r.COLOR=16384]=\"COLOR\",r[r.DEPTH=256]=\"DEPTH\",r[r.STENCIL=1024]=\"STENCIL\",r))(gn||{}),H=(r=>(r[r.NORMAL=0]=\"NORMAL\",r[r.ADD=1]=\"ADD\",r[r.MULTIPLY=2]=\"MULTIPLY\",r[r.SCREEN=3]=\"SCREEN\",r[r.OVERLAY=4]=\"OVERLAY\",r[r.DARKEN=5]=\"DARKEN\",r[r.LIGHTEN=6]=\"LIGHTEN\",r[r.COLOR_DODGE=7]=\"COLOR_DODGE\",r[r.COLOR_BURN=8]=\"COLOR_BURN\",r[r.HARD_LIGHT=9]=\"HARD_LIGHT\",r[r.SOFT_LIGHT=10]=\"SOFT_LIGHT\",r[r.DIFFERENCE=11]=\"DIFFERENCE\",r[r.EXCLUSION=12]=\"EXCLUSION\",r[r.HUE=13]=\"HUE\",r[r.SATURATION=14]=\"SATURATION\",r[r.COLOR=15]=\"COLOR\",r[r.LUMINOSITY=16]=\"LUMINOSITY\",r[r.NORMAL_NPM=17]=\"NORMAL_NPM\",r[r.ADD_NPM=18]=\"ADD_NPM\",r[r.SCREEN_NPM=19]=\"SCREEN_NPM\",r[r.NONE=20]=\"NONE\",r[r.SRC_OVER=0]=\"SRC_OVER\",r[r.SRC_IN=21]=\"SRC_IN\",r[r.SRC_OUT=22]=\"SRC_OUT\",r[r.SRC_ATOP=23]=\"SRC_ATOP\",r[r.DST_OVER=24]=\"DST_OVER\",r[r.DST_IN=25]=\"DST_IN\",r[r.DST_OUT=26]=\"DST_OUT\",r[r.DST_ATOP=27]=\"DST_ATOP\",r[r.ERASE=26]=\"ERASE\",r[r.SUBTRACT=28]=\"SUBTRACT\",r[r.XOR=29]=\"XOR\",r))(H||{}),oe=(r=>(r[r.POINTS=0]=\"POINTS\",r[r.LINES=1]=\"LINES\",r[r.LINE_LOOP=2]=\"LINE_LOOP\",r[r.LINE_STRIP=3]=\"LINE_STRIP\",r[r.TRIANGLES=4]=\"TRIANGLES\",r[r.TRIANGLE_STRIP=5]=\"TRIANGLE_STRIP\",r[r.TRIANGLE_FAN=6]=\"TRIANGLE_FAN\",r))(oe||{}),M=(r=>(r[r.RGBA=6408]=\"RGBA\",r[r.RGB=6407]=\"RGB\",r[r.RG=33319]=\"RG\",r[r.RED=6403]=\"RED\",r[r.RGBA_INTEGER=36249]=\"RGBA_INTEGER\",r[r.RGB_INTEGER=36248]=\"RGB_INTEGER\",r[r.RG_INTEGER=33320]=\"RG_INTEGER\",r[r.RED_INTEGER=36244]=\"RED_INTEGER\",r[r.ALPHA=6406]=\"ALPHA\",r[r.LUMINANCE=6409]=\"LUMINANCE\",r[r.LUMINANCE_ALPHA=6410]=\"LUMINANCE_ALPHA\",r[r.DEPTH_COMPONENT=6402]=\"DEPTH_COMPONENT\",r[r.DEPTH_STENCIL=34041]=\"DEPTH_STENCIL\",r))(M||{}),Ai=(r=>(r[r.TEXTURE_2D=3553]=\"TEXTURE_2D\",r[r.TEXTURE_CUBE_MAP=34067]=\"TEXTURE_CUBE_MAP\",r[r.TEXTURE_2D_ARRAY=35866]=\"TEXTURE_2D_ARRAY\",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]=\"TEXTURE_CUBE_MAP_POSITIVE_X\",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]=\"TEXTURE_CUBE_MAP_NEGATIVE_X\",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]=\"TEXTURE_CUBE_MAP_POSITIVE_Y\",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]=\"TEXTURE_CUBE_MAP_NEGATIVE_Y\",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]=\"TEXTURE_CUBE_MAP_POSITIVE_Z\",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]=\"TEXTURE_CUBE_MAP_NEGATIVE_Z\",r))(Ai||{}),V=(r=>(r[r.UNSIGNED_BYTE=5121]=\"UNSIGNED_BYTE\",r[r.UNSIGNED_SHORT=5123]=\"UNSIGNED_SHORT\",r[r.UNSIGNED_SHORT_5_6_5=33635]=\"UNSIGNED_SHORT_5_6_5\",r[r.UNSIGNED_SHORT_4_4_4_4=32819]=\"UNSIGNED_SHORT_4_4_4_4\",r[r.UNSIGNED_SHORT_5_5_5_1=32820]=\"UNSIGNED_SHORT_5_5_5_1\",r[r.UNSIGNED_INT=5125]=\"UNSIGNED_INT\",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]=\"UNSIGNED_INT_10F_11F_11F_REV\",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]=\"UNSIGNED_INT_2_10_10_10_REV\",r[r.UNSIGNED_INT_24_8=34042]=\"UNSIGNED_INT_24_8\",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]=\"UNSIGNED_INT_5_9_9_9_REV\",r[r.BYTE=5120]=\"BYTE\",r[r.SHORT=5122]=\"SHORT\",r[r.INT=5124]=\"INT\",r[r.FLOAT=5126]=\"FLOAT\",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]=\"FLOAT_32_UNSIGNED_INT_24_8_REV\",r[r.HALF_FLOAT=36193]=\"HALF_FLOAT\",r))(V||{}),O=(r=>(r[r.FLOAT=0]=\"FLOAT\",r[r.INT=1]=\"INT\",r[r.UINT=2]=\"UINT\",r))(O||{}),Me=(r=>(r[r.NEAREST=0]=\"NEAREST\",r[r.LINEAR=1]=\"LINEAR\",r))(Me||{}),Re=(r=>(r[r.CLAMP=33071]=\"CLAMP\",r[r.REPEAT=10497]=\"REPEAT\",r[r.MIRRORED_REPEAT=33648]=\"MIRRORED_REPEAT\",r))(Re||{}),fe=(r=>(r[r.OFF=0]=\"OFF\",r[r.POW2=1]=\"POW2\",r[r.ON=2]=\"ON\",r[r.ON_MANUAL=3]=\"ON_MANUAL\",r))(fe||{}),Nt=(r=>(r[r.NPM=0]=\"NPM\",r[r.UNPACK=1]=\"UNPACK\",r[r.PMA=2]=\"PMA\",r[r.NO_PREMULTIPLIED_ALPHA=0]=\"NO_PREMULTIPLIED_ALPHA\",r[r.PREMULTIPLY_ON_UPLOAD=1]=\"PREMULTIPLY_ON_UPLOAD\",r[r.PREMULTIPLIED_ALPHA=2]=\"PREMULTIPLIED_ALPHA\",r))(Nt||{}),ae=(r=>(r[r.NO=0]=\"NO\",r[r.YES=1]=\"YES\",r[r.AUTO=2]=\"AUTO\",r[r.BLEND=0]=\"BLEND\",r[r.CLEAR=1]=\"CLEAR\",r[r.BLIT=2]=\"BLIT\",r))(ae||{}),Vn=(r=>(r[r.AUTO=0]=\"AUTO\",r[r.MANUAL=1]=\"MANUAL\",r))(Vn||{}),zt=(r=>(r.LOW=\"lowp\",r.MEDIUM=\"mediump\",r.HIGH=\"highp\",r))(zt||{}),yt=(r=>(r[r.NONE=0]=\"NONE\",r[r.SCISSOR=1]=\"SCISSOR\",r[r.STENCIL=2]=\"STENCIL\",r[r.SPRITE=3]=\"SPRITE\",r[r.COLOR=4]=\"COLOR\",r))(yt||{}),Ic=(r=>(r[r.RED=1]=\"RED\",r[r.GREEN=2]=\"GREEN\",r[r.BLUE=4]=\"BLUE\",r[r.ALPHA=8]=\"ALPHA\",r))(Ic||{}),mt=(r=>(r[r.NONE=0]=\"NONE\",r[r.LOW=2]=\"LOW\",r[r.MEDIUM=4]=\"MEDIUM\",r[r.HIGH=8]=\"HIGH\",r))(mt||{}),ue=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]=\"ELEMENT_ARRAY_BUFFER\",r[r.ARRAY_BUFFER=34962]=\"ARRAY_BUFFER\",r[r.UNIFORM_BUFFER=35345]=\"UNIFORM_BUFFER\",r))(ue||{});const Rc={createCanvas:(r,t)=>{const e=document.createElement(\"canvas\");return e.width=r,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,t)=>fetch(r,t),parseXML:r=>new DOMParser().parseFromString(r,\"text/xml\")},N={ADAPTER:Rc,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var na=/iPhone/i,gl=/iPod/i,_l=/iPad/i,yl=/\\biOS-universal(?:.+)Mac\\b/i,aa=/\\bAndroid(?:.+)Mobile\\b/i,vl=/Android/i,Oi=/(?:SD4930UR|\\bSilk(?:.+)Mobile\\b)/i,Cs=/Silk/i,Be=/Windows Phone/i,xl=/\\bWindows(?:.+)ARM\\b/i,bl=/BlackBerry/i,Tl=/BB10/i,wl=/Opera Mini/i,El=/\\b(CriOS|Chrome)(?:.+)Mobile/i,Cl=/Mobile(?:.+)Firefox\\b/i,Sl=function(r){return typeof r<\"u\"&&r.platform===\"MacIntel\"&&typeof r.maxTouchPoints==\"number\"&&r.maxTouchPoints>1&&typeof MSStream>\"u\"};function Jp(r){return function(t){return t.test(r)}}function Al(r){var t={userAgent:\"\",platform:\"\",maxTouchPoints:0};!r&&typeof navigator<\"u\"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r==\"string\"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split(\"[FBAN\");typeof i[1]<\"u\"&&(e=i[0]),i=e.split(\"Twitter\"),typeof i[1]<\"u\"&&(e=i[0]);var s=Jp(e),n={apple:{phone:s(na)&&!s(Be),ipod:s(gl),tablet:!s(na)&&(s(_l)||Sl(t))&&!s(Be),universal:s(yl),device:(s(na)||s(gl)||s(_l)||s(yl)||Sl(t))&&!s(Be)},amazon:{phone:s(Oi),tablet:!s(Oi)&&s(Cs),device:s(Oi)||s(Cs)},android:{phone:!s(Be)&&s(Oi)||!s(Be)&&s(aa),tablet:!s(Be)&&!s(Oi)&&!s(aa)&&(s(Cs)||s(vl)),device:!s(Be)&&(s(Oi)||s(Cs)||s(aa)||s(vl))||s(/\\bokhttp\\b/i)},windows:{phone:s(Be),tablet:s(xl),device:s(Be)||s(xl)},other:{blackberry:s(bl),blackberry10:s(Tl),opera:s(wl),firefox:s(Cl),chrome:s(El),device:s(bl)||s(Tl)||s(wl)||s(Cl)||s(El)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Qp=Al.default??Al,he=Qp(globalThis.navigator);N.RETINA_PREFIX=/@([0-9\\.]+)x/;N.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Or=typeof globalThis<\"u\"?globalThis:typeof window<\"u\"?window:typeof global<\"u\"?global:typeof self<\"u\"?self:{};function Dc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,\"default\")?r.default:r}function tm(r){if(r.__esModule)return r;var t=r.default;if(typeof t==\"function\"){var e=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,\"__esModule\",{value:!0}),Object.keys(r).forEach(function(i){var s=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return r[i]}})}),e}var Fc={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e=\"~\";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function s(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function n(h,l,u,c,d){if(typeof u!=\"function\")throw new TypeError(\"The listener must be a function\");var f=new s(u,c||h,d),p=e?e+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function a(h,l){--h._eventsCount===0?h._events=new i:delete h._events[l]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],u,c;if(this._eventsCount===0)return l;for(c in u=this._events)t.call(u,c)&&l.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},o.prototype.listeners=function(l){var u=e?e+l:l,c=this._events[u];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,p=new Array(f);d<f;d++)p[d]=c[d].fn;return p},o.prototype.listenerCount=function(l){var u=e?e+l:l,c=this._events[u];return c?c.fn?1:c.length:0},o.prototype.emit=function(l,u,c,d,f,p){var m=e?e+l:l;if(!this._events[m])return!1;var g=this._events[m],y=arguments.length,x,_;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,c),!0;case 4:return g.fn.call(g.context,u,c,d),!0;case 5:return g.fn.call(g.context,u,c,d,f),!0;case 6:return g.fn.call(g.context,u,c,d,f,p),!0}for(_=1,x=new Array(y-1);_<y;_++)x[_-1]=arguments[_];g.fn.apply(g.context,x)}else{var v=g.length,T;for(_=0;_<v;_++)switch(g[_].once&&this.removeListener(l,g[_].fn,void 0,!0),y){case 1:g[_].fn.call(g[_].context);break;case 2:g[_].fn.call(g[_].context,u);break;case 3:g[_].fn.call(g[_].context,u,c);break;case 4:g[_].fn.call(g[_].context,u,c,d);break;default:if(!x)for(T=1,x=new Array(y-1);T<y;T++)x[T-1]=arguments[T];g[_].fn.apply(g[_].context,x)}}return!0},o.prototype.on=function(l,u,c){return n(this,l,u,c,!1)},o.prototype.once=function(l,u,c){return n(this,l,u,c,!0)},o.prototype.removeListener=function(l,u,c,d){var f=e?e+l:l;if(!this._events[f])return this;if(!u)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!d||p.once)&&(!c||p.context===c)&&a(this,f);else{for(var m=0,g=[],y=p.length;m<y;m++)(p[m].fn!==u||d&&!p[m].once||c&&p[m].context!==c)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:a(this,f)}return this},o.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&a(this,u)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,r.exports=o})(Fc);var em=Fc.exports;const Ye=Dc(em);var dh={exports:{}};dh.exports=Hn;dh.exports.default=Hn;function Hn(r,t,e){e=e||2;var i=t&&t.length,s=i?t[0]*e:r.length,n=Bc(r,0,s,e,!0),a=[];if(!n||n.next===n.prev)return a;var o,h,l,u,c,d,f;if(i&&(n=am(r,t,n,e)),r.length>80*e){o=l=r[0],h=u=r[1];for(var p=e;p<s;p+=e)c=r[p],d=r[p+1],c<o&&(o=c),d<h&&(h=d),c>l&&(l=c),d>u&&(u=d);f=Math.max(l-o,u-h),f=f!==0?32767/f:0}return $r(n,a,e,o,h,f,0),a}function Bc(r,t,e,i,s){var n,a;if(s===uo(r,t,e,i)>0)for(n=t;n<e;n+=i)a=Pl(n,r[n],r[n+1],a);else for(n=e-i;n>=t;n-=i)a=Pl(n,r[n],r[n+1],a);return a&&Xn(a,a.next)&&(Wr(a),a=a.next),a}function Di(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(Xn(e,e.next)||dt(e.prev,e,e.next)===0)){if(Wr(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function $r(r,t,e,i,s,n,a){if(r){!a&&n&&cm(r,i,s,n);for(var o=r,h,l;r.prev!==r.next;){if(h=r.prev,l=r.next,n?rm(r,i,s,n):im(r)){t.push(h.i/e|0),t.push(r.i/e|0),t.push(l.i/e|0),Wr(r),r=l.next,o=l.next;continue}if(r=l,r===o){a?a===1?(r=sm(Di(r),t,e),$r(r,t,e,i,s,n,2)):a===2&&nm(r,t,e,i,s,n):$r(Di(r),t,e,i,s,n,1);break}}}}function im(r){var t=r.prev,e=r,i=r.next;if(dt(t,e,i)>=0)return!1;for(var s=t.x,n=e.x,a=i.x,o=t.y,h=e.y,l=i.y,u=s<n?s<a?s:a:n<a?n:a,c=o<h?o<l?o:l:h<l?h:l,d=s>n?s>a?s:a:n>a?n:a,f=o>h?o>l?o:l:h>l?h:l,p=i.next;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=c&&p.y<=f&&Zi(s,o,n,h,a,l,p.x,p.y)&&dt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function rm(r,t,e,i){var s=r.prev,n=r,a=r.next;if(dt(s,n,a)>=0)return!1;for(var o=s.x,h=n.x,l=a.x,u=s.y,c=n.y,d=a.y,f=o<h?o<l?o:l:h<l?h:l,p=u<c?u<d?u:d:c<d?c:d,m=o>h?o>l?o:l:h>l?h:l,g=u>c?u>d?u:d:c>d?c:d,y=ho(f,p,t,e,i),x=ho(m,g,t,e,i),_=r.prevZ,v=r.nextZ;_&&_.z>=y&&v&&v.z<=x;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==s&&_!==a&&Zi(o,u,h,c,l,d,_.x,_.y)&&dt(_.prev,_,_.next)>=0||(_=_.prevZ,v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==s&&v!==a&&Zi(o,u,h,c,l,d,v.x,v.y)&&dt(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;_&&_.z>=y;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==s&&_!==a&&Zi(o,u,h,c,l,d,_.x,_.y)&&dt(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;v&&v.z<=x;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==s&&v!==a&&Zi(o,u,h,c,l,d,v.x,v.y)&&dt(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function sm(r,t,e){var i=r;do{var s=i.prev,n=i.next.next;!Xn(s,n)&&Lc(s,i,i.next,n)&&zr(s,n)&&zr(n,s)&&(t.push(s.i/e|0),t.push(i.i/e|0),t.push(n.i/e|0),Wr(i),Wr(i.next),i=r=n),i=i.next}while(i!==r);return Di(i)}function nm(r,t,e,i,s,n){var a=r;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&pm(a,o)){var h=Oc(a,o);a=Di(a,a.next),h=Di(h,h.next),$r(a,t,e,i,s,n,0),$r(h,t,e,i,s,n,0);return}o=o.next}a=a.next}while(a!==r)}function am(r,t,e,i){var s=[],n,a,o,h,l;for(n=0,a=t.length;n<a;n++)o=t[n]*i,h=n<a-1?t[n+1]*i:r.length,l=Bc(r,o,h,i,!1),l===l.next&&(l.steiner=!0),s.push(fm(l));for(s.sort(om),n=0;n<s.length;n++)e=hm(s[n],e);return e}function om(r,t){return r.x-t.x}function hm(r,t){var e=lm(r,t);if(!e)return t;var i=Oc(e,r);return Di(i,i.next),Di(e,e.next)}function lm(r,t){var e=t,i=r.x,s=r.y,n=-1/0,a;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var o=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(o<=i&&o>n&&(n=o,a=e.x<e.next.x?e:e.next,o===i))return a}e=e.next}while(e!==t);if(!a)return null;var h=a,l=a.x,u=a.y,c=1/0,d;e=a;do i>=e.x&&e.x>=l&&i!==e.x&&Zi(s<u?i:n,s,l,u,s<u?n:i,s,e.x,e.y)&&(d=Math.abs(s-e.y)/(i-e.x),zr(e,r)&&(d<c||d===c&&(e.x>a.x||e.x===a.x&&um(a,e)))&&(a=e,c=d)),e=e.next;while(e!==h);return a}function um(r,t){return dt(r.prev,r,t.prev)<0&&dt(t.next,r,r.next)<0}function cm(r,t,e,i){var s=r;do s.z===0&&(s.z=ho(s.x,s.y,t,e,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,dm(s)}function dm(r){var t,e,i,s,n,a,o,h,l=1;do{for(e=r,r=null,n=null,a=0;e;){for(a++,i=e,o=0,t=0;t<l&&(o++,i=i.nextZ,!!i);t++);for(h=l;o>0||h>0&&i;)o!==0&&(h===0||!i||e.z<=i.z)?(s=e,e=e.nextZ,o--):(s=i,i=i.nextZ,h--),n?n.nextZ=s:r=s,s.prevZ=n,n=s;e=i}n.nextZ=null,l*=2}while(a>1);return r}function ho(r,t,e,i,s){return r=(r-e)*s|0,t=(t-i)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function fm(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Zi(r,t,e,i,s,n,a,o){return(s-a)*(t-o)>=(r-a)*(n-o)&&(r-a)*(i-o)>=(e-a)*(t-o)&&(e-a)*(n-o)>=(s-a)*(i-o)}function pm(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!mm(r,t)&&(zr(r,t)&&zr(t,r)&&gm(r,t)&&(dt(r.prev,r,t.prev)||dt(r,t.prev,t))||Xn(r,t)&&dt(r.prev,r,r.next)>0&&dt(t.prev,t,t.next)>0)}function dt(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function Xn(r,t){return r.x===t.x&&r.y===t.y}function Lc(r,t,e,i){var s=As(dt(r,t,e)),n=As(dt(r,t,i)),a=As(dt(e,i,r)),o=As(dt(e,i,t));return!!(s!==n&&a!==o||s===0&&Ss(r,e,t)||n===0&&Ss(r,i,t)||a===0&&Ss(e,r,i)||o===0&&Ss(e,t,i))}function Ss(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function As(r){return r>0?1:r<0?-1:0}function mm(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&Lc(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function zr(r,t){return dt(r.prev,r,r.next)<0?dt(r,t,r.next)>=0&&dt(r,r.prev,t)>=0:dt(r,t,r.prev)<0||dt(r,r.next,t)<0}function gm(r,t){var e=r,i=!1,s=(r.x+t.x)/2,n=(r.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&s<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function Oc(r,t){var e=new lo(r.i,r.x,r.y),i=new lo(t.i,t.x,t.y),s=r.next,n=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}function Pl(r,t,e,i){var s=new lo(r,t,e);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Wr(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function lo(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Hn.deviation=function(r,t,e,i){var s=t&&t.length,n=s?t[0]*e:r.length,a=Math.abs(uo(r,0,n,e));if(s)for(var o=0,h=t.length;o<h;o++){var l=t[o]*e,u=o<h-1?t[o+1]*e:r.length;a-=Math.abs(uo(r,l,u,e))}var c=0;for(o=0;o<i.length;o+=3){var d=i[o]*e,f=i[o+1]*e,p=i[o+2]*e;c+=Math.abs((r[d]-r[p])*(r[f+1]-r[d+1])-(r[d]-r[f])*(r[p+1]-r[d+1]))}return a===0&&c===0?0:Math.abs((c-a)/a)};function uo(r,t,e,i){for(var s=0,n=t,a=e-i;n<e;n+=i)s+=(r[a]-r[n])*(r[n+1]+r[a+1]),a=n;return s}Hn.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,s=0;s<r.length;s++){for(var n=0;n<r[s].length;n++)for(var a=0;a<t;a++)e.vertices.push(r[s][n][a]);s>0&&(i+=r[s-1].length,e.holes.push(i))}return e};var _m=dh.exports;const Nc=Dc(_m);var _n={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */_n.exports;(function(r,t){(function(e){var i=t&&!t.nodeType&&t,s=r&&!r.nodeType&&r,n=typeof Or==\"object\"&&Or;(n.global===n||n.window===n||n.self===n)&&(e=n);var a,o=2147483647,h=36,l=1,u=26,c=38,d=700,f=72,p=128,m=\"-\",g=/^xn--/,y=/[^\\x20-\\x7E]/,x=/[\\x2E\\u3002\\uFF0E\\uFF61]/g,_={overflow:\"Overflow: input needs wider integers to process\",\"not-basic\":\"Illegal input >= 0x80 (not a basic code point)\",\"invalid-input\":\"Invalid input\"},v=h-l,T=Math.floor,S=String.fromCharCode,w;function b(P){throw new RangeError(_[P])}function R(P,W){for(var J=P.length,rt=[];J--;)rt[J]=W(P[J]);return rt}function L(P,W){var J=P.split(\"@\"),rt=\"\";J.length>1&&(rt=J[0]+\"@\",P=J[1]),P=P.replace(x,\".\");var st=P.split(\".\"),Tt=R(st,W).join(\".\");return rt+Tt}function I(P){for(var W=[],J=0,rt=P.length,st,Tt;J<rt;)st=P.charCodeAt(J++),st>=55296&&st<=56319&&J<rt?(Tt=P.charCodeAt(J++),(Tt&64512)==56320?W.push(((st&1023)<<10)+(Tt&1023)+65536):(W.push(st),J--)):W.push(st);return W}function D(P){return R(P,function(W){var J=\"\";return W>65535&&(W-=65536,J+=S(W>>>10&1023|55296),W=56320|W&1023),J+=S(W),J}).join(\"\")}function C(P){return P-48<10?P-22:P-65<26?P-65:P-97<26?P-97:h}function A(P,W){return P+22+75*(P<26)-((W!=0)<<5)}function $(P,W,J){var rt=0;for(P=J?T(P/d):P>>1,P+=T(P/W);P>v*u>>1;rt+=h)P=T(P/v);return T(rt+(v+1)*P/(P+c))}function q(P){var W=[],J=P.length,rt,st=0,Tt=p,gt=f,wt,Dt,Gt,It,ht,_t,vt,ge,_e;for(wt=P.lastIndexOf(m),wt<0&&(wt=0),Dt=0;Dt<wt;++Dt)P.charCodeAt(Dt)>=128&&b(\"not-basic\"),W.push(P.charCodeAt(Dt));for(Gt=wt>0?wt+1:0;Gt<J;){for(It=st,ht=1,_t=h;Gt>=J&&b(\"invalid-input\"),vt=C(P.charCodeAt(Gt++)),(vt>=h||vt>T((o-st)/ht))&&b(\"overflow\"),st+=vt*ht,ge=_t<=gt?l:_t>=gt+u?u:_t-gt,!(vt<ge);_t+=h)_e=h-ge,ht>T(o/_e)&&b(\"overflow\"),ht*=_e;rt=W.length+1,gt=$(st-It,rt,It==0),T(st/rt)>o-Tt&&b(\"overflow\"),Tt+=T(st/rt),st%=rt,W.splice(st++,0,Tt)}return D(W)}function U(P){var W,J,rt,st,Tt,gt,wt,Dt,Gt,It,ht,_t=[],vt,ge,_e,gr;for(P=I(P),vt=P.length,W=p,J=0,Tt=f,gt=0;gt<vt;++gt)ht=P[gt],ht<128&&_t.push(S(ht));for(rt=st=_t.length,st&&_t.push(m);rt<vt;){for(wt=o,gt=0;gt<vt;++gt)ht=P[gt],ht>=W&&ht<wt&&(wt=ht);for(ge=rt+1,wt-W>T((o-J)/ge)&&b(\"overflow\"),J+=(wt-W)*ge,W=wt,gt=0;gt<vt;++gt)if(ht=P[gt],ht<W&&++J>o&&b(\"overflow\"),ht==W){for(Dt=J,Gt=h;It=Gt<=Tt?l:Gt>=Tt+u?u:Gt-Tt,!(Dt<It);Gt+=h)gr=Dt-It,_e=h-It,_t.push(S(A(It+gr%_e,0))),Dt=T(gr/_e);_t.push(S(A(Dt,0))),Tt=$(J,ge,rt==st),J=0,++rt}++J,++W}return _t.join(\"\")}function nt(P){return L(P,function(W){return g.test(W)?q(W.slice(4).toLowerCase()):W})}function at(P){return L(P,function(W){return y.test(W)?\"xn--\"+U(W):W})}if(a={version:\"1.4.1\",ucs2:{decode:I,encode:D},decode:q,encode:U,toASCII:at,toUnicode:nt},i&&s)if(r.exports==i)s.exports=a;else for(w in a)a.hasOwnProperty(w)&&(i[w]=a[w]);else e.punycode=a})(Or)})(_n,_n.exports);var ym=_n.exports,cr=TypeError;const vm={},xm=Object.freeze(Object.defineProperty({__proto__:null,default:vm},Symbol.toStringTag,{value:\"Module\"})),bm=tm(xm);var fh=typeof Map==\"function\"&&Map.prototype,oa=Object.getOwnPropertyDescriptor&&fh?Object.getOwnPropertyDescriptor(Map.prototype,\"size\"):null,yn=fh&&oa&&typeof oa.get==\"function\"?oa.get:null,Ml=fh&&Map.prototype.forEach,ph=typeof Set==\"function\"&&Set.prototype,ha=Object.getOwnPropertyDescriptor&&ph?Object.getOwnPropertyDescriptor(Set.prototype,\"size\"):null,vn=ph&&ha&&typeof ha.get==\"function\"?ha.get:null,Il=ph&&Set.prototype.forEach,Tm=typeof WeakMap==\"function\"&&WeakMap.prototype,Nr=Tm?WeakMap.prototype.has:null,wm=typeof WeakSet==\"function\"&&WeakSet.prototype,Ur=wm?WeakSet.prototype.has:null,Em=typeof WeakRef==\"function\"&&WeakRef.prototype,Rl=Em?WeakRef.prototype.deref:null,Cm=Boolean.prototype.valueOf,Sm=Object.prototype.toString,Am=Function.prototype.toString,Pm=String.prototype.match,mh=String.prototype.slice,ri=String.prototype.replace,Mm=String.prototype.toUpperCase,Dl=String.prototype.toLowerCase,Uc=RegExp.prototype.test,Fl=Array.prototype.concat,Ae=Array.prototype.join,Im=Array.prototype.slice,Bl=Math.floor,co=typeof BigInt==\"function\"?BigInt.prototype.valueOf:null,la=Object.getOwnPropertySymbols,fo=typeof Symbol==\"function\"&&typeof Symbol.iterator==\"symbol\"?Symbol.prototype.toString:null,ar=typeof Symbol==\"function\"&&typeof Symbol.iterator==\"object\",kr=typeof Symbol==\"function\"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===ar||!0)?Symbol.toStringTag:null,kc=Object.prototype.propertyIsEnumerable,Ll=(typeof Reflect==\"function\"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Ol(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Uc.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r==\"number\"){var i=r<0?-Bl(-r):Bl(r);if(i!==r){var s=String(i),n=mh.call(t,s.length+1);return ri.call(s,e,\"$&_\")+\".\"+ri.call(ri.call(n,/([0-9]{3})/g,\"$&_\"),/_$/,\"\")}}return ri.call(t,e,\"$&_\")}var po=bm,Nl=po.custom,Ul=Hc(Nl)?Nl:null,Gc={__proto__:null,double:'\"',single:\"'\"},Rm={__proto__:null,double:/([\"\\\\])/g,single:/(['\\\\])/g},$n=function r(t,e,i,s){var n=e||{};if(Oe(n,\"quoteStyle\")&&!Oe(Gc,n.quoteStyle))throw new TypeError('option \"quoteStyle\" must be \"single\" or \"double\"');if(Oe(n,\"maxStringLength\")&&(typeof n.maxStringLength==\"number\"?n.maxStringLength<0&&n.maxStringLength!==1/0:n.maxStringLength!==null))throw new TypeError('option \"maxStringLength\", if provided, must be a positive integer, Infinity, or `null`');var a=Oe(n,\"customInspect\")?n.customInspect:!0;if(typeof a!=\"boolean\"&&a!==\"symbol\")throw new TypeError(\"option \\\"customInspect\\\", if provided, must be `true`, `false`, or `'symbol'`\");if(Oe(n,\"indent\")&&n.indent!==null&&n.indent!==\"\t\"&&!(parseInt(n.indent,10)===n.indent&&n.indent>0))throw new TypeError('option \"indent\" must be \"\\\\t\", an integer > 0, or `null`');if(Oe(n,\"numericSeparator\")&&typeof n.numericSeparator!=\"boolean\")throw new TypeError('option \"numericSeparator\", if provided, must be `true` or `false`');var o=n.numericSeparator;if(typeof t>\"u\")return\"undefined\";if(t===null)return\"null\";if(typeof t==\"boolean\")return t?\"true\":\"false\";if(typeof t==\"string\")return $c(t,n);if(typeof t==\"number\"){if(t===0)return 1/0/t>0?\"0\":\"-0\";var h=String(t);return o?Ol(t,h):h}if(typeof t==\"bigint\"){var l=String(t)+\"n\";return o?Ol(t,l):l}var u=typeof n.depth>\"u\"?5:n.depth;if(typeof i>\"u\"&&(i=0),i>=u&&u>0&&typeof t==\"object\")return mo(t)?\"[Array]\":\"[Object]\";var c=qm(n,i);if(typeof s>\"u\")s=[];else if(Xc(s,t)>=0)return\"[Circular]\";function d(C,A,$){if(A&&(s=Im.call(s),s.push(A)),$){var q={depth:n.depth};return Oe(n,\"quoteStyle\")&&(q.quoteStyle=n.quoteStyle),r(C,q,i+1,s)}return r(C,n,i+1,s)}if(typeof t==\"function\"&&!kl(t)){var f=Gm(t),p=Ps(t,d);return\"[Function\"+(f?\": \"+f:\" (anonymous)\")+\"]\"+(p.length>0?\" { \"+Ae.call(p,\", \")+\" }\":\"\")}if(Hc(t)){var m=ar?ri.call(String(t),/^(Symbol\\(.*\\))_[^)]*$/,\"$1\"):fo.call(t);return typeof t==\"object\"&&!ar?_r(m):m}if(Wm(t)){for(var g=\"<\"+Dl.call(String(t.nodeName)),y=t.attributes||[],x=0;x<y.length;x++)g+=\" \"+y[x].name+\"=\"+Vc(Dm(y[x].value),\"double\",n);return g+=\">\",t.childNodes&&t.childNodes.length&&(g+=\"...\"),g+=\"</\"+Dl.call(String(t.nodeName))+\">\",g}if(mo(t)){if(t.length===0)return\"[]\";var _=Ps(t,d);return c&&!Ym(_)?\"[\"+go(_,c)+\"]\":\"[ \"+Ae.call(_,\", \")+\" ]\"}if(Bm(t)){var v=Ps(t,d);return!(\"cause\"in Error.prototype)&&\"cause\"in t&&!kc.call(t,\"cause\")?\"{ [\"+String(t)+\"] \"+Ae.call(Fl.call(\"[cause]: \"+d(t.cause),v),\", \")+\" }\":v.length===0?\"[\"+String(t)+\"]\":\"{ [\"+String(t)+\"] \"+Ae.call(v,\", \")+\" }\"}if(typeof t==\"object\"&&a){if(Ul&&typeof t[Ul]==\"function\"&&po)return po(t,{depth:u-i});if(a!==\"symbol\"&&typeof t.inspect==\"function\")return t.inspect()}if(Vm(t)){var T=[];return Ml&&Ml.call(t,function(C,A){T.push(d(A,t,!0)+\" => \"+d(C,t))}),Gl(\"Map\",yn.call(t),T,c)}if($m(t)){var S=[];return Il&&Il.call(t,function(C){S.push(d(C,t))}),Gl(\"Set\",vn.call(t),S,c)}if(Hm(t))return ua(\"WeakMap\");if(zm(t))return ua(\"WeakSet\");if(Xm(t))return ua(\"WeakRef\");if(Om(t))return _r(d(Number(t)));if(Um(t))return _r(d(co.call(t)));if(Nm(t))return _r(Cm.call(t));if(Lm(t))return _r(d(String(t)));if(typeof window<\"u\"&&t===window)return\"{ [object Window] }\";if(typeof globalThis<\"u\"&&t===globalThis||typeof Or<\"u\"&&t===Or)return\"{ [object globalThis] }\";if(!Fm(t)&&!kl(t)){var w=Ps(t,d),b=Ll?Ll(t)===Object.prototype:t instanceof Object||t.constructor===Object,R=t instanceof Object?\"\":\"null prototype\",L=!b&&kr&&Object(t)===t&&kr in t?mh.call(ci(t),8,-1):R?\"Object\":\"\",I=b||typeof t.constructor!=\"function\"?\"\":t.constructor.name?t.constructor.name+\" \":\"\",D=I+(L||R?\"[\"+Ae.call(Fl.call([],L||[],R||[]),\": \")+\"] \":\"\");return w.length===0?D+\"{}\":c?D+\"{\"+go(w,c)+\"}\":D+\"{ \"+Ae.call(w,\", \")+\" }\"}return String(t)};function Vc(r,t,e){var i=e.quoteStyle||t,s=Gc[i];return s+r+s}function Dm(r){return ri.call(String(r),/\"/g,\"&quot;\")}function Fi(r){return!kr||!(typeof r==\"object\"&&(kr in r||typeof r[kr]<\"u\"))}function mo(r){return ci(r)===\"[object Array]\"&&Fi(r)}function Fm(r){return ci(r)===\"[object Date]\"&&Fi(r)}function kl(r){return ci(r)===\"[object RegExp]\"&&Fi(r)}function Bm(r){return ci(r)===\"[object Error]\"&&Fi(r)}function Lm(r){return ci(r)===\"[object String]\"&&Fi(r)}function Om(r){return ci(r)===\"[object Number]\"&&Fi(r)}function Nm(r){return ci(r)===\"[object Boolean]\"&&Fi(r)}function Hc(r){if(ar)return r&&typeof r==\"object\"&&r instanceof Symbol;if(typeof r==\"symbol\")return!0;if(!r||typeof r!=\"object\"||!fo)return!1;try{return fo.call(r),!0}catch{}return!1}function Um(r){if(!r||typeof r!=\"object\"||!co)return!1;try{return co.call(r),!0}catch{}return!1}var km=Object.prototype.hasOwnProperty||function(r){return r in this};function Oe(r,t){return km.call(r,t)}function ci(r){return Sm.call(r)}function Gm(r){if(r.name)return r.name;var t=Pm.call(Am.call(r),/^function\\s*([\\w$]+)/);return t?t[1]:null}function Xc(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e;return-1}function Vm(r){if(!yn||!r||typeof r!=\"object\")return!1;try{yn.call(r);try{vn.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function Hm(r){if(!Nr||!r||typeof r!=\"object\")return!1;try{Nr.call(r,Nr);try{Ur.call(r,Ur)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function Xm(r){if(!Rl||!r||typeof r!=\"object\")return!1;try{return Rl.call(r),!0}catch{}return!1}function $m(r){if(!vn||!r||typeof r!=\"object\")return!1;try{vn.call(r);try{yn.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function zm(r){if(!Ur||!r||typeof r!=\"object\")return!1;try{Ur.call(r,Ur);try{Nr.call(r,Nr)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function Wm(r){return!r||typeof r!=\"object\"?!1:typeof HTMLElement<\"u\"&&r instanceof HTMLElement?!0:typeof r.nodeName==\"string\"&&typeof r.getAttribute==\"function\"}function $c(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,i=\"... \"+e+\" more character\"+(e>1?\"s\":\"\");return $c(mh.call(r,0,t.maxStringLength),t)+i}var s=Rm[t.quoteStyle||\"single\"];s.lastIndex=0;var n=ri.call(ri.call(r,s,\"\\\\$1\"),/[\\x00-\\x1f]/g,jm);return Vc(n,\"single\",t)}function jm(r){var t=r.charCodeAt(0),e={8:\"b\",9:\"t\",10:\"n\",12:\"f\",13:\"r\"}[t];return e?\"\\\\\"+e:\"\\\\x\"+(t<16?\"0\":\"\")+Mm.call(t.toString(16))}function _r(r){return\"Object(\"+r+\")\"}function ua(r){return r+\" { ? }\"}function Gl(r,t,e,i){var s=i?go(e,i):Ae.call(e,\", \");return r+\" (\"+t+\") {\"+s+\"}\"}function Ym(r){for(var t=0;t<r.length;t++)if(Xc(r[t],`\n`)>=0)return!1;return!0}function qm(r,t){var e;if(r.indent===\"\t\")e=\"\t\";else if(typeof r.indent==\"number\"&&r.indent>0)e=Ae.call(Array(r.indent+1),\" \");else return null;return{base:e,prev:Ae.call(Array(t+1),e)}}function go(r,t){if(r.length===0)return\"\";var e=`\n`+t.prev+t.base;return e+Ae.call(r,\",\"+e)+`\n`+t.prev}function Ps(r,t){var e=mo(r),i=[];if(e){i.length=r.length;for(var s=0;s<r.length;s++)i[s]=Oe(r,s)?t(r[s],r):\"\"}var n=typeof la==\"function\"?la(r):[],a;if(ar){a={};for(var o=0;o<n.length;o++)a[\"$\"+n[o]]=n[o]}for(var h in r)Oe(r,h)&&(e&&String(Number(h))===h&&h<r.length||ar&&a[\"$\"+h]instanceof Symbol||(Uc.call(/[^\\w$]/,h)?i.push(t(h,r)+\": \"+t(r[h],r)):i.push(h+\": \"+t(r[h],r))));if(typeof la==\"function\")for(var l=0;l<n.length;l++)kc.call(r,n[l])&&i.push(\"[\"+t(n[l])+\"]: \"+t(r[n[l]],r));return i}var Km=$n,Zm=cr,zn=function(r,t,e){for(var i=r,s;(s=i.next)!=null;i=s)if(s.key===t)return i.next=s.next,e||(s.next=r.next,r.next=s),s},Jm=function(r,t){if(r){var e=zn(r,t);return e&&e.value}},Qm=function(r,t,e){var i=zn(r,t);i?i.value=e:r.next={key:t,next:r.next,value:e}},tg=function(r,t){return r?!!zn(r,t):!1},eg=function(r,t){if(r)return zn(r,t,!0)},ig=function(){var t,e={assert:function(i){if(!e.has(i))throw new Zm(\"Side channel does not contain \"+Km(i))},delete:function(i){var s=t&&t.next,n=eg(t,i);return n&&s&&s===n&&(t=void 0),!!n},get:function(i){return Jm(t,i)},has:function(i){return tg(t,i)},set:function(i,s){t||(t={next:void 0}),Qm(t,i,s)}};return e},zc=Object,rg=Error,sg=EvalError,ng=RangeError,ag=ReferenceError,og=SyntaxError,hg=URIError,lg=Math.abs,ug=Math.floor,cg=Math.max,dg=Math.min,fg=Math.pow,pg=Math.round,mg=Number.isNaN||function(t){return t!==t},gg=mg,_g=function(t){return gg(t)||t===0?t:t<0?-1:1},yg=Object.getOwnPropertyDescriptor,Js=yg;if(Js)try{Js([],\"length\")}catch{Js=null}var Wc=Js,Qs=Object.defineProperty||!1;if(Qs)try{Qs({},\"a\",{value:1})}catch{Qs=!1}var vg=Qs,ca,Vl;function xg(){return Vl||(Vl=1,ca=function(){if(typeof Symbol!=\"function\"||typeof Object.getOwnPropertySymbols!=\"function\")return!1;if(typeof Symbol.iterator==\"symbol\")return!0;var t={},e=Symbol(\"test\"),i=Object(e);if(typeof e==\"string\"||Object.prototype.toString.call(e)!==\"[object Symbol]\"||Object.prototype.toString.call(i)!==\"[object Symbol]\")return!1;var s=42;t[e]=s;for(var n in t)return!1;if(typeof Object.keys==\"function\"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames==\"function\"&&Object.getOwnPropertyNames(t).length!==0)return!1;var a=Object.getOwnPropertySymbols(t);if(a.length!==1||a[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor==\"function\"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==s||o.enumerable!==!0)return!1}return!0}),ca}var da,Hl;function bg(){if(Hl)return da;Hl=1;var r=typeof Symbol<\"u\"&&Symbol,t=xg();return da=function(){return typeof r!=\"function\"||typeof Symbol!=\"function\"||typeof r(\"foo\")!=\"symbol\"||typeof Symbol(\"bar\")!=\"symbol\"?!1:t()},da}var fa,Xl;function jc(){return Xl||(Xl=1,fa=typeof Reflect<\"u\"&&Reflect.getPrototypeOf||null),fa}var pa,$l;function Yc(){if($l)return pa;$l=1;var r=zc;return pa=r.getPrototypeOf||null,pa}var ma,zl;function Tg(){if(zl)return ma;zl=1;var r=\"Function.prototype.bind called on incompatible \",t=Object.prototype.toString,e=Math.max,i=\"[object Function]\",s=function(h,l){for(var u=[],c=0;c<h.length;c+=1)u[c]=h[c];for(var d=0;d<l.length;d+=1)u[d+h.length]=l[d];return u},n=function(h,l){for(var u=[],c=l,d=0;c<h.length;c+=1,d+=1)u[d]=h[c];return u},a=function(o,h){for(var l=\"\",u=0;u<o.length;u+=1)l+=o[u],u+1<o.length&&(l+=h);return l};return ma=function(h){var l=this;if(typeof l!=\"function\"||t.apply(l)!==i)throw new TypeError(r+l);for(var u=n(arguments,1),c,d=function(){if(this instanceof c){var y=l.apply(this,s(u,arguments));return Object(y)===y?y:this}return l.apply(h,s(u,arguments))},f=e(0,l.length-u.length),p=[],m=0;m<f;m++)p[m]=\"$\"+m;if(c=Function(\"binder\",\"return function (\"+a(p,\",\")+\"){ return binder.apply(this,arguments); }\")(d),l.prototype){var g=function(){};g.prototype=l.prototype,c.prototype=new g,g.prototype=null}return c},ma}var ga,Wl;function Wn(){if(Wl)return ga;Wl=1;var r=Tg();return ga=Function.prototype.bind||r,ga}var _a,jl;function gh(){return jl||(jl=1,_a=Function.prototype.call),_a}var ya,Yl;function qc(){return Yl||(Yl=1,ya=Function.prototype.apply),ya}var wg=typeof Reflect<\"u\"&&Reflect&&Reflect.apply,Eg=Wn(),Cg=qc(),Sg=gh(),Ag=wg,Pg=Ag||Eg.call(Sg,Cg),Mg=Wn(),Ig=cr,Rg=gh(),Dg=Pg,Kc=function(t){if(t.length<1||typeof t[0]!=\"function\")throw new Ig(\"a function is required\");return Dg(Mg,Rg,t)},va,ql;function Fg(){if(ql)return va;ql=1;var r=Kc,t=Wc,e;try{e=[].__proto__===Array.prototype}catch(a){if(!a||typeof a!=\"object\"||!(\"code\"in a)||a.code!==\"ERR_PROTO_ACCESS\")throw a}var i=!!e&&t&&t(Object.prototype,\"__proto__\"),s=Object,n=s.getPrototypeOf;return va=i&&typeof i.get==\"function\"?r([i.get]):typeof n==\"function\"?function(o){return n(o==null?o:s(o))}:!1,va}var xa,Kl;function Bg(){if(Kl)return xa;Kl=1;var r=jc(),t=Yc(),e=Fg();return xa=r?function(s){return r(s)}:t?function(s){if(!s||typeof s!=\"object\"&&typeof s!=\"function\")throw new TypeError(\"getProto: not an object\");return t(s)}:e?function(s){return e(s)}:null,xa}var ba,Zl;function Lg(){if(Zl)return ba;Zl=1;var r=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=Wn();return ba=e.call(r,t),ba}var K,Og=zc,Ng=rg,Ug=sg,kg=ng,Gg=ag,or=og,Qi=cr,Vg=hg,Hg=lg,Xg=ug,$g=cg,zg=dg,Wg=fg,jg=pg,Yg=_g,Zc=Function,Ta=function(r){try{return Zc('\"use strict\"; return ('+r+\").constructor;\")()}catch{}},jr=Wc,qg=vg,wa=function(){throw new Qi},Kg=jr?function(){try{return arguments.callee,wa}catch{try{return jr(arguments,\"callee\").get}catch{return wa}}}():wa,Ni=bg()(),St=Bg(),Zg=Yc(),Jg=jc(),Jc=qc(),us=gh(),Xi={},Qg=typeof Uint8Array>\"u\"||!St?K:St(Uint8Array),Pi={__proto__:null,\"%AggregateError%\":typeof AggregateError>\"u\"?K:AggregateError,\"%Array%\":Array,\"%ArrayBuffer%\":typeof ArrayBuffer>\"u\"?K:ArrayBuffer,\"%ArrayIteratorPrototype%\":Ni&&St?St([][Symbol.iterator]()):K,\"%AsyncFromSyncIteratorPrototype%\":K,\"%AsyncFunction%\":Xi,\"%AsyncGenerator%\":Xi,\"%AsyncGeneratorFunction%\":Xi,\"%AsyncIteratorPrototype%\":Xi,\"%Atomics%\":typeof Atomics>\"u\"?K:Atomics,\"%BigInt%\":typeof BigInt>\"u\"?K:BigInt,\"%BigInt64Array%\":typeof BigInt64Array>\"u\"?K:BigInt64Array,\"%BigUint64Array%\":typeof BigUint64Array>\"u\"?K:BigUint64Array,\"%Boolean%\":Boolean,\"%DataView%\":typeof DataView>\"u\"?K:DataView,\"%Date%\":Date,\"%decodeURI%\":decodeURI,\"%decodeURIComponent%\":decodeURIComponent,\"%encodeURI%\":encodeURI,\"%encodeURIComponent%\":encodeURIComponent,\"%Error%\":Ng,\"%eval%\":eval,\"%EvalError%\":Ug,\"%Float16Array%\":typeof Float16Array>\"u\"?K:Float16Array,\"%Float32Array%\":typeof Float32Array>\"u\"?K:Float32Array,\"%Float64Array%\":typeof Float64Array>\"u\"?K:Float64Array,\"%FinalizationRegistry%\":typeof FinalizationRegistry>\"u\"?K:FinalizationRegistry,\"%Function%\":Zc,\"%GeneratorFunction%\":Xi,\"%Int8Array%\":typeof Int8Array>\"u\"?K:Int8Array,\"%Int16Array%\":typeof Int16Array>\"u\"?K:Int16Array,\"%Int32Array%\":typeof Int32Array>\"u\"?K:Int32Array,\"%isFinite%\":isFinite,\"%isNaN%\":isNaN,\"%IteratorPrototype%\":Ni&&St?St(St([][Symbol.iterator]())):K,\"%JSON%\":typeof JSON==\"object\"?JSON:K,\"%Map%\":typeof Map>\"u\"?K:Map,\"%MapIteratorPrototype%\":typeof Map>\"u\"||!Ni||!St?K:St(new Map()[Symbol.iterator]()),\"%Math%\":Math,\"%Number%\":Number,\"%Object%\":Og,\"%Object.getOwnPropertyDescriptor%\":jr,\"%parseFloat%\":parseFloat,\"%parseInt%\":parseInt,\"%Promise%\":typeof Promise>\"u\"?K:Promise,\"%Proxy%\":typeof Proxy>\"u\"?K:Proxy,\"%RangeError%\":kg,\"%ReferenceError%\":Gg,\"%Reflect%\":typeof Reflect>\"u\"?K:Reflect,\"%RegExp%\":RegExp,\"%Set%\":typeof Set>\"u\"?K:Set,\"%SetIteratorPrototype%\":typeof Set>\"u\"||!Ni||!St?K:St(new Set()[Symbol.iterator]()),\"%SharedArrayBuffer%\":typeof SharedArrayBuffer>\"u\"?K:SharedArrayBuffer,\"%String%\":String,\"%StringIteratorPrototype%\":Ni&&St?St(\"\"[Symbol.iterator]()):K,\"%Symbol%\":Ni?Symbol:K,\"%SyntaxError%\":or,\"%ThrowTypeError%\":Kg,\"%TypedArray%\":Qg,\"%TypeError%\":Qi,\"%Uint8Array%\":typeof Uint8Array>\"u\"?K:Uint8Array,\"%Uint8ClampedArray%\":typeof Uint8ClampedArray>\"u\"?K:Uint8ClampedArray,\"%Uint16Array%\":typeof Uint16Array>\"u\"?K:Uint16Array,\"%Uint32Array%\":typeof Uint32Array>\"u\"?K:Uint32Array,\"%URIError%\":Vg,\"%WeakMap%\":typeof WeakMap>\"u\"?K:WeakMap,\"%WeakRef%\":typeof WeakRef>\"u\"?K:WeakRef,\"%WeakSet%\":typeof WeakSet>\"u\"?K:WeakSet,\"%Function.prototype.call%\":us,\"%Function.prototype.apply%\":Jc,\"%Object.defineProperty%\":qg,\"%Object.getPrototypeOf%\":Zg,\"%Math.abs%\":Hg,\"%Math.floor%\":Xg,\"%Math.max%\":$g,\"%Math.min%\":zg,\"%Math.pow%\":Wg,\"%Math.round%\":jg,\"%Math.sign%\":Yg,\"%Reflect.getPrototypeOf%\":Jg};if(St)try{null.error}catch(r){var t_=St(St(r));Pi[\"%Error.prototype%\"]=t_}var e_=function r(t){var e;if(t===\"%AsyncFunction%\")e=Ta(\"async function () {}\");else if(t===\"%GeneratorFunction%\")e=Ta(\"function* () {}\");else if(t===\"%AsyncGeneratorFunction%\")e=Ta(\"async function* () {}\");else if(t===\"%AsyncGenerator%\"){var i=r(\"%AsyncGeneratorFunction%\");i&&(e=i.prototype)}else if(t===\"%AsyncIteratorPrototype%\"){var s=r(\"%AsyncGenerator%\");s&&St&&(e=St(s.prototype))}return Pi[t]=e,e},Jl={__proto__:null,\"%ArrayBufferPrototype%\":[\"ArrayBuffer\",\"prototype\"],\"%ArrayPrototype%\":[\"Array\",\"prototype\"],\"%ArrayProto_entries%\":[\"Array\",\"prototype\",\"entries\"],\"%ArrayProto_forEach%\":[\"Array\",\"prototype\",\"forEach\"],\"%ArrayProto_keys%\":[\"Array\",\"prototype\",\"keys\"],\"%ArrayProto_values%\":[\"Array\",\"prototype\",\"values\"],\"%AsyncFunctionPrototype%\":[\"AsyncFunction\",\"prototype\"],\"%AsyncGenerator%\":[\"AsyncGeneratorFunction\",\"prototype\"],\"%AsyncGeneratorPrototype%\":[\"AsyncGeneratorFunction\",\"prototype\",\"prototype\"],\"%BooleanPrototype%\":[\"Boolean\",\"prototype\"],\"%DataViewPrototype%\":[\"DataView\",\"prototype\"],\"%DatePrototype%\":[\"Date\",\"prototype\"],\"%ErrorPrototype%\":[\"Error\",\"prototype\"],\"%EvalErrorPrototype%\":[\"EvalError\",\"prototype\"],\"%Float32ArrayPrototype%\":[\"Float32Array\",\"prototype\"],\"%Float64ArrayPrototype%\":[\"Float64Array\",\"prototype\"],\"%FunctionPrototype%\":[\"Function\",\"prototype\"],\"%Generator%\":[\"GeneratorFunction\",\"prototype\"],\"%GeneratorPrototype%\":[\"GeneratorFunction\",\"prototype\",\"prototype\"],\"%Int8ArrayPrototype%\":[\"Int8Array\",\"prototype\"],\"%Int16ArrayPrototype%\":[\"Int16Array\",\"prototype\"],\"%Int32ArrayPrototype%\":[\"Int32Array\",\"prototype\"],\"%JSONParse%\":[\"JSON\",\"parse\"],\"%JSONStringify%\":[\"JSON\",\"stringify\"],\"%MapPrototype%\":[\"Map\",\"prototype\"],\"%NumberPrototype%\":[\"Number\",\"prototype\"],\"%ObjectPrototype%\":[\"Object\",\"prototype\"],\"%ObjProto_toString%\":[\"Object\",\"prototype\",\"toString\"],\"%ObjProto_valueOf%\":[\"Object\",\"prototype\",\"valueOf\"],\"%PromisePrototype%\":[\"Promise\",\"prototype\"],\"%PromiseProto_then%\":[\"Promise\",\"prototype\",\"then\"],\"%Promise_all%\":[\"Promise\",\"all\"],\"%Promise_reject%\":[\"Promise\",\"reject\"],\"%Promise_resolve%\":[\"Promise\",\"resolve\"],\"%RangeErrorPrototype%\":[\"RangeError\",\"prototype\"],\"%ReferenceErrorPrototype%\":[\"ReferenceError\",\"prototype\"],\"%RegExpPrototype%\":[\"RegExp\",\"prototype\"],\"%SetPrototype%\":[\"Set\",\"prototype\"],\"%SharedArrayBufferPrototype%\":[\"SharedArrayBuffer\",\"prototype\"],\"%StringPrototype%\":[\"String\",\"prototype\"],\"%SymbolPrototype%\":[\"Symbol\",\"prototype\"],\"%SyntaxErrorPrototype%\":[\"SyntaxError\",\"prototype\"],\"%TypedArrayPrototype%\":[\"TypedArray\",\"prototype\"],\"%TypeErrorPrototype%\":[\"TypeError\",\"prototype\"],\"%Uint8ArrayPrototype%\":[\"Uint8Array\",\"prototype\"],\"%Uint8ClampedArrayPrototype%\":[\"Uint8ClampedArray\",\"prototype\"],\"%Uint16ArrayPrototype%\":[\"Uint16Array\",\"prototype\"],\"%Uint32ArrayPrototype%\":[\"Uint32Array\",\"prototype\"],\"%URIErrorPrototype%\":[\"URIError\",\"prototype\"],\"%WeakMapPrototype%\":[\"WeakMap\",\"prototype\"],\"%WeakSetPrototype%\":[\"WeakSet\",\"prototype\"]},cs=Wn(),xn=Lg(),i_=cs.call(us,Array.prototype.concat),r_=cs.call(Jc,Array.prototype.splice),Ql=cs.call(us,String.prototype.replace),bn=cs.call(us,String.prototype.slice),s_=cs.call(us,RegExp.prototype.exec),n_=/[^%.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|%$))/g,a_=/\\\\(\\\\)?/g,o_=function(t){var e=bn(t,0,1),i=bn(t,-1);if(e===\"%\"&&i!==\"%\")throw new or(\"invalid intrinsic syntax, expected closing `%`\");if(i===\"%\"&&e!==\"%\")throw new or(\"invalid intrinsic syntax, expected opening `%`\");var s=[];return Ql(t,n_,function(n,a,o,h){s[s.length]=o?Ql(h,a_,\"$1\"):a||n}),s},h_=function(t,e){var i=t,s;if(xn(Jl,i)&&(s=Jl[i],i=\"%\"+s[0]+\"%\"),xn(Pi,i)){var n=Pi[i];if(n===Xi&&(n=e_(i)),typeof n>\"u\"&&!e)throw new Qi(\"intrinsic \"+t+\" exists, but is not available. Please file an issue!\");return{alias:s,name:i,value:n}}throw new or(\"intrinsic \"+t+\" does not exist!\")},_h=function(t,e){if(typeof t!=\"string\"||t.length===0)throw new Qi(\"intrinsic name must be a non-empty string\");if(arguments.length>1&&typeof e!=\"boolean\")throw new Qi('\"allowMissing\" argument must be a boolean');if(s_(/^%?[^%]*%?$/,t)===null)throw new or(\"`%` may not be present anywhere but at the beginning and end of the intrinsic name\");var i=o_(t),s=i.length>0?i[0]:\"\",n=h_(\"%\"+s+\"%\",e),a=n.name,o=n.value,h=!1,l=n.alias;l&&(s=l[0],r_(i,i_([0,1],l)));for(var u=1,c=!0;u<i.length;u+=1){var d=i[u],f=bn(d,0,1),p=bn(d,-1);if((f==='\"'||f===\"'\"||f===\"`\"||p==='\"'||p===\"'\"||p===\"`\")&&f!==p)throw new or(\"property names with quotes must have matching quotes\");if((d===\"constructor\"||!c)&&(h=!0),s+=\".\"+d,a=\"%\"+s+\"%\",xn(Pi,a))o=Pi[a];else if(o!=null){if(!(d in o)){if(!e)throw new Qi(\"base intrinsic for \"+t+\" exists, but the property is not available.\");return}if(jr&&u+1>=i.length){var m=jr(o,d);c=!!m,c&&\"get\"in m&&!(\"originalValue\"in m.get)?o=m.get:o=o[d]}else c=xn(o,d),o=o[d];c&&!h&&(Pi[a]=o)}}return o},Qc=_h,td=Kc,l_=td([Qc(\"%String.prototype.indexOf%\")]),ed=function(t,e){var i=Qc(t,!!e);return typeof i==\"function\"&&l_(t,\".prototype.\")>-1?td([i]):i},u_=_h,ds=ed,c_=$n,d_=cr,tu=u_(\"%Map%\",!0),f_=ds(\"Map.prototype.get\",!0),p_=ds(\"Map.prototype.set\",!0),m_=ds(\"Map.prototype.has\",!0),g_=ds(\"Map.prototype.delete\",!0),__=ds(\"Map.prototype.size\",!0),id=!!tu&&function(){var t,e={assert:function(i){if(!e.has(i))throw new d_(\"Side channel does not contain \"+c_(i))},delete:function(i){if(t){var s=g_(t,i);return __(t)===0&&(t=void 0),s}return!1},get:function(i){if(t)return f_(t,i)},has:function(i){return t?m_(t,i):!1},set:function(i,s){t||(t=new tu),p_(t,i,s)}};return e},y_=_h,jn=ed,v_=$n,Ms=id,x_=cr,Ui=y_(\"%WeakMap%\",!0),b_=jn(\"WeakMap.prototype.get\",!0),T_=jn(\"WeakMap.prototype.set\",!0),w_=jn(\"WeakMap.prototype.has\",!0),E_=jn(\"WeakMap.prototype.delete\",!0),C_=Ui?function(){var t,e,i={assert:function(s){if(!i.has(s))throw new x_(\"Side channel does not contain \"+v_(s))},delete:function(s){if(Ui&&s&&(typeof s==\"object\"||typeof s==\"function\")){if(t)return E_(t,s)}else if(Ms&&e)return e.delete(s);return!1},get:function(s){return Ui&&s&&(typeof s==\"object\"||typeof s==\"function\")&&t?b_(t,s):e&&e.get(s)},has:function(s){return Ui&&s&&(typeof s==\"object\"||typeof s==\"function\")&&t?w_(t,s):!!e&&e.has(s)},set:function(s,n){Ui&&s&&(typeof s==\"object\"||typeof s==\"function\")?(t||(t=new Ui),T_(t,s,n)):Ms&&(e||(e=Ms()),e.set(s,n))}};return i}:Ms,S_=cr,A_=$n,P_=ig,M_=id,I_=C_,R_=I_||M_||P_,rd=function(){var t,e={assert:function(i){if(!e.has(i))throw new S_(\"Side channel does not contain \"+A_(i))},delete:function(i){return!!t&&t.delete(i)},get:function(i){return t&&t.get(i)},has:function(i){return!!t&&t.has(i)},set:function(i,s){t||(t=R_()),t.set(i,s)}};return e},D_=String.prototype.replace,F_=/%20/g,Ea={RFC1738:\"RFC1738\",RFC3986:\"RFC3986\"},yh={default:Ea.RFC3986,formatters:{RFC1738:function(r){return D_.call(r,F_,\"+\")},RFC3986:function(r){return String(r)}},RFC1738:Ea.RFC1738,RFC3986:Ea.RFC3986},B_=yh,L_=rd,Ca=Object.prototype.hasOwnProperty,Ei=Array.isArray,Yn=L_(),sd=function(t,e){return Yn.set(t,e),t},Tn=function(t){return Yn.has(t)},_o=function(t){return Yn.get(t)},nd=function(t,e){Yn.set(t,e)},ye=function(){for(var r=[],t=0;t<256;++t)r.push(\"%\"+((t<16?\"0\":\"\")+t.toString(16)).toUpperCase());return r}(),O_=function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(Ei(i)){for(var s=[],n=0;n<i.length;++n)typeof i[n]<\"u\"&&s.push(i[n]);e.obj[e.prop]=s}}},vh=function(t,e){for(var i=e&&e.plainObjects?{__proto__:null}:{},s=0;s<t.length;++s)typeof t[s]<\"u\"&&(i[s]=t[s]);return i},N_=function r(t,e,i){if(!e)return t;if(typeof e!=\"object\"&&typeof e!=\"function\"){if(Ei(t))t.push(e);else if(t&&typeof t==\"object\")if(Tn(t)){var s=_o(t)+1;t[s]=e,nd(t,s)}else(i&&(i.plainObjects||i.allowPrototypes)||!Ca.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!=\"object\"){if(Tn(e)){for(var n=Object.keys(e),a=i&&i.plainObjects?{__proto__:null,0:t}:{0:t},o=0;o<n.length;o++){var h=parseInt(n[o],10);a[h+1]=e[n[o]]}return sd(a,_o(e)+1)}return[t].concat(e)}var l=t;return Ei(t)&&!Ei(e)&&(l=vh(t,i)),Ei(t)&&Ei(e)?(e.forEach(function(u,c){if(Ca.call(t,c)){var d=t[c];d&&typeof d==\"object\"&&u&&typeof u==\"object\"?t[c]=r(d,u,i):t.push(u)}else t[c]=u}),t):Object.keys(e).reduce(function(u,c){var d=e[c];return Ca.call(u,c)?u[c]=r(u[c],d,i):u[c]=d,u},l)},U_=function(t,e){return Object.keys(e).reduce(function(i,s){return i[s]=e[s],i},t)},k_=function(r,t,e){var i=r.replace(/\\+/g,\" \");if(e===\"iso-8859-1\")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},Sa=1024,G_=function(t,e,i,s,n){if(t.length===0)return t;var a=t;if(typeof t==\"symbol\"?a=Symbol.prototype.toString.call(t):typeof t!=\"string\"&&(a=String(t)),i===\"iso-8859-1\")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(f){return\"%26%23\"+parseInt(f.slice(2),16)+\"%3B\"});for(var o=\"\",h=0;h<a.length;h+=Sa){for(var l=a.length>=Sa?a.slice(h,h+Sa):a,u=[],c=0;c<l.length;++c){var d=l.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||n===B_.RFC1738&&(d===40||d===41)){u[u.length]=l.charAt(c);continue}if(d<128){u[u.length]=ye[d];continue}if(d<2048){u[u.length]=ye[192|d>>6]+ye[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=ye[224|d>>12]+ye[128|d>>6&63]+ye[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|l.charCodeAt(c)&1023),u[u.length]=ye[240|d>>18]+ye[128|d>>12&63]+ye[128|d>>6&63]+ye[128|d&63]}o+=u.join(\"\")}return o},V_=function(t){for(var e=[{obj:{o:t},prop:\"o\"}],i=[],s=0;s<e.length;++s)for(var n=e[s],a=n.obj[n.prop],o=Object.keys(a),h=0;h<o.length;++h){var l=o[h],u=a[l];typeof u==\"object\"&&u!==null&&i.indexOf(u)===-1&&(e.push({obj:a,prop:l}),i.push(u))}return O_(e),t},H_=function(t){return Object.prototype.toString.call(t)===\"[object RegExp]\"},X_=function(t){return!t||typeof t!=\"object\"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},$_=function(t,e,i,s){if(Tn(t)){var n=_o(t)+1;return t[n]=e,nd(t,n),t}var a=[].concat(t,e);return a.length>i?sd(vh(a,{plainObjects:s}),a.length-1):a},z_=function(t,e){if(Ei(t)){for(var i=[],s=0;s<t.length;s+=1)i.push(e(t[s]));return i}return e(t)},ad={arrayToObject:vh,assign:U_,combine:$_,compact:V_,decode:k_,encode:G_,isBuffer:X_,isOverflow:Tn,isRegExp:H_,maybeMap:z_,merge:N_},od=rd,tn=ad,Gr=yh,W_=Object.prototype.hasOwnProperty,hd={brackets:function(t){return t+\"[]\"},comma:\"comma\",indices:function(t,e){return t+\"[\"+e+\"]\"},repeat:function(t){return t}},Se=Array.isArray,j_=Array.prototype.push,ld=function(r,t){j_.apply(r,Se(t)?t:[t])},Y_=Date.prototype.toISOString,eu=Gr.default,xt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:\"indices\",charset:\"utf-8\",charsetSentinel:!1,commaRoundTrip:!1,delimiter:\"&\",encode:!0,encodeDotInKeys:!1,encoder:tn.encode,encodeValuesOnly:!1,filter:void 0,format:eu,formatter:Gr.formatters[eu],indices:!1,serializeDate:function(t){return Y_.call(t)},skipNulls:!1,strictNullHandling:!1},q_=function(t){return typeof t==\"string\"||typeof t==\"number\"||typeof t==\"boolean\"||typeof t==\"symbol\"||typeof t==\"bigint\"},Aa={},K_=function r(t,e,i,s,n,a,o,h,l,u,c,d,f,p,m,g,y,x){for(var _=t,v=x,T=0,S=!1;(v=v.get(Aa))!==void 0&&!S;){var w=v.get(t);if(T+=1,typeof w<\"u\"){if(w===T)throw new RangeError(\"Cyclic object value\");S=!0}typeof v.get(Aa)>\"u\"&&(T=0)}if(typeof u==\"function\"?_=u(e,_):_ instanceof Date?_=f(_):i===\"comma\"&&Se(_)&&(_=tn.maybeMap(_,function(P){return P instanceof Date?f(P):P})),_===null){if(a)return l&&!g?l(e,xt.encoder,y,\"key\",p):e;_=\"\"}if(q_(_)||tn.isBuffer(_)){if(l){var b=g?e:l(e,xt.encoder,y,\"key\",p);return[m(b)+\"=\"+m(l(_,xt.encoder,y,\"value\",p))]}return[m(e)+\"=\"+m(String(_))]}var R=[];if(typeof _>\"u\")return R;var L;if(i===\"comma\"&&Se(_))g&&l&&(_=tn.maybeMap(_,l)),L=[{value:_.length>0?_.join(\",\")||null:void 0}];else if(Se(u))L=u;else{var I=Object.keys(_);L=c?I.sort(c):I}var D=h?String(e).replace(/\\./g,\"%2E\"):String(e),C=s&&Se(_)&&_.length===1?D+\"[]\":D;if(n&&Se(_)&&_.length===0)return C+\"[]\";for(var A=0;A<L.length;++A){var $=L[A],q=typeof $==\"object\"&&$&&typeof $.value<\"u\"?$.value:_[$];if(!(o&&q===null)){var U=d&&h?String($).replace(/\\./g,\"%2E\"):String($),nt=Se(_)?typeof i==\"function\"?i(C,U):C:C+(d?\".\"+U:\"[\"+U+\"]\");x.set(t,T);var at=od();at.set(Aa,x),ld(R,r(q,nt,i,s,n,a,o,h,i===\"comma\"&&g&&Se(_)?null:l,u,c,d,f,p,m,g,y,at))}}return R},Z_=function(t){if(!t)return xt;if(typeof t.allowEmptyArrays<\"u\"&&typeof t.allowEmptyArrays!=\"boolean\")throw new TypeError(\"`allowEmptyArrays` option can only be `true` or `false`, when provided\");if(typeof t.encodeDotInKeys<\"u\"&&typeof t.encodeDotInKeys!=\"boolean\")throw new TypeError(\"`encodeDotInKeys` option can only be `true` or `false`, when provided\");if(t.encoder!==null&&typeof t.encoder<\"u\"&&typeof t.encoder!=\"function\")throw new TypeError(\"Encoder has to be a function.\");var e=t.charset||xt.charset;if(typeof t.charset<\"u\"&&t.charset!==\"utf-8\"&&t.charset!==\"iso-8859-1\")throw new TypeError(\"The charset option must be either utf-8, iso-8859-1, or undefined\");var i=Gr.default;if(typeof t.format<\"u\"){if(!W_.call(Gr.formatters,t.format))throw new TypeError(\"Unknown format option provided.\");i=t.format}var s=Gr.formatters[i],n=xt.filter;(typeof t.filter==\"function\"||Se(t.filter))&&(n=t.filter);var a;if(t.arrayFormat in hd?a=t.arrayFormat:\"indices\"in t?a=t.indices?\"indices\":\"repeat\":a=xt.arrayFormat,\"commaRoundTrip\"in t&&typeof t.commaRoundTrip!=\"boolean\")throw new TypeError(\"`commaRoundTrip` must be a boolean, or absent\");var o=typeof t.allowDots>\"u\"?t.encodeDotInKeys===!0?!0:xt.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix==\"boolean\"?t.addQueryPrefix:xt.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof t.allowEmptyArrays==\"boolean\"?!!t.allowEmptyArrays:xt.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof t.charsetSentinel==\"boolean\"?t.charsetSentinel:xt.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>\"u\"?xt.delimiter:t.delimiter,encode:typeof t.encode==\"boolean\"?t.encode:xt.encode,encodeDotInKeys:typeof t.encodeDotInKeys==\"boolean\"?t.encodeDotInKeys:xt.encodeDotInKeys,encoder:typeof t.encoder==\"function\"?t.encoder:xt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly==\"boolean\"?t.encodeValuesOnly:xt.encodeValuesOnly,filter:n,format:i,formatter:s,serializeDate:typeof t.serializeDate==\"function\"?t.serializeDate:xt.serializeDate,skipNulls:typeof t.skipNulls==\"boolean\"?t.skipNulls:xt.skipNulls,sort:typeof t.sort==\"function\"?t.sort:null,strictNullHandling:typeof t.strictNullHandling==\"boolean\"?t.strictNullHandling:xt.strictNullHandling}},J_=function(r,t){var e=r,i=Z_(t),s,n;typeof i.filter==\"function\"?(n=i.filter,e=n(\"\",e)):Se(i.filter)&&(n=i.filter,s=n);var a=[];if(typeof e!=\"object\"||e===null)return\"\";var o=hd[i.arrayFormat],h=o===\"comma\"&&i.commaRoundTrip;s||(s=Object.keys(e)),i.sort&&s.sort(i.sort);for(var l=od(),u=0;u<s.length;++u){var c=s[u],d=e[c];i.skipNulls&&d===null||ld(a,K_(d,c,o,h,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,l))}var f=a.join(i.delimiter),p=i.addQueryPrefix===!0?\"?\":\"\";return i.charsetSentinel&&(i.charset===\"iso-8859-1\"?p+=\"utf8=%26%2310003%3B&\":p+=\"utf8=%E2%9C%93&\"),f.length>0?p+f:\"\"},ai=ad,en=Object.prototype.hasOwnProperty,iu=Array.isArray,ft={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:\"utf-8\",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:ai.decode,delimiter:\"&\",depth:5,duplicates:\"combine\",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},Q_=function(r){return r.replace(/&#(\\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},ud=function(r,t,e){if(r&&typeof r==\"string\"&&t.comma&&r.indexOf(\",\")>-1)return r.split(\",\");if(t.throwOnLimitExceeded&&e>=t.arrayLimit)throw new RangeError(\"Array limit exceeded. Only \"+t.arrayLimit+\" element\"+(t.arrayLimit===1?\"\":\"s\")+\" allowed in an array.\");return r},ty=\"utf8=%26%2310003%3B\",ey=\"utf8=%E2%9C%93\",iy=function(t,e){var i={__proto__:null},s=e.ignoreQueryPrefix?t.replace(/^\\?/,\"\"):t;s=s.replace(/%5B/gi,\"[\").replace(/%5D/gi,\"]\");var n=e.parameterLimit===1/0?void 0:e.parameterLimit,a=s.split(e.delimiter,e.throwOnLimitExceeded?n+1:n);if(e.throwOnLimitExceeded&&a.length>n)throw new RangeError(\"Parameter limit exceeded. Only \"+n+\" parameter\"+(n===1?\"\":\"s\")+\" allowed.\");var o=-1,h,l=e.charset;if(e.charsetSentinel)for(h=0;h<a.length;++h)a[h].indexOf(\"utf8=\")===0&&(a[h]===ey?l=\"utf-8\":a[h]===ty&&(l=\"iso-8859-1\"),o=h,h=a.length);for(h=0;h<a.length;++h)if(h!==o){var u=a[h],c=u.indexOf(\"]=\"),d=c===-1?u.indexOf(\"=\"):c+1,f,p;if(d===-1?(f=e.decoder(u,ft.decoder,l,\"key\"),p=e.strictNullHandling?null:\"\"):(f=e.decoder(u.slice(0,d),ft.decoder,l,\"key\"),f!==null&&(p=ai.maybeMap(ud(u.slice(d+1),e,iu(i[f])?i[f].length:0),function(g){return e.decoder(g,ft.decoder,l,\"value\")}))),p&&e.interpretNumericEntities&&l===\"iso-8859-1\"&&(p=Q_(String(p))),u.indexOf(\"[]=\")>-1&&(p=iu(p)?[p]:p),f!==null){var m=en.call(i,f);m&&e.duplicates===\"combine\"?i[f]=ai.combine(i[f],p,e.arrayLimit,e.plainObjects):(!m||e.duplicates===\"last\")&&(i[f]=p)}}return i},ry=function(r,t,e,i){var s=0;if(r.length>0&&r[r.length-1]===\"[]\"){var n=r.slice(0,-1).join(\"\");s=Array.isArray(t)&&t[n]?t[n].length:0}for(var a=i?t:ud(t,e,s),o=r.length-1;o>=0;--o){var h,l=r[o];if(l===\"[]\"&&e.parseArrays)ai.isOverflow(a)?h=a:h=e.allowEmptyArrays&&(a===\"\"||e.strictNullHandling&&a===null)?[]:ai.combine([],a,e.arrayLimit,e.plainObjects);else{h=e.plainObjects?{__proto__:null}:{};var u=l.charAt(0)===\"[\"&&l.charAt(l.length-1)===\"]\"?l.slice(1,-1):l,c=e.decodeDotInKeys?u.replace(/%2E/g,\".\"):u,d=parseInt(c,10);!e.parseArrays&&c===\"\"?h={0:a}:!isNaN(d)&&l!==c&&String(d)===c&&d>=0&&e.parseArrays&&d<=e.arrayLimit?(h=[],h[d]=a):c!==\"__proto__\"&&(h[c]=a)}a=h}return a},sy=function(t,e){var i=e.allowDots?t.replace(/\\.([^.[]+)/g,\"[$1]\"):t;if(e.depth<=0)return!e.plainObjects&&en.call(Object.prototype,i)&&!e.allowPrototypes?void 0:[i];var s=/(\\[[^[\\]]*])/,n=/(\\[[^[\\]]*])/g,a=s.exec(i),o=a?i.slice(0,a.index):i,h=[];if(o){if(!e.plainObjects&&en.call(Object.prototype,o)&&!e.allowPrototypes)return;h.push(o)}for(var l=0;(a=n.exec(i))!==null&&l<e.depth;){l+=1;var u=a[1].slice(1,-1);if(!e.plainObjects&&en.call(Object.prototype,u)&&!e.allowPrototypes)return;h.push(a[1])}if(a){if(e.strictDepth===!0)throw new RangeError(\"Input depth exceeded depth option of \"+e.depth+\" and strictDepth is true\");h.push(\"[\"+i.slice(a.index)+\"]\")}return h},ny=function(t,e,i,s){if(t){var n=sy(t,i);if(n)return ry(n,e,i,s)}},ay=function(t){if(!t)return ft;if(typeof t.allowEmptyArrays<\"u\"&&typeof t.allowEmptyArrays!=\"boolean\")throw new TypeError(\"`allowEmptyArrays` option can only be `true` or `false`, when provided\");if(typeof t.decodeDotInKeys<\"u\"&&typeof t.decodeDotInKeys!=\"boolean\")throw new TypeError(\"`decodeDotInKeys` option can only be `true` or `false`, when provided\");if(t.decoder!==null&&typeof t.decoder<\"u\"&&typeof t.decoder!=\"function\")throw new TypeError(\"Decoder has to be a function.\");if(typeof t.charset<\"u\"&&t.charset!==\"utf-8\"&&t.charset!==\"iso-8859-1\")throw new TypeError(\"The charset option must be either utf-8, iso-8859-1, or undefined\");if(typeof t.throwOnLimitExceeded<\"u\"&&typeof t.throwOnLimitExceeded!=\"boolean\")throw new TypeError(\"`throwOnLimitExceeded` option must be a boolean\");var e=typeof t.charset>\"u\"?ft.charset:t.charset,i=typeof t.duplicates>\"u\"?ft.duplicates:t.duplicates;if(i!==\"combine\"&&i!==\"first\"&&i!==\"last\")throw new TypeError(\"The duplicates option must be either combine, first, or last\");var s=typeof t.allowDots>\"u\"?t.decodeDotInKeys===!0?!0:ft.allowDots:!!t.allowDots;return{allowDots:s,allowEmptyArrays:typeof t.allowEmptyArrays==\"boolean\"?!!t.allowEmptyArrays:ft.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes==\"boolean\"?t.allowPrototypes:ft.allowPrototypes,allowSparse:typeof t.allowSparse==\"boolean\"?t.allowSparse:ft.allowSparse,arrayLimit:typeof t.arrayLimit==\"number\"?t.arrayLimit:ft.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel==\"boolean\"?t.charsetSentinel:ft.charsetSentinel,comma:typeof t.comma==\"boolean\"?t.comma:ft.comma,decodeDotInKeys:typeof t.decodeDotInKeys==\"boolean\"?t.decodeDotInKeys:ft.decodeDotInKeys,decoder:typeof t.decoder==\"function\"?t.decoder:ft.decoder,delimiter:typeof t.delimiter==\"string\"||ai.isRegExp(t.delimiter)?t.delimiter:ft.delimiter,depth:typeof t.depth==\"number\"||t.depth===!1?+t.depth:ft.depth,duplicates:i,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities==\"boolean\"?t.interpretNumericEntities:ft.interpretNumericEntities,parameterLimit:typeof t.parameterLimit==\"number\"?t.parameterLimit:ft.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects==\"boolean\"?t.plainObjects:ft.plainObjects,strictDepth:typeof t.strictDepth==\"boolean\"?!!t.strictDepth:ft.strictDepth,strictNullHandling:typeof t.strictNullHandling==\"boolean\"?t.strictNullHandling:ft.strictNullHandling,throwOnLimitExceeded:typeof t.throwOnLimitExceeded==\"boolean\"?t.throwOnLimitExceeded:!1}},oy=function(r,t){var e=ay(t);if(r===\"\"||r===null||typeof r>\"u\")return e.plainObjects?{__proto__:null}:{};for(var i=typeof r==\"string\"?iy(r,e):r,s=e.plainObjects?{__proto__:null}:{},n=Object.keys(i),a=0;a<n.length;++a){var o=n[a],h=ny(o,i[o],e,typeof r==\"string\");s=ai.merge(s,h,e)}return e.allowSparse===!0?s:ai.compact(s)},hy=J_,ly=oy,uy=yh,cy={formats:uy,parse:ly,stringify:hy},dy=ym;function ce(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var fy=/^([a-z0-9.+-]+:)/i,py=/:[0-9]*$/,my=/^(\\/\\/?(?!\\/)[^?\\s]*)(\\?[^\\s]*)?$/,gy=[\"<\",\">\",'\"',\"`\",\" \",\"\\r\",`\n`,\"\t\"],_y=[\"{\",\"}\",\"|\",\"\\\\\",\"^\",\"`\"].concat(gy),yo=[\"'\"].concat(_y),ru=[\"%\",\"/\",\"?\",\";\",\"#\"].concat(yo),su=[\"/\",\"?\",\"#\"],yy=255,nu=/^[+a-z0-9A-Z_-]{0,63}$/,vy=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,xy={javascript:!0,\"javascript:\":!0},vo={javascript:!0,\"javascript:\":!0},tr={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,\"http:\":!0,\"https:\":!0,\"ftp:\":!0,\"gopher:\":!0,\"file:\":!0},xo=cy;function qn(r,t,e){if(r&&typeof r==\"object\"&&r instanceof ce)return r;var i=new ce;return i.parse(r,t,e),i}ce.prototype.parse=function(r,t,e){if(typeof r!=\"string\")throw new TypeError(\"Parameter 'url' must be a string, not \"+typeof r);var i=r.indexOf(\"?\"),s=i!==-1&&i<r.indexOf(\"#\")?\"?\":\"#\",n=r.split(s),a=/\\\\/g;n[0]=n[0].replace(a,\"/\"),r=n.join(s);var o=r;if(o=o.trim(),!e&&r.split(\"#\").length===1){var h=my.exec(o);if(h)return this.path=o,this.href=o,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=xo.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search=\"\",this.query={}),this}var l=fy.exec(o);if(l){l=l[0];var u=l.toLowerCase();this.protocol=u,o=o.substr(l.length)}if(e||l||o.match(/^\\/\\/[^@/]+@[^@/]+/)){var c=o.substr(0,2)===\"//\";c&&!(l&&vo[l])&&(o=o.substr(2),this.slashes=!0)}if(!vo[l]&&(c||l&&!tr[l])){for(var d=-1,f=0;f<su.length;f++){var p=o.indexOf(su[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var m,g;d===-1?g=o.lastIndexOf(\"@\"):g=o.lastIndexOf(\"@\",d),g!==-1&&(m=o.slice(0,g),o=o.slice(g+1),this.auth=decodeURIComponent(m)),d=-1;for(var f=0;f<ru.length;f++){var p=o.indexOf(ru[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=o.length),this.host=o.slice(0,d),o=o.slice(d),this.parseHost(),this.hostname=this.hostname||\"\";var y=this.hostname[0]===\"[\"&&this.hostname[this.hostname.length-1]===\"]\";if(!y)for(var x=this.hostname.split(/\\./),f=0,_=x.length;f<_;f++){var v=x[f];if(v&&!v.match(nu)){for(var T=\"\",S=0,w=v.length;S<w;S++)v.charCodeAt(S)>127?T+=\"x\":T+=v[S];if(!T.match(nu)){var b=x.slice(0,f),R=x.slice(f+1),L=v.match(vy);L&&(b.push(L[1]),R.unshift(L[2])),R.length&&(o=\"/\"+R.join(\".\")+o),this.hostname=b.join(\".\");break}}}this.hostname.length>yy?this.hostname=\"\":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=dy.toASCII(this.hostname));var I=this.port?\":\"+this.port:\"\",D=this.hostname||\"\";this.host=D+I,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),o[0]!==\"/\"&&(o=\"/\"+o))}if(!xy[u])for(var f=0,_=yo.length;f<_;f++){var C=yo[f];if(o.indexOf(C)!==-1){var A=encodeURIComponent(C);A===C&&(A=escape(C)),o=o.split(C).join(A)}}var $=o.indexOf(\"#\");$!==-1&&(this.hash=o.substr($),o=o.slice(0,$));var q=o.indexOf(\"?\");if(q!==-1?(this.search=o.substr(q),this.query=o.substr(q+1),t&&(this.query=xo.parse(this.query)),o=o.slice(0,q)):t&&(this.search=\"\",this.query={}),o&&(this.pathname=o),tr[u]&&this.hostname&&!this.pathname&&(this.pathname=\"/\"),this.pathname||this.search){var I=this.pathname||\"\",U=this.search||\"\";this.path=I+U}return this.href=this.format(),this};function by(r){return typeof r==\"string\"&&(r=qn(r)),r instanceof ce?r.format():ce.prototype.format.call(r)}ce.prototype.format=function(){var r=this.auth||\"\";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,\":\"),r+=\"@\");var t=this.protocol||\"\",e=this.pathname||\"\",i=this.hash||\"\",s=!1,n=\"\";this.host?s=r+this.host:this.hostname&&(s=r+(this.hostname.indexOf(\":\")===-1?this.hostname:\"[\"+this.hostname+\"]\"),this.port&&(s+=\":\"+this.port)),this.query&&typeof this.query==\"object\"&&Object.keys(this.query).length&&(n=xo.stringify(this.query,{arrayFormat:\"repeat\",addQueryPrefix:!1}));var a=this.search||n&&\"?\"+n||\"\";return t&&t.substr(-1)!==\":\"&&(t+=\":\"),this.slashes||(!t||tr[t])&&s!==!1?(s=\"//\"+(s||\"\"),e&&e.charAt(0)!==\"/\"&&(e=\"/\"+e)):s||(s=\"\"),i&&i.charAt(0)!==\"#\"&&(i=\"#\"+i),a&&a.charAt(0)!==\"?\"&&(a=\"?\"+a),e=e.replace(/[?#]/g,function(o){return encodeURIComponent(o)}),a=a.replace(\"#\",\"%23\"),t+s+e+a+i};function Ty(r,t){return qn(r,!1,!0).resolve(t)}ce.prototype.resolve=function(r){return this.resolveObject(qn(r,!1,!0)).format()};ce.prototype.resolveObject=function(r){if(typeof r==\"string\"){var t=new ce;t.parse(r,!1,!0),r=t}for(var e=new ce,i=Object.keys(this),s=0;s<i.length;s++){var n=i[s];e[n]=this[n]}if(e.hash=r.hash,r.href===\"\")return e.href=e.format(),e;if(r.slashes&&!r.protocol){for(var a=Object.keys(r),o=0;o<a.length;o++){var h=a[o];h!==\"protocol\"&&(e[h]=r[h])}return tr[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname=\"/\",e.path=e.pathname),e.href=e.format(),e}if(r.protocol&&r.protocol!==e.protocol){if(!tr[r.protocol]){for(var l=Object.keys(r),u=0;u<l.length;u++){var c=l[u];e[c]=r[c]}return e.href=e.format(),e}if(e.protocol=r.protocol,!r.host&&!vo[r.protocol]){for(var _=(r.pathname||\"\").split(\"/\");_.length&&!(r.host=_.shift()););r.host||(r.host=\"\"),r.hostname||(r.hostname=\"\"),_[0]!==\"\"&&_.unshift(\"\"),_.length<2&&_.unshift(\"\"),e.pathname=_.join(\"/\")}else e.pathname=r.pathname;if(e.search=r.search,e.query=r.query,e.host=r.host||\"\",e.auth=r.auth,e.hostname=r.hostname||r.host,e.port=r.port,e.pathname||e.search){var d=e.pathname||\"\",f=e.search||\"\";e.path=d+f}return e.slashes=e.slashes||r.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)===\"/\",m=r.host||r.pathname&&r.pathname.charAt(0)===\"/\",g=m||p||e.host&&r.pathname,y=g,x=e.pathname&&e.pathname.split(\"/\")||[],_=r.pathname&&r.pathname.split(\"/\")||[],v=e.protocol&&!tr[e.protocol];if(v&&(e.hostname=\"\",e.port=null,e.host&&(x[0]===\"\"?x[0]=e.host:x.unshift(e.host)),e.host=\"\",r.protocol&&(r.hostname=null,r.port=null,r.host&&(_[0]===\"\"?_[0]=r.host:_.unshift(r.host)),r.host=null),g=g&&(_[0]===\"\"||x[0]===\"\")),m)e.host=r.host||r.host===\"\"?r.host:e.host,e.hostname=r.hostname||r.hostname===\"\"?r.hostname:e.hostname,e.search=r.search,e.query=r.query,x=_;else if(_.length)x||(x=[]),x.pop(),x=x.concat(_),e.search=r.search,e.query=r.query;else if(r.search!=null){if(v){e.host=x.shift(),e.hostname=e.host;var T=e.host&&e.host.indexOf(\"@\")>0?e.host.split(\"@\"):!1;T&&(e.auth=T.shift(),e.hostname=T.shift(),e.host=e.hostname)}return e.search=r.search,e.query=r.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:\"\")+(e.search?e.search:\"\")),e.href=e.format(),e}if(!x.length)return e.pathname=null,e.search?e.path=\"/\"+e.search:e.path=null,e.href=e.format(),e;for(var S=x.slice(-1)[0],w=(e.host||r.host||x.length>1)&&(S===\".\"||S===\"..\")||S===\"\",b=0,R=x.length;R>=0;R--)S=x[R],S===\".\"?x.splice(R,1):S===\"..\"?(x.splice(R,1),b++):b&&(x.splice(R,1),b--);if(!g&&!y)for(;b--;b)x.unshift(\"..\");g&&x[0]!==\"\"&&(!x[0]||x[0].charAt(0)!==\"/\")&&x.unshift(\"\"),w&&x.join(\"/\").substr(-1)!==\"/\"&&x.push(\"\");var L=x[0]===\"\"||x[0]&&x[0].charAt(0)===\"/\";if(v){e.hostname=L?\"\":x.length?x.shift():\"\",e.host=e.hostname;var T=e.host&&e.host.indexOf(\"@\")>0?e.host.split(\"@\"):!1;T&&(e.auth=T.shift(),e.hostname=T.shift(),e.host=e.hostname)}return g=g||e.host&&x.length,g&&!L&&x.unshift(\"\"),x.length>0?e.pathname=x.join(\"/\"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:\"\")+(e.search?e.search:\"\")),e.auth=r.auth||e.auth,e.slashes=e.slashes||r.slashes,e.href=e.format(),e};ce.prototype.parseHost=function(){var r=this.host,t=py.exec(r);t&&(t=t[0],t!==\":\"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r)};var wy=qn,Ey=Ty,Cy=by;const au={};function z(r,t,e=3){if(au[t])return;let i=new Error().stack;typeof i>\"u\"?console.warn(\"PixiJS Deprecation Warning: \",`${t}\nDeprecated since v${r}`):(i=i.split(`\n`).splice(e).join(`\n`),console.groupCollapsed?(console.groupCollapsed(\"%cPixiJS Deprecation Warning: %c%s\",\"color:#614108;background:#fffbe6\",\"font-weight:normal;color:#614108;background:#fffbe6\",`${t}\nDeprecated since v${r}`),console.warn(i),console.groupEnd()):(console.warn(\"PixiJS Deprecation Warning: \",`${t}\nDeprecated since v${r}`),console.warn(i))),au[t]=!0}const Kn={get parse(){return z(\"7.3.0\",\"utils.url.parse is deprecated, use native URL API instead.\"),wy},get format(){return z(\"7.3.0\",\"utils.url.format is deprecated, use native URL API instead.\"),Cy},get resolve(){return z(\"7.3.0\",\"utils.url.resolve is deprecated, use native URL API instead.\"),Ey}};function ie(r){if(typeof r!=\"string\")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function yr(r){return r.split(\"?\")[0].split(\"#\")[0]}function Sy(r){return r.replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\")}function Ay(r,t,e){return r.replace(new RegExp(Sy(t),\"g\"),e)}function Py(r,t){let e=\"\",i=0,s=-1,n=0,a=-1;for(let o=0;o<=r.length;++o){if(o<r.length)a=r.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(s===o-1||n===1))if(s!==o-1&&n===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf(\"/\");if(h!==e.length-1){h===-1?(e=\"\",i=0):(e=e.slice(0,h),i=e.length-1-e.lastIndexOf(\"/\")),s=o,n=0;continue}}else if(e.length===2||e.length===1){e=\"\",i=0,s=o,n=0;continue}}}else e.length>0?e+=`/${r.slice(s+1,o)}`:e=r.slice(s+1,o),i=o-s-1;s=o,n=0}else a===46&&n!==-1?++n:n=-1}return e}const bt={toPosix(r){return Ay(r,\"\\\\\",\"/\")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\\-._~:@\\/?%\\s<>]*?)$/i.test(r)},isBlobUrl(r){return r.startsWith(\"blob:\")},hasProtocol(r){return/^[^/:]+:/.test(this.toPosix(r))},getProtocol(r){ie(r),r=this.toPosix(r);const t=/^file:\\/\\/\\//.exec(r);if(t)return t[0];const e=/^[^/:]+:\\/{0,2}/.exec(r);return e?e[0]:\"\"},toAbsolute(r,t,e){if(ie(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;const i=yr(this.toPosix(t??N.ADAPTER.getBaseUrl())),s=yr(this.toPosix(e??this.rootname(i)));return r=this.toPosix(r),r.startsWith(\"/\")?bt.join(s,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(ie(r),r.length===0)return\".\";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);let t=\"\";const e=r.startsWith(\"/\");this.hasProtocol(r)&&(t=this.rootname(r),r=r.slice(t.length));const i=r.endsWith(\"/\");return r=Py(r),r.length>0&&i&&(r+=\"/\"),e?`/${r}`:t+r},isAbsolute(r){return ie(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith(\"/\")},join(...r){if(r.length===0)return\".\";let t;for(let e=0;e<r.length;++e){const i=r[e];if(ie(i),i.length>0)if(t===void 0)t=i;else{const s=r[e-1]??\"\";this.joinExtensions.includes(this.extname(s).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?\".\":this.normalize(t)},dirname(r){if(ie(r),r.length===0)return\".\";r=this.toPosix(r);let t=r.charCodeAt(0);const e=t===47;let i=-1,s=!0;const n=this.getProtocol(r),a=r;r=r.slice(n.length);for(let o=r.length-1;o>=1;--o)if(t=r.charCodeAt(o),t===47){if(!s){i=o;break}}else s=!1;return i===-1?e?\"/\":this.isUrl(a)?n+r:n:e&&i===1?\"//\":n+r.slice(0,i)},rootname(r){ie(r),r=this.toPosix(r);let t=\"\";if(r.startsWith(\"/\")?t=\"/\":t=this.getProtocol(r),this.isUrl(r)){const e=r.indexOf(\"/\",t.length);e!==-1?t=r.slice(0,e):t=r,t.endsWith(\"/\")||(t+=\"/\")}return t},basename(r,t){ie(r),t&&ie(t),r=yr(this.toPosix(r));let e=0,i=-1,s=!0,n;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t.length===r.length&&t===r)return\"\";let a=t.length-1,o=-1;for(n=r.length-1;n>=0;--n){const h=r.charCodeAt(n);if(h===47){if(!s){e=n+1;break}}else o===-1&&(s=!1,o=n+1),a>=0&&(h===t.charCodeAt(a)?--a===-1&&(i=n):(a=-1,i=o))}return e===i?i=o:i===-1&&(i=r.length),r.slice(e,i)}for(n=r.length-1;n>=0;--n)if(r.charCodeAt(n)===47){if(!s){e=n+1;break}}else i===-1&&(s=!1,i=n+1);return i===-1?\"\":r.slice(e,i)},extname(r){ie(r),r=yr(this.toPosix(r));let t=-1,e=0,i=-1,s=!0,n=0;for(let a=r.length-1;a>=0;--a){const o=r.charCodeAt(a);if(o===47){if(!s){e=a+1;break}continue}i===-1&&(s=!1,i=a+1),o===46?t===-1?t=a:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||i===-1||n===0||n===1&&t===i-1&&t===e+1?\"\":r.slice(t,i)},parse(r){ie(r);const t={root:\"\",dir:\"\",base:\"\",ext:\"\",name:\"\"};if(r.length===0)return t;r=yr(this.toPosix(r));let e=r.charCodeAt(0);const i=this.isAbsolute(r);let s;t.root=this.rootname(r),i||this.hasProtocol(r)?s=1:s=0;let n=-1,a=0,o=-1,h=!0,l=r.length-1,u=0;for(;l>=s;--l){if(e=r.charCodeAt(l),e===47){if(!h){a=l+1;break}continue}o===-1&&(h=!1,o=l+1),e===46?n===-1?n=l:u!==1&&(u=1):n!==-1&&(u=-1)}return n===-1||o===-1||u===0||u===1&&n===o-1&&n===a+1?o!==-1&&(a===0&&i?t.base=t.name=r.slice(1,o):t.base=t.name=r.slice(a,o)):(a===0&&i?(t.name=r.slice(1,n),t.base=r.slice(1,o)):(t.name=r.slice(a,n),t.base=r.slice(a,o)),t.ext=r.slice(n,o)),t.dir=this.dirname(r),t},sep:\"/\",delimiter:\":\",joinExtensions:[\".html\"]};let Pa;async function cd(){return Pa??(Pa=(async()=>{const r=document.createElement(\"canvas\").getContext(\"webgl\");if(!r)return Nt.UNPACK;const t=await new Promise(n=>{const a=document.createElement(\"video\");a.onloadeddata=()=>n(a),a.onerror=()=>n(null),a.autoplay=!1,a.crossOrigin=\"anonymous\",a.preload=\"auto\",a.src=\"data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=\",a.load()});if(!t)return Nt.UNPACK;const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);const i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t);const s=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,s),r.deleteFramebuffer(i),r.deleteTexture(e),r.getExtension(\"WEBGL_lose_context\")?.loseContext(),s[0]<=s[3]?Nt.PMA:Nt.UNPACK})()),Pa}function My(){z(\"7.0.0\",\"skipHello is deprecated, please use settings.RENDER_OPTIONS.hello\")}function Iy(){z(\"7.0.0\",`sayHello is deprecated, please use Renderer's \"hello\" option`)}let Ma;function dd(){return typeof Ma>\"u\"&&(Ma=function(){const r={stencil:!0,failIfMajorPerformanceCaveat:N.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!N.ADAPTER.getWebGLRenderingContext())return!1;const t=N.ADAPTER.createCanvas();let e=t.getContext(\"webgl\",r)||t.getContext(\"experimental-webgl\",r);const i=!!e?.getContextAttributes()?.stencil;if(e){const s=e.getExtension(\"WEBGL_lose_context\");s&&s.loseContext()}return e=null,i}catch{return!1}}()),Ma}var Ry={grad:.9,turn:360,rad:360/(2*Math.PI)},Le=function(r){return typeof r==\"string\"?r.length>0:typeof r==\"number\"},At=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*r)/e+0},Zt=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r>e?e:r>t?r:t},fd=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},ou=function(r){return{r:Zt(r.r,0,255),g:Zt(r.g,0,255),b:Zt(r.b,0,255),a:Zt(r.a)}},Ia=function(r){return{r:At(r.r),g:At(r.g),b:At(r.b),a:At(r.a,3)}},Dy=/^#([0-9a-f]{3,8})$/i,Is=function(r){var t=r.toString(16);return t.length<2?\"0\"+t:t},pd=function(r){var t=r.r,e=r.g,i=r.b,s=r.a,n=Math.max(t,e,i),a=n-Math.min(t,e,i),o=a?n===t?(e-i)/a:n===e?2+(i-t)/a:4+(t-e)/a:0;return{h:60*(o<0?o+6:o),s:n?a/n*100:0,v:n/255*100,a:s}},md=function(r){var t=r.h,e=r.s,i=r.v,s=r.a;t=t/360*6,e/=100,i/=100;var n=Math.floor(t),a=i*(1-e),o=i*(1-(t-n)*e),h=i*(1-(1-t+n)*e),l=n%6;return{r:255*[i,o,a,a,h,i][l],g:255*[h,i,i,o,a,a][l],b:255*[a,a,h,i,i,o][l],a:s}},hu=function(r){return{h:fd(r.h),s:Zt(r.s,0,100),l:Zt(r.l,0,100),a:Zt(r.a)}},lu=function(r){return{h:At(r.h),s:At(r.s),l:At(r.l),a:At(r.a,3)}},uu=function(r){return md((e=(t=r).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},Vr=function(r){return{h:(t=pd(r)).h,s:(s=(200-(e=t.s))*(i=t.v)/100)>0&&s<200?e*i/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,i,s},Fy=/^hsla?\\(\\s*([+-]?\\d*\\.?\\d+)(deg|rad|grad|turn)?\\s*,\\s*([+-]?\\d*\\.?\\d+)%\\s*,\\s*([+-]?\\d*\\.?\\d+)%\\s*(?:,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,By=/^hsla?\\(\\s*([+-]?\\d*\\.?\\d+)(deg|rad|grad|turn)?\\s+([+-]?\\d*\\.?\\d+)%\\s+([+-]?\\d*\\.?\\d+)%\\s*(?:\\/\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,Ly=/^rgba?\\(\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*(?:,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,Oy=/^rgba?\\(\\s*([+-]?\\d*\\.?\\d+)(%)?\\s+([+-]?\\d*\\.?\\d+)(%)?\\s+([+-]?\\d*\\.?\\d+)(%)?\\s*(?:\\/\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,bo={string:[[function(r){var t=Dy.exec(r);return t?(r=t[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?At(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?At(parseInt(r.substr(6,2),16)/255,2):1}:null:null},\"hex\"],[function(r){var t=Ly.exec(r)||Oy.exec(r);return t?t[2]!==t[4]||t[4]!==t[6]?null:ou({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},\"rgb\"],[function(r){var t=Fy.exec(r)||By.exec(r);if(!t)return null;var e,i,s=hu({h:(e=t[1],i=t[2],i===void 0&&(i=\"deg\"),Number(e)*(Ry[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return uu(s)},\"hsl\"]],object:[[function(r){var t=r.r,e=r.g,i=r.b,s=r.a,n=s===void 0?1:s;return Le(t)&&Le(e)&&Le(i)?ou({r:Number(t),g:Number(e),b:Number(i),a:Number(n)}):null},\"rgb\"],[function(r){var t=r.h,e=r.s,i=r.l,s=r.a,n=s===void 0?1:s;if(!Le(t)||!Le(e)||!Le(i))return null;var a=hu({h:Number(t),s:Number(e),l:Number(i),a:Number(n)});return uu(a)},\"hsl\"],[function(r){var t=r.h,e=r.s,i=r.v,s=r.a,n=s===void 0?1:s;if(!Le(t)||!Le(e)||!Le(i))return null;var a=function(o){return{h:fd(o.h),s:Zt(o.s,0,100),v:Zt(o.v,0,100),a:Zt(o.a)}}({h:Number(t),s:Number(e),v:Number(i),a:Number(n)});return md(a)},\"hsv\"]]},cu=function(r,t){for(var e=0;e<t.length;e++){var i=t[e][0](r);if(i)return[i,t[e][1]]}return[null,void 0]},Ny=function(r){return typeof r==\"string\"?cu(r.trim(),bo.string):typeof r==\"object\"&&r!==null?cu(r,bo.object):[null,void 0]},Ra=function(r,t){var e=Vr(r);return{h:e.h,s:Zt(e.s+100*t,0,100),l:e.l,a:e.a}},Da=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},du=function(r,t){var e=Vr(r);return{h:e.h,s:e.s,l:Zt(e.l+100*t,0,100),a:e.a}},To=function(){function r(t){this.parsed=Ny(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return At(Da(this.rgba),2)},r.prototype.isDark=function(){return Da(this.rgba)<.5},r.prototype.isLight=function(){return Da(this.rgba)>=.5},r.prototype.toHex=function(){return t=Ia(this.rgba),e=t.r,i=t.g,s=t.b,a=(n=t.a)<1?Is(At(255*n)):\"\",\"#\"+Is(e)+Is(i)+Is(s)+a;var t,e,i,s,n,a},r.prototype.toRgb=function(){return Ia(this.rgba)},r.prototype.toRgbString=function(){return t=Ia(this.rgba),e=t.r,i=t.g,s=t.b,(n=t.a)<1?\"rgba(\"+e+\", \"+i+\", \"+s+\", \"+n+\")\":\"rgb(\"+e+\", \"+i+\", \"+s+\")\";var t,e,i,s,n},r.prototype.toHsl=function(){return lu(Vr(this.rgba))},r.prototype.toHslString=function(){return t=lu(Vr(this.rgba)),e=t.h,i=t.s,s=t.l,(n=t.a)<1?\"hsla(\"+e+\", \"+i+\"%, \"+s+\"%, \"+n+\")\":\"hsl(\"+e+\", \"+i+\"%, \"+s+\"%)\";var t,e,i,s,n},r.prototype.toHsv=function(){return t=pd(this.rgba),{h:At(t.h),s:At(t.s),v:At(t.v),a:At(t.a,3)};var t},r.prototype.invert=function(){return xe({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},r.prototype.saturate=function(t){return t===void 0&&(t=.1),xe(Ra(this.rgba,t))},r.prototype.desaturate=function(t){return t===void 0&&(t=.1),xe(Ra(this.rgba,-t))},r.prototype.grayscale=function(){return xe(Ra(this.rgba,-1))},r.prototype.lighten=function(t){return t===void 0&&(t=.1),xe(du(this.rgba,t))},r.prototype.darken=function(t){return t===void 0&&(t=.1),xe(du(this.rgba,-t))},r.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},r.prototype.alpha=function(t){return typeof t==\"number\"?xe({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):At(this.rgba.a,3);var e},r.prototype.hue=function(t){var e=Vr(this.rgba);return typeof t==\"number\"?xe({h:t,s:e.s,l:e.l,a:e.a}):At(e.h)},r.prototype.isEqual=function(t){return this.toHex()===xe(t).toHex()},r}(),xe=function(r){return r instanceof To?r:new To(r)},fu=[],Uy=function(r){r.forEach(function(t){fu.indexOf(t)<0&&(t(To,bo),fu.push(t))})};function ky(r,t){var e={white:\"#ffffff\",bisque:\"#ffe4c4\",blue:\"#0000ff\",cadetblue:\"#5f9ea0\",chartreuse:\"#7fff00\",chocolate:\"#d2691e\",coral:\"#ff7f50\",antiquewhite:\"#faebd7\",aqua:\"#00ffff\",azure:\"#f0ffff\",whitesmoke:\"#f5f5f5\",papayawhip:\"#ffefd5\",plum:\"#dda0dd\",blanchedalmond:\"#ffebcd\",black:\"#000000\",gold:\"#ffd700\",goldenrod:\"#daa520\",gainsboro:\"#dcdcdc\",cornsilk:\"#fff8dc\",cornflowerblue:\"#6495ed\",burlywood:\"#deb887\",aquamarine:\"#7fffd4\",beige:\"#f5f5dc\",crimson:\"#dc143c\",cyan:\"#00ffff\",darkblue:\"#00008b\",darkcyan:\"#008b8b\",darkgoldenrod:\"#b8860b\",darkkhaki:\"#bdb76b\",darkgray:\"#a9a9a9\",darkgreen:\"#006400\",darkgrey:\"#a9a9a9\",peachpuff:\"#ffdab9\",darkmagenta:\"#8b008b\",darkred:\"#8b0000\",darkorchid:\"#9932cc\",darkorange:\"#ff8c00\",darkslateblue:\"#483d8b\",gray:\"#808080\",darkslategray:\"#2f4f4f\",darkslategrey:\"#2f4f4f\",deeppink:\"#ff1493\",deepskyblue:\"#00bfff\",wheat:\"#f5deb3\",firebrick:\"#b22222\",floralwhite:\"#fffaf0\",ghostwhite:\"#f8f8ff\",darkviolet:\"#9400d3\",magenta:\"#ff00ff\",green:\"#008000\",dodgerblue:\"#1e90ff\",grey:\"#808080\",honeydew:\"#f0fff0\",hotpink:\"#ff69b4\",blueviolet:\"#8a2be2\",forestgreen:\"#228b22\",lawngreen:\"#7cfc00\",indianred:\"#cd5c5c\",indigo:\"#4b0082\",fuchsia:\"#ff00ff\",brown:\"#a52a2a\",maroon:\"#800000\",mediumblue:\"#0000cd\",lightcoral:\"#f08080\",darkturquoise:\"#00ced1\",lightcyan:\"#e0ffff\",ivory:\"#fffff0\",lightyellow:\"#ffffe0\",lightsalmon:\"#ffa07a\",lightseagreen:\"#20b2aa\",linen:\"#faf0e6\",mediumaquamarine:\"#66cdaa\",lemonchiffon:\"#fffacd\",lime:\"#00ff00\",khaki:\"#f0e68c\",mediumseagreen:\"#3cb371\",limegreen:\"#32cd32\",mediumspringgreen:\"#00fa9a\",lightskyblue:\"#87cefa\",lightblue:\"#add8e6\",midnightblue:\"#191970\",lightpink:\"#ffb6c1\",mistyrose:\"#ffe4e1\",moccasin:\"#ffe4b5\",mintcream:\"#f5fffa\",lightslategray:\"#778899\",lightslategrey:\"#778899\",navajowhite:\"#ffdead\",navy:\"#000080\",mediumvioletred:\"#c71585\",powderblue:\"#b0e0e6\",palegoldenrod:\"#eee8aa\",oldlace:\"#fdf5e6\",paleturquoise:\"#afeeee\",mediumturquoise:\"#48d1cc\",mediumorchid:\"#ba55d3\",rebeccapurple:\"#663399\",lightsteelblue:\"#b0c4de\",mediumslateblue:\"#7b68ee\",thistle:\"#d8bfd8\",tan:\"#d2b48c\",orchid:\"#da70d6\",mediumpurple:\"#9370db\",purple:\"#800080\",pink:\"#ffc0cb\",skyblue:\"#87ceeb\",springgreen:\"#00ff7f\",palegreen:\"#98fb98\",red:\"#ff0000\",yellow:\"#ffff00\",slateblue:\"#6a5acd\",lavenderblush:\"#fff0f5\",peru:\"#cd853f\",palevioletred:\"#db7093\",violet:\"#ee82ee\",teal:\"#008080\",slategray:\"#708090\",slategrey:\"#708090\",aliceblue:\"#f0f8ff\",darkseagreen:\"#8fbc8f\",darkolivegreen:\"#556b2f\",greenyellow:\"#adff2f\",seagreen:\"#2e8b57\",seashell:\"#fff5ee\",tomato:\"#ff6347\",silver:\"#c0c0c0\",sienna:\"#a0522d\",lavender:\"#e6e6fa\",lightgreen:\"#90ee90\",orange:\"#ffa500\",orangered:\"#ff4500\",steelblue:\"#4682b4\",royalblue:\"#4169e1\",turquoise:\"#40e0d0\",yellowgreen:\"#9acd32\",salmon:\"#fa8072\",saddlebrown:\"#8b4513\",sandybrown:\"#f4a460\",rosybrown:\"#bc8f8f\",darksalmon:\"#e9967a\",lightgoldenrodyellow:\"#fafad2\",snow:\"#fffafa\",lightgrey:\"#d3d3d3\",lightgray:\"#d3d3d3\",dimgray:\"#696969\",dimgrey:\"#696969\",olivedrab:\"#6b8e23\",olive:\"#808000\"},i={};for(var s in e)i[e[s]]=s;var n={};r.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return\"transparent\";var o,h,l=i[this.toHex()];if(l)return l;if(a?.closest){var u=this.toRgb(),c=1/0,d=\"black\";if(!n.length)for(var f in e)n[f]=new r(e[f]).toRgb();for(var p in e){var m=(o=u,h=n[p],Math.pow(o.r-h.r,2)+Math.pow(o.g-h.g,2)+Math.pow(o.b-h.b,2));m<c&&(c=m,d=p)}return d}},t.string.push([function(a){var o=a.toLowerCase(),h=o===\"transparent\"?\"#0000\":e[o];return h?new r(h).toRgb():null},\"name\"])}Uy([ky]);const $i=class rn{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof rn)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error(\"Cannot set PIXI.Color#value to null\");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t==\"string\"||typeof t==\"number\"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t==\"object\"&&t!==null?{...t}:t}isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if(i===\"number\"||i===\"string\"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){const s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,i,s]=this._components;return{r:t,g:e,b:i,a:s}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,s]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(s*255),t}toRgbArray(t){t=t??[];const[e,i,s]=this._components;return t[0]=e,t[1]=i,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,i,s,n]=rn.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,s=this._int>>8&255,n=this._int&255;return e&&(i=i*t+.5|0,s=s*t+.5|0,n=n*t+.5|0),(t*255<<24)+(i<<16)+(s<<8)+n}toHex(){const t=this._int.toString(16);return`#${\"000000\".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+\"00\".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,i,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,i,s,n]=this._components;return t[0]=e,t[1]=i,t[2]=s,t[3]=n,t}normalize(t){let e,i,s,n;if((typeof t==\"number\"||t instanceof Number)&&t>=0&&t<=16777215){const a=t;e=(a>>16&255)/255,i=(a>>8&255)/255,s=(a&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,s,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,s,n=255]=t,e/=255,i/=255,s/=255,n/=255;else if(typeof t==\"string\"||typeof t==\"object\"){if(typeof t==\"string\"){const o=rn.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}const a=xe(t);a.isValid()&&({r:e,g:i,b:s,a:n}=a.rgba,e/=255,i/=255,s/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t==\"number\"?Math.min(Math.max(t,e),i):(t.forEach((s,n)=>{t[n]=Math.min(Math.max(s,e),i)}),t)}};$i.shared=new $i,$i.temp=new $i,$i.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let tt=$i;function Gy(r,t=[]){return z(\"7.2.0\",\"utils.hex2rgb is deprecated, use Color#toRgbArray instead\"),tt.shared.setValue(r).toRgbArray(t)}function gd(r){return z(\"7.2.0\",\"utils.hex2string is deprecated, use Color#toHex instead\"),tt.shared.setValue(r).toHex()}function Vy(r){return z(\"7.2.0\",\"utils.string2hex is deprecated, use Color#toNumber instead\"),tt.shared.setValue(r).toNumber()}function _d(r){return z(\"7.2.0\",\"utils.rgb2hex is deprecated, use Color#toNumber instead\"),tt.shared.setValue(r).toNumber()}function Hy(){const r=[],t=[];for(let i=0;i<32;i++)r[i]=i,t[i]=i;r[H.NORMAL_NPM]=H.NORMAL,r[H.ADD_NPM]=H.ADD,r[H.SCREEN_NPM]=H.SCREEN,t[H.NORMAL]=H.NORMAL_NPM,t[H.ADD]=H.ADD_NPM,t[H.SCREEN]=H.SCREEN_NPM;const e=[];return e.push(t),e.push(r),e}const xh=Hy();function bh(r,t){return xh[t?1:0][r]}function Xy(r,t,e,i=!0){return z(\"7.2.0\",\"utils.premultiplyRgba has moved to Color.premultiply\"),tt.shared.setValue(r).premultiply(t,i).toArray(e??new Float32Array(4))}function $y(r,t){return z(\"7.2.0\",\"utils.premultiplyTint has moved to Color.toPremultiplied\"),tt.shared.setValue(r).toPremultiplied(t)}function zy(r,t,e,i=!0){return z(\"7.2.0\",\"utils.premultiplyTintToRgba has moved to Color.premultiply\"),tt.shared.setValue(r).premultiply(t,i).toArray(e??new Float32Array(4))}const yd=/^\\s*data:(?:([\\w-]+)\\/([\\w+.-]+))?(?:;charset=([\\w-]+))?(?:;(base64))?,(.*)/i;function vd(r,t=null){const e=r*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,s=0;i<e;i+=6,s+=4)t[i+0]=s+0,t[i+1]=s+1,t[i+2]=s+2,t[i+3]=s+0,t[i+4]=s+2,t[i+5]=s+3;return t}function Zn(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?\"Float32Array\":r instanceof Uint32Array?\"Uint32Array\":\"Int32Array\";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return\"Uint16Array\"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return\"Uint8Array\";return null}const Wy={Float32Array,Uint32Array,Int32Array,Uint8Array};function jy(r,t){let e=0,i=0;const s={};for(let h=0;h<r.length;h++)i+=t[h],e+=r[h].length;const n=new ArrayBuffer(e*4);let a=null,o=0;for(let h=0;h<r.length;h++){const l=t[h],u=r[h],c=Zn(u);s[c]||(s[c]=new Wy[c](n)),a=s[c];for(let d=0;d<u.length;d++){const f=(d/l|0)*i+o,p=d%l;a[f+p]=u[d]}o+=l}return new Float32Array(n)}function Yr(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function wo(r){return!(r&r-1)&&!!r}function Eo(r){let t=(r>65535?1:0)<<4;r>>>=t;let e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1}function Mi(r,t,e){const i=r.length;let s;if(t>=i||e===0)return;e=t+e>i?i-t:e;const n=i-e;for(s=t;s<n;++s)r[s]=r[s+e];r.length=n}function Ge(r){return r===0?0:r<0?-1:1}let Yy=0;function oi(){return++Yy}const Co=class{constructor(r,t,e,i){this.left=r,this.top=t,this.right=e,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Co.EMPTY=new Co(0,0,0,0);let So=Co;const Ao={},Lt=Object.create(null),Ht=Object.create(null);function qy(){let r;for(r in Lt)Lt[r].destroy();for(r in Ht)Ht[r].destroy()}function Ky(){let r;for(r in Lt)delete Lt[r];for(r in Ht)delete Ht[r]}class xd{constructor(t,e,i){this._canvas=N.ADAPTER.createCanvas(),this._context=this._canvas.getContext(\"2d\"),this.resolution=i||N.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError(\"The CanvasRenderTarget has already been destroyed\")}}function pu(r,t,e){for(let i=0,s=4*e*t;i<t;++i,s+=4)if(r[s+3]!==0)return!1;return!0}function mu(r,t,e,i,s){const n=4*t;for(let a=i,o=i*n+4*e;a<=s;++a,o+=n)if(r[o+3]!==0)return!1;return!0}function bd(r){const{width:t,height:e}=r,i=r.getContext(\"2d\",{willReadFrequently:!0});if(i===null)throw new TypeError(\"Failed to get canvas 2D context\");const s=i.getImageData(0,0,t,e).data;let n=0,a=0,o=t-1,h=e-1;for(;a<e&&pu(s,t,a);)++a;if(a===e)return So.EMPTY;for(;pu(s,t,h);)--h;for(;mu(s,t,n,a,h);)++n;for(;mu(s,t,o,a,h);)--o;return++o,++h,new So(n,a,o,h)}function Td(r){const t=bd(r),{width:e,height:i}=t;let s=null;if(!t.isEmpty()){const n=r.getContext(\"2d\");if(n===null)throw new TypeError(\"Failed to get canvas 2D context\");s=n.getImageData(t.left,t.top,e,i)}return{width:e,height:i,data:s}}function Zy(r){const t=yd.exec(r);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}function wd(r,t=globalThis.location){if(r.startsWith(\"data:\"))return\"\";t=t||globalThis.location;const e=new URL(r,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?\"anonymous\":\"\"}function De(r,t=1){const e=N.RETINA_PREFIX?.exec(r);return e?parseFloat(e[1]):t}const Jy=Object.freeze(Object.defineProperty({__proto__:null,BaseTextureCache:Ht,BoundingBox:So,CanvasRenderTarget:xd,DATA_URI:yd,EventEmitter:Ye,ProgramCache:Ao,TextureCache:Lt,clearTextureCache:Ky,correctBlendMode:bh,createIndicesForQuads:vd,decomposeDataUri:Zy,deprecation:z,destroyTextureCache:qy,detectVideoAlphaMode:cd,determineCrossOrigin:wd,earcut:Nc,getBufferType:Zn,getCanvasBoundingBox:bd,getResolutionOfUrl:De,hex2rgb:Gy,hex2string:gd,interleaveTypedArrays:jy,isMobile:he,isPow2:wo,isWebGLSupported:dd,log2:Eo,nextPow2:Yr,path:bt,premultiplyBlendMode:xh,premultiplyRgba:Xy,premultiplyTint:$y,premultiplyTintToRgba:zy,removeItems:Mi,rgb2hex:_d,sayHello:Iy,sign:Ge,skipHello:My,string2hex:Vy,trimCanvas:Td,uid:oi,url:Kn},Symbol.toStringTag,{value:\"Module\"}));var F=(r=>(r.Renderer=\"renderer\",r.Application=\"application\",r.RendererSystem=\"renderer-webgl-system\",r.RendererPlugin=\"renderer-webgl-plugin\",r.CanvasRendererSystem=\"renderer-canvas-system\",r.CanvasRendererPlugin=\"renderer-canvas-plugin\",r.Asset=\"asset\",r.LoadParser=\"load-parser\",r.ResolveParser=\"resolve-parser\",r.CacheParser=\"cache-parser\",r.DetectionParser=\"detection-parser\",r))(F||{});const Po=r=>{if(typeof r==\"function\"||typeof r==\"object\"&&r.extension){if(!r.extension)throw new Error(\"Extension class must have an extension object\");r={...typeof r.extension!=\"object\"?{type:r.extension}:r.extension,ref:r}}if(typeof r==\"object\")r={...r};else throw new Error(\"Invalid extension type\");return typeof r.type==\"string\"&&(r.type=[r.type]),r},gu=(r,t)=>Po(r).priority??t,k={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(Po).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...r){return r.map(Po).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,s=this._queue;i[e]?i[e]?.(t):(s[e]=s[e]||[],s[e]?.push(t))})}),this},handle(r,t,e){const i=this._addHandlers,s=this._removeHandlers;if(i[r]||s[r])throw new Error(`Extension type ${r} already has a handler`);i[r]=t,s[r]=e;const n=this._queue;return n[r]&&(n[r]?.forEach(a=>t(a)),delete n[r]),this},handleByMap(r,t){return this.handle(r,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(r,t,e=-1){return this.handle(r,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((s,n)=>gu(n,e)-gu(s,e)))},i=>{const s=t.indexOf(i.ref);s!==-1&&t.splice(s,1)})}};class wn{constructor(t){typeof t==\"number\"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case\"int8\":case\"uint8\":return 1;case\"int16\":case\"uint16\":return 2;case\"int32\":case\"uint32\":case\"float32\":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Qy=[\"precision mediump float;\",\"void main(void){\",\"float test = 0.1;\",\"%forloop%\",\"gl_FragColor = vec4(0.0);\",\"}\"].join(`\n`);function tv(r){let t=\"\";for(let e=0;e<r;++e)e>0&&(t+=`\nelse `),e<r-1&&(t+=`if(test == ${e}.0){}`);return t}function Ed(r,t){if(r===0)throw new Error(\"Invalid value of `0` passed to `checkMaxIfStatementsInShader`\");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=Qy.replace(/%forloop%/gi,tv(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break}return r}const Fa=0,Ba=1,La=2,Oa=3,Na=4,Ua=5;class pe{constructor(){this.data=0,this.blendMode=H.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Fa)}set blend(t){!!(this.data&1<<Fa)!==t&&(this.data^=1<<Fa)}get offsets(){return!!(this.data&1<<Ba)}set offsets(t){!!(this.data&1<<Ba)!==t&&(this.data^=1<<Ba)}get culling(){return!!(this.data&1<<La)}set culling(t){!!(this.data&1<<La)!==t&&(this.data^=1<<La)}get depthTest(){return!!(this.data&1<<Oa)}set depthTest(t){!!(this.data&1<<Oa)!==t&&(this.data^=1<<Oa)}get depthMask(){return!!(this.data&1<<Ua)}set depthMask(t){!!(this.data&1<<Ua)!==t&&(this.data^=1<<Ua)}get clockwiseFrontFace(){return!!(this.data&1<<Na)}set clockwiseFrontFace(t){!!(this.data&1<<Na)!==t&&(this.data^=1<<Na)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==H.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new pe;return t.depthTest=!1,t.blend=!0,t}}pe.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const En=[];function Th(r,t){if(!r)return null;let e=\"\";if(typeof r==\"string\"){const i=/\\.(\\w{3,4})(?:$|\\?|#)/i.exec(r);i&&(e=i[1].toLowerCase())}for(let i=En.length-1;i>=0;--i){const s=En[i];if(s.test&&s.test(r,e))return new s(r,t)}throw new Error(\"Unrecognized source type to auto-detect Resource\")}class Wt{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,s,n,a,o,h){if(arguments.length>8)throw new Error(\"max arguments reached\");const{name:l,items:u}=this;this._aliasCount++;for(let c=0,d=u.length;c<d;c++)u[c][l](t,e,i,s,n,a,o,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=\"\"}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Wt.prototype,{dispatch:{value:Wt.prototype.emit},run:{value:Wt.prototype.emit}});class hr{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Wt(\"setRealSize\"),this.onUpdate=new Wt(\"update\"),this.onError=new Wt(\"onError\")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class fs extends hr{constructor(t,e){const{width:i,height:s}=e||{};if(!i||!s)throw new Error(\"BufferResource width or height invalid\");super(i,s),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,i){const s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Nt.UNPACK);const n=e.realWidth,a=e.realHeight;return i.width===n&&i.height===a?s.texSubImage2D(e.target,0,0,0,n,a,e.format,i.type,this.data):(i.width=n,i.height=a,s.texImage2D(e.target,0,i.internalFormat,n,a,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const ev={scaleMode:Me.NEAREST,alphaMode:Nt.NPM},Mo=class zi extends Ye{constructor(t=null,e=null){super(),e=Object.assign({},zi.defaultOptions,e);const{alphaMode:i,mipmap:s,anisotropicLevel:n,scaleMode:a,width:o,height:h,wrapMode:l,format:u,type:c,target:d,resolution:f,resourceOptions:p}=e;t&&!(t instanceof hr)&&(t=Th(t,p),t.internal=!0),this.resolution=f||N.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=a,this.format=u,this.type=c,this.target=d,this.alphaMode=i,this.uid=oi(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=wo(this.realWidth)&&wo(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit(\"update\",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error(\"Resource can be set only once\");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit(\"update\",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit(\"loaded\",this),this.emit(\"update\",this))}onError(t){this.emit(\"error\",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Ht[this.cacheId],delete Lt[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),zi.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit(\"destroyed\",this),this.removeAllListeners()}dispose(){this.emit(\"dispose\",this)}castToBaseTexture(){return this}static from(t,e,i=N.STRICT_TEXTURE_CACHE){const s=typeof t==\"string\";let n=null;if(s)n=t;else{if(!t._pixiId){const o=e?.pixiIdPrefix||\"pixiid\";t._pixiId=`${o}_${oi()}`}n=t._pixiId}let a=Ht[n];if(s&&i&&!a)throw new Error(`The cacheId \"${n}\" does not exist in BaseTextureCache.`);return a||(a=new zi(t,e),a.cacheId=n,zi.addToCache(a,n)),a}static fromBuffer(t,e,i,s){t=t||new Float32Array(e*i*4);const n=new fs(t,{width:e,height:i,...s?.resourceOptions});let a,o;return t instanceof Float32Array?(a=M.RGBA,o=V.FLOAT):t instanceof Int32Array?(a=M.RGBA_INTEGER,o=V.INT):t instanceof Uint32Array?(a=M.RGBA_INTEGER,o=V.UNSIGNED_INT):t instanceof Int16Array?(a=M.RGBA_INTEGER,o=V.SHORT):t instanceof Uint16Array?(a=M.RGBA_INTEGER,o=V.UNSIGNED_SHORT):t instanceof Int8Array?(a=M.RGBA,o=V.BYTE):(a=M.RGBA,o=V.UNSIGNED_BYTE),n.internal=!0,new zi(n,Object.assign({},ev,{type:o,format:a},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ht[e]&&Ht[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Ht[e]=t)}static removeFromCache(t){if(typeof t==\"string\"){const e=Ht[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Ht[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Ht[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};Mo.defaultOptions={mipmap:fe.POW2,anisotropicLevel:0,scaleMode:Me.LINEAR,wrapMode:Re.CLAMP,alphaMode:Nt.UNPACK,target:Ai.TEXTURE_2D,format:M.RGBA,type:V.UNSIGNED_BYTE},Mo._globalBatch=0;let j=Mo;class Cn{constructor(){this.texArray=null,this.blend=0,this.type=oe.TRIANGLES,this.start=0,this.size=0,this.data=null}}let iv=0;class pt{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=iv++,this.disposeRunner=new Wt(\"disposeBuffer\")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?ue.ELEMENT_ARRAY_BUFFER:ue.ARRAY_BUFFER}get index(){return this.type===ue.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new pt(t)}}class qr{constructor(t,e=0,i=!1,s=V.FLOAT,n,a,o,h=1){this.buffer=t,this.size=e,this.normalized=i,this.type=s,this.stride=n,this.start=a,this.instance=o,this.divisor=h}destroy(){this.buffer=null}static from(t,e,i,s,n){return new qr(t,e,i,s,n)}}const rv={Float32Array,Uint32Array,Int32Array,Uint8Array};function sv(r,t){let e=0,i=0;const s={};for(let h=0;h<r.length;h++)i+=t[h],e+=r[h].length;const n=new ArrayBuffer(e*4);let a=null,o=0;for(let h=0;h<r.length;h++){const l=t[h],u=r[h],c=Zn(u);s[c]||(s[c]=new rv[c](n)),a=s[c];for(let d=0;d<u.length;d++){const f=(d/l|0)*i+o,p=d%l;a[f+p]=u[d]}o+=l}return new Float32Array(n)}const _u={5126:4,5123:2,5121:1};let nv=0;const av={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class ze{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=nv++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Wt(\"disposeGeometry\"),this.refCount=0}addAttribute(t,e,i=0,s=!1,n,a,o,h=!1){if(!e)throw new Error(\"You must pass a buffer when creating an attribute\");e instanceof pt||(e instanceof Array&&(e=new Float32Array(e)),e=new pt(e));const l=t.split(\"|\");if(l.length>1){for(let c=0;c<l.length;c++)this.addAttribute(l[c],e,i,s,n);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new qr(u,i,s,n,a,o,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof pt||(t instanceof Array&&(t=new Uint16Array(t)),t=new pt(t)),t.type=ue.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],i=new pt;let s;for(s in this.attributes){const n=this.attributes[s],a=this.buffers[n.buffer];t.push(a.data),e.push(n.size*_u[n.type]/4),n.buffer=0}for(i.data=sv(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new ze;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new pt(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new qr(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=ue.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new ze,i=[],s=[],n=[];let a;for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)s[h]=s[h]||0,s[h]+=a.buffers[h].data.length,n[h]=0}for(let o=0;o<a.buffers.length;o++)i[o]=new av[Zn(a.buffers[o].data)](s[o]),e.buffers[o]=new pt(i[o]);for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)i[h].set(a.buffers[h].data,n[h]),n[h]+=a.buffers[h].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=ue.ELEMENT_ARRAY_BUFFER;let o=0,h=0,l=0,u=0;for(let c=0;c<a.buffers.length;c++)if(a.buffers[c]!==a.indexBuffer){u=c;break}for(const c in a.attributes){const d=a.attributes[c];(d.buffer|0)===u&&(h+=d.size*_u[d.type]/4)}for(let c=0;c<t.length;c++){const d=t[c].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+l]+=o;o+=t[c].buffers[u].data.length/h,l+=d.length}}return e}}class wh extends ze{constructor(t=!1){super(),this._buffer=new pt(null,t,!1),this._indexBuffer=new pt(null,t,!0),this.addAttribute(\"aVertexPosition\",this._buffer,2,!1,V.FLOAT).addAttribute(\"aTextureCoord\",this._buffer,2,!1,V.FLOAT).addAttribute(\"aColor\",this._buffer,4,!0,V.UNSIGNED_BYTE).addAttribute(\"aTextureId\",this._buffer,1,!0,V.FLOAT).addIndex(this._indexBuffer)}}const Kr=Math.PI*2,Cd=180/Math.PI,Sd=Math.PI/180;var Pt=(r=>(r[r.POLY=0]=\"POLY\",r[r.RECT=1]=\"RECT\",r[r.CIRC=2]=\"CIRC\",r[r.ELIP=3]=\"ELIP\",r[r.RREC=4]=\"RREC\",r))(Pt||{});class Z{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Z(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}Z.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Rs=[new Z,new Z,new Z,new Z];class Y{constructor(t=0,e=0,i=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(s),this.type=Pt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Y(0,0,0,0)}clone(){return new Y(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const b=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=b)return!1;const R=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>R}const i=this.left,s=this.right,n=this.top,a=this.bottom;if(s<=i||a<=n)return!1;const o=Rs[0].set(t.left,t.top),h=Rs[1].set(t.left,t.bottom),l=Rs[2].set(t.right,t.top),u=Rs[3].set(t.right,t.bottom);if(l.x<=o.x||h.y<=o.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(c===0||(e.apply(o,o),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(o.x,h.x,l.x,u.x)<=i||Math.min(o.x,h.x,l.x,u.x)>=s||Math.max(o.y,h.y,l.y,u.y)<=n||Math.min(o.y,h.y,l.y,u.y)>=a))return!1;const d=c*(h.y-o.y),f=c*(o.x-h.x),p=d*i+f*n,m=d*s+f*n,g=d*i+f*a,y=d*s+f*a;if(Math.max(p,m,g,y)<=d*o.x+f*o.y||Math.min(p,m,g,y)>=d*u.x+f*u.y)return!1;const x=c*(o.y-l.y),_=c*(l.x-o.x),v=x*i+_*n,T=x*s+_*n,S=x*i+_*a,w=x*s+_*a;return!(Math.max(v,T,S,w)<=x*o.x+_*o.y||Math.min(v,T,S,w)>=x*u.x+_*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=s-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=s,this.height=n-s,this}}Y.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class ps{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=Pt.CIRC}clone(){return new ps(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let s=this.x-t,n=this.y-e;return s*=s,n*=n,s+n<=i}getBounds(){return new Y(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}ps.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class ms{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s,this.type=Pt.ELIP}clone(){return new ms(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,s=(e-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new Y(this.x-this.width,this.y-this.height,this.width,this.height)}}ms.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class si{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!=\"number\"){const i=[];for(let s=0,n=e.length;s<n;s++)i.push(e[s].x,e[s].y);e=i}this.points=e,this.type=Pt.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new si(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const s=this.points.length/2;for(let n=0,a=s-1;n<s;a=n++){const o=this.points[n*2],h=this.points[n*2+1],l=this.points[a*2],u=this.points[a*2+1];h>e!=u>e&&t<(l-o)*((e-h)/(u-h))+o&&(i=!i)}return i}}si.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((r,t)=>`${r}, ${t}`,\"\")}]`};class gs{constructor(t=0,e=0,i=0,s=0,n=20){this.x=t,this.y=e,this.width=i,this.height=s,this.radius=n,this.type=Pt.RREC}clone(){return new gs(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let s=t-(this.x+i),n=e-(this.y+i);const a=i*i;if(s*s+n*n<=a||(s=t-(this.x+this.width-i),s*s+n*n<=a)||(n=e-(this.y+this.height-i),s*s+n*n<=a)||(s=t-(this.x+i),s*s+n*n<=a))return!0}return!1}}gs.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class et{constructor(t=1,e=0,i=0,s=1,n=0,a=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,s,n,a){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new Z;const i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e}applyInverse(t,e){e=e||new Z;const i=1/(this.a*this.d+this.c*-this.b),s=t.x,n=t.y;return e.x=this.d*i*s+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*n+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.a,n=this.c,a=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this}append(t){const e=this.a,i=this.b,s=this.c,n=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this}setTransform(t,e,i,s,n,a,o,h,l){return this.a=Math.cos(o+l)*n,this.b=Math.sin(o+l)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=t-(i*this.a+s*this.c),this.ty=e-(i*this.b+s*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,s=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,s=this.c,n=this.d,a=t.pivot,o=-Math.atan2(-s,n),h=Math.atan2(i,e),l=Math.abs(o+h);return l<1e-5||Math.abs(Kr-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=h),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(s*s+n*n),t.position.x=this.tx+(a.x*e+a.y*s),t.position.y=this.ty+(a.x*i+a.y*n),t}invert(){const t=this.a,e=this.b,i=this.c,s=this.d,n=this.tx,a=t*s-e*i;return this.a=s/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-s*n)/a,this.ty=-(t*this.ty-e*n)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new et;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new et}static get TEMP_MATRIX(){return new et}}et.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const yi=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],vi=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],xi=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],bi=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Io=[],Ad=[],Ds=Math.sign;function ov(){for(let r=0;r<16;r++){const t=[];Io.push(t);for(let e=0;e<16;e++){const i=Ds(yi[r]*yi[e]+xi[r]*vi[e]),s=Ds(vi[r]*yi[e]+bi[r]*vi[e]),n=Ds(yi[r]*xi[e]+xi[r]*bi[e]),a=Ds(vi[r]*xi[e]+bi[r]*bi[e]);for(let o=0;o<16;o++)if(yi[o]===i&&vi[o]===s&&xi[o]===n&&bi[o]===a){t.push(o);break}}}for(let r=0;r<16;r++){const t=new et;t.set(yi[r],vi[r],xi[r],bi[r],0,0),Ad.push(t)}}ov();const lt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>yi[r],uY:r=>vi[r],vX:r=>xi[r],vY:r=>bi[r],inv:r=>r&8?r&15:-r&7,add:(r,t)=>Io[r][t],sub:(r,t)=>Io[r][lt.inv(t)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,t)=>Math.abs(r)*2<=Math.abs(t)?t>=0?lt.S:lt.N:Math.abs(t)*2<=Math.abs(r)?r>0?lt.E:lt.W:t>0?r>0?lt.SE:lt.SW:r>0?lt.NE:lt.NW,matrixAppendRotationInv:(r,t,e=0,i=0)=>{const s=Ad[lt.inv(t)];s.tx=e,s.ty=i,r.append(s)}};class le{constructor(t,e,i=0,s=0){this._x=i,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new le(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}le.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Ro=class{constructor(){this.worldTransform=new et,this.localTransform=new et,this.position=new le(this.onChange,this,0,0),this.scale=new le(this.onChange,this,1,1),this.pivot=new le(this.onChange,this,0,0),this.skew=new le(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){const e=r.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};Ro.IDENTITY=new Ro;let dr=Ro;dr.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var hv=`varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}`,lv=`attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n`;function yu(r,t,e){const i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function ka(r){const t=new Array(r);for(let e=0;e<t.length;e++)t[e]=!1;return t}function Pd(r,t){switch(r){case\"float\":return 0;case\"vec2\":return new Float32Array(2*t);case\"vec3\":return new Float32Array(3*t);case\"vec4\":return new Float32Array(4*t);case\"int\":case\"uint\":case\"sampler2D\":case\"sampler2DArray\":return 0;case\"ivec2\":return new Int32Array(2*t);case\"ivec3\":return new Int32Array(3*t);case\"ivec4\":return new Int32Array(4*t);case\"uvec2\":return new Uint32Array(2*t);case\"uvec3\":return new Uint32Array(3*t);case\"uvec4\":return new Uint32Array(4*t);case\"bool\":return!1;case\"bvec2\":return ka(2*t);case\"bvec3\":return ka(3*t);case\"bvec4\":return ka(4*t);case\"mat2\":return new Float32Array([1,0,0,1]);case\"mat3\":return new Float32Array([1,0,0,0,1,0,0,0,1]);case\"mat4\":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Ii=[{test:r=>r.type===\"float\"&&r.size===1&&!r.isArray,code:r=>`\n            if(uv[\"${r}\"] !== ud[\"${r}\"].value)\n            {\n                ud[\"${r}\"].value = uv[\"${r}\"]\n                gl.uniform1f(ud[\"${r}\"].location, uv[\"${r}\"])\n            }\n            `},{test:(r,t)=>(r.type===\"sampler2D\"||r.type===\"samplerCube\"||r.type===\"sampler2DArray\")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv[\"${r}\"], t);\n\n            if(ud[\"${r}\"].value !== t)\n            {\n                ud[\"${r}\"].value = t;\n                gl.uniform1i(ud[\"${r}\"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(r,t)=>r.type===\"mat3\"&&r.size===1&&!r.isArray&&t.a!==void 0,code:r=>`\n            gl.uniformMatrix3fv(ud[\"${r}\"].location, false, uv[\"${r}\"].toArray(true));\n            `,codeUbo:r=>`\n                var ${r}_matrix = uv.${r}.toArray(true);\n\n                data[offset] = ${r}_matrix[0];\n                data[offset+1] = ${r}_matrix[1];\n                data[offset+2] = ${r}_matrix[2];\n        \n                data[offset + 4] = ${r}_matrix[3];\n                data[offset + 5] = ${r}_matrix[4];\n                data[offset + 6] = ${r}_matrix[5];\n        \n                data[offset + 8] = ${r}_matrix[6];\n                data[offset + 9] = ${r}_matrix[7];\n                data[offset + 10] = ${r}_matrix[8];\n            `},{test:(r,t)=>r.type===\"vec2\"&&r.size===1&&!r.isArray&&t.x!==void 0,code:r=>`\n                cv = ud[\"${r}\"].value;\n                v = uv[\"${r}\"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud[\"${r}\"].location, v.x, v.y);\n                }`,codeUbo:r=>`\n                v = uv.${r};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:r=>r.type===\"vec2\"&&r.size===1&&!r.isArray,code:r=>`\n                cv = ud[\"${r}\"].value;\n                v = uv[\"${r}\"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud[\"${r}\"].location, v[0], v[1]);\n                }\n            `},{test:(r,t)=>r.type===\"vec4\"&&r.size===1&&!r.isArray&&t.width!==void 0,code:r=>`\n                cv = ud[\"${r}\"].value;\n                v = uv[\"${r}\"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud[\"${r}\"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:r=>`\n                    v = uv.${r};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(r,t)=>r.type===\"vec4\"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`\n                cv = ud[\"${r}\"].value;\n                v = uv[\"${r}\"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud[\"${r}\"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:r=>`\n                    v = uv.${r};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(r,t)=>r.type===\"vec3\"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`\n                cv = ud[\"${r}\"].value;\n                v = uv[\"${r}\"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud[\"${r}\"].location, v.red, v.green, v.blue)\n                }`,codeUbo:r=>`\n                    v = uv.${r};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:r=>r.type===\"vec4\"&&r.size===1&&!r.isArray,code:r=>`\n                cv = ud[\"${r}\"].value;\n                v = uv[\"${r}\"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud[\"${r}\"].location, v[0], v[1], v[2], v[3])\n                }`}],uv={float:`\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }`,vec2:`\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }`,vec3:`\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }`,vec4:`\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }`,int:`\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }`,ivec2:`\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }`,ivec3:`\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }`,ivec4:`\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }`,uint:`\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }`,uvec2:`\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }`,uvec3:`\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }`,uvec4:`\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }`,bool:`\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }`,bvec2:`\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }`,bvec3:`\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }`,bvec4:`\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }`,mat2:\"gl.uniformMatrix2fv(location, false, v)\",mat3:\"gl.uniformMatrix3fv(location, false, v)\",mat4:\"gl.uniformMatrix4fv(location, false, v)\",sampler2D:`\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }`,samplerCube:`\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }`,sampler2DArray:`\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }`},cv={float:\"gl.uniform1fv(location, v)\",vec2:\"gl.uniform2fv(location, v)\",vec3:\"gl.uniform3fv(location, v)\",vec4:\"gl.uniform4fv(location, v)\",mat4:\"gl.uniformMatrix4fv(location, false, v)\",mat3:\"gl.uniformMatrix3fv(location, false, v)\",mat2:\"gl.uniformMatrix2fv(location, false, v)\",int:\"gl.uniform1iv(location, v)\",ivec2:\"gl.uniform2iv(location, v)\",ivec3:\"gl.uniform3iv(location, v)\",ivec4:\"gl.uniform4iv(location, v)\",uint:\"gl.uniform1uiv(location, v)\",uvec2:\"gl.uniform2uiv(location, v)\",uvec3:\"gl.uniform3uiv(location, v)\",uvec4:\"gl.uniform4uiv(location, v)\",bool:\"gl.uniform1iv(location, v)\",bvec2:\"gl.uniform2iv(location, v)\",bvec3:\"gl.uniform3iv(location, v)\",bvec4:\"gl.uniform4iv(location, v)\",sampler2D:\"gl.uniform1iv(location, v)\",samplerCube:\"gl.uniform1iv(location, v)\",sampler2DArray:\"gl.uniform1iv(location, v)\"};function dv(r,t){const e=[`\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    `];for(const i in r.uniforms){const s=t[i];if(!s){r.uniforms[i]?.group===!0&&(r.uniforms[i].ubo?e.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');\n                    `):e.push(`\n                        renderer.shader.syncUniformGroup(uv.${i}, syncData);\n                    `));continue}const n=r.uniforms[i];let a=!1;for(let o=0;o<Ii.length;o++)if(Ii[o].test(s,n)){e.push(Ii[o].code(i,n)),a=!0;break}if(!a){const o=(s.size===1&&!s.isArray?uv:cv)[s.type].replace(\"location\",`ud[\"${i}\"].location`);e.push(`\n            cu = ud[\"${i}\"];\n            cv = cu.value;\n            v = uv[\"${i}\"];\n            ${o};`)}}return new Function(\"ud\",\"uv\",\"renderer\",\"syncData\",e.join(`\n`))}const Md={};let Fs=Md;function Id(){if(Fs===Md||Fs?.isContextLost()){const r=N.ADAPTER.createCanvas();let t;N.PREFER_ENV>=ui.WEBGL2&&(t=r.getContext(\"webgl2\",{})),t||(t=r.getContext(\"webgl\",{})||r.getContext(\"experimental-webgl\",{}),t?t.getExtension(\"WEBGL_draw_buffers\"):t=null),Fs=t}return Fs}let Bs;function fv(){if(!Bs){Bs=zt.MEDIUM;const r=Id();if(r&&r.getShaderPrecisionFormat){const t=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);t&&(Bs=t.precision?zt.HIGH:zt.MEDIUM)}}return Bs}function vu(r,t){const e=r.getShaderSource(t).split(`\n`).map((l,u)=>`${u}: ${l}`),i=r.getShaderInfoLog(t),s=i.split(`\n`),n={},a=s.map(l=>parseFloat(l.replace(/^ERROR\\: 0\\:([\\d]+)\\:.*$/,\"$1\"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),o=[\"\"];a.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,o.push(\"background: #FF0000; color:#FFFFFF; font-size: 10px\",\"font-size: 10px\")});const h=e.join(`\n`);o[0]=h,console.error(i),console.groupCollapsed(\"click to view full shader code\"),console.warn(...o),console.groupEnd()}function pv(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||vu(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||vu(r,i),console.error(\"PixiJS Error: Could not initialize shader.\"),r.getProgramInfoLog(t)!==\"\"&&console.warn(\"PixiJS Warning: gl.getProgramInfoLog()\",r.getProgramInfoLog(t)))}const mv={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Rd(r){return mv[r]}let Ls=null;const xu={FLOAT:\"float\",FLOAT_VEC2:\"vec2\",FLOAT_VEC3:\"vec3\",FLOAT_VEC4:\"vec4\",INT:\"int\",INT_VEC2:\"ivec2\",INT_VEC3:\"ivec3\",INT_VEC4:\"ivec4\",UNSIGNED_INT:\"uint\",UNSIGNED_INT_VEC2:\"uvec2\",UNSIGNED_INT_VEC3:\"uvec3\",UNSIGNED_INT_VEC4:\"uvec4\",BOOL:\"bool\",BOOL_VEC2:\"bvec2\",BOOL_VEC3:\"bvec3\",BOOL_VEC4:\"bvec4\",FLOAT_MAT2:\"mat2\",FLOAT_MAT3:\"mat3\",FLOAT_MAT4:\"mat4\",SAMPLER_2D:\"sampler2D\",INT_SAMPLER_2D:\"sampler2D\",UNSIGNED_INT_SAMPLER_2D:\"sampler2D\",SAMPLER_CUBE:\"samplerCube\",INT_SAMPLER_CUBE:\"samplerCube\",UNSIGNED_INT_SAMPLER_CUBE:\"samplerCube\",SAMPLER_2D_ARRAY:\"sampler2DArray\",INT_SAMPLER_2D_ARRAY:\"sampler2DArray\",UNSIGNED_INT_SAMPLER_2D_ARRAY:\"sampler2DArray\"};function Dd(r,t){if(!Ls){const e=Object.keys(xu);Ls={};for(let i=0;i<e.length;++i){const s=e[i];Ls[r[s]]=xu[s]}}return Ls[t]}function bu(r,t,e){if(r.substring(0,9)!==\"precision\"){let i=t;return t===zt.HIGH&&e!==zt.HIGH&&(i=zt.MEDIUM),`precision ${i} float;\n${r}`}else if(e!==zt.HIGH&&r.substring(0,15)===\"precision highp\")return r.replace(\"precision highp\",\"precision mediump\");return r}let vr;function Fd(){if(typeof vr==\"boolean\")return vr;try{vr=new Function(\"param1\",\"param2\",\"param3\",\"return param1[param2] === param3;\")({a:\"b\"},\"a\",\"b\")===!0}catch{vr=!1}return vr}let gv=0;const Os={},Do=class Wi{constructor(t,e,i=\"pixi-shader\",s={}){this.extra={},this.id=gv++,this.vertexSrc=t||Wi.defaultVertexSrc,this.fragmentSrc=e||Wi.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!==\"#version\"&&(i=i.replace(/\\s+/g,\"-\"),Os[i]?(Os[i]++,i+=`-${Os[i]}`):Os[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}\n${this.fragmentSrc}`,this.vertexSrc=bu(this.vertexSrc,Wi.defaultVertexPrecision,zt.HIGH),this.fragmentSrc=bu(this.fragmentSrc,Wi.defaultFragmentPrecision,fv())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return lv}static get defaultFragmentSrc(){return hv}static from(t,e,i){const s=t+e;let n=Ao[s];return n||(Ao[s]=n=new Wi(t,e,i)),n}};Do.defaultVertexPrecision=zt.HIGH,Do.defaultFragmentPrecision=he.apple.device?zt.HIGH:zt.MEDIUM;let Ie=Do,_v=0;class Qt{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=_v++,this.static=!!e,this.ubo=!!i,t instanceof pt?(this.buffer=t,this.buffer.type=ue.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new pt(new Float32Array(1)),this.buffer.type=ue.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(!this.ubo)this.uniforms[t]=new Qt(e,i);else throw new Error(\"[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them\")}static from(t,e,i){return new Qt(t,e,i)}static uboFrom(t,e){return new Qt(t,e??!0,!0)}}class de{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Qt?this.uniformGroup=e:this.uniformGroup=new Qt(e):this.uniformGroup=new Qt({}),this.disposeRunner=new Wt(\"disposeShader\")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const s=e.uniforms[i];if(s.group===!0&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const s=Ie.from(t,e);return new de(s,i)}}class Bd{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes(\"%count%\"))throw new Error('Fragment template must contain \"%count%\".');if(!e.includes(\"%forloop%\"))throw new Error('Fragment template must contain \"%forloop%\".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=n;this.defaultGroupCache[t]=Qt.from({uSamplers:i},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ie(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new et,default:this.defaultGroupCache[t]};return new de(this.programCache[t],e)}generateSampleSrc(t){let e=\"\";e+=`\n`,e+=`\n`;for(let i=0;i<t;i++)i>0&&(e+=`\nelse `),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+=`\n{`,e+=`\n\tcolor = texture2D(uSamplers[${i}], vTextureCoord);`,e+=`\n}`;return e+=`\n`,e+=`\n`,e}}class Sn{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function yv(){return!he.apple.device}function vv(r){let t=!0;const e=N.ADAPTER.getNavigator();if(he.tablet||he.phone){if(he.apple.device){const i=e.userAgent.match(/OS (\\d+)_(\\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(he.android.device){const i=e.userAgent.match(/Android\\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?r:4}class _s{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var xv=`varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n`,bv=`precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n`;const Sr=class se extends _s{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=wh,this.vertexSize=6,this.state=pe.for2d(),this.size=se.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on(\"prerender\",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??vv(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??yv(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return z(\"7.1.0\",\"BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures\"),this.maxTextures}static get defaultVertexSrc(){return bv}static get defaultFragmentTemplate(){return xv}setShaderGenerator({vertex:t=se.defaultVertexSrc,fragment:e=se.defaultFragmentTemplate}={}){this.shaderGenerator=new Bd(t,e)}contextChange(){const t=this.renderer.gl;N.PREFER_ENV===ui.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),se.defaultMaxTextures),this.maxTextures=Ed(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=se,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new Cn);for(;e.length<s;)e.push(new Sn);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,i=se._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,a=this.renderer.textureGC.count;let o=++j._globalBatch,h=0,l=i[0],u=0;s.copyBoundTextures(n,e);for(let c=0;c<this._bufferSize;++c){const d=t[c];t[c]=null,d._batchEnabled!==o&&(l.count>=e&&(s.boundArray(l,n,o,e),this.buildDrawCalls(l,u,c),u=c,l=i[++h],++o),d._batchEnabled=o,d.touched=a,l.elements[l.count++]=d)}l.count>0&&(s.boundArray(l,n,o,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++o);for(let c=0;c<n.length;c++)n[c]=null;j._globalBatch=o}buildDrawCalls(t,e,i){const{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:a,vertexSize:o}=this,h=se._drawCallPool;let l=this._dcIndex,u=this._aIndex,c=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=t;for(let f=e;f<i;++f){const p=s[f],m=p._texture.baseTexture,g=xh[m.alphaMode?1:0][p.blendMode];s[f]=null,e<f&&d.blend!==g&&(d.size=c-d.start,e=f,d=h[++l],d.texArray=t,d.start=c),this.packInterleavedGeometry(p,n,a,u,c),u+=p.vertexData.length/2*o,c+=p.indices.length,d.blend=g}e<i&&(d.size=c-d.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;se.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:i}=this.renderer,s=se._drawCallPool;let n=null;for(let a=0;a<t;a++){const{texArray:o,type:h,size:l,start:u,blend:c}=s[a];n!==o&&(n=o,this.bindAndClearTexArray(o)),this.state.blendMode=c,i.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),se.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off(\"prerender\",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Yr(Math.ceil(t/8)),i=Eo(e),s=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new wn(s*this.vertexSize*4)),n}getIndexBuffer(t){const e=Yr(Math.ceil(t/12)),i=Eo(e),s=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._iBuffers[i];return n||(this._iBuffers[i]=n=new Uint16Array(s)),n}packInterleavedGeometry(t,e,i,s,n){const{uint32View:a,float32View:o}=e,h=s/this.vertexSize,l=t.uvs,u=t.indices,c=t.vertexData,d=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),p=tt.shared.setValue(t._tintRGB).toPremultiplied(f,t._texture.baseTexture.alphaMode>0);for(let m=0;m<c.length;m+=2)o[s++]=c[m],o[s++]=c[m+1],o[s++]=l[m],o[s++]=l[m+1],a[s++]=p,o[s++]=d;for(let m=0;m<u.length;m++)i[n++]=h+u[m]}};Sr.defaultBatchSize=4096,Sr.extension={name:\"batch\",type:F.RendererPlugin},Sr._drawCallPool=[],Sr._textureArrayPool=[];let Qe=Sr;k.add(Qe);var Tv=`varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n`,wv=`attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n`;const Fo=class Ar extends de{constructor(t,e,i){const s=Ie.from(t||Ar.defaultVertexSrc,e||Ar.defaultFragmentSrc);super(s,i),this.padding=0,this.resolution=Ar.defaultResolution,this.multisample=Ar.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new pe}apply(t,e,i,s,n){t.applyFilter(this,e,i,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return wv}static get defaultFragmentSrc(){return Tv}};Fo.defaultResolution=1,Fo.defaultMultisample=mt.NONE;let Ft=Fo;class Zr{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new tt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:i,backgroundAlpha:s}=t,n=i??e;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Zr.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Zr.extension={type:[F.RendererSystem,F.CanvasRendererSystem],name:\"background\"};k.add(Zr);class Eh{constructor(t){this.renderer=t,this.emptyRenderer=new _s(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=i[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,i,s){const{elements:n,ids:a,count:o}=t;let h=0;for(let l=0;l<o;l++){const u=n[l],c=u._batchLocation;if(c>=0&&c<s&&e[c]===u){a[l]=c;continue}for(;h<s;){const d=e[h];if(d&&d._batchEnabled===i&&d._batchLocation===h){h++;continue}a[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}}Eh.extension={type:F.RendererSystem,name:\"batch\"};k.add(Eh);let Tu=0;class Jr{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Tu++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Tu++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener(\"webglcontextlost\",this.handleContextLost,!1),e.addEventListener(\"webglcontextrestored\",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(N.PREFER_ENV>=ui.WEBGL2&&(i=t.getContext(\"webgl2\",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext(\"webgl\",e)||t.getContext(\"experimental-webgl\",e),!i)throw new Error(\"This browser does not support WebGL. Try using the canvas renderer\");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension(\"WEBGL_lose_context\"),anisotropicFiltering:t.getExtension(\"EXT_texture_filter_anisotropic\"),floatTextureLinear:t.getExtension(\"OES_texture_float_linear\"),s3tc:t.getExtension(\"WEBGL_compressed_texture_s3tc\"),s3tc_sRGB:t.getExtension(\"WEBGL_compressed_texture_s3tc_srgb\"),etc:t.getExtension(\"WEBGL_compressed_texture_etc\"),etc1:t.getExtension(\"WEBGL_compressed_texture_etc1\"),pvrtc:t.getExtension(\"WEBGL_compressed_texture_pvrtc\")||t.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\"),atc:t.getExtension(\"WEBGL_compressed_texture_atc\"),astc:t.getExtension(\"WEBGL_compressed_texture_astc\"),bptc:t.getExtension(\"EXT_texture_compression_bptc\")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension(\"WEBGL_draw_buffers\"),depthTexture:t.getExtension(\"WEBGL_depth_texture\"),vertexArrayObject:t.getExtension(\"OES_vertex_array_object\")||t.getExtension(\"MOZ_OES_vertex_array_object\")||t.getExtension(\"WEBKIT_OES_vertex_array_object\"),uint32ElementIndex:t.getExtension(\"OES_element_index_uint\"),floatTexture:t.getExtension(\"OES_texture_float\"),floatTextureLinear:t.getExtension(\"OES_texture_float_linear\"),textureHalfFloat:t.getExtension(\"OES_texture_half_float\"),textureHalfFloatLinear:t.getExtension(\"OES_texture_half_float_linear\")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension(\"EXT_color_buffer_float\")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener(\"webglcontextlost\",this.handleContextLost),t.removeEventListener(\"webglcontextrestored\",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i=\"WebGL2RenderingContext\"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn(\"Provided WebGL context does not have a stencil buffer, masks may not render correctly\");const s=i||!!t.getExtension(\"OES_element_index_uint\");this.supports.uint32Indices=s,s||console.warn(\"Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly\")}}Jr.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:\"default\"},Jr.extension={type:F.RendererSystem,name:\"context\"};k.add(Jr);class An{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error(\"Framebuffer width or height is zero\");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Wt(\"disposeFramebuffer\"),this.multisample=mt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new j(null,{scaleMode:Me.NEAREST,resolution:1,mipmap:fe.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new j(null,{scaleMode:Me.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:fe.OFF,format:M.DEPTH_COMPONENT,type:V.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error(\"Framebuffer width and height must not be zero\");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const s=this.colorTextures[i],n=s.resolution;s.setSize(t/n,e/n)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Ch extends j{constructor(t={}){if(typeof t==\"number\"){const e=arguments[0],i=arguments[1],s=arguments[2],n=arguments[3];t={width:e,height:i,scaleMode:s,resolution:n}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=mt.NONE),super(null,t),this.mipmap=fe.OFF,this.valid=!0,this._clear=new tt([0,0,0,0]),this.framebuffer=new An(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Fe extends hr{constructor(t){const e=t,i=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,s=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;super(i,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){i===void 0&&!e.startsWith(\"data:\")?t.crossOrigin=wd(e):i!==!1&&(t.crossOrigin=typeof i==\"string\"?i:\"anonymous\")}upload(t,e,i,s){const n=t.gl,a=e.realWidth,o=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<\"u\"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<\"u\"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Nt.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&i.width===a&&i.height===o?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,i.type,s):(i.width=a,i.height=o,n.texImage2D(e.target,0,i.internalFormat,e.format,i.type,s)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class Sh extends Fe{constructor(t,e){if(e=e||{},typeof t==\"string\"){const i=new Image;Fe.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??N.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode==\"number\"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,i)=>{const s=this.source;this.url=s.src;const n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=a=>{i(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin===\"anonymous\";return this._process=fetch(t.src,{mode:i?\"cors\":\"no-cors\"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Nt.UNPACK?\"premultiply\":\"none\"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if(typeof this.alphaMode==\"number\"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let s=!0;const n=e._glTextures;for(const a in n){const o=n[a];if(o!==i&&o.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<\"u\"&&(typeof t==\"string\"||t instanceof HTMLImageElement)}}class Jn{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const s=e.width,n=e.height;if(i){const a=t.width/2/s,o=t.height/2/n,h=t.x/s+a,l=t.y/n+o;i=lt.add(i,lt.NW),this.x0=h+a*lt.uX(i),this.y0=l+o*lt.uY(i),i=lt.add(i,2),this.x1=h+a*lt.uX(i),this.y1=l+o*lt.uY(i),i=lt.add(i,2),this.x2=h+a*lt.uX(i),this.y2=l+o*lt.uY(i),i=lt.add(i,2),this.x3=h+a*lt.uX(i),this.y3=l+o*lt.uY(i)}else this.x0=t.x/s,this.y0=t.y/n,this.x1=(t.x+t.width)/s,this.y1=t.y/n,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/n,this.x3=t.x/s,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}Jn.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const wu=new Jn;function Ns(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}class B extends Ye{constructor(t,e,i,s,n,a,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Y(0,0,1,1)),t instanceof B&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=wu,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error(\"attempt to use diamond-shaped UVs. If you are sure, set rotation manually\");this.defaultAnchor=a?new Z(a.x,a.y):new Z(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once(\"loaded\",this.onBaseTextureUpdated,this),this.noFrame&&t.on(\"update\",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit(\"update\",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e?.url&&Lt[e.url]&&B.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off(\"loaded\",this.onBaseTextureUpdated,this),this.baseTexture.off(\"update\",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,B.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit(\"destroyed\",this),this.removeAllListeners()}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new B(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===wu&&(this._uvs=new Jn),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=N.STRICT_TEXTURE_CACHE){const s=typeof t==\"string\";let n=null;if(s)n=t;else if(t instanceof j){if(!t.cacheId){const o=e?.pixiIdPrefix||\"pixiid\";t.cacheId=`${o}-${oi()}`,j.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const o=e?.pixiIdPrefix||\"pixiid\";t._pixiId=`${o}_${oi()}`}n=t._pixiId}let a=Lt[n];if(s&&i&&!a)throw new Error(`The cacheId \"${n}\" does not exist in TextureCache.`);return!a&&!(t instanceof j)?(e.resolution||(e.resolution=De(t)),a=new B(new j(t,e)),a.baseTexture.cacheId=n,j.addToCache(a.baseTexture,n),B.addToCache(a,n)):!a&&t instanceof j&&(a=new B(t),B.addToCache(a,n)),a}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e?.resourceOptions),s=B.from(t,Object.assign({resourceOptions:i},e),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,i,s){return new B(j.fromBuffer(t,e,i,s))}static fromLoader(t,e,i,s){const n=new j(t,Object.assign({scaleMode:j.defaultOptions.scaleMode,resolution:De(e)},s)),{resource:a}=n;a instanceof Sh&&(a.url=e);const o=new B(n);return i||(i=e),j.addToCache(o.baseTexture,i),B.addToCache(o,i),i!==e&&(j.addToCache(o.baseTexture,e),B.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise(h=>{o.baseTexture.once(\"loaded\",()=>h(o))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Lt[e]&&Lt[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Lt[e]=t)}static removeFromCache(t){if(typeof t==\"string\"){const e=Lt[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Lt[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Lt[t.textureCacheIds[e]]===t&&delete Lt[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:s,height:n}=t,a=e+s>this.baseTexture.width,o=i+n>this.baseTexture.height;if(a||o){const h=a&&o?\"and\":\"or\",l=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,u=`Y: ${i} + ${n} = ${i+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return B._EMPTY||(B._EMPTY=new B(new j),Ns(B._EMPTY),Ns(B._EMPTY.baseTexture)),B._EMPTY}static get WHITE(){if(!B._WHITE){const t=N.ADAPTER.createCanvas(16,16),e=t.getContext(\"2d\");t.width=16,t.height=16,e.fillStyle=\"white\",e.fillRect(0,0,16,16),B._WHITE=new B(j.from(t)),Ns(B._WHITE),Ns(B._WHITE.baseTexture)}return B._WHITE}}class di extends B{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const s=this.baseTexture.resolution,n=Math.round(t*s)/s,a=Math.round(e*s)/s;this.valid=n>0&&a>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=a,i&&this.baseTexture.resize(n,a),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new di(new Ch(t))}}class Ah{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=mt.NONE){const s=new Ch(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new di(s)}getOptimalTexture(t,e,i=1,s=mt.NONE){let n;t=Math.max(Math.ceil(t*i-1e-6),1),e=Math.max(Math.ceil(e*i-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Yr(t),e=Yr(e),n=((t&65535)<<16|e&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(t,e,s)),a.filterPoolKey=n,a.setResolution(i),a}getFilterTexture(t,e,i){const s=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||mt.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const i=this.texturePool[e];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const i=this.texturePool[e];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Ah.SCREEN_KEY=-1;class Ld extends ze{constructor(){super(),this.addAttribute(\"aVertexPosition\",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Ph extends ze{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new pt(this.vertices),this.uvBuffer=new pt(this.uvs),this.addAttribute(\"aVertexPosition\",this.vertexBuffer).addAttribute(\"aTextureCoord\",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+e.width/t.width,this.uvs[3]=s,this.uvs[4]=i+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=i,this.uvs[7]=s+e.height/t.height,i=e.x,s=e.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+e.width,this.vertices[3]=s,this.vertices[4]=i+e.width,this.vertices[5]=s+e.height,this.vertices[6]=i,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Od{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=mt.NONE,this.sourceFrame=new Y,this.destinationFrame=new Y,this.bindingSourceFrame=new Y,this.bindingDestinationFrame=new Y,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Us=[new Z,new Z,new Z,new Z],Ga=new et;class Mh{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Ah,this.statePool=[],this.quad=new Ld,this.quadUv=new Ph,this.tempRect=new Y,this.activeState={},this.globalUniforms=new Qt({outputFrame:new Y,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new Od,a=i.renderTexture;let o,h;if(a.current){const g=a.current;o=g.resolution,h=g.multisample}else o=i.resolution,h=i.multisample;let l=e[0].resolution||o,u=e[0].multisample??h,c=e[0].padding,d=e[0].autoFit,f=e[0].legacy??!0;for(let g=1;g<e.length;g++){const y=e[g];l=Math.min(l,y.resolution||o),u=Math.min(u,y.multisample??h),c=this.useMaxPadding?Math.max(c,y.padding):c+y.padding,d=d&&y.autoFit,f=f||(y.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),s.push(n),n.resolution=l,n.multisample=u,n.legacy=f,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(c);const p=this.tempRect.copyFrom(a.sourceFrame);i.projection.transform&&this.transformAABB(Ga.copyFrom(i.projection.transform).invert(),p),d?(n.sourceFrame.fit(p),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(p)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,a.current?a.current.resolution:i.resolution,a.sourceFrame,a.destinationFrame,i.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,l,u),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const m=this.tempRect;m.x=0,m.y=0,m.width=n.sourceFrame.width,m.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(a.sourceFrame),n.bindingDestinationFrame.copyFrom(a.destinationFrame),n.transform=i.projection.transform,i.projection.transform=null,a.bind(n.renderTexture,n.sourceFrame,m),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const n=s.inputSize,a=s.inputPixel,o=s.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*e.resolution),a[1]=Math.round(n[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=e.sourceFrame.width*n[2]-.5*a[2],o[3]=e.sourceFrame.height*n[3]-.5*a[3],e.legacy){const l=s.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,h.renderTexture,ae.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let c=0;for(c=0;c<i.length-1;++c){c===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),i[c].apply(this,l,u,ae.CLEAR,e);const d=l;l=u,u=d}i[c].apply(this,l,h.renderTexture,ae.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=ae.CLEAR){const{renderTexture:i,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,i.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=s.stateId&1||this.forceClear;(e===ae.CLEAR||e===ae.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,s){const n=this.renderer;n.state.set(t.state),this.bindAndClear(i,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(oe.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(oe.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:n}=e._texture,a=t.set(s.width,0,0,s.height,i.x,i.y),o=e.worldTransform.copyTo(et.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/n.width,1/n.height),a.translate(e.anchor.x,e.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,s=mt.NONE){return this.texturePool.getOptimalTexture(t,e,i,s)}getFilterTexture(t,e,i){if(typeof t==\"number\"){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||mt.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=Us[0],s=Us[1],n=Us[2],a=Us[3];i.set(e.left,e.top),s.set(e.left,e.bottom),n.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(i,i),t.apply(s,s),t.apply(n,n),t.apply(a,a);const o=Math.min(i.x,s.x,n.x,a.x),h=Math.min(i.y,s.y,n.y,a.y),l=Math.max(i.x,s.x,n.x,a.x),u=Math.max(i.y,s.y,n.y,a.y);e.x=o,e.y=h,e.width=l-o,e.height=u-h}roundFrame(t,e,i,s,n){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(n){const{a,b:o,c:h,d:l}=n;if((Math.abs(o)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(l)>1e-4))return}n=n?Ga.copyFrom(n):Ga.identity(),n.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}Mh.extension={type:F.RendererSystem,name:\"filter\"};k.add(Mh);class Nd{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=mt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Ev=new Y;class Ih{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new An(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Y,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;N.PREFER_ENV===ui.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:s}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=i),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const o=t.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const a=e.width>>i,o=e.height>>i,h=a/e.width;this.setViewport(e.x*h,e.y*h,a,o)}else{const a=t.width>>i,o=t.height>>i;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,s){const n=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),(n.width!==i||n.height!==s||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=i,n.height=s,this.gl.viewport(t,e,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,s,n=gn.COLOR|gn.DEPTH){const{gl:a}=this;a.clearColor(t,e,i,s),a.clear(n)}initFramebuffer(t){const{gl:e}=this,i=new Nd(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];if(i.stencil){e.bindRenderbuffer(e.RENDERBUFFER,i.stencil);let a;this.renderer.context.webGLVersion===1?a=e.DEPTH_STENCIL:t.depth&&t.stencil?a=e.DEPTH24_STENCIL8:t.depth?a=e.DEPTH_COMPONENT24:a=e.STENCIL_INDEX8,i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,a,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,a,t.width,t.height)}const s=t.colorTextures;let n=s.length;e.drawBuffers||(n=Math.min(n,1));for(let a=0;a<n;a++){const o=s[a],h=o.parentTextureArray||o;this.renderer.texture.bind(h,0),a===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,s=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let a=n.length;i.drawBuffers||(a=Math.min(a,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const o=[];for(let h=0;h<a;h++){const l=n[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),o.push(i.COLOR_ATTACHMENT0+h))}if(o.length>1&&i.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||i.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH_STENCIL):t.depth&&t.stencil?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH24_STENCIL8):t.depth?(h=i.DEPTH_ATTACHMENT,l=i.DEPTH_COMPONENT24):(h=i.STENCIL_ATTACHMENT,l=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,l,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,l,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,h,i.RENDERBUFFER,s.stencil)}else s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=mt.NONE;if(t<=1||e===null)return i;for(let s=0;s<e.length;s++)if(e[s]<=t){i=e[s];break}return i===1&&(i=mt.NONE),i}blit(t,e,i){const{current:s,renderer:n,gl:a,CONTEXT_UID:o}=this;if(n.context.webGLVersion!==2||!s)return;const h=s.glFramebuffers[o];if(!h)return;if(!t){if(!h.msaaBuffer)return;const u=s.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new An(s.width,s.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=Ev,e.width=s.width,e.height=s.height),i||(i=e);const l=e.width===i.width&&e.height===i.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const i=t.width,s=t.height,n=this.gl,a=e.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a);let o,h;this.renderer.context.webGLVersion===1?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH_STENCIL):t.depth?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH24_STENCIL8):(o=n.STENCIL_ATTACHMENT,h=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,h,i,s):n.renderbufferStorage(n.RENDERBUFFER,h,i,s),n.framebufferRenderbuffer(n.FRAMEBUFFER,o,n.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Y}destroy(){this.renderer=null}}Ih.extension={type:F.RendererSystem,name:\"framebuffer\"};k.add(Ih);const Va={5126:4,5123:2,5121:1};class Rh{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;N.PREFER_ENV===ui.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=s=>i.bindVertexArrayOES(s),t.deleteVertexArray=s=>i.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const i=t.getExtension(\"ANGLE_instanced_arrays\");i?(t.vertexAttribDivisor=(s,n)=>i.vertexAttribDivisorANGLE(s,n),t.drawElementsInstanced=(s,n,a,o,h)=>i.drawElementsInstancedANGLE(s,n,a,o,h),t.drawArraysInstanced=(s,n,a,o)=>i.drawArraysInstancedANGLE(s,n,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);const a=s[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?i.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const s=t.buffers[i];e.update(s)}}checkCompatibility(t,e){const i=t.attributes,s=e.attributeData;for(const n in s)if(!i[n])throw new Error(`shader and geometry incompatible, geometry missing the \"${n}\" attribute`)}getSignature(t,e){const i=t.attributes,s=e.attributeData,n=[\"g\",t.id];for(const a in i)s[a]&&n.push(a,s[a].location);return n.join(\"-\")}initGeometryVao(t,e,i=!0){const s=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,o=e.program;o.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const h=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID];let u=l[h];if(u)return l[o.id]=u,u;const c=t.buffers,d=t.attributes,f={},p={};for(const m in c)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&o.attributeData[m]?d[m].size=o.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*Va[d[m].type];for(const m in d){const g=d[m],y=g.size;g.stride===void 0&&(f[g.buffer]===y*Va[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=y*Va[g.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(let m=0;m<c.length;m++){const g=c[m];a.bind(g),i&&g._glBuffers[n].refCount++}return this.activateVao(t,o),l[o.id]=u,l[h]=u,s.bindVertexArray(null),a.unbind(ue.ARRAY_BUFFER),u}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=t.buffers,a=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!i){if(a)for(let o=0;o<n.length;o++){const h=n[o]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&a.dispose(n[o],e))}if(!e){for(const o in i)if(o[0]===\"g\"){const h=i[o];this._activeVao===h&&this.unbind(),s.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,a=t.buffers,o=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let h=null;for(const l in o){const u=o[l],c=a[u.buffer],d=c._glBuffers[s];if(e.attributeData[l]){h!==d&&(n.bind(c),h=d);const f=e.attributeData[l].location;if(i.enableVertexAttribArray(f),i.vertexAttribPointer(f,u.size,u.type||i.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)i.vertexAttribDivisor(f,u.divisor);else throw new Error(\"geometry error, GPU Instancing is not supported on this device\")}}}draw(t,e,i,s){const{gl:n}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,h=o===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(t,e||a.indexBuffer.data.length,h,(i||0)*o,s||1):n.drawElements(t,e||a.indexBuffer.data.length,h,(i||0)*o):console.warn(\"unsupported index buffer type: uint32\")}else a.instanced?n.drawArraysInstanced(t,i,e||a.getSize(),s||1):n.drawArrays(t,i,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Rh.extension={type:F.RendererSystem,name:\"geometry\"};k.add(Rh);const Eu=new et;class Qn{constructor(t,e){this._texture=t,this.mapCoord=new et,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>\"u\"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let s=0;s<t.length;s+=2){const n=t[s],a=t[s+1];e[s]=n*i.a+a*i.c+i.tx,e[s+1]=n*i.b+a*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const s=e.orig,n=e.trim;n&&(Eu.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Eu));const a=e.baseTexture,o=this.uClampFrame,h=this.clampMargin/a.resolution,l=this.clampOffset;return o[0]=(e._frame.x+h+l)/a.width,o[1]=(e._frame.y+h+l)/a.height,o[2]=(e._frame.x+e._frame.width-h+l)/a.width,o[3]=(e._frame.y+e._frame.height-h+l)/a.height,this.uClampOffset[0]=l/a.realWidth,this.uClampOffset[1]=l/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&e.rotate===0,!0}}var Cv=`varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n`,Sv=`attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n`;class Ud extends Ft{constructor(t,e,i){let s=null;typeof t!=\"string\"&&e===void 0&&i===void 0&&(s=t,t=void 0,e=void 0,i=void 0),super(t||Sv,e||Cv,i),this.maskSprite=s,this.maskMatrix=new et}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,s){const n=this._maskSprite,a=n._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new Qn(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,i,s))}}class kd{constructor(t=null){this.type=yt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Ft.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=yt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Dh{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const n=this.maskDataPool.pop()||new kd;n.pooled=!0,n.maskObject=e,i=n}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==yt.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case yt.SCISSOR:this.renderer.scissor.push(i);break;case yt.STENCIL:this.renderer.stencil.push(i);break;case yt.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case yt.COLOR:this.pushColorMask(i);break}i.type===yt.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case yt.SCISSOR:this.renderer.scissor.pop(e);break;case yt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case yt.SPRITE:this.popSpriteMask(e);break;case yt.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===yt.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=yt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=yt.SCISSOR:t.type=yt.STENCIL:t.type=yt.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Ud])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;const n=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,s),i.filterArea=n,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}Dh.extension={type:F.RendererSystem,name:\"mask\"};k.add(Dh);class Gd{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==i&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Cu=new et,Su=[],Vd=class sn extends Gd{constructor(t){super(t),this.glConst=N.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:i}=t,{renderer:s}=this,n=s.renderTexture,a=i.getBounds(!0,Su.pop()??new Y);this.roundFrameToPixels(a,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),e&&a.fit(e),t._scissorRectLocal=a}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:i,c:s,d:n}=t;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||sn.isMatrixRotated(e.worldTransform)||sn.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,s,n){sn.isMatrixRotated(n)||(n=n?Cu.copyFrom(n):Cu.identity(),n.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Su.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Vd.extension={type:F.RendererSystem,name:\"scissor\"};let Hd=Vd;k.add(Hd);class Fh extends Gd{constructor(t){super(t),this.glConst=N.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,i.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;s!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(i._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Fh.extension={type:F.RendererSystem,name:\"stencil\"};k.add(Fh);class Bh{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return z(\"7.0.0\",\"renderer.plugins.extract has moved to renderer.extract\"),t.extract}},prepare:{enumerable:!1,get(){return z(\"7.0.0\",\"renderer.plugins.prepare has moved to renderer.prepare\"),t.prepare}},interaction:{enumerable:!1,get(){return z(\"7.0.0\",\"renderer.plugins.interaction has been deprecated, use renderer.events\"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Bh.extension={type:[F.RendererSystem,F.CanvasRendererSystem],name:\"_plugin\"};k.add(Bh);class Lh{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new et,this.transform=null}update(t,e,i,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,i,s){const n=this.projectionMatrix,a=s?-1:1;n.identity(),n.a=1/e.width*2,n.d=a*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-a-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}Lh.extension={type:F.RendererSystem,name:\"projection\"};k.add(Lh);const Av=new dr,Au=new Y;class Oh{constructor(t){this.renderer=t,this._tempMatrix=new et}generateTexture(t,e){const{region:i,...s}=e||{},n=i?.copyTo(Au)||t.getLocalBounds(Au,!0),a=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/a),n.height=Math.max(n.height,1/a),s.width=n.width,s.height=n.height,s.resolution=a,s.multisample??(s.multisample=this.renderer.multisample);const o=di.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const h=t.transform;return t.transform=Av,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,o}destroy(){}}Oh.extension={type:[F.RendererSystem,F.CanvasRendererSystem],name:\"textureGenerator\"};k.add(Oh);const pi=new Y,xr=new Y;class Nh{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Y,this.destinationFrame=new Y,this.viewportFrame=new Y}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){const s=this.renderer;this.current=t;let n,a,o;t?(n=t.baseTexture,o=n.resolution,e||(pi.width=t.frame.width,pi.height=t.frame.height,e=pi),i||(xr.x=t.frame.x,xr.y=t.frame.y,xr.width=e.width,xr.height=e.height,i=xr),a=n.framebuffer):(o=s.resolution,e||(pi.width=s._view.screen.width,pi.height=s._view.screen.height,e=pi),i||(i=pi,i.width=e.width,i.height=e.height));const h=this.viewportFrame;h.x=i.x*o,h.y=i.y*o,h.width=i.width*o,h.height=i.height*o,t||(h.y=s.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(i,e,o,!a),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=tt.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);const n=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,o=n.width!==a.width||n.height!==a.height;if(o){let{x:h,y:l,width:u,height:c}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,c)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Nh.extension={type:F.RendererSystem,name:\"renderTexture\"};k.add(Nh);class Pv{}class Xd{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Mv(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const n=t.getActiveAttrib(r,s);if(n.name.startsWith(\"gl_\"))continue;const a=Dd(t,n.type),o={type:a,name:n.name,size:Rd(a),location:t.getAttribLocation(r,n.name)};e[n.name]=o}return e}function Iv(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){const n=t.getActiveUniform(r,s),a=n.name.replace(/\\[.*?\\]$/,\"\"),o=!!n.name.match(/\\[.*?\\]$/),h=Dd(t,n.type);e[a]={name:a,index:s,type:h,size:n.size,isArray:o,value:Pd(h,n.size)}}return e}function $d(r,t){const e=yu(r,r.VERTEX_SHADER,t.vertexSrc),i=yu(r,r.FRAGMENT_SHADER,t.fragmentSrc),s=r.createProgram();r.attachShader(s,e),r.attachShader(s,i);const n=t.extra?.transformFeedbackVaryings;if(n&&(typeof r.transformFeedbackVaryings!=\"function\"?console.warn(\"TransformFeedback is not supported but TransformFeedbackVaryings are given.\"):r.transformFeedbackVaryings(s,n.names,n.bufferMode===\"separate\"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)||pv(r,s,e,i),t.attributeData=Mv(s,r),t.uniformData=Iv(s,r),!/^[ \\t]*#[ \\t]*version[ \\t]+300[ \\t]+es[ \\t]*$/m.test(t.vertexSrc)){const o=Object.keys(t.attributeData);o.sort((h,l)=>h>l?1:-1);for(let h=0;h<o.length;h++)t.attributeData[o[h]].location=h,r.bindAttribLocation(s,h,o[h]);r.linkProgram(s)}r.deleteShader(e),r.deleteShader(i);const a={};for(const o in t.uniformData){const h=t.uniformData[o];a[o]={location:r.getUniformLocation(s,o),value:Pd(h.type,h.size)}}return new Xd(s,a)}function Rv(r,t,e,i,s){e.buffer.update(s)}const Dv={float:`\n        data[offset] = v;\n    `,vec2:`\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    `,vec3:`\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    `,vec4:`\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    `,mat2:`\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    `,mat3:`\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    `,mat4:`\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    `},zd={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Wd(r){const t=r.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let e=0,i=0,s=0;for(let n=0;n<t.length;n++){const a=t[n];if(e=zd[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,i%e!==0&&i<16){const o=i%e%16;i+=o,s+=o}i+e>16?(s=Math.ceil(s/16)*16,a.offset=s,s+=e,i=e):(a.offset=s,i+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function jd(r,t){const e=[];for(const i in r)t[i]&&e.push(t[i]);return e.sort((i,s)=>i.index-s.index),e}function Yd(r,t){if(!r.autoManage)return{size:0,syncFunc:Rv};const e=jd(r.uniforms,t),{uboElements:i,size:s}=Wd(e),n=[`\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    `];for(let a=0;a<i.length;a++){const o=i[a],h=r.uniforms[o.data.name],l=o.data.name;let u=!1;for(let c=0;c<Ii.length;c++){const d=Ii[c];if(d.codeUbo&&d.test(o.data,h)){n.push(`offset = ${o.offset/4};`,Ii[c].codeUbo(o.data.name,h)),u=!0;break}}if(!u)if(o.data.size>1){const c=Rd(o.data.type),d=Math.max(zd[o.data.type]/16,1),f=c/d,p=(4-f%4)%4;n.push(`\n                cv = ud.${l}.value;\n                v = uv.${l};\n                offset = ${o.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${o.data.size*d}; i++)\n                {\n                    for(var j = 0; j < ${f}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${p};\n                }\n\n                `)}else{const c=Dv[o.data.type];n.push(`\n                cv = ud.${l}.value;\n                v = uv.${l};\n                offset = ${o.offset/4};\n                ${c};\n                `)}}return n.push(`\n       renderer.buffer.update(buffer);\n    `),{size:s,syncFunc:new Function(\"ud\",\"uv\",\"renderer\",\"syncData\",\"buffer\",n.join(`\n`))}}let Fv=0;const ks={textureCount:0,uboCount:0};class Uh{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Fv++}systemCheck(){if(!Fd())throw new Error(\"Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.\")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),e||(ks.textureCount=0,ks.uboCount=0,this.syncUniformGroup(t.uniformGroup,ks)),s}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,\"u\");return this.cache[e]||(this.cache[e]=dv(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const s=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),s(i.uniformData,t.uniforms,this.renderer,ks,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,\"ubo\");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=Yd(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(o.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const s=t.uniforms,n=[`${i}-`];for(const a in s)n.push(a),e[a]&&n.push(e[a].type);return n.join(\"-\")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,s=$d(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Uh.extension={type:F.RendererSystem,name:\"shader\"};k.add(Uh);class Qr{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.3 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Qr.defaultOptions={hello:!1},Qr.extension={type:[F.RendererSystem,F.CanvasRendererSystem],name:\"startup\"};k.add(Qr);function Bv(r,t=[]){return t[H.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.ADD]=[r.ONE,r.ONE],t[H.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.NONE]=[0,0],t[H.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[H.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[H.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[H.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[H.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[H.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[H.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[H.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[H.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[H.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t}const Lv=0,Ov=1,Nv=2,Uv=3,kv=4,Gv=5,qd=class Bo{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=H.NONE,this._blendEq=!1,this.map=[],this.map[Lv]=this.setBlend,this.map[Ov]=this.setOffset,this.map[Nv]=this.setCullFace,this.map[Uv]=this.setDepthTest,this.map[kv]=this.setFrontFace,this.map[Gv]=this.setDepthMask,this.checks=[],this.defaultState=new pe,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=Bv(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Bo.checkBlendMode,t),this.gl[t?\"enable\":\"disable\"](this.gl.BLEND)}setOffset(t){this.updateCheck(Bo.checkPolygonOffset,t),this.gl[t?\"enable\":\"disable\"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?\"enable\":\"disable\"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?\"enable\":\"disable\"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?\"CW\":\"CCW\"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};qd.extension={type:F.RendererSystem,name:\"state\"};let Kd=qd;k.add(Kd);class Zd extends Ye{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(s=>t.systems[s]),i=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(const s of i)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Wt(e)})}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name \"${e}\" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const s in this.runners)this.runners[s].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach(s=>{const n=i.find(a=>this._systemsHash[a]===s);s[t.name](e[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Pr=class nn{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=nn.defaultMaxIdle,this.checkCountMax=nn.defaultCheckCountMax,this.mode=nn.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Vn.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let s=0;s<e.length;s++){const n=e[s];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[s]=null,i=!0)}if(i){let s=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[s++]=e[n]);e.length=s}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let s=t.children.length-1;s>=0;s--)this.unload(t.children[s])}destroy(){this.renderer=null}};Pr.defaultMode=Vn.AUTO,Pr.defaultMaxIdle=60*60,Pr.defaultCheckCountMax=60*10,Pr.extension={type:F.RendererSystem,name:\"textureGC\"};let ti=Pr;k.add(ti);class an{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=V.UNSIGNED_BYTE,this.internalFormat=M.RGBA,this.samplerType=0}}function Vv(r){let t;return\"WebGL2RenderingContext\"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[r.RGB]:O.FLOAT,[r.RGBA]:O.FLOAT,[r.ALPHA]:O.FLOAT,[r.LUMINANCE]:O.FLOAT,[r.LUMINANCE_ALPHA]:O.FLOAT,[r.R8]:O.FLOAT,[r.R8_SNORM]:O.FLOAT,[r.RG8]:O.FLOAT,[r.RG8_SNORM]:O.FLOAT,[r.RGB8]:O.FLOAT,[r.RGB8_SNORM]:O.FLOAT,[r.RGB565]:O.FLOAT,[r.RGBA4]:O.FLOAT,[r.RGB5_A1]:O.FLOAT,[r.RGBA8]:O.FLOAT,[r.RGBA8_SNORM]:O.FLOAT,[r.RGB10_A2]:O.FLOAT,[r.RGB10_A2UI]:O.FLOAT,[r.SRGB8]:O.FLOAT,[r.SRGB8_ALPHA8]:O.FLOAT,[r.R16F]:O.FLOAT,[r.RG16F]:O.FLOAT,[r.RGB16F]:O.FLOAT,[r.RGBA16F]:O.FLOAT,[r.R32F]:O.FLOAT,[r.RG32F]:O.FLOAT,[r.RGB32F]:O.FLOAT,[r.RGBA32F]:O.FLOAT,[r.R11F_G11F_B10F]:O.FLOAT,[r.RGB9_E5]:O.FLOAT,[r.R8I]:O.INT,[r.R8UI]:O.UINT,[r.R16I]:O.INT,[r.R16UI]:O.UINT,[r.R32I]:O.INT,[r.R32UI]:O.UINT,[r.RG8I]:O.INT,[r.RG8UI]:O.UINT,[r.RG16I]:O.INT,[r.RG16UI]:O.UINT,[r.RG32I]:O.INT,[r.RG32UI]:O.UINT,[r.RGB8I]:O.INT,[r.RGB8UI]:O.UINT,[r.RGB16I]:O.INT,[r.RGB16UI]:O.UINT,[r.RGB32I]:O.INT,[r.RGB32UI]:O.UINT,[r.RGBA8I]:O.INT,[r.RGBA8UI]:O.UINT,[r.RGBA16I]:O.INT,[r.RGBA16UI]:O.UINT,[r.RGBA32I]:O.INT,[r.RGBA32UI]:O.UINT,[r.DEPTH_COMPONENT16]:O.FLOAT,[r.DEPTH_COMPONENT24]:O.FLOAT,[r.DEPTH_COMPONENT32F]:O.FLOAT,[r.DEPTH_STENCIL]:O.FLOAT,[r.DEPTH24_STENCIL8]:O.FLOAT,[r.DEPTH32F_STENCIL8]:O.FLOAT}:t={[r.RGB]:O.FLOAT,[r.RGBA]:O.FLOAT,[r.ALPHA]:O.FLOAT,[r.LUMINANCE]:O.FLOAT,[r.LUMINANCE_ALPHA]:O.FLOAT,[r.DEPTH_STENCIL]:O.FLOAT},t}function Hv(r){let t;return\"WebGL2RenderingContext\"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[V.UNSIGNED_BYTE]:{[M.RGBA]:r.RGBA8,[M.RGB]:r.RGB8,[M.RG]:r.RG8,[M.RED]:r.R8,[M.RGBA_INTEGER]:r.RGBA8UI,[M.RGB_INTEGER]:r.RGB8UI,[M.RG_INTEGER]:r.RG8UI,[M.RED_INTEGER]:r.R8UI,[M.ALPHA]:r.ALPHA,[M.LUMINANCE]:r.LUMINANCE,[M.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[V.BYTE]:{[M.RGBA]:r.RGBA8_SNORM,[M.RGB]:r.RGB8_SNORM,[M.RG]:r.RG8_SNORM,[M.RED]:r.R8_SNORM,[M.RGBA_INTEGER]:r.RGBA8I,[M.RGB_INTEGER]:r.RGB8I,[M.RG_INTEGER]:r.RG8I,[M.RED_INTEGER]:r.R8I},[V.UNSIGNED_SHORT]:{[M.RGBA_INTEGER]:r.RGBA16UI,[M.RGB_INTEGER]:r.RGB16UI,[M.RG_INTEGER]:r.RG16UI,[M.RED_INTEGER]:r.R16UI,[M.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[V.SHORT]:{[M.RGBA_INTEGER]:r.RGBA16I,[M.RGB_INTEGER]:r.RGB16I,[M.RG_INTEGER]:r.RG16I,[M.RED_INTEGER]:r.R16I},[V.UNSIGNED_INT]:{[M.RGBA_INTEGER]:r.RGBA32UI,[M.RGB_INTEGER]:r.RGB32UI,[M.RG_INTEGER]:r.RG32UI,[M.RED_INTEGER]:r.R32UI,[M.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[V.INT]:{[M.RGBA_INTEGER]:r.RGBA32I,[M.RGB_INTEGER]:r.RGB32I,[M.RG_INTEGER]:r.RG32I,[M.RED_INTEGER]:r.R32I},[V.FLOAT]:{[M.RGBA]:r.RGBA32F,[M.RGB]:r.RGB32F,[M.RG]:r.RG32F,[M.RED]:r.R32F,[M.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[V.HALF_FLOAT]:{[M.RGBA]:r.RGBA16F,[M.RGB]:r.RGB16F,[M.RG]:r.RG16F,[M.RED]:r.R16F},[V.UNSIGNED_SHORT_5_6_5]:{[M.RGB]:r.RGB565},[V.UNSIGNED_SHORT_4_4_4_4]:{[M.RGBA]:r.RGBA4},[V.UNSIGNED_SHORT_5_5_5_1]:{[M.RGBA]:r.RGB5_A1},[V.UNSIGNED_INT_2_10_10_10_REV]:{[M.RGBA]:r.RGB10_A2,[M.RGBA_INTEGER]:r.RGB10_A2UI},[V.UNSIGNED_INT_10F_11F_11F_REV]:{[M.RGB]:r.R11F_G11F_B10F},[V.UNSIGNED_INT_5_9_9_9_REV]:{[M.RGB]:r.RGB9_E5},[V.UNSIGNED_INT_24_8]:{[M.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[V.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[M.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:t={[V.UNSIGNED_BYTE]:{[M.RGBA]:r.RGBA,[M.RGB]:r.RGB,[M.ALPHA]:r.ALPHA,[M.LUMINANCE]:r.LUMINANCE,[M.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[V.UNSIGNED_SHORT_5_6_5]:{[M.RGB]:r.RGB},[V.UNSIGNED_SHORT_4_4_4_4]:{[M.RGBA]:r.RGBA},[V.UNSIGNED_SHORT_5_5_5_1]:{[M.RGBA]:r.RGBA}},t}class kh{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new j,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Hv(t),this.samplerTypes=Vv(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};const i=new an(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new an(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){const{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<i.length;s++)i[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<i.length;s++)i[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[s]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let n=t-1;n>=0;--n){const a=e[n];a&&a._glTextures[s].samplerType!==O.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const e=new an(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on(\"dispose\",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??O.FLOAT,this.webGLVersion===2&&t.type===V.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==O.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,n=t.realHeight,a=i.gl;(e.width!==s||e.height!==n||e.dirtyId<0)&&(e.width=s,e.height=n,a.texImage2D(t.target,0,e.internalFormat,s,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off(\"dispose\",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const s=this.managedTextures.indexOf(t);s!==-1&&Mi(this.managedTextures,s,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===fe.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Re.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==fe.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Me.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===Me.LINEAR){const n=Math.min(t.anisotropicLevel,i.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Me.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===Me.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}kh.extension={type:F.RendererSystem,name:\"texture\"};k.add(kh);class Gh{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:s}=this;e&&s.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:s}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[s]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];o&&(i.buffer.update(o),o._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];if(!o)continue;const h=o._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&n.dispose(o,e))}i&&(e||s.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Gh.extension={type:F.RendererSystem,name:\"transformFeedback\"};k.add(Gh);class ts{constructor(t){this.renderer=t}init(t){this.screen=new Y(0,0,t.width,t.height),this.element=t.view||N.ADAPTER.createCanvas(),this.resolution=t.resolution||N.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit(\"resize\",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}ts.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},ts.extension={type:[F.RendererSystem,F.CanvasRendererSystem],name:\"_view\"};k.add(ts);N.PREFER_ENV=ui.WEBGL2;N.STRICT_TEXTURE_CACHE=!1;N.RENDER_OPTIONS={...Jr.defaultOptions,...Zr.defaultOptions,...ts.defaultOptions,...Qr.defaultOptions};Object.defineProperties(N,{WRAP_MODE:{get(){return j.defaultOptions.wrapMode},set(r){z(\"7.1.0\",\"settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode\"),j.defaultOptions.wrapMode=r}},SCALE_MODE:{get(){return j.defaultOptions.scaleMode},set(r){z(\"7.1.0\",\"settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode\"),j.defaultOptions.scaleMode=r}},MIPMAP_TEXTURES:{get(){return j.defaultOptions.mipmap},set(r){z(\"7.1.0\",\"settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap\"),j.defaultOptions.mipmap=r}},ANISOTROPIC_LEVEL:{get(){return j.defaultOptions.anisotropicLevel},set(r){z(\"7.1.0\",\"settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel\"),j.defaultOptions.anisotropicLevel=r}},FILTER_RESOLUTION:{get(){return z(\"7.1.0\",\"settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution\"),Ft.defaultResolution},set(r){Ft.defaultResolution=r}},FILTER_MULTISAMPLE:{get(){return z(\"7.1.0\",\"settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample\"),Ft.defaultMultisample},set(r){Ft.defaultMultisample=r}},SPRITE_MAX_TEXTURES:{get(){return Qe.defaultMaxTextures},set(r){z(\"7.1.0\",\"settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures\"),Qe.defaultMaxTextures=r}},SPRITE_BATCH_SIZE:{get(){return Qe.defaultBatchSize},set(r){z(\"7.1.0\",\"settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize\"),Qe.defaultBatchSize=r}},CAN_UPLOAD_SAME_BUFFER:{get(){return Qe.canUploadSameBuffer},set(r){z(\"7.1.0\",\"settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer\"),Qe.canUploadSameBuffer=r}},GC_MODE:{get(){return ti.defaultMode},set(r){z(\"7.1.0\",\"settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode\"),ti.defaultMode=r}},GC_MAX_IDLE:{get(){return ti.defaultMaxIdle},set(r){z(\"7.1.0\",\"settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle\"),ti.defaultMaxIdle=r}},GC_MAX_CHECK_COUNT:{get(){return ti.defaultCheckCountMax},set(r){z(\"7.1.0\",\"settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax\"),ti.defaultCheckCountMax=r}},PRECISION_VERTEX:{get(){return Ie.defaultVertexPrecision},set(r){z(\"7.1.0\",\"settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision\"),Ie.defaultVertexPrecision=r}},PRECISION_FRAGMENT:{get(){return Ie.defaultFragmentPrecision},set(r){z(\"7.1.0\",\"settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision\"),Ie.defaultFragmentPrecision=r}}});var We=(r=>(r[r.INTERACTION=50]=\"INTERACTION\",r[r.HIGH=25]=\"HIGH\",r[r.NORMAL=0]=\"NORMAL\",r[r.LOW=-25]=\"LOW\",r[r.UTILITY=-50]=\"UTILITY\",r))(We||{});class Ha{constructor(t,e=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Jd=class Vt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Ha(null,null,1/0),this.deltaMS=1/Vt.targetFPMS,this.elapsedMS=1/Vt.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=We.NORMAL){return this._addListener(new Ha(t,e,i))}addOnce(t,e,i=We.NORMAL){return this._addListener(new Ha(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Vt.targetFPMS;const i=this._head;let s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Vt.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Vt._shared){const t=Vt._shared=new Vt;t.autoStart=!0,t._protected=!0}return Vt._shared}static get system(){if(!Vt._system){const t=Vt._system=new Vt;t.autoStart=!0,t._protected=!0}return Vt._system}};Jd.targetFPMS=.06;let Mt=Jd;Object.defineProperties(N,{TARGET_FPMS:{get(){return Mt.targetFPMS},set(r){z(\"7.1.0\",\"settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS\"),Mt.targetFPMS=r}}});class Vh{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,\"ticker\",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,We.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Mt.shared:new Mt,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Vh.extension=F.Application;k.add(Vh);const Qd=[];k.handleByList(F.Renderer,Qd);function tf(r){for(const t of Qd)if(t.test(r))return new t(r);throw new Error(\"Unable to auto-detect a suitable renderer.\")}var Xv=`attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}`,$v=`attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n`;const ef=Xv,Hh=$v;class Xh{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=mt.HIGH?this.multisample=mt.HIGH:e>=mt.MEDIUM?this.multisample=mt.MEDIUM:e>=mt.LOW?this.multisample=mt.LOW:this.multisample=mt.NONE}destroy(){}}Xh.extension={type:F.RendererSystem,name:\"_multisample\"};k.add(Xh);class zv{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class $h{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,i){const{gl:s,CONTEXT_UID:n}=this;i=i||0;const a=t._glBuffers[n]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,a.buffer,i*256,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),i&&(e||s.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new zv(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}$h.extension={type:F.RendererSystem,name:\"buffer\"};k.add($h);class zh{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let s,n,a,o;if(e&&(s=e.renderTexture,n=e.clear,a=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit(\"prerender\"),i.projection.transform=a,!i.context.isLost){if(s||(this.lastObjectRendered=t),!o){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(n??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),s&&(e.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit(\"postrender\")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}zh.extension={type:F.RendererSystem,name:\"objectRenderer\"};k.add(zh);const on=class Lo extends Zd{constructor(t){super(),this.type=ch.WEBGL,t=Object.assign({},N.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Qt({projectionMatrix:new et},!0);const e={runners:[\"init\",\"destroy\",\"contextChange\",\"resolutionChange\",\"reset\",\"update\",\"postrender\",\"prerender\",\"resize\"],systems:Lo.__systems,priority:[\"_view\",\"textureGenerator\",\"background\",\"_plugin\",\"startup\",\"context\",\"state\",\"texture\",\"buffer\",\"geometry\",\"framebuffer\",\"transformFeedback\",\"mask\",\"scissor\",\"stencil\",\"projection\",\"textureGC\",\"filter\",\"renderTexture\",\"batch\",\"objectRenderer\",\"_multisample\"]};this.setup(e),\"useContextAlpha\"in t&&(z(\"7.0.0\",\"options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead\"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!==\"notMultiplied\",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=Lo.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:dd()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return z(\"7.0.0\",\"renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead.\"),this.background.clearBeforeRender}get useContextAlpha(){return z(\"7.0.0\",\"renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead.\"),this.context.useContextAlpha}get preserveDrawingBuffer(){return z(\"7.0.0\",\"renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context\"),this.context.preserveDrawingBuffer}get backgroundColor(){return z(\"7.0.0\",\"renderer.backgroundColor has been deprecated, use renderer.background.color instead.\"),this.background.color}set backgroundColor(t){z(\"7.0.0\",\"renderer.backgroundColor has been deprecated, use renderer.background.color instead.\"),this.background.color=t}get backgroundAlpha(){return z(\"7.0.0\",\"renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead.\"),this.background.alpha}set backgroundAlpha(t){z(\"7.0.0\",\"renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead.\"),this.background.alpha=t}get powerPreference(){return z(\"7.0.0\",\"renderer.powerPreference has been deprecated, we can only know this if pixi creates the context\"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};on.extension={type:F.Renderer,priority:1},on.__plugins={},on.__systems={};let ta=on;k.handleByMap(F.RendererPlugin,ta.__plugins);k.handleByMap(F.RendererSystem,ta.__systems);k.add(ta);class Wh extends hr{constructor(t,e){const{width:i,height:s}=e||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const a=new j;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof hr?this.addResourceAt(t[i],i):this.addResourceAt(Th(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error(\"Only one base texture per TextureArray is allowed\");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on(\"update\",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off(\"update\",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:i}=this.items[0];return this.resize(e,i),this.update(),Promise.resolve(this)}),this._load}}class rf extends Wh{constructor(t,e){const{width:i,height:s}=e||{};let n,a;Array.isArray(t)?(n=t,a=t.length):a=t,super(a,{width:i,height:s}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error(\"ArrayResource does not support RenderTexture\");return this}bind(t){super.bind(t),t.target=Ai.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:s,itemDirtyIds:n,items:a}=this,{gl:o}=t;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,e.format,i.type,null);for(let h=0;h<s;h++){const l=a[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,i.type,l.resource.source))}return!0}}class sf extends Fe{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const nf=class Mr extends Wh{constructor(t,e){const{width:i,height:s,autoLoad:n,linkBaseTexture:a}=e||{};if(t&&t.length!==Mr.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:s});for(let o=0;o<Mr.SIDES;o++)this.items[o].target=Ai.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=a!==!1,t&&this.initFromArray(t,e),n!==!1&&this.load()}bind(t){super.bind(t),t.target=Ai.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error(\"CubeResource does not support copying of renderTexture.\");else t.target=Ai.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){const s=this.itemDirtyIds;for(let n=0;n<Mr.SIDES;n++){const a=this.items[n];(s[n]<a.dirtyId||i.dirtyId<e.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(t,a,i),s[n]=a.dirtyId):s[n]<-1&&(t.gl.texImage2D(a.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),s[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Mr.SIDES}};nf.SIDES=6;let af=nf;class Ci extends Fe{constructor(t,e){e=e||{};let i,s,n;typeof t==\"string\"?(i=Ci.EMPTY,s=t,n=!0):(i=t,s=null,n=!1),super(i),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode==\"number\"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??n,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const i=await N.ADAPTER.fetch(this.url,{mode:this.crossOrigin?\"cors\":\"no-cors\"});if(this.destroyed)return;const s=await i.blob();if(this.destroyed)return;const n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Nt.UNPACK?\"premultiply\":\"none\"});if(this.destroyed){n.close();return}this.source=n,this.update(),t(this)}catch(i){if(this.destroyed)return;e(i),this.onError.emit(i)}}),this._load)}upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode==\"number\"&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<\"u\"&&(typeof t==\"string\"||t instanceof ImageBitmap)}static get EMPTY(){return Ci._EMPTY=Ci._EMPTY??N.ADAPTER.createCanvas(0,0),Ci._EMPTY}}const Oo=class hn extends Fe{constructor(t,e){e=e||{},super(N.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},hn.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error(\"Your browser doesn't support base64 conversions.\");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;Fe.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,i=t.height;if(!e||!i)throw new Error(\"The SVG image must have width and height defined (in pixels), canvas API needs them.\");let s=e*this.scale,n=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*e,n=this._overrideHeight||this._overrideWidth/e*i),s=Math.round(s),n=Math.round(n);const a=this.source;a.width=s,a.height=n,a._pixiId=`canvas_${oi()}`,a.getContext(\"2d\").drawImage(t,0,0,e,i,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(t){const e=hn.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e===\"svg\"||typeof t==\"string\"&&t.startsWith(\"data:image/svg+xml\")||typeof t==\"string\"&&hn.SVG_XML.test(t)}};Oo.SVG_XML=/^(<\\?xml[^?]+\\?>)?\\s*(\\x3C!--[^(-->)]*-->)?\\s*\\<svg/m,Oo.SVG_SIZE=/<svg[^>]*(?:\\s(width|height)=('|\")(\\d*(?:\\.\\d+)?)(?:px)?('|\"))[^>]*(?:\\s(width|height)=('|\")(\\d*(?:\\.\\d+)?)(?:px)?('|\"))[^>]*>/i;let Pn=Oo;class Wv extends Fe{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const No=class Uo extends Fe{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const i=document.createElement(\"video\");e.autoLoad!==!1&&i.setAttribute(\"preload\",\"auto\"),e.playsinline!==!1&&(i.setAttribute(\"webkit-playsinline\",\"\"),i.setAttribute(\"playsinline\",\"\")),e.muted===!0&&(i.setAttribute(\"muted\",\"\"),i.muted=!0),e.loop===!0&&i.setAttribute(\"loop\",\"\"),e.autoPlay!==!1&&i.setAttribute(\"autoplay\",\"\"),typeof t==\"string\"&&(t=[t]);const s=t[0].src||t[0];Fe.crossOrigin(i,s,e.crossorigin);for(let n=0;n<t.length;++n){const a=document.createElement(\"source\");let{src:o,mime:h}=t[n];if(o=o||t[n],o.startsWith(\"data:\"))h=o.slice(5,o.indexOf(\";\"));else if(!o.startsWith(\"blob:\")){const l=o.split(\"?\").shift().toLowerCase(),u=l.slice(l.lastIndexOf(\".\")+1);h=h||Uo.MIME_TYPES[u]||`video/${u}`}a.src=o,h&&(a.type=h),i.appendChild(a)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=Mt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener(\"play\",this._onPlayStart),t.addEventListener(\"pause\",this._onPlayStop),t.addEventListener(\"seeked\",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener(\"canplay\",this._onCanPlay),t.addEventListener(\"canplaythrough\",this._onCanPlay),t.addEventListener(\"error\",this._onError,!0)),this._load=new Promise((e,i)=>{this.valid?e(this):(this._resolve=e,this._reject=i,t.load())}),this._load}_onError(t){this.source.removeEventListener(\"error\",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener(\"canplay\",this._onCanPlay),t.removeEventListener(\"canplaythrough\",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener(\"play\",this._onPlayStart),t.removeEventListener(\"pause\",this._onPlayStop),t.removeEventListener(\"seeked\",this._onSeeked),t.removeEventListener(\"canplay\",this._onCanPlay),t.removeEventListener(\"canplaythrough\",this._onCanPlay),t.removeEventListener(\"error\",this._onError,!0),t.pause(),t.src=\"\",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Mt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Mt.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Mt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Uo.TYPES.includes(e)}};No.TYPES=[\"mp4\",\"m4v\",\"webm\",\"ogg\",\"ogv\",\"h264\",\"avi\",\"mov\"],No.MIME_TYPES={ogv:\"video/ogg\",mov:\"video/quicktime\",m4v:\"video/mp4\"};let jh=No;En.push(Ci,Sh,sf,jh,Wv,Pn,fs,af,rf);class jv{constructor(){this._glTransformFeedbacks={},this.buffers=[],this.disposeRunner=new Wt(\"disposeTransformFeedback\")}bindBuffer(t,e){this.buffers[t]=e}destroy(){this.disposeRunner.emit(this,!1)}}const Yv=\"7.4.3\";class es{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Y.EMPTY:(t=t||new Y(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:s,c:n,d:a,tx:o,ty:h}=t,l=i*e.x+n*e.y+o,u=s*e.x+a*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,i=this.minY,s=this.maxX,n=this.maxY,a=t[0],o=t[1];e=a<e?a:e,i=o<i?o:i,s=a>s?a:s,n=o>n?o:n,a=t[2],o=t[3],e=a<e?a:e,i=o<i?o:i,s=a>s?a:s,n=o>n?o:n,a=t[4],o=t[5],e=a<e?a:e,i=o<i?o:i,s=a>s?a:s,n=o>n?o:n,a=t[6],o=t[7],e=a<e?a:e,i=o<i?o:i,s=a>s?a:s,n=o>n?o:n,this.minX=e,this.minY=i,this.maxX=s,this.maxY=n}addFrame(t,e,i,s,n){this.addFrameMatrix(t.worldTransform,e,i,s,n)}addFrameMatrix(t,e,i,s,n){const a=t.a,o=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=a*e+h*i+u,y=o*e+l*i+c;d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=a*s+h*i+u,y=o*s+l*i+c,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=a*e+h*n+u,y=o*e+l*n+c,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=a*s+h*n+u,y=o*s+l*n+c,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(t,e,i){let s=this.minX,n=this.minY,a=this.maxX,o=this.maxY;for(let h=e;h<i;h+=2){const l=t[h],u=t[h+1];s=l<s?l:s,n=u<n?u:n,a=l>a?l:a,o=u>o?u:o}this.minX=s,this.minY=n,this.maxX=a,this.maxY=o}addVertices(t,e,i,s){this.addVerticesMatrix(t.worldTransform,e,i,s)}addVerticesMatrix(t,e,i,s,n=0,a=n){const o=t.a,h=t.b,l=t.c,u=t.d,c=t.tx,d=t.ty;let f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let y=i;y<s;y+=2){const x=e[y],_=e[y+1],v=o*x+l*_+c,T=u*_+h*x+d;f=Math.min(f,v-n),m=Math.max(m,v+n),p=Math.min(p,T-a),g=Math.max(g,T+a)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(t){const e=this.minX,i=this.minY,s=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=n&&s<=a){const o=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=i<o?i:o,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=a>u?a:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=n&&s<=a){const o=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=i<o?i:o,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=a>u?a:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,s,n,a){t-=n,e-=a,i+=n,s+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}}class ct extends Ye{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new dr,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new es,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const s=e[i];Object.defineProperty(ct.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Y),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Y),t=this._localBoundsRect),this._localBounds||(this._localBounds=new es);const e=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=i?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-n,a}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,s){return e&&(t=e.toGlobal(t,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error(\"setParent: Argument must be a Container\");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,s=1,n=0,a=0,o=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=s||1,this.rotation=n,this.skew.x=a,this.skew.y=o,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode=\"auto\",this.interactiveChildren=!1,this.emit(\"destroyed\"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new of),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Cd}set angle(t){this.transform.rotation=t*Sd}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class of extends ct{constructor(){super(...arguments),this.sortDirty=null}}ct.prototype.displayObjectUpdateTransform=ct.prototype.updateTransform;const qv=new et;function Kv(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex}const hf=class ko extends ct{constructor(){super(),this.children=[],this.sortableChildren=ko.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit(\"childAdded\",e,this,this.children.length-1),e.emit(\"added\",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit(\"added\",this),this.emit(\"childAdded\",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),s=this.getChildIndex(e);this.children[i]=e,this.children[s]=t,this.onChildrenChange(i<s?i:s)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error(\"The supplied DisplayObject must be a child of the caller\");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);Mi(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,Mi(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit(\"removed\",this),this.emit(\"childRemoved\",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Mi(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit(\"removed\",this),this.emit(\"childRemoved\",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,s=e,n=s-i;let a;if(n>0&&n<=s){a=this.children.splice(i,n);for(let o=0;o<a.length;++o)a[o].parent=null,a[o].transform&&(a[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let o=0;o<a.length;++o)a[o].emit(\"removed\",this),this.emit(\"childRemoved\",a[o],this,o);return a}else if(n===0&&this.children.length===0)return[];throw new RangeError(\"removeChildren: numeric values are outside the acceptable range.\")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(Kv),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let s=0,n=this.children.length;s<n;++s){const a=this.children[s];a.visible&&a.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==ko.prototype._render&&(i=this.getBounds(!0));const n=t.projection.transform;if(n&&(s?(s=qv.copyFrom(s),s.prepend(n)):s=n),i&&e.intersects(i,s))this._render(t);else if(this.cullArea)return;for(let a=0,o=this.children.length;a<o;++a){const h=this.children[a],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let n=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n])}const s=e&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==yt.NONE));if(s&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let n=0,a=this.children.length;n<a;++n)this.children[n].render(t)}s&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t==\"boolean\"?t:t?.children,i=this.removeChildren(0,this.children.length);if(e)for(let s=0;s<i.length;++s)i[s].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};hf.defaultSortableChildren=!1;let kt=hf;kt.prototype.containerUpdateTransform=kt.prototype.updateTransform;Object.defineProperties(N,{SORTABLE_CHILDREN:{get(){return kt.defaultSortableChildren},set(r){z(\"7.1.0\",\"settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren\"),kt.defaultSortableChildren=r}}});const br=new Z,Zv=new Uint16Array([0,1,2,0,2,3]);class qe extends kt{constructor(t){super(),this._anchor=new le(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new tt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=H.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||B.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Zv,this.pluginName=\"batch\",this.isSprite=!0,this._roundPixels=N.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Ge(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Ge(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,s=e.b,n=e.c,a=e.d,o=e.tx,h=e.ty,l=this.vertexData,u=t.trim,c=t.orig,d=this._anchor;let f=0,p=0,m=0,g=0;if(u?(p=u.x-d._x*c.width,f=p+u.width,g=u.y-d._y*c.height,m=g+u.height):(p=-d._x*c.width,f=p+c.width,g=-d._y*c.height,m=g+c.height),l[0]=i*p+n*g+o,l[1]=a*g+s*p+h,l[2]=i*f+n*g+o,l[3]=a*g+s*f+h,l[4]=i*f+n*m+o,l[5]=a*m+s*f+h,l[6]=i*p+n*m+o,l[7]=a*m+s*p+h,this._roundPixels){const y=N.RESOLUTION;for(let x=0;x<l.length;++x)l[x]=Math.round(l[x]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,s=this._anchor,n=this.transform.worldTransform,a=n.a,o=n.b,h=n.c,l=n.d,u=n.tx,c=n.ty,d=-s._x*i.width,f=d+i.width,p=-s._y*i.height,m=p+i.height;if(e[0]=a*d+h*p+u,e[1]=l*p+o*d+c,e[2]=a*f+h*p+u,e[3]=l*p+o*f+c,e[4]=a*f+h*m+u,e[5]=l*m+o*f+c,e[6]=a*d+h*m+u,e[7]=l*m+o*d+c,this._roundPixels){const g=N.RESOLUTION;for(let y=0;y<e.length;++y)e[y]=Math.round(e[y]*g)/g}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new es),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Y),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,br);const e=this._texture.orig.width,i=this._texture.orig.height,s=-e*this.anchor.x;let n=0;return br.x>=s&&br.x<s+e&&(n=-i*this.anchor.y,br.y>=n&&br.y<n+i)}destroy(t){if(super.destroy(t),this._texture.off(\"update\",this._onTextureUpdate,this),this._anchor=null,typeof t==\"boolean\"?t:t?.texture){const e=typeof t==\"boolean\"?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const i=t instanceof B?t:B.from(t,e);return new qe(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Ge(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Ge(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off(\"update\",this._onTextureUpdate,this),this._texture=t||B.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once(\"update\",this._onTextureUpdate,this)))}}const lf=new et;ct.prototype._cacheAsBitmap=!1;ct.prototype._cacheData=null;ct.prototype._cacheAsBitmapResolution=null;ct.prototype._cacheAsBitmapMultisample=null;class Jv{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(ct.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;let t;r?(this._cacheData||(this._cacheData=new Jv),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});ct.prototype._renderCached=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(r),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(r))};ct.prototype._initCachedDisplayObject=function(r){if(this._cacheData?.sprite)return;const t=this.alpha;this.alpha=1,r.batch.flush();const e=this.getLocalBounds(new Y,!0);if(this.filters?.length){const d=this.filters[0].padding;e.pad(d)}const i=this.cacheAsBitmapResolution||r.resolution;e.ceil(i),e.width=Math.max(e.width,1/i),e.height=Math.max(e.height,1/i);const s=r.renderTexture.current,n=r.renderTexture.sourceFrame.clone(),a=r.renderTexture.destinationFrame.clone(),o=r.projection.transform,h=di.create({width:e.width,height:e.height,resolution:i,multisample:this.cacheAsBitmapMultisample??r.multisample}),l=`cacheAsBitmap_${oi()}`;this._cacheData.textureCacheId=l,j.addToCache(h.baseTexture,l),B.addToCache(h,l);const u=this.transform.localTransform.copyTo(lf).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,r.render(this,{renderTexture:h,clear:!0,transform:u,skipUpdateTransform:!1}),r.framebuffer.blit(),r.projection.transform=o,r.renderTexture.bind(s,n,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const c=new qe(h);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(e.x/e.width),c.anchor.y=-(e.y/e.height),c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)};ct.prototype._renderCachedCanvas=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(r),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(r))};ct.prototype._initCachedDisplayObjectCanvas=function(r){if(this._cacheData?.sprite)return;const t=this.getLocalBounds(new Y,!0),e=this.alpha;this.alpha=1;const i=r.canvasContext.activeContext,s=r._projTransform,n=this.cacheAsBitmapResolution||r.resolution;t.ceil(n),t.width=Math.max(t.width,1/n),t.height=Math.max(t.height,1/n);const a=di.create({width:t.width,height:t.height,resolution:n}),o=`cacheAsBitmap_${oi()}`;this._cacheData.textureCacheId=o,j.addToCache(a.baseTexture,o),B.addToCache(a,o);const h=lf;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,r.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),r.canvasContext.activeContext=i,r._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const l=new qe(a);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(t.x/t.width),l.anchor.y=-(t.y/t.height),l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=r._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)};ct.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};ct.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};ct.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,j.removeFromCache(this._cacheData.textureCacheId),B.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};ct.prototype._cacheAsBitmapDestroy=function(r){this.cacheAsBitmap=!1,this.destroy(r)};ct.prototype.name=null;kt.prototype.getChildByName=function(r,t){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===r)return this.children[e];if(t)for(let e=0,i=this.children.length;e<i;e++){const s=this.children[e];if(!s.getChildByName)continue;const n=s.getChildByName(r,!0);if(n)return n}return null};ct.prototype.getGlobalPosition=function(r=new Z,t=!1){return this.parent?this.parent.toGlobal(this.position,r,t):(r.x=this.position.x,r.y=this.position.y),r};var Qv=`varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n`;class uf extends Ft{constructor(t=1){super(ef,Qv,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const tx={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},ex=[\"varying vec2 vBlurTexCoords[%size%];\",\"uniform sampler2D uSampler;\",\"void main(void)\",\"{\",\"    gl_FragColor = vec4(0.0);\",\"    %blur%\",\"}\"].join(`\n`);function ix(r){const t=tx[r],e=t.length;let i=ex,s=\"\";const n=\"gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;\";let a;for(let o=0;o<r;o++){let h=n.replace(\"%index%\",o.toString());a=o,o>=e&&(a=r-o-1),h=h.replace(\"%value%\",t[a].toString()),s+=h,s+=`\n`}return i=i.replace(\"%blur%\",s),i=i.replace(\"%size%\",r.toString()),i}const rx=`\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }`;function sx(r,t){const e=Math.ceil(r/2);let i=rx,s=\"\",n;t?n=\"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);\":n=\"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);\";for(let a=0;a<r;a++){let o=n.replace(\"%index%\",a.toString());o=o.replace(\"%sampleIndex%\",`${a-(e-1)}.0`),s+=o,s+=`\n`}return i=i.replace(\"%blur%\",s),i=i.replace(\"%size%\",r.toString()),i}class Mn extends Ft{constructor(t,e=8,i=4,s=Ft.defaultResolution,n=5){const a=sx(n,t),o=ix(n);super(a,o),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,s){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,i,s);else{const n=t.getFilterTexture(),a=t.renderer;let o=e,h=n;this.state.blend=!1,t.applyFilter(this,o,h,ae.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(o,ae.BLIT),this.uniforms.uSampler=h;const u=h;h=o,o=u,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,i,s),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class cf extends Ft{constructor(t=8,e=4,i=Ft.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Mn(!0,t,e,i,s),this.blurYFilter=new Mn(!1,t,e,i,s),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,s){const n=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(n&&a){const o=t.getFilterTexture();this.blurXFilter.apply(t,e,o,ae.CLEAR),this.blurYFilter.apply(t,o,i,s),t.returnFilterTexture(o)}else a?this.blurYFilter.apply(t,e,i,s):this.blurXFilter.apply(t,e,i,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var nx=`varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n`;class In extends Ft{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Hh,nx,t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const[i,s,n]=tt.shared.setValue(t).toArray(),a=[i,0,0,0,0,0,s,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(a,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),s=Math.sin(t),n=Math.sqrt,a=1/3,o=n(a),h=i+(1-i)*a,l=a*(1-i)-o*s,u=a*(1-i)+o*s,c=a*(1-i)+o*s,d=i+a*(1-i),f=a*(1-i)-o*s,p=a*(1-i)-o*s,m=a*(1-i)+o*s,g=i+a*(1-i),y=[h,l,u,0,0,c,d,f,0,0,p,m,g,0,0,0,0,0,1,0];this._loadMatrix(y,e)}contrast(t,e){const i=(t||0)+1,s=-.5*(i-1),n=[i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0];this._loadMatrix(n,e)}saturate(t=0,e){const i=t*2/3+1,s=(i-1)*-.5,n=[i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0];this._loadMatrix(n,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,i,s,n){t=t||.2,e=e||.15,i=i||16770432,s=s||3375104;const a=tt.shared,[o,h,l]=a.setValue(i).toArray(),[u,c,d]=a.setValue(s).toArray(),f=[.3,.59,.11,0,0,o,h,l,t,0,u,c,d,e,0,o-u,h-c,l-d,0,0];this._loadMatrix(f,n)}night(t,e){t=t||.1;const i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}In.prototype.grayscale=In.prototype.greyscale;var ax=`varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n`,ox=`attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n`;class df extends Ft{constructor(t,e){const i=new et;t.renderable=!1,super(ox,ax,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,e==null&&(e=20),this.scale=new Z(e,e)}apply(t,e,i,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,a=Math.sqrt(n.a*n.a+n.b*n.b),o=Math.sqrt(n.c*n.c+n.d*n.d);a!==0&&o!==0&&(this.uniforms.rotation[0]=n.a/a,this.uniforms.rotation[1]=n.b/a,this.uniforms.rotation[2]=n.c/o,this.uniforms.rotation[3]=n.d/o),t.applyFilter(this,e,i,s)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var hx=`varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it's\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n`,lx=`\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n`;class ff extends Ft{constructor(){super(lx,hx)}}var ux=`precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n`;class pf extends Ft{constructor(t=.5,e=Math.random()){super(Hh,ux,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const Go={AlphaFilter:uf,BlurFilter:cf,BlurFilterPass:Mn,ColorMatrixFilter:In,DisplacementFilter:df,FXAAFilter:ff,NoiseFilter:pf};Object.entries(Go).forEach(([r,t])=>{Object.defineProperty(Go,r,{get(){return z(\"7.1.0\",`filters.${r} has moved to ${r}`),t}})});class cx{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(Mt.system.add(this.tickerUpdate,this,We.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Mt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType===\"touch\"||globalThis.document.dispatchEvent(new PointerEvent(\"pointermove\",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const ei=new cx;class fr{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=fr.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Z,this.page=new Z,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error(\"initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.\")}initUIEvent(t,e,i,s,n){throw new Error(\"initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.\")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class is extends fr{constructor(){super(...arguments),this.client=new Z,this.movement=new Z,this.offset=new Z,this.global=new Z,this.screen=new Z}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return\"getModifierState\"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,s,n,a,o,h,l,u,c,d,f,p,m){throw new Error(\"Method not implemented.\")}}class Yt extends is{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type===\"pointermove\"||this.type===\"mousemove\"||this.type===\"touchmove\"?[this]:[]}getPredictedEvents(){throw new Error(\"getPredictedEvents is not supported!\")}}class Ri extends is{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Ri.DOM_DELTA_PIXEL=0,Ri.DOM_DELTA_LINE=1,Ri.DOM_DELTA_PAGE=2;const dx=2048,fx=new Z,Xa=new Z;class mf{constructor(t){this.dispatch=new Ye,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping(\"pointerdown\",this.mapPointerDown),this.addEventMapping(\"pointermove\",this.mapPointerMove),this.addEventMapping(\"pointerout\",this.mapPointerOut),this.addEventMapping(\"pointerleave\",this.mapPointerOut),this.addEventMapping(\"pointerover\",this.mapPointerOver),this.addEventMapping(\"pointerup\",this.mapPointerUp),this.addEventMapping(\"pointerupoutside\",this.mapPointerUpOutside),this.addEventMapping(\"wheel\",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,s)=>i.priority-s.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,s=e.length;i<s;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){ei.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?\"hitTestMoveRecursive\":\"hitTestRecursive\",s=this[i](this.rootTarget,this.rootTarget.eventMode,fx.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,n=i.length-1;s<n;s++)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const s=Array.isArray(e)?e:[e];for(let n=i.length-1;n>=0;n--)s.forEach(a=>{t.currentTarget=i[n],this.notifyTarget(t,a)})}propagationPath(t){const e=[t];for(let i=0;i<dx&&t!==this.rootTarget;i++){if(!t.parent)throw new Error(\"Cannot find propagation path to disconnected target\");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,s,n,a=!1){let o=!1;if(this._interactivePrune(t))return null;if((t.eventMode===\"dynamic\"||e===\"dynamic\")&&(ei.pauseUpdate=!1),t.interactiveChildren&&t.children){const u=t.children;for(let c=u.length-1;c>=0;c--){const d=u[c],f=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,i,s,n,a||n(t,i));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),o=!0}}}const h=this._isInteractive(e),l=t.isInteractive();return h&&l&&this._allInteractiveElements.push(t),a||this._hitElements.length>0?null:o?this._hitElements:h&&!n(t,i)&&s(t,i)?l?[t]:[]:null}hitTestRecursive(t,e,i,s,n){if(this._interactivePrune(t)||n(t,i))return null;if((t.eventMode===\"dynamic\"||e===\"dynamic\")&&(ei.pauseUpdate=!1),t.interactiveChildren&&t.children){const h=t.children;for(let l=h.length-1;l>=0;l--){const u=h[l],c=this.hitTestRecursive(u,this._isInteractive(e)?e:u.eventMode,i,s,n);if(c){if(c.length>0&&!c[c.length-1].parent)continue;const d=t.isInteractive();return(c.length>0||d)&&c.push(t),c}}}const a=this._isInteractive(e),o=t.isInteractive();return a&&s(t,i)?o?[t]:[]:null}_isInteractive(t){return t===\"static\"||t===\"dynamic\"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode===\"none\"||t.eventMode===\"passive\"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Xa),!t.hitArea.contains(Xa.x,Xa.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return t.eventMode===\"passive\"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){e=e??t.type;const i=`on${e}`;t.currentTarget[i]?.(t);const s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Yt)){console.warn(\"EventBoundary cannot map a non-pointer event as a pointer event\");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,\"pointerdown\"),e.pointerType===\"touch\")this.dispatchEvent(e,\"touchstart\");else if(e.pointerType===\"mouse\"||e.pointerType===\"pen\"){const s=e.button===2;this.dispatchEvent(e,s?\"rightdown\":\"mousedown\")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Yt)){console.warn(\"EventBoundary cannot map a non-pointer event as a pointer event\");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i=e.pointerType===\"mouse\"||e.pointerType===\"pen\",s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&n!==e.target){const h=t.type===\"mousemove\"?\"mouseout\":\"pointerout\",l=this.createPointerEvent(t,h,n);if(this.dispatchEvent(l,\"pointerout\"),i&&this.dispatchEvent(l,\"mouseout\"),!e.composedPath().includes(n)){const u=this.createPointerEvent(t,\"pointerleave\",n);for(u.eventPhase=u.AT_TARGET;u.target&&!e.composedPath().includes(u.target);)u.currentTarget=u.target,this.notifyTarget(u),i&&this.notifyTarget(u,\"mouseleave\"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(l)}if(n!==e.target){const h=t.type===\"mousemove\"?\"mouseover\":\"pointerover\",l=this.clonePointerEvent(e,h);this.dispatchEvent(l,\"pointerover\"),i&&this.dispatchEvent(l,\"mouseover\");let u=n?.parent;for(;u&&u!==this.rootTarget.parent&&u!==e.target;)u=u.parent;if(!u||u===this.rootTarget.parent){const c=this.clonePointerEvent(e,\"pointerenter\");for(c.eventPhase=c.AT_TARGET;c.target&&c.target!==n&&c.target!==this.rootTarget.parent;)c.currentTarget=c.target,this.notifyTarget(c),i&&this.notifyTarget(c,\"mouseenter\"),c.target=c.target.parent;this.freeEvent(c)}this.freeEvent(l)}const a=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?a.push(\"pointermove\"):this.dispatchEvent(e,\"pointermove\"),o&&a.push(\"globalpointermove\"),e.pointerType===\"touch\"&&(this.moveOnAll?a.splice(1,0,\"touchmove\"):this.dispatchEvent(e,\"touchmove\"),o&&a.push(\"globaltouchmove\")),i&&(this.moveOnAll?a.splice(1,0,\"mousemove\"):this.dispatchEvent(e,\"mousemove\"),o&&a.push(\"globalmousemove\"),this.cursor=e.target?.cursor),a.length>0&&this.all(e,a),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Yt)){console.warn(\"EventBoundary cannot map a non-pointer event as a pointer event\");return}const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s=i.pointerType===\"mouse\"||i.pointerType===\"pen\";this.dispatchEvent(i,\"pointerover\"),s&&this.dispatchEvent(i,\"mouseover\"),i.pointerType===\"mouse\"&&(this.cursor=i.target?.cursor);const n=this.clonePointerEvent(i,\"pointerenter\");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,\"mouseenter\"),n.target=n.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof Yt)){console.warn(\"EventBoundary cannot map a non-pointer event as a pointer event\");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const i=t.pointerType===\"mouse\"||t.pointerType===\"pen\",s=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,\"pointerout\",s);this.dispatchEvent(n),i&&this.dispatchEvent(n,\"mouseout\");const a=this.createPointerEvent(t,\"pointerleave\",s);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),i&&this.notifyTarget(a,\"mouseleave\"),a.target=a.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(a)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Yt)){console.warn(\"EventBoundary cannot map a non-pointer event as a pointer event\");return}const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,\"pointerup\"),i.pointerType===\"touch\")this.dispatchEvent(i,\"touchend\");else if(i.pointerType===\"mouse\"||i.pointerType===\"pen\"){const o=i.button===2;this.dispatchEvent(i,o?\"rightup\":\"mouseup\")}const s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[t.button]);let a=n;if(n&&!i.composedPath().includes(n)){let o=n;for(;o&&!i.composedPath().includes(o);){if(i.currentTarget=o,this.notifyTarget(i,\"pointerupoutside\"),i.pointerType===\"touch\")this.notifyTarget(i,\"touchendoutside\");else if(i.pointerType===\"mouse\"||i.pointerType===\"pen\"){const h=i.button===2;this.notifyTarget(i,h?\"rightupoutside\":\"mouseupoutside\")}o=o.parent}delete s.pressTargetsByButton[t.button],a=o}if(a){const o=this.clonePointerEvent(i,\"click\");o.target=a,o.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:o.target,timeStamp:e});const h=s.clicksByButton[t.button];if(h.target===o.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=o.target,h.timeStamp=e,o.detail=h.clickCount,o.pointerType===\"mouse\"){const l=o.button===2;this.dispatchEvent(o,l?\"rightclick\":\"click\")}else o.pointerType===\"touch\"&&this.dispatchEvent(o,\"tap\");this.dispatchEvent(o,\"pointertap\"),this.freeEvent(o)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Yt)){console.warn(\"EventBoundary cannot map a non-pointer event as a pointer event\");return}const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(i){let n=i;for(;n;)s.currentTarget=n,this.notifyTarget(s,\"pointerupoutside\"),s.pointerType===\"touch\"?this.notifyTarget(s,\"touchendoutside\"):(s.pointerType===\"mouse\"||s.pointerType===\"pen\")&&this.notifyTarget(s,s.button===2?\"rightupoutside\":\"mouseupoutside\"),n=n.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof Ri)){console.warn(\"EventBoundary cannot map a non-wheel event as a wheel event\");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const s=this.allocateEvent(Yt);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=i??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],typeof e==\"string\"&&(s.type=e),s}createWheelEvent(t){const e=this.allocateEvent(Ri);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(Yt);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Yt&&e instanceof Yt&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof is&&e instanceof is&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error(\"It is illegal to free an event not managed by this EventBoundary!\");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if(\"fn\"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let s=0,n=i.length;s<n&&!t.propagationImmediatelyStopped;s++)i[s].once&&t.currentTarget.removeListener(e,i[s].fn,void 0,!0),i[s].fn.call(i[s].context,t)}}const px=1,mx={touchstart:\"pointerdown\",touchend:\"pointerup\",touchendoutside:\"pointerupoutside\",touchmove:\"pointermove\",touchcancel:\"pointercancel\"},Vo=class Ho{constructor(t){this.supportsTouchEvents=\"ontouchstart\"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new mf(null),ei.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Yt(null),this.rootWheelEvent=new Ri(null),this.cursorStyles={default:\"inherit\",pointer:\"pointer\"},this.features=new Proxy({...Ho.defaultEventFeatures},{set:(e,i,s)=>(i===\"globalMove\"&&(this.rootBoundary.enableGlobalMoveEvents=s),e[i]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,Ho._defaultEventMode=t.eventMode??\"auto\",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||\"default\";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case\"string\":e&&(this.domElement.style.cursor=i);break;case\"function\":i(t);break;case\"object\":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t==\"string\"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!(\"cancelable\"in t))&&t.preventDefault();for(let i=0,s=e.length;i<s;i++){const n=e[i],a=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,ei.pointerMoved();const e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){const n=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?\"outside\":\"\",s=this.normalizeToPointerData(t);for(let n=0,a=s.length;n<a;n++){const o=this.bootstrapEvent(this.rootPointerEvent,s[n]);o.type+=i,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){const n=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,ei.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;ei.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming=\"none\",t.msTouchAction=\"none\"):this.supportsPointerEvents&&(t.touchAction=\"none\")),this.supportsPointerEvents?(globalThis.document.addEventListener(\"pointermove\",this.onPointerMove,!0),this.domElement.addEventListener(\"pointerdown\",this.onPointerDown,!0),this.domElement.addEventListener(\"pointerleave\",this.onPointerOverOut,!0),this.domElement.addEventListener(\"pointerover\",this.onPointerOverOut,!0),globalThis.addEventListener(\"pointerup\",this.onPointerUp,!0)):(globalThis.document.addEventListener(\"mousemove\",this.onPointerMove,!0),this.domElement.addEventListener(\"mousedown\",this.onPointerDown,!0),this.domElement.addEventListener(\"mouseout\",this.onPointerOverOut,!0),this.domElement.addEventListener(\"mouseover\",this.onPointerOverOut,!0),globalThis.addEventListener(\"mouseup\",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener(\"touchstart\",this.onPointerDown,!0),this.domElement.addEventListener(\"touchend\",this.onPointerUp,!0),this.domElement.addEventListener(\"touchmove\",this.onPointerMove,!0))),this.domElement.addEventListener(\"wheel\",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;ei.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming=\"\",t.msTouchAction=\"\"):this.supportsPointerEvents&&(t.touchAction=\"\"),this.supportsPointerEvents?(globalThis.document.removeEventListener(\"pointermove\",this.onPointerMove,!0),this.domElement.removeEventListener(\"pointerdown\",this.onPointerDown,!0),this.domElement.removeEventListener(\"pointerleave\",this.onPointerOverOut,!0),this.domElement.removeEventListener(\"pointerover\",this.onPointerOverOut,!0),globalThis.removeEventListener(\"pointerup\",this.onPointerUp,!0)):(globalThis.document.removeEventListener(\"mousemove\",this.onPointerMove,!0),this.domElement.removeEventListener(\"mousedown\",this.onPointerDown,!0),this.domElement.removeEventListener(\"mouseout\",this.onPointerOverOut,!0),this.domElement.removeEventListener(\"mouseover\",this.onPointerOverOut,!0),globalThis.removeEventListener(\"mouseup\",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener(\"touchstart\",this.onPointerDown,!0),this.domElement.removeEventListener(\"touchend\",this.onPointerUp,!0),this.domElement.removeEventListener(\"touchmove\",this.onPointerMove,!0))),this.domElement.removeEventListener(\"wheel\",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){const s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*n,t.y=(i-s.top)*(this.domElement.height/s.height)*n}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,s=t.changedTouches.length;i<s;i++){const n=t.changedTouches[i];typeof n.button>\"u\"&&(n.button=0),typeof n.buttons>\"u\"&&(n.buttons=1),typeof n.isPrimary>\"u\"&&(n.isPrimary=t.touches.length===1&&t.type===\"touchstart\"),typeof n.width>\"u\"&&(n.width=n.radiusX||1),typeof n.height>\"u\"&&(n.height=n.radiusY||1),typeof n.tiltX>\"u\"&&(n.tiltX=0),typeof n.tiltY>\"u\"&&(n.tiltY=0),typeof n.pointerType>\"u\"&&(n.pointerType=\"touch\"),typeof n.pointerId>\"u\"&&(n.pointerId=n.identifier||0),typeof n.pressure>\"u\"&&(n.pressure=n.force||.5),typeof n.twist>\"u\"&&(n.twist=0),typeof n.tangentialPressure>\"u\"&&(n.tangentialPressure=0),typeof n.layerX>\"u\"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>\"u\"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const i=t;typeof i.isPrimary>\"u\"&&(i.isPrimary=!0),typeof i.width>\"u\"&&(i.width=1),typeof i.height>\"u\"&&(i.height=1),typeof i.tiltX>\"u\"&&(i.tiltX=0),typeof i.tiltY>\"u\"&&(i.tiltY=0),typeof i.pointerType>\"u\"&&(i.pointerType=\"mouse\"),typeof i.pointerId>\"u\"&&(i.pointerId=px),typeof i.pressure>\"u\"&&(i.pressure=.5),typeof i.twist>\"u\"&&(i.twist=0),typeof i.tangentialPressure>\"u\"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type===\"pointerleave\"&&(t.type=\"pointerout\"),t.type.startsWith(\"mouse\")&&(t.type=t.type.replace(\"mouse\",\"pointer\")),t.type.startsWith(\"touch\")&&(t.type=mx[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};Vo.extension={name:\"events\",type:[F.RendererSystem,F.CanvasRendererSystem]},Vo.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let Rn=Vo;k.add(Rn);function Pu(r){return r===\"dynamic\"||r===\"static\"}const gf={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Pu(Rn.defaultEventMode)},set interactive(r){z(\"7.2.0\",\"Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead.\"),this._internalInteractive=r,this.eventMode=r?\"static\":\"auto\"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Rn.defaultEventMode},set eventMode(r){this._internalInteractive=Pu(r),this._internalEventMode=r},isInteractive(){return this.eventMode===\"static\"||this.eventMode===\"dynamic\"},interactiveChildren:!0,hitArea:null,addEventListener(r,t,e){const i=typeof e==\"boolean\"&&e||typeof e==\"object\"&&e.capture,s=typeof e==\"object\"?e.signal:void 0,n=typeof e==\"object\"?e.once===!0:!1,a=typeof t==\"function\"?void 0:t;r=i?`${r}capture`:r;const o=typeof t==\"function\"?t:t.handleEvent,h=this;s&&s.addEventListener(\"abort\",()=>{h.off(r,o,a)}),n?h.once(r,o,a):h.on(r,o,a)},removeEventListener(r,t,e){const i=typeof e==\"boolean\"&&e||typeof e==\"object\"&&e.capture,s=typeof t==\"function\"?void 0:t;r=i?`${r}capture`:r,t=typeof t==\"function\"?t:t.handleEvent,this.off(r,t,s)},dispatchEvent(r){if(!(r instanceof fr))throw new Error(\"DisplayObject cannot propagate events outside of the Federated Events API\");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};ct.mixin(gf);const _f={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:\"button\",accessiblePointerEvents:\"auto\",accessibleChildren:!0,renderId:-1};ct.mixin(_f);const gx=9,Gs=100,_x=0,yx=0,Mu=2,Iu=1,vx=-1e3,xx=-1e3,bx=2;class Yh{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(he.tablet||he.phone)&&this.createTouchHook();const e=document.createElement(\"div\");e.style.width=`${Gs}px`,e.style.height=`${Gs}px`,e.style.position=\"absolute\",e.style.top=`${_x}px`,e.style.left=`${yx}px`,e.style.zIndex=Mu.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener(\"keydown\",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement(\"button\");t.style.width=`${Iu}px`,t.style.height=`${Iu}px`,t.style.position=\"absolute\",t.style.top=`${vx}px`,t.style.left=`${xx}px`,t.style.zIndex=bx.toString(),t.style.backgroundColor=\"#FF0000\",t.title=\"select to enable accessibility for this content\",t.addEventListener(\"focus\",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener(\"mousemove\",this._onMouseMove,!0),globalThis.removeEventListener(\"keydown\",this._onKeyDown,!1),this.renderer.on(\"postrender\",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener(\"mousemove\",this._onMouseMove,!0),globalThis.addEventListener(\"keydown\",this._onKeyDown,!1),this.renderer.off(\"postrender\",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}update(){const t=performance.now();if(he.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:s,height:n}=this.renderer.view.getBoundingClientRect(),{width:a,height:o,resolution:h}=this.renderer,l=s/a*h,u=n/o*h;let c=this.div;c.style.left=`${e}px`,c.style.top=`${i}px`,c.style.width=`${a}px`,c.style.height=`${o}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,Mi(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{c=f._accessibleDiv;let p=f.hitArea;const m=f.worldTransform;f.hitArea?(c.style.left=`${(m.tx+p.x*m.a)*l}px`,c.style.top=`${(m.ty+p.y*m.d)*u}px`,c.style.width=`${p.width*m.a*l}px`,c.style.height=`${p.height*m.d*u}px`):(p=f.getBounds(),this.capHitArea(p),c.style.left=`${p.x*l}px`,c.style.top=`${p.y*u}px`,c.style.width=`${p.width*l}px`,c.style.height=`${p.height*u}px`,c.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(c.title=f.accessibleTitle),c.getAttribute(\"aria-label\")!==f.accessibleHint&&f.accessibleHint!==null&&c.setAttribute(\"aria-label\",f.accessibleHint)),(f.accessibleTitle!==c.title||f.tabIndex!==c.tabIndex)&&(c.title=f.accessibleTitle,c.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement(\"button\"),e.style.width=`${Gs}px`,e.style.height=`${Gs}px`,e.style.backgroundColor=this.debug?\"rgba(255,255,255,0.5)\":\"transparent\",e.style.position=\"absolute\",e.style.zIndex=Mu.toString(),e.style.borderStyle=\"none\",navigator.userAgent.toLowerCase().includes(\"chrome\")?e.setAttribute(\"aria-live\",\"off\"):e.setAttribute(\"aria-live\",\"polite\"),navigator.userAgent.match(/rv:.*Gecko\\//)?e.setAttribute(\"aria-relevant\",\"additions\"):e.setAttribute(\"aria-relevant\",\"text\"),e.addEventListener(\"click\",this._onClick.bind(this)),e.addEventListener(\"focus\",this._onFocus.bind(this)),e.addEventListener(\"focusout\",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute(\"aria-label\",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,s=this.renderer.events.rootBoundary,n=Object.assign(new fr(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,e.forEach(a=>s.dispatchEvent(n,a))}_onClick(t){this._dispatchEvent(t,[\"click\",\"pointertap\",\"tap\"])}_onFocus(t){t.target.getAttribute(\"aria-live\")||t.target.setAttribute(\"aria-live\",\"assertive\"),this._dispatchEvent(t,[\"mouseover\"])}_onFocusOut(t){t.target.getAttribute(\"aria-live\")||t.target.setAttribute(\"aria-live\",\"polite\"),this._dispatchEvent(t,[\"mouseout\"])}_onKeyDown(t){t.keyCode===gx&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener(\"mousemove\",this._onMouseMove,!0),globalThis.removeEventListener(\"keydown\",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Yh.extension={name:\"accessibility\",type:[F.RendererPlugin,F.CanvasRendererPlugin]};k.add(Yh);const yf=class Xo{constructor(t){this.stage=new kt,t=Object.assign({forceCanvas:!1},t),this.renderer=tf(t),Xo._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,e){const i=Xo._plugins.slice(0);i.reverse(),i.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};yf._plugins=[];let qh=yf;k.handleByList(F.Application,qh._plugins);class Kh{static init(t){Object.defineProperty(this,\"resizeTo\",{set(e){globalThis.removeEventListener(\"resize\",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener(\"resize\",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:n}=this._resizeTo;e=s,i=n}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener(\"resize\",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Kh.extension=F.Application;k.add(Kh);const Ru={loader:F.LoadParser,resolver:F.ResolveParser,cache:F.CacheParser,detection:F.DetectionParser};k.handle(F.Asset,r=>{const t=r.ref;Object.entries(Ru).filter(([e])=>!!t[e]).forEach(([e,i])=>k.add(Object.assign(t[e],{extension:t[e].extension??i})))},r=>{const t=r.ref;Object.keys(Ru).filter(e=>!!t[e]).forEach(e=>k.remove(t[e]))});class Tx{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log(\"[BackgroundLoader] assets: \",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Bi(r,t){if(Array.isArray(t)){for(const e of t)if(r.startsWith(`data:${e}`))return!0;return!1}return r.startsWith(`data:${t}`)}function Ke(r,t){const e=r.split(\"?\")[0],i=bt.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Kt=(r,t,e=!1)=>(Array.isArray(r)||(r=[r]),t?r.map(i=>typeof i==\"string\"||e?t(i):i):r),Dn=(r,t)=>{const e=t.split(\"?\")[1];return e&&(r+=`?${e}`),r};function vf(r,t,e,i,s){const n=t[e];for(let a=0;a<n.length;a++){const o=n[a];e<t.length-1?vf(r.replace(i[e],o),t,e+1,i,s):s.push(r.replace(i[e],o))}}function xf(r){const t=/\\{(.*?)\\}/g,e=r.match(t),i=[];if(e){const s=[];e.forEach(n=>{const a=n.substring(1,n.length-1).split(\",\");s.push(a)}),vf(r,s,0,e,i)}else i.push(r);return i}const rs=r=>!Array.isArray(r);class wx{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=Kt(t);let s;for(let o=0;o<this.parsers.length;o++){const h=this.parsers[o];if(h.test(e)){s=h.getCacheableAssets(i,e);break}}s||(s={},i.forEach(o=>{s[o]=e}));const n=Object.keys(s),a={cacheKeys:n,keys:i};if(i.forEach(o=>{this._cacheMap.set(o,a)}),n.forEach(o=>{const h=s?s[o]:e;this._cache.has(o)&&this._cache.get(o)!==h&&console.warn(\"[Cache] already has key:\",o),this._cache.set(o,s[o])}),e instanceof B){const o=e;i.forEach(h=>{o.baseTexture!==B.EMPTY.baseTexture&&j.addToCache(o.baseTexture,h),B.addToCache(o,h)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(i=>{this._cache.delete(i)}),e.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const ii=new wx;class Ex{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{let s=null,n=null;if(e.loadParser&&(n=this._parserHash[e.loadParser],n||console.warn(`[Assets] specified load parser \"${e.loadParser}\" not found while loading ${t}`)),!n){for(let a=0;a<this.parsers.length;a++){const o=this.parsers[a];if(o.load&&o.test?.(t,e,this)){n=o;break}}if(!n)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=await n.load(t,e,this),i.parser=n;for(let a=0;a<this.parsers.length;a++){const o=this.parsers[a];o.parse&&o.parse&&await o.testParse?.(s,e,this)&&(s=await o.parse(s,e,this)||s,i.parser=o)}return s})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const s={},n=rs(t),a=Kt(t,l=>({alias:[l],src:l})),o=a.length,h=a.map(async l=>{const u=bt.toAbsolute(l.src);if(!s[l.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,l)),s[l.src]=await this.promiseCache[u].promise,e&&e(++i/o)}catch(c){throw delete this.promiseCache[u],delete s[l.src],new Error(`[Loader.load] Failed to load ${u}.\n${c}`)}});return await Promise.all(h),n?s[a[0].src]:s}async unload(t){const e=Kt(t,i=>({alias:[i],src:i})).map(async i=>{const s=bt.toAbsolute(i.src),n=this.promiseCache[s];if(n){const a=await n.promise;delete this.promiseCache[s],n.parser?.unload?.(a,i,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict \"${e.name}\"`),{...t,[e.name]:e}),{})}}var ee=(r=>(r[r.Low=0]=\"Low\",r[r.Normal=1]=\"Normal\",r[r.High=2]=\"High\",r))(ee||{});const Cx=\".json\",Sx=\"application/json\",bf={extension:{type:F.LoadParser,priority:ee.Low},name:\"loadJson\",test(r){return Bi(r,Sx)||Ke(r,Cx)},async load(r){return await(await N.ADAPTER.fetch(r)).json()}};k.add(bf);const Ax=\".txt\",Px=\"text/plain\",Tf={name:\"loadTxt\",extension:{type:F.LoadParser,priority:ee.Low},test(r){return Bi(r,Px)||Ke(r,Ax)},async load(r){return await(await N.ADAPTER.fetch(r)).text()}};k.add(Tf);const Mx=[\"normal\",\"bold\",\"100\",\"200\",\"300\",\"400\",\"500\",\"600\",\"700\",\"800\",\"900\"],Ix=[\".ttf\",\".otf\",\".woff\",\".woff2\"],Rx=[\"font/ttf\",\"font/otf\",\"font/woff\",\"font/woff2\"],Dx=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function wf(r){const t=bt.extname(r),e=bt.basename(r,t).replace(/(-|_)/g,\" \").toLowerCase().split(\" \").map(n=>n.charAt(0).toUpperCase()+n.slice(1));let i=e.length>0;for(const n of e)if(!n.match(Dx)){i=!1;break}let s=e.join(\" \");return i||(s=`\"${s.replace(/[\\\\\"]/g,\"\\\\$&\")}\"`),s}const Fx=/^[0-9A-Za-z%:/?#\\[\\]@!\\$&'()\\*\\+,;=\\-._~]*$/;function Bx(r){return Fx.test(r)?r:encodeURI(r)}const Ef={extension:{type:F.LoadParser,priority:ee.Low},name:\"loadWebFont\",test(r){return Bi(r,Rx)||Ke(r,Ix)},async load(r,t){const e=N.ADAPTER.getFontFaceSet();if(e){const i=[],s=t.data?.family??wf(r),n=t.data?.weights?.filter(o=>Mx.includes(o))??[\"normal\"],a=t.data??{};for(let o=0;o<n.length;o++){const h=n[o],l=new FontFace(s,`url(${Bx(r)})`,{...a,weight:h});await l.load(),e.add(l),i.push(l)}return i.length===1?i[0]:i}return console.warn(\"[loadWebFont] FontFace API is not supported. Skipping loading font\"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(t=>N.ADAPTER.getFontFaceSet().delete(t))}};k.add(Ef);const Lx=`(function() {\n  \"use strict\";\n  const WHITE_PNG = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=\";\n  async function checkImageBitmap() {\n    try {\n      if (typeof createImageBitmap != \"function\")\n        return !1;\n      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);\n      return imageBitmap.width === 1 && imageBitmap.height === 1;\n    } catch {\n      return !1;\n    }\n  }\n  checkImageBitmap().then((result) => {\n    self.postMessage(result);\n  });\n})();\n`;let er=null,$o=class{constructor(){er||(er=URL.createObjectURL(new Blob([Lx],{type:\"application/javascript\"}))),this.worker=new Worker(er)}};$o.revokeObjectURL=function(){er&&(URL.revokeObjectURL(er),er=null)};const Ox=`(function() {\n  \"use strict\";\n  async function loadImageBitmap(url) {\n    const response = await fetch(url);\n    if (!response.ok)\n      throw new Error(\\`[WorkerManager.loadImageBitmap] Failed to fetch \\${url}: \\${response.status} \\${response.statusText}\\`);\n    const imageBlob = await response.blob();\n    return await createImageBitmap(imageBlob);\n  }\n  self.onmessage = async (event) => {\n    try {\n      const imageBitmap = await loadImageBitmap(event.data.data[0]);\n      self.postMessage({\n        data: imageBitmap,\n        uuid: event.data.uuid,\n        id: event.data.id\n      }, [imageBitmap]);\n    } catch (e) {\n      self.postMessage({\n        error: e,\n        uuid: event.data.uuid,\n        id: event.data.id\n      });\n    }\n  };\n})();\n`;let ir=null;class Cf{constructor(){ir||(ir=URL.createObjectURL(new Blob([Ox],{type:\"application/javascript\"}))),this.worker=new Worker(ir)}}Cf.revokeObjectURL=function(){ir&&(URL.revokeObjectURL(ir),ir=null)};let Du=0,$a;class Nx{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new $o;e.addEventListener(\"message\",i=>{e.terminate(),$o.revokeObjectURL(),t(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run(\"loadImageBitmap\",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){$a===void 0&&($a=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<$a&&(this._createdWorkers++,t=new Cf().worker,t.addEventListener(\"message\",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise((s,n)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:n})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[Du]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Du++,id:i})}}const Fu=new Nx;function pr(r,t,e){r.resource.internal=!0;const i=new B(r),s=()=>{delete t.promiseCache[e],ii.has(e)&&ii.remove(e)};return i.baseTexture.once(\"destroyed\",()=>{e in t.promiseCache&&(console.warn(\"[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture.\"),s())}),i.once(\"destroyed\",()=>{r.destroyed||(console.warn(\"[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture.\"),s())}),i}const Ux=[\".jpeg\",\".jpg\",\".png\",\".webp\",\".avif\"],kx=[\"image/jpeg\",\"image/png\",\"image/webp\",\"image/avif\"];async function Sf(r){const t=await N.ADAPTER.fetch(r);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const ys={name:\"loadTextures\",extension:{type:F.LoadParser,priority:ee.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:\"anonymous\"},test(r){return Bi(r,kx)||Ke(r,Ux)},async load(r,t,e){const i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let s;i?this.config.preferWorkers&&await Fu.isImageBitmapSupported()?s=await Fu.loadImageBitmap(r):s=await Sf(r):s=await new Promise((o,h)=>{const l=new Image;l.crossOrigin=this.config.crossOrigin,l.src=r,l.complete?o(l):(l.onload=()=>o(l),l.onerror=u=>h(u))});const n={...t.data};n.resolution??(n.resolution=De(r)),i&&n.resourceOptions?.ownsImageBitmap===void 0&&(n.resourceOptions={...n.resourceOptions},n.resourceOptions.ownsImageBitmap=!0);const a=new j(s,n);return a.resource.src=r,pr(a,e,r)},unload(r){r.destroy(!0)}};k.add(ys);const Gx=\".svg\",Vx=\"image/svg+xml\",Af={extension:{type:F.LoadParser,priority:ee.High},name:\"loadSVG\",test(r){return Bi(r,Vx)||Ke(r,Gx)},async testParse(r){return Pn.test(r)},async parse(r,t,e){const i=new Pn(r,t?.data?.resourceOptions);await i.load();const s=new j(i,{resolution:De(r),...t?.data});return s.resource.src=t.src,pr(s,e,t.src)},async load(r,t){return(await N.ADAPTER.fetch(r)).text()},unload:ys.unload};k.add(Af);const Hx=[\".mp4\",\".m4v\",\".webm\",\".ogv\"],Xx=[\"video/mp4\",\"video/webm\",\"video/ogg\"],Pf={name:\"loadVideo\",extension:{type:F.LoadParser,priority:ee.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(r){return Bi(r,Xx)||Ke(r,Hx)},async load(r,t,e){let i;const s=await(await N.ADAPTER.fetch(r)).blob(),n=URL.createObjectURL(s);try{const a={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...t?.data?.resourceOptions,autoLoad:!0},o=new jh(n,a);await o.load();const h=new j(o,{alphaMode:await cd(),resolution:De(r),...t?.data});h.resource.src=r,i=pr(h,e,r),i.baseTexture.once(\"destroyed\",()=>{URL.revokeObjectURL(n)})}catch(a){throw URL.revokeObjectURL(n),a}return i},unload(r){r.destroy(!0)}};k.add(Pf);class $x{constructor(){this._defaultBundleIdentifierOptions={connector:\"-\",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,\"\")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle(\"foo\",this._createBundleAssetId(\"foo\",\"bar\"))!==\"bar\")throw new Error(\"[Resolver] GenerateBundleAssetId are not working correctly\")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t==\"string\")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join(\"&\")}}getAlias(t){const{alias:e,name:i,src:s,srcs:n}=t;return Kt(e||i||s||n,a=>typeof a==\"string\"?a:Array.isArray(a)?a.map(o=>o?.src??o?.srcs??o):a?.src||a?.srcs?a.src??a.srcs:a,!0)}addManifest(t){this._manifest&&console.warn(\"[Resolver] Manifest already exists, this will be overwritten\"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach(s=>{const n=s.src??s.srcs,a=s.alias??s.name;let o;if(typeof a==\"string\"){const h=this._createBundleAssetId(t,a);i.push(h),o=[a,h]}else{const h=a.map(l=>this._createBundleAssetId(t,l));i.push(...h),o=[...a,...h]}this.add({...s,alias:o,src:n})}):Object.keys(e).forEach(s=>{const n=[s,this._createBundleAssetId(t,s)];if(typeof e[s]==\"string\")this.add({alias:n,src:e[s]});else if(Array.isArray(e[s]))this.add({alias:n,src:e[s]});else{const a=e[s],o=a.src??a.srcs;this.add({...a,alias:n,src:Array.isArray(o)?o:[o]})}i.push(...n)}),this._bundles[t]=i}add(t,e,i,s,n){const a=[];typeof t==\"string\"||Array.isArray(t)&&typeof t[0]==\"string\"?(z(\"7.2.0\",`Assets.add now uses an object instead of individual parameters.\nPlease use Assets.add({ alias, src, data, format, loadParser }) instead.`),a.push({alias:t,src:e,data:i,format:s,loadParser:n})):Array.isArray(t)?a.push(...t):a.push(t);let o;o=h=>{this.hasKey(h)&&console.warn(`[Resolver] already has key: ${h} overwriting`)},Kt(a).forEach(h=>{const{src:l,srcs:u}=h;let{data:c,format:d,loadParser:f}=h;const p=Kt(l||u).map(y=>typeof y==\"string\"?xf(y):Array.isArray(y)?y:[y]),m=this.getAlias(h);Array.isArray(m)?m.forEach(o):o(m);const g=[];p.forEach(y=>{y.forEach(x=>{let _={};if(typeof x!=\"object\"){_.src=x;for(let v=0;v<this._parsers.length;v++){const T=this._parsers[v];if(T.test(x)){_=T.parse(x);break}}}else c=x.data??c,d=x.format??d,f=x.loadParser??f,_={..._,...x};if(!m)throw new Error(`[Resolver] alias is undefined for this asset: ${_.src}`);_=this.buildResolvedAsset(_,{aliases:m,data:c,format:d,loadParser:f}),g.push(_)})}),m.forEach(y=>{this._assetMap[y]=g})})}resolveBundle(t){const e=rs(t);t=Kt(t);const i={};return t.forEach(s=>{const n=this._bundles[s];if(n){const a=this.resolve(n),o={};for(const h in a){const l=a[h];o[this._extractAssetIdFromBundle(s,h)]=l}i[s]=o}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!=\"string\"){const i={};for(const s in e)i[s]=e[s].src;return i}return e.src}resolve(t){const e=rs(t);t=Kt(t);const i={};return t.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let n=this._assetMap[s];const a=n[0],o=this._getPreferredOrder(n);o?.priority.forEach(h=>{o.params[h].forEach(l=>{const u=n.filter(c=>c[h]?c[h]===l:!1);u.length&&(n=u)})}),this._resolverHash[s]=n[0]??a}else this._resolverHash[s]=this.buildResolvedAsset({alias:[s],src:s},{});i[s]=this._resolverHash[s]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[0],s=this._preferredOrder.find(n=>n.params.format.includes(i.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\\?/.test(t)?\"&\":\"?\";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:i,data:s,loadParser:n,format:a}=e;return(this._basePath||this._rootPath)&&(t.src=bt.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...s||{},...t.data},t.loadParser=n??t.loadParser,t.format=a??t.format??bt.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class Mf{constructor(){this._detections=[],this._initialized=!1,this.resolver=new $x,this.loader=new Ex,this.cache=ii,this._backgroundLoader=new Tx(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){console.warn(\"[Assets]AssetManager already initialized, did you load before calling this Assets.init()?\");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let n=t.manifest;typeof n==\"string\"&&(n=await this.load(n)),this.resolver.addManifest(n)}const e=t.texturePreference?.resolution??1,i=typeof e==\"number\"?[e]:e,s=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i,s,n){this.resolver.add(t,e,i,s,n)}async load(t,e){this._initialized||await this.init();const i=rs(t),s=Kt(t).map(o=>{if(typeof o!=\"string\"){const h=this.resolver.getAlias(o);return h.some(l=>!this.resolver.hasKey(l))&&this.add(o),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(o)||this.add({alias:o,src:o}),o}),n=this.resolver.resolve(s),a=await this._mapLoadToResolve(n,e);return i?a[s[0]]:a}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t==\"string\"&&(i=!0,t=[t]);const s=this.resolver.resolveBundle(t),n={},a=Object.keys(s);let o=0,h=0;const l=()=>{e?.(++o/h)},u=a.map(c=>{const d=s[c];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{n[c]=f})});return await Promise.all(u),i?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t==\"string\"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t==\"string\"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t==\"string\")return ii.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=ii.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(i,e);this._backgroundLoader.active=!0;const a={};return i.forEach((o,h)=>{const l=n[o.src],u=[o.src];o.alias&&u.push(...o.alias),a[s[h]]=l,ii.set(u,l)}),a}async unload(t){this._initialized||await this.init();const e=Kt(t).map(s=>typeof s!=\"string\"?s.src:s),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Kt(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(s=>this._unloadFromResolved(e[s]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{ii.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,s)=>e.indexOf(i)===s),e}get detections(){return this._detections}get preferWorkers(){return ys.config.preferWorkers}set preferWorkers(t){z(\"7.2.0\",\"Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead.\"),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}}const Ir=new Mf;k.handleByList(F.LoadParser,Ir.loader.parsers).handleByList(F.ResolveParser,Ir.resolver.parsers).handleByList(F.CacheParser,Ir.cache.parsers).handleByList(F.DetectionParser,Ir.detections);const If={extension:F.CacheParser,test:r=>Array.isArray(r)&&r.every(t=>t instanceof B),getCacheableAssets:(r,t)=>{const e={};return r.forEach(i=>{t.forEach((s,n)=>{e[i+(n===0?\"\":n+1)]=s})}),e}};k.add(If);async function Rf(r){if(\"Image\"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=r});if(\"createImageBitmap\"in globalThis&&\"fetch\"in globalThis){try{const t=await(await fetch(r)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const Df={extension:{type:F.DetectionParser,priority:1},test:async()=>Rf(\"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=\"),add:async r=>[...r,\"avif\"],remove:async r=>r.filter(t=>t!==\"avif\")};k.add(Df);const Ff={extension:{type:F.DetectionParser,priority:0},test:async()=>Rf(\"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=\"),add:async r=>[...r,\"webp\"],remove:async r=>r.filter(t=>t!==\"webp\")};k.add(Ff);const Bu=[\"png\",\"jpg\",\"jpeg\"],Bf={extension:{type:F.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...Bu],remove:async r=>r.filter(t=>!Bu.includes(t))};k.add(Bf);const zx=\"WorkerGlobalScope\"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Zh(r){return zx?!1:document.createElement(\"video\").canPlayType(r)!==\"\"}const Lf={extension:{type:F.DetectionParser,priority:0},test:async()=>Zh(\"video/webm\"),add:async r=>[...r,\"webm\"],remove:async r=>r.filter(t=>t!==\"webm\")};k.add(Lf);const Of={extension:{type:F.DetectionParser,priority:0},test:async()=>Zh(\"video/mp4\"),add:async r=>[...r,\"mp4\",\"m4v\"],remove:async r=>r.filter(t=>t!==\"mp4\"&&t!==\"m4v\")};k.add(Of);const Nf={extension:{type:F.DetectionParser,priority:0},test:async()=>Zh(\"video/ogg\"),add:async r=>[...r,\"ogv\"],remove:async r=>r.filter(t=>t!==\"ogv\")};k.add(Nf);const Uf={extension:F.ResolveParser,test:ys.test,parse:r=>({resolution:parseFloat(N.RETINA_PREFIX.exec(r)?.[1]??\"1\"),format:bt.extname(r).slice(1),src:r})};k.add(Uf);var Ct=(r=>(r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]=\"COMPRESSED_RGB_S3TC_DXT1_EXT\",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]=\"COMPRESSED_RGBA_S3TC_DXT1_EXT\",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]=\"COMPRESSED_RGBA_S3TC_DXT3_EXT\",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]=\"COMPRESSED_RGBA_S3TC_DXT5_EXT\",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]=\"COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT\",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]=\"COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT\",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]=\"COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT\",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]=\"COMPRESSED_SRGB_S3TC_DXT1_EXT\",r[r.COMPRESSED_R11_EAC=37488]=\"COMPRESSED_R11_EAC\",r[r.COMPRESSED_SIGNED_R11_EAC=37489]=\"COMPRESSED_SIGNED_R11_EAC\",r[r.COMPRESSED_RG11_EAC=37490]=\"COMPRESSED_RG11_EAC\",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]=\"COMPRESSED_SIGNED_RG11_EAC\",r[r.COMPRESSED_RGB8_ETC2=37492]=\"COMPRESSED_RGB8_ETC2\",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]=\"COMPRESSED_RGBA8_ETC2_EAC\",r[r.COMPRESSED_SRGB8_ETC2=37493]=\"COMPRESSED_SRGB8_ETC2\",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]=\"COMPRESSED_SRGB8_ALPHA8_ETC2_EAC\",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]=\"COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2\",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]=\"COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2\",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]=\"COMPRESSED_RGB_PVRTC_4BPPV1_IMG\",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]=\"COMPRESSED_RGBA_PVRTC_4BPPV1_IMG\",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]=\"COMPRESSED_RGB_PVRTC_2BPPV1_IMG\",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]=\"COMPRESSED_RGBA_PVRTC_2BPPV1_IMG\",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]=\"COMPRESSED_RGB_ETC1_WEBGL\",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]=\"COMPRESSED_RGB_ATC_WEBGL\",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]=\"COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL\",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]=\"COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL\",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]=\"COMPRESSED_RGBA_ASTC_4x4_KHR\",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]=\"COMPRESSED_RGBA_BPTC_UNORM_EXT\",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]=\"COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT\",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]=\"COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT\",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]=\"COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT\",r))(Ct||{});const ss={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let be,ji;function Lu(){ji={bptc:be.getExtension(\"EXT_texture_compression_bptc\"),astc:be.getExtension(\"WEBGL_compressed_texture_astc\"),etc:be.getExtension(\"WEBGL_compressed_texture_etc\"),s3tc:be.getExtension(\"WEBGL_compressed_texture_s3tc\"),s3tc_sRGB:be.getExtension(\"WEBGL_compressed_texture_s3tc_srgb\"),pvrtc:be.getExtension(\"WEBGL_compressed_texture_pvrtc\")||be.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\"),etc1:be.getExtension(\"WEBGL_compressed_texture_etc1\"),atc:be.getExtension(\"WEBGL_compressed_texture_atc\")}}const kf={extension:{type:F.DetectionParser,priority:2},test:async()=>{const r=N.ADAPTER.createCanvas().getContext(\"webgl\");return r?(be=r,!0):(console.warn(\"WebGL not available for compressed textures.\"),!1)},add:async r=>{ji||Lu();const t=[];for(const e in ji)ji[e]&&t.push(e);return[...t,...r]},remove:async r=>(ji||Lu(),r.filter(t=>!(t in ji)))};k.add(kf);class Gf extends fs{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,s;typeof t==\"string\"?(i=t,s=new Uint8Array):(i=null,s=t),super(s,e),this.origin=i,this.buffer=s?new wn(s):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new wn(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class ni extends Gf{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=ni._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||ni._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let n=0,a=this.levels;n<a;n++){const{levelID:o,levelWidth:h,levelHeight:l,levelBuffer:u}=this._levelBuffers[n];s.compressedTexImage2D(s.TEXTURE_2D,o,this.format,h,l,0,u)}return!0}onBlobLoaded(){this._levelBuffers=ni._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return\"s3tc\";if(t>=35916&&t<=35919)return\"s3tc_sRGB\";if(t>=37488&&t<=37497)return\"etc\";if(t>=35840&&t<=35843)return\"pvrtc\";if(t===36196)return\"etc1\";if(t===35986||t===35987||t===34798)return\"atc\";if(t>=36492&&t<=36495)return\"bptc\";if(t===37808)return\"astc\";throw new Error(`Invalid (compressed) texture format given: ${t}`)}static _createLevelBuffers(t,e,i,s,n,a,o){const h=new Array(i);let l=t.byteOffset,u=a,c=o,d=u+s-1&~(s-1),f=c+n-1&~(n-1),p=d*f*ss[e];for(let m=0;m<i;m++)h[m]={levelID:m,levelWidth:i>1?u:d,levelHeight:i>1?c:f,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,u=u>>1||1,c=c>>1||1,d=u+s-1&~(s-1),f=c+n-1&~(n-1),p=d*f*ss[e];return h}}const za=4,Vs=124,Wx=32,Ou=20,jx=542327876,Hs={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Yx={FOURCC:2},Xs={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},qx=1,Kx=2,Zx=4,Jx=64,Qx=512,t0=131072,e0=827611204,i0=861165636,r0=894720068,s0=808540228,n0=4,a0={[e0]:Ct.COMPRESSED_RGBA_S3TC_DXT1_EXT,[i0]:Ct.COMPRESSED_RGBA_S3TC_DXT3_EXT,[r0]:Ct.COMPRESSED_RGBA_S3TC_DXT5_EXT},o0={70:Ct.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Ct.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Ct.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Ct.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Ct.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Ct.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Ct.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Ct.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Ct.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:Ct.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:Ct.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:Ct.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:Ct.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function Vf(r){const t=new Uint32Array(r);if(t[0]!==jx)throw new Error(\"Invalid DDS file magic word\");const e=new Uint32Array(r,0,Vs/Uint32Array.BYTES_PER_ELEMENT),i=e[Hs.HEIGHT],s=e[Hs.WIDTH],n=e[Hs.MIPMAP_COUNT],a=new Uint32Array(r,Hs.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Wx/Uint32Array.BYTES_PER_ELEMENT),o=a[qx];if(o&Zx){const h=a[Yx.FOURCC];if(h!==s0){const x=a0[h],_=za+Vs,v=new Uint8Array(r,_);return[new ni(v,{format:x,width:s,height:i,levels:n})]}const l=za+Vs,u=new Uint32Array(t.buffer,l,Ou/Uint32Array.BYTES_PER_ELEMENT),c=u[Xs.DXGI_FORMAT],d=u[Xs.RESOURCE_DIMENSION],f=u[Xs.MISC_FLAG],p=u[Xs.ARRAY_SIZE],m=o0[c];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(f===n0)throw new Error(\"DDSParser does not support cubemap textures\");if(d===6)throw new Error(\"DDSParser does not supported 3D texture data\");const g=new Array,y=za+Vs+Ou;if(p===1)g.push(new Uint8Array(r,y));else{const x=ss[m];let _=0,v=s,T=i;for(let w=0;w<n;w++){const b=Math.max(1,v+3&-4),R=Math.max(1,T+3&-4),L=b*R*x;_+=L,v=v>>>1,T=T>>>1}let S=y;for(let w=0;w<p;w++)g.push(new Uint8Array(r,S,_)),S+=_}return g.map(x=>new ni(x,{format:m,width:s,height:i,levels:n}))}throw o&Jx?new Error(\"DDSParser does not support uncompressed texture data.\"):o&Qx?new Error(\"DDSParser does not supported YUV uncompressed texture data.\"):o&t0?new Error(\"DDSParser does not support single-channel (lumninance) texture data!\"):o&Kx?new Error(\"DDSParser does not support single-channel (alpha) texture data!\"):new Error(\"DDSParser failed to load a texture file due to an unknown reason!\")}const Nu=[171,75,84,88,32,49,49,187,13,10,26,10],h0=67305985,re={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},zo=64,Wo={[V.UNSIGNED_BYTE]:1,[V.UNSIGNED_SHORT]:2,[V.INT]:4,[V.UNSIGNED_INT]:4,[V.FLOAT]:4,[V.HALF_FLOAT]:8},Hf={[M.RGBA]:4,[M.RGB]:3,[M.RG]:2,[M.RED]:1,[M.LUMINANCE]:1,[M.LUMINANCE_ALPHA]:2,[M.ALPHA]:1},Xf={[V.UNSIGNED_SHORT_4_4_4_4]:2,[V.UNSIGNED_SHORT_5_5_5_1]:2,[V.UNSIGNED_SHORT_5_6_5]:2};function $f(r,t,e=!1){const i=new DataView(t);if(!l0(r,i))return null;const s=i.getUint32(re.ENDIANNESS,!0)===h0,n=i.getUint32(re.GL_TYPE,s),a=i.getUint32(re.GL_FORMAT,s),o=i.getUint32(re.GL_INTERNAL_FORMAT,s),h=i.getUint32(re.PIXEL_WIDTH,s),l=i.getUint32(re.PIXEL_HEIGHT,s)||1,u=i.getUint32(re.PIXEL_DEPTH,s)||1,c=i.getUint32(re.NUMBER_OF_ARRAY_ELEMENTS,s)||1,d=i.getUint32(re.NUMBER_OF_FACES,s),f=i.getUint32(re.NUMBER_OF_MIPMAP_LEVELS,s),p=i.getUint32(re.BYTES_OF_KEY_VALUE_DATA,s);if(l===0||u!==1)throw new Error(\"Only 2D textures are supported\");if(d!==1)throw new Error(\"CubeTextures are not supported by KTXLoader yet!\");if(c!==1)throw new Error(\"WebGL does not support array textures\");const m=4,g=4,y=h+3&-4,x=l+3&-4,_=new Array(c);let v=h*l;n===0&&(v=y*x);let T;if(n!==0?Wo[n]?T=Wo[n]*Hf[a]:T=Xf[n]:T=ss[o],T===void 0)throw new Error(\"Unable to resolve the pixel format stored in the *.ktx file!\");const S=e?c0(i,p,s):null;let w=v*T,b=h,R=l,L=y,I=x,D=zo+p;for(let C=0;C<f;C++){const A=i.getUint32(D,s);let $=D+4;for(let q=0;q<c;q++){let U=_[q];U||(U=_[q]=new Array(f)),U[C]={levelID:C,levelWidth:f>1||n!==0?b:L,levelHeight:f>1||n!==0?R:I,levelBuffer:new Uint8Array(t,$,w)},$+=w}D+=A+4,D=D%4!==0?D+4-D%4:D,b=b>>1||1,R=R>>1||1,L=b+m-1&-4,I=R+g-1&-4,w=L*I*T}return n!==0?{uncompressed:_.map(C=>{let A=C[0].levelBuffer,$=!1;return n===V.FLOAT?A=new Float32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4):n===V.UNSIGNED_INT?($=!0,A=new Uint32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4)):n===V.INT&&($=!0,A=new Int32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4)),{resource:new fs(A,{width:C[0].levelWidth,height:C[0].levelHeight}),type:n,format:$?u0(a):a}}),kvData:S}:{compressed:_.map(C=>new ni(null,{format:o,width:h,height:l,levels:f,levelBuffers:C})),kvData:S}}function l0(r,t){for(let e=0;e<Nu.length;e++)if(t.getUint8(e)!==Nu[e])return console.error(`${r} is not a valid *.ktx file!`),!1;return!0}function u0(r){switch(r){case M.RGBA:return M.RGBA_INTEGER;case M.RGB:return M.RGB_INTEGER;case M.RG:return M.RG_INTEGER;case M.RED:return M.RED_INTEGER;default:return r}}function c0(r,t,e){const i=new Map;let s=0;for(;s<t;){const n=r.getUint32(zo+s,e),a=zo+s+4,o=3-(n+3)%4;if(n===0||n>t-s){console.error(\"KTXLoader: keyAndValueByteSize out of bounds\");break}let h=0;for(;h<n&&r.getUint8(a+h)!==0;h++);if(h===-1){console.error(\"KTXLoader: Failed to find null byte terminating kvData key\");break}const l=new TextDecoder().decode(new Uint8Array(r.buffer,a,h)),u=new DataView(r.buffer,a+h+1,n-h-1);i.set(l,u),s+=4+n+o}return i}const zf={extension:{type:F.LoadParser,priority:ee.High},name:\"loadDDS\",test(r){return Ke(r,\".dds\")},async load(r,t,e){const i=await(await N.ADAPTER.fetch(r)).arrayBuffer(),s=Vf(i).map(n=>{const a=new j(n,{mipmap:fe.OFF,alphaMode:Nt.NO_PREMULTIPLIED_ALPHA,resolution:De(r),...t.data});return pr(a,e,r)});return s.length===1?s[0]:s},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};k.add(zf);const Wf={extension:{type:F.LoadParser,priority:ee.High},name:\"loadKTX\",test(r){return Ke(r,\".ktx\")},async load(r,t,e){const i=await(await N.ADAPTER.fetch(r)).arrayBuffer(),{compressed:s,uncompressed:n,kvData:a}=$f(r,i),o=s??n,h={mipmap:fe.OFF,alphaMode:Nt.NO_PREMULTIPLIED_ALPHA,resolution:De(r),...t.data},l=o.map(u=>{o===n&&Object.assign(h,{type:u.type,format:u.format});const c=u.resource??u,d=new j(c,h);return d.ktxKeyValueData=a,pr(d,e,r)});return l.length===1?l[0]:l},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};k.add(Wf);const d0=[\"s3tc\",\"s3tc_sRGB\",\"etc\",\"etc1\",\"pvrtc\",\"atc\",\"astc\",\"bptc\"],jf={extension:F.ResolveParser,test:r=>{const t=bt.extname(r).slice(1);return[\"basis\",\"ktx\",\"dds\"].includes(t)},parse:r=>{const t=r.split(\".\"),e=t.pop();if([\"ktx\",\"dds\"].includes(e)){const i=t.pop();if(d0.includes(i))return{resolution:parseFloat(N.RETINA_PREFIX.exec(r)?.[1]??\"1\"),format:i,src:r}}return{resolution:parseFloat(N.RETINA_PREFIX.exec(r)?.[1]??\"1\"),format:e,src:r}}};k.add(jf);const $s=new Y,f0=4,Yf=class Rr{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,i,s){const n=new Image;return n.src=await this.base64(t,e,i,s),n}async base64(t,e,i,s){const n=this.canvas(t,s);if(n.toBlob!==void 0)return new Promise((a,o)=>{n.toBlob(h=>{if(!h){o(new Error(\"ICanvas.toBlob failed!\"));return}const l=new FileReader;l.onload=()=>a(l.result),l.onerror=o,l.readAsDataURL(h)},e,i)});if(n.toDataURL!==void 0)return n.toDataURL(e,i);if(n.convertToBlob!==void 0){const a=await n.convertToBlob({type:e,quality:i});return new Promise((o,h)=>{const l=new FileReader;l.onload=()=>o(l.result),l.onerror=h,l.readAsDataURL(a)})}throw new Error(\"Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented\")}canvas(t,e){const{pixels:i,width:s,height:n,flipY:a,premultipliedAlpha:o}=this._rawPixels(t,e);a&&Rr._flipY(i,s,n),o&&Rr._unpremultiplyAlpha(i);const h=new xd(s,n,1),l=new ImageData(new Uint8ClampedArray(i.buffer),s,n);return h.context.putImageData(l,0,0),h.canvas}pixels(t,e){const{pixels:i,width:s,height:n,flipY:a,premultipliedAlpha:o}=this._rawPixels(t,e);return a&&Rr._flipY(i,s,n),o&&Rr._unpremultiplyAlpha(i),i}_rawPixels(t,e){const i=this.renderer;if(!i)throw new Error(\"The Extract has already been destroyed\");let s,n=!1,a=!1,o,h=!1;t&&(t instanceof di?o=t:(o=i.generateTexture(t,{region:e,resolution:i.resolution,multisample:i.multisample}),h=!0,e&&($s.width=e.width,$s.height=e.height,e=$s)));const l=i.gl;if(o){if(s=o.baseTexture.resolution,e=e??o.frame,n=!1,a=o.baseTexture.alphaMode>0&&o.baseTexture.format===M.RGBA,!h){i.renderTexture.bind(o);const f=o.framebuffer.glFramebuffers[i.CONTEXT_UID];f.blitFramebuffer&&i.framebuffer.bind(f.blitFramebuffer)}}else s=i.resolution,e||(e=$s,e.width=i.width/s,e.height=i.height/s),n=!0,a=this._rendererPremultipliedAlpha,i.renderTexture.bind();const u=Math.max(Math.round(e.width*s),1),c=Math.max(Math.round(e.height*s),1),d=new Uint8Array(f0*u*c);return l.readPixels(Math.round(e.x*s),Math.round(e.y*s),u,c,l.RGBA,l.UNSIGNED_BYTE,d),h&&o?.destroy(!0),{pixels:d,width:u,height:c,flipY:n,premultipliedAlpha:a}}destroy(){this.renderer=null}static _flipY(t,e,i){const s=e<<2,n=i>>1,a=new Uint8Array(s);for(let o=0;o<n;o++){const h=o*s,l=(i-o-1)*s;a.set(t.subarray(h,h+s)),t.copyWithin(h,l,l+s),t.set(a,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let i=0;i<e;i+=4){const s=t[i+3];if(s!==0){const n=255.001/s;t[i]=t[i]*n+.5,t[i+1]=t[i+1]*n+.5,t[i+2]=t[i+2]*n+.5}}}};Yf.extension={name:\"extract\",type:F.RendererSystem};let qf=Yf;k.add(qf);const ns={build(r){const t=r.points;let e,i,s,n,a,o;if(r.type===Pt.CIRC){const p=r.shape;e=p.x,i=p.y,a=o=p.radius,s=n=0}else if(r.type===Pt.ELIP){const p=r.shape;e=p.x,i=p.y,a=p.width,o=p.height,s=n=0}else{const p=r.shape,m=p.width/2,g=p.height/2;e=p.x+m,i=p.y+g,a=o=Math.max(0,Math.min(p.radius,Math.min(m,g))),s=m-a,n=g-o}if(!(a>=0&&o>=0&&s>=0&&n>=0)){t.length=0;return}const h=Math.ceil(2.3*Math.sqrt(a+o)),l=h*8+(s?4:0)+(n?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=e+s,t[1]=t[3]=i+n,t[2]=t[4]=e-s,t[5]=t[7]=i-n;return}let u=0,c=h*4+(s?2:0)+2,d=c,f=l;{const p=s+a,m=n,g=e+p,y=e-p,x=i+m;if(t[u++]=g,t[u++]=x,t[--c]=x,t[--c]=y,n){const _=i-m;t[d++]=y,t[d++]=_,t[--f]=_,t[--f]=g}}for(let p=1;p<h;p++){const m=Math.PI/2*(p/h),g=s+Math.cos(m)*a,y=n+Math.sin(m)*o,x=e+g,_=e-g,v=i+y,T=i-y;t[u++]=x,t[u++]=v,t[--c]=v,t[--c]=_,t[d++]=_,t[d++]=T,t[--f]=T,t[--f]=x}{const p=s,m=n+o,g=e+p,y=e-p,x=i+m,_=i-m;t[u++]=g,t[u++]=x,t[--f]=_,t[--f]=g,s&&(t[u++]=y,t[u++]=x,t[--f]=_,t[--f]=y)}},triangulate(r,t){const e=r.points,i=t.points,s=t.indices;if(e.length===0)return;let n=i.length/2;const a=n;let o,h;if(r.type!==Pt.RREC){const u=r.shape;o=u.x,h=u.y}else{const u=r.shape;o=u.x+u.width/2,h=u.y+u.height/2}const l=r.matrix;i.push(r.matrix?l.a*o+l.c*h+l.tx:o,r.matrix?l.b*o+l.d*h+l.ty:h),n++,i.push(e[0],e[1]);for(let u=2;u<e.length;u+=2)i.push(e[u],e[u+1]),s.push(n++,a,n);s.push(a+1,a,n)}};function Uu(r,t=!1){const e=r.length;if(e<6)return;let i=0;for(let s=0,n=r[e-2],a=r[e-1];s<e;s+=2){const o=r[s],h=r[s+1];i+=(o-n)*(h+a),n=o,a=h}if(!t&&i>0||t&&i<=0){const s=e/2;for(let n=s+s%2;n<e;n+=2){const a=e-n-2,o=e-n-1,h=n,l=n+1;[r[a],r[h]]=[r[h],r[a]],[r[o],r[l]]=[r[l],r[o]]}}}const Jh={build(r){r.points=r.shape.points.slice()},triangulate(r,t){let e=r.points;const i=r.holes,s=t.points,n=t.indices;if(e.length>=6){Uu(e,!1);const a=[];for(let l=0;l<i.length;l++){const u=i[l];Uu(u.points,!0),a.push(e.length/2),e=e.concat(u.points)}const o=Nc(e,a,2);if(!o)return;const h=s.length/2;for(let l=0;l<o.length;l+=3)n.push(o[l]+h),n.push(o[l+1]+h),n.push(o[l+2]+h);for(let l=0;l<e.length;l++)s.push(e[l])}}},Kf={build(r){const t=r.shape,e=t.x,i=t.y,s=t.width,n=t.height,a=r.points;a.length=0,s>=0&&n>=0&&a.push(e,i,e+s,i,e+s,i+n,e,i+n)},triangulate(r,t){const e=r.points,i=t.points;if(e.length===0)return;const s=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},Zf={build(r){ns.build(r)},triangulate(r,t){ns.triangulate(r,t)}};var Xt=(r=>(r.MITER=\"miter\",r.BEVEL=\"bevel\",r.ROUND=\"round\",r))(Xt||{}),Ve=(r=>(r.BUTT=\"butt\",r.ROUND=\"round\",r.SQUARE=\"square\",r))(Ve||{});const hi={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,t=20){if(!this.adaptive||!r||isNaN(r))return t;let e=Math.ceil(r/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}},p0=hi;class jo{static curveTo(t,e,i,s,n,a){const o=a[a.length-2],h=a[a.length-1]-e,l=o-t,u=s-e,c=i-t,d=Math.abs(h*c-l*u);if(d<1e-8||n===0)return(a[a.length-2]!==t||a[a.length-1]!==e)&&a.push(t,e),null;const f=h*h+l*l,p=u*u+c*c,m=h*u+l*c,g=n*Math.sqrt(f)/d,y=n*Math.sqrt(p)/d,x=g*m/f,_=y*m/p,v=g*c+y*l,T=g*u+y*h,S=l*(y+x),w=h*(y+x),b=c*(g+_),R=u*(g+_),L=Math.atan2(w-T,S-v),I=Math.atan2(R-T,b-v);return{cx:v+t,cy:T+e,radius:n,startAngle:L,endAngle:I,anticlockwise:l*u>c*h}}static arc(t,e,i,s,n,a,o,h,l){const u=o-a,c=hi._segmentsCount(Math.abs(u)*n,Math.ceil(Math.abs(u)/Kr)*40),d=u/(c*2),f=d*2,p=Math.cos(d),m=Math.sin(d),g=c-1,y=g%1/g;for(let x=0;x<=g;++x){const _=x+y*x,v=d+a+f*_,T=Math.cos(v),S=-Math.sin(v);l.push((p*T+m*S)*n+i,(p*-S+m*T)*n+s)}}}class Jf{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class ea{static curveLength(t,e,i,s,n,a,o,h){let l=0,u=0,c=0,d=0,f=0,p=0,m=0,g=0,y=0,x=0,_=0,v=t,T=e;for(let S=1;S<=10;++S)u=S/10,c=u*u,d=c*u,f=1-u,p=f*f,m=p*f,g=m*t+3*p*u*i+3*f*c*n+d*o,y=m*e+3*p*u*s+3*f*c*a+d*h,x=v-g,_=T-y,v=g,T=y,l+=Math.sqrt(x*x+_*_);return l}static curveTo(t,e,i,s,n,a,o){const h=o[o.length-2],l=o[o.length-1];o.length-=2;const u=hi._segmentsCount(ea.curveLength(h,l,t,e,i,s,n,a));let c=0,d=0,f=0,p=0,m=0;o.push(h,l);for(let g=1,y=0;g<=u;++g)y=g/u,c=1-y,d=c*c,f=d*c,p=y*y,m=p*y,o.push(f*h+3*d*y*t+3*c*p*i+m*n,f*l+3*d*y*e+3*c*p*s+m*a)}}function ku(r,t,e,i,s,n,a,o){const h=r-e*s,l=t-i*s,u=r+e*n,c=t+i*n;let d,f;a?(d=i,f=-e):(d=-i,f=e);const p=h+d,m=l+f,g=u+d,y=c+f;return o.push(p,m,g,y),2}function mi(r,t,e,i,s,n,a,o){const h=e-r,l=i-t;let u=Math.atan2(h,l),c=Math.atan2(s-r,n-t);o&&u<c?u+=Math.PI*2:!o&&u>c&&(c+=Math.PI*2);let d=u;const f=c-u,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,y=f/g;if(d+=y,o){a.push(r,t,e,i);for(let x=1,_=d;x<g;x++,_+=y)a.push(r,t,r+Math.sin(_)*m,t+Math.cos(_)*m);a.push(r,t,s,n)}else{a.push(e,i,r,t);for(let x=1,_=d;x<g;x++,_+=y)a.push(r+Math.sin(_)*m,t+Math.cos(_)*m,r,t);a.push(s,n,r,t)}return g*2}function m0(r,t){const e=r.shape;let i=r.points||e.points.slice();const s=t.closePointEps;if(i.length===0)return;const n=r.lineStyle,a=new Z(i[0],i[1]),o=new Z(i[i.length-2],i[i.length-1]),h=e.type!==Pt.POLY||e.closeStroke,l=Math.abs(a.x-o.x)<s&&Math.abs(a.y-o.y)<s;if(h){i=i.slice(),l&&(i.pop(),i.pop(),o.set(i[i.length-2],i[i.length-1]));const U=(a.x+o.x)*.5,nt=(o.y+a.y)*.5;i.unshift(U,nt),i.push(U,nt)}const u=t.points,c=i.length/2;let d=i.length;const f=u.length/2,p=n.width/2,m=p*p,g=n.miterLimit*n.miterLimit;let y=i[0],x=i[1],_=i[2],v=i[3],T=0,S=0,w=-(x-v),b=y-_,R=0,L=0,I=Math.sqrt(w*w+b*b);w/=I,b/=I,w*=p,b*=p;const D=n.alignment,C=(1-D)*2,A=D*2;h||(n.cap===Ve.ROUND?d+=mi(y-w*(C-A)*.5,x-b*(C-A)*.5,y-w*C,x-b*C,y+w*A,x+b*A,u,!0)+2:n.cap===Ve.SQUARE&&(d+=ku(y,x,w,b,C,A,!0,u))),u.push(y-w*C,x-b*C,y+w*A,x+b*A);for(let U=1;U<c-1;++U){y=i[(U-1)*2],x=i[(U-1)*2+1],_=i[U*2],v=i[U*2+1],T=i[(U+1)*2],S=i[(U+1)*2+1],w=-(x-v),b=y-_,I=Math.sqrt(w*w+b*b),w/=I,b/=I,w*=p,b*=p,R=-(v-S),L=_-T,I=Math.sqrt(R*R+L*L),R/=I,L/=I,R*=p,L*=p;const nt=_-y,at=x-v,P=_-T,W=S-v,J=nt*P+at*W,rt=at*P-W*nt,st=rt<0;if(Math.abs(rt)<.001*Math.abs(J)){u.push(_-w*C,v-b*C,_+w*A,v+b*A),J>=0&&(n.join===Xt.ROUND?d+=mi(_,v,_-w*C,v-b*C,_-R*C,v-L*C,u,!1)+4:d+=2,u.push(_-R*A,v-L*A,_+R*C,v+L*C));continue}const Tt=(-w+y)*(-b+v)-(-w+_)*(-b+x),gt=(-R+T)*(-L+v)-(-R+_)*(-L+S),wt=(nt*gt-P*Tt)/rt,Dt=(W*Tt-at*gt)/rt,Gt=(wt-_)*(wt-_)+(Dt-v)*(Dt-v),It=_+(wt-_)*C,ht=v+(Dt-v)*C,_t=_-(wt-_)*A,vt=v-(Dt-v)*A,ge=Math.min(nt*nt+at*at,P*P+W*W),_e=st?C:A,gr=ge+_e*_e*m,Kp=Gt<=gr;let Es=n.join;if(Es===Xt.MITER&&Gt/m>g&&(Es=Xt.BEVEL),Kp)switch(Es){case Xt.MITER:{u.push(It,ht,_t,vt);break}case Xt.BEVEL:{st?u.push(It,ht,_+w*A,v+b*A,It,ht,_+R*A,v+L*A):u.push(_-w*C,v-b*C,_t,vt,_-R*C,v-L*C,_t,vt),d+=2;break}case Xt.ROUND:{st?(u.push(It,ht,_+w*A,v+b*A),d+=mi(_,v,_+w*A,v+b*A,_+R*A,v+L*A,u,!0)+4,u.push(It,ht,_+R*A,v+L*A)):(u.push(_-w*C,v-b*C,_t,vt),d+=mi(_,v,_-w*C,v-b*C,_-R*C,v-L*C,u,!1)+4,u.push(_-R*C,v-L*C,_t,vt));break}}else{switch(u.push(_-w*C,v-b*C,_+w*A,v+b*A),Es){case Xt.MITER:{st?u.push(_t,vt,_t,vt):u.push(It,ht,It,ht),d+=2;break}case Xt.ROUND:{st?d+=mi(_,v,_+w*A,v+b*A,_+R*A,v+L*A,u,!0)+2:d+=mi(_,v,_-w*C,v-b*C,_-R*C,v-L*C,u,!1)+2;break}}u.push(_-R*C,v-L*C,_+R*A,v+L*A),d+=2}}y=i[(c-2)*2],x=i[(c-2)*2+1],_=i[(c-1)*2],v=i[(c-1)*2+1],w=-(x-v),b=y-_,I=Math.sqrt(w*w+b*b),w/=I,b/=I,w*=p,b*=p,u.push(_-w*C,v-b*C,_+w*A,v+b*A),h||(n.cap===Ve.ROUND?d+=mi(_-w*(C-A)*.5,v-b*(C-A)*.5,_-w*C,v-b*C,_+w*A,v+b*A,u,!1)+2:n.cap===Ve.SQUARE&&(d+=ku(_,v,w,b,C,A,!1,u)));const $=t.indices,q=hi.epsilon*hi.epsilon;for(let U=f;U<d+f-2;++U)y=u[U*2],x=u[U*2+1],_=u[(U+1)*2],v=u[(U+1)*2+1],T=u[(U+2)*2],S=u[(U+2)*2+1],!(Math.abs(y*(v-S)+_*(S-x)+T*(x-v))<q)&&$.push(U,U+1,U+2)}function g0(r,t){let e=0;const i=r.shape,s=r.points||i.points,n=i.type!==Pt.POLY||i.closeStroke;if(s.length===0)return;const a=t.points,o=t.indices,h=s.length/2,l=a.length/2;let u=l;for(a.push(s[0],s[1]),e=1;e<h;e++)a.push(s[e*2],s[e*2+1]),o.push(u,u+1),u++;n&&o.push(u,l)}function Yo(r,t){r.lineStyle.native?g0(r,t):m0(r,t)}class ia{static curveLength(t,e,i,s,n,a){const o=t-2*i+n,h=e-2*s+a,l=2*i-2*t,u=2*s-2*e,c=4*(o*o+h*h),d=4*(o*l+h*u),f=l*l+u*u,p=2*Math.sqrt(c+d+f),m=Math.sqrt(c),g=2*c*m,y=2*Math.sqrt(f),x=d/m;return(g*p+m*d*(p-y)+(4*f*c-d*d)*Math.log((2*m+x+p)/(x+y)))/(4*g)}static curveTo(t,e,i,s,n){const a=n[n.length-2],o=n[n.length-1],h=hi._segmentsCount(ia.curveLength(a,o,t,e,i,s));let l=0,u=0;for(let c=1;c<=h;++c){const d=c/h;l=a+(t-a)*d,u=o+(e-o)*d,n.push(l+(t+(i-t)*d-l)*d,u+(e+(s-e)*d-u)*d)}}}const ln={[Pt.POLY]:Jh,[Pt.CIRC]:ns,[Pt.ELIP]:ns,[Pt.RECT]:Kf,[Pt.RREC]:Zf},qo=[],Dr=[];class as{constructor(t,e=null,i=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new as(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const ki=new Z,Qf=class tp extends wh{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new es,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Dr.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),qo.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,s=null){const n=new as(t,e,i,s);return this.graphicsData.push(n),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new as(t,null,null,e),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const s=e[i];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,ki):ki.copyFrom(t),s.shape.contains(ki.x,ki.y))){let n=!1;if(s.holes){for(let a=0;a<s.holes.length;a++)if(s.holes[a].shape.contains(ki.x,ki.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let h=this.shapeIndex;h<e.length;h++){this.shapeIndex++;const l=e[h],u=l.fillStyle,c=l.lineStyle;ln[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(u.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const f=d===0?u:c;if(!f.visible)continue;const p=f.texture.baseTexture,m=this.indices.length,g=this.points.length/2;p.wrapMode=Re.REPEAT,d===0?this.processFill(l):this.processLine(l);const y=this.points.length/2-g;y!==0&&(i&&!this._compareStyles(s,f)&&(i.end(m,g),i=null),i||(i=qo.pop()||new Jf,i.begin(f,m,g),this.batches.push(i),s=f),this.addUvs(this.points,t,f.texture,g,y,f.matrix))}}const n=this.indices.length,a=this.points.length/2;if(i&&i.end(n,a),this.batches.length===0){this.batchable=!0;return}const o=a>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const i=this.graphicsData[t],s=i.fillStyle,n=i.lineStyle;if(s&&!s.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,i=t.length;e<i;e++){const s=t[e];for(let n=0;n<s.size;n++){const a=s.start+n;this.indicesUint16[a]=this.indicesUint16[a]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<tp.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++j._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),Dr.push(this.drawCalls[c]);this.drawCalls.length=0;const e=this.colors,i=this.textureIds;let s=Dr.pop();s||(s=new Cn,s.texArray=new Sn),s.texArray.count=0,s.start=0,s.size=0,s.type=oe.TRIANGLES;let n=0,a=null,o=0,h=!1,l=oe.TRIANGLES,u=0;this.drawCalls.push(s);for(let c=0;c<this.batches.length;c++){const d=this.batches[c],f=8,p=d.style,m=p.texture.baseTexture;h!==!!p.native&&(h=!!p.native,l=h?oe.LINES:oe.TRIANGLES,a=null,n=f,t++),a!==m&&(a=m,m._batchEnabled!==t&&(n===f&&(t++,n=0,s.size>0&&(s=Dr.pop(),s||(s=new Cn,s.texArray=new Sn),this.drawCalls.push(s)),s.start=u,s.size=0,s.texArray.count=0,s.type=l),m.touched=1,m._batchEnabled=t,m._batchLocation=n,m.wrapMode=Re.REPEAT,s.texArray.elements[s.texArray.count++]=m,n++)),s.size+=d.size,u+=d.size,o=m._batchLocation,this.addColors(e,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,o,d.attribSize,d.attribStart)}j._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,i=this.colors,s=this.textureIds,n=new ArrayBuffer(t.length*3*4),a=new Float32Array(n),o=new Uint32Array(n);let h=0;for(let l=0;l<t.length/2;l++)a[h++]=t[l*2],a[h++]=t[l*2+1],a[h++]=e[l*2],a[h++]=e[l*2+1],o[h++]=i[l],a[h++]=s[l];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Jh.triangulate(t,this):ln[t.type].triangulate(t,this)}processLine(t){Yo(t,this);for(let e=0;e<t.holes.length;e++)Yo(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e];ln[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const s=t[i*2],n=t[i*2+1];t[i*2]=e.a*s+e.c*n+e.tx,t[i*2+1]=e.b*s+e.d*n+e.ty}}addColors(t,e,i,s,n=0){const a=tt.shared.setValue(e).toLittleEndianNumber(),o=tt.shared.setValue(a).toPremultiplied(i);t.length=Math.max(t.length,n+s);for(let h=0;h<s;h++)t[n+h]=o}addTextureIds(t,e,i,s=0){t.length=Math.max(t.length,s+i);for(let n=0;n<i;n++)t[s+n]=e}addUvs(t,e,i,s,n,a=null){let o=0;const h=e.length,l=i.frame;for(;o<n;){let c=t[(s+o)*2],d=t[(s+o)*2+1];if(a){const f=a.a*c+a.c*d+a.tx;d=a.b*c+a.d*d+a.ty,c=f}o++,e.push(c/l.width,d/l.height)}const u=i.baseTexture;(l.width<u.width||l.height<u.height)&&this.adjustUvs(e,i,h,n)}adjustUvs(t,e,i,s){const n=e.baseTexture,a=1e-6,o=i+s*2,h=e.frame,l=h.width/n.width,u=h.height/n.height;let c=h.x/h.width,d=h.y/h.height,f=Math.floor(t[i]+a),p=Math.floor(t[i+1]+a);for(let m=i+2;m<o;m+=2)f=Math.min(f,Math.floor(t[m]+a)),p=Math.min(p,Math.floor(t[m+1]+a));c-=f,d-=p;for(let m=i;m<o;m+=2)t[m]=(t[m]+c)*l,t[m+1]=(t[m+1]+d)*u}};Qf.BATCHABLE_SIZE=100;let ep=Qf;class vs{constructor(){this.color=16777215,this.alpha=1,this.texture=B.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new vs;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=B.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class ra extends vs{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Ve.BUTT,this.join=Xt.MITER,this.miterLimit=10}clone(){const t=new ra;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Ve.BUTT,this.join=Xt.MITER,this.miterLimit=10}}const Wa={},Ko=class un extends kt{constructor(t=null){super(),this.shader=null,this.pluginName=\"batch\",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new vs,this._lineStyle=new ra,this._matrix=null,this._holeMode=!1,this.state=pe.for2d(),this._geometry=t||new ep,this._geometry.refCount++,this._transformID=-1,this._tintColor=new tt(16777215),this.blendMode=H.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new un(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,s=.5,n=!1){return typeof t==\"number\"&&(t={width:t,color:e,alpha:i,alignment:s,native:n}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:B.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Ve.BUTT,join:Xt.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new si,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new si,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,s=i[i.length-2],n=i[i.length-1];return(s!==t||n!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),ia.curveTo(t,e,i,s,n),this}bezierCurveTo(t,e,i,s,n,a){return this._initCurve(),ea.curveTo(t,e,i,s,n,a,this.currentPath.points),this}arcTo(t,e,i,s,n){this._initCurve(t,e);const a=this.currentPath.points,o=jo.curveTo(t,e,i,s,n,a);if(o){const{cx:h,cy:l,radius:u,startAngle:c,endAngle:d,anticlockwise:f}=o;this.arc(h,l,u,c,d,f)}return this}arc(t,e,i,s,n,a=!1){if(s===n)return this;if(!a&&n<=s?n+=Kr:a&&s<=n&&(s+=Kr),n-s===0)return this;const o=t+Math.cos(s)*i,h=e+Math.sin(s)*i,l=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const c=Math.abs(u[u.length-2]-o),d=Math.abs(u[u.length-1]-h);c<l&&d<l||u.push(o,h)}else this.moveTo(o,h),u=this.currentPath.points;return jo.arc(o,h,t,e,i,s,n,a,u),this}beginFill(t=0,e){return this.beginTextureFill({texture:B.WHITE,color:t,alpha:e})}normalizeColor(t){const e=tt.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:B.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,s){return this.drawShape(new Y(t,e,i,s))}drawRoundedRect(t,e,i,s,n){return this.drawShape(new gs(t,e,i,s,n))}drawCircle(t,e,i){return this.drawShape(new ps(t,e,i))}drawEllipse(t,e,i,s){return this.drawShape(new ms(t,e,i,s))}drawPolygon(...t){let e,i=!0;const s=t[0];s.points?(i=s.closeStroke,e=s.points):Array.isArray(t[0])?e=t[0]:e=t;const n=new si(e);return n.closeStroke=i,this.drawShape(n),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===Pt.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let s=0;s<i;s++){const n=t.batches[s],a=n.style.color,o=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),h=new Float32Array(t.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,n.start*2,n.size),u={vertexData:o,blendMode:e,indices:l,uvs:h,_batchRGB:tt.shared.setValue(a).toRgbArray(),_tintRGB:a,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[s]=u}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}}_renderDirect(t){const e=this._resolveDirectShader(t),i=this._geometry,s=this.worldAlpha,n=e.uniforms,a=i.drawCalls;n.translationMatrix=this.transform.worldTransform,tt.shared.setValue(this._tintColor).premultiply(s).toArray(n.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let o=0,h=a.length;o<h;o++)this._renderDrawCallDirect(t,i.drawCalls[o])}_renderDrawCallDirect(t,e){const{texArray:i,type:s,size:n,start:a}=e,o=i.count;for(let h=0;h<o;h++)t.texture.bind(i.elements[h],h);t.geometry.draw(s,n,a)}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;if(!e){if(!Wa[i]){const{maxTextures:s}=t.plugins[i],n=new Int32Array(s);for(let h=0;h<s;h++)n[h]=h;const a={tint:new Float32Array([1,1,1,1]),translationMatrix:new et,default:Qt.from({uSamplers:n},!0)},o=t.plugins[i]._shader.program;Wa[i]=new de(o,a)}e=Wa[i]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:s,maxY:n}=t.bounds;this._bounds.addFrame(this.transform,e,i,s,n)}containsPoint(t){return this.worldTransform.applyInverse(t,un._TEMP_POINT),this._geometry.containsPoint(un._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=tt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,s=e.b,n=e.c,a=e.d,o=e.tx,h=e.ty,l=this._geometry.points,u=this.vertexData;let c=0;for(let d=0;d<l.length;d+=2){const f=l[d],p=l[d+1];u[c++]=i*f+n*p+o,u[c++]=a*p+s*f+h}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};Ko.curves=hi,Ko._TEMP_POINT=new Z;let Qh=Ko;const _0={buildPoly:Jh,buildCircle:ns,buildRectangle:Kf,buildRoundedRectangle:Zf,buildLine:Yo,ArcUtils:jo,BezierUtils:ea,QuadraticUtils:ia,BatchPart:Jf,FILL_COMMANDS:ln,BATCH_POOL:qo,DRAW_CALL_POOL:Dr};class ip{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const ja=new Z,Gu=new si,rp=class sp extends kt{constructor(t,e,i,s=oe.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||pe.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=N.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return\"tint\"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return\"texture\"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===oe.TRIANGLES&&e.length<sp.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const s=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[s]),t.plugins[s].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const s=this.transform.worldTransform,n=s.a,a=s.b,o=s.c,h=s.d,l=s.tx,u=s.ty,c=this.vertexData;for(let d=0;d<c.length/2;d++){const f=e[d*2],p=e[d*2+1];c[d*2]=n*f+o*p+l,c[d*2+1]=a*f+h*p+u}if(this._roundPixels){const d=N.RESOLUTION;for(let f=0;f<c.length;++f)c[f]=Math.round(c[f]*d)/d}this.vertexDirty=i}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new ip(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,ja);const e=this.geometry.getBuffer(\"aVertexPosition\").data,i=Gu.points,s=this.geometry.getIndex().data,n=s.length,a=this.drawMode===4?3:1;for(let o=0;o+2<n;o+=a){const h=s[o]*2,l=s[o+1]*2,u=s[o+2]*2;if(i[0]=e[h],i[1]=e[h+1],i[2]=e[l],i[3]=e[l+1],i[4]=e[u],i[5]=e[u+1],Gu.contains(ja.x,ja.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};rp.BATCHABLE_SIZE=100;let lr=rp;class xs extends ze{constructor(t,e,i){super();const s=new pt(t),n=new pt(e,!0),a=new pt(i,!0,!0);this.addAttribute(\"aVertexPosition\",s,2,!1,V.FLOAT).addAttribute(\"aTextureCoord\",n,2,!1,V.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var y0=`varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n`,v0=`attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n`;class ur extends de{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:et.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:\"batch\"},e),e.uniforms&&Object.assign(i,e.uniforms),super(e.program||Ie.from(v0,y0),i),this._colorDirty=!1,this.uvMatrix=new Qn(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new tt(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;tt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class np extends xs{constructor(t=100,e=100,i=10,s=10){super(),this.segWidth=i,this.segHeight=s,this.width=t,this.height=e,this.build()}build(){const t=this.segWidth*this.segHeight,e=[],i=[],s=[],n=this.segWidth-1,a=this.segHeight-1,o=this.width/n,h=this.height/a;for(let u=0;u<t;u++){const c=u%this.segWidth,d=u/this.segWidth|0;e.push(c*o,d*h),i.push(c/n,d/a)}const l=n*a;for(let u=0;u<l;u++){const c=u%n,d=u/n|0,f=d*this.segWidth+c,p=d*this.segWidth+c+1,m=(d+1)*this.segWidth+c,g=(d+1)*this.segWidth+c+1;s.push(f,p,m,p,g,m)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint16Array(s),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class ap extends xs{constructor(t=200,e,i=0){super(new Float32Array(e.length*4),new Float32Array(e.length*4),new Uint16Array((e.length-1)*6)),this.points=e,this._width=t,this.textureScale=i,this.build()}get width(){return this._width}build(){const t=this.points;if(!t)return;const e=this.getBuffer(\"aVertexPosition\"),i=this.getBuffer(\"aTextureCoord\"),s=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(t.length*4),i.data=new Float32Array(t.length*4),s.data=new Uint16Array((t.length-1)*6));const n=i.data,a=s.data;n[0]=0,n[1]=0,n[2]=0,n[3]=1;let o=0,h=t[0];const l=this._width*this.textureScale,u=t.length;for(let d=0;d<u;d++){const f=d*4;if(this.textureScale>0){const p=h.x-t[d].x,m=h.y-t[d].y,g=Math.sqrt(p*p+m*m);h=t[d],o+=g/l}else o=d/(u-1);n[f]=o,n[f+1]=0,n[f+2]=o,n[f+3]=1}let c=0;for(let d=0;d<u-1;d++){const f=d*2;a[c++]=f,a[c++]=f+1,a[c++]=f+2,a[c++]=f+2,a[c++]=f+1,a[c++]=f+3}i.update(),s.update(),this.updateVertices()}updateVertices(){const t=this.points;if(t.length<1)return;let e=t[0],i,s=0,n=0;const a=this.buffers[0].data,o=t.length,h=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let l=0;l<o;l++){const u=t[l],c=l*4;l<t.length-1?i=t[l+1]:i=u,n=-(i.x-e.x),s=i.y-e.y;const d=Math.sqrt(s*s+n*n);d<1e-6?(s=0,n=0):(s/=d,n/=d,s*=h,n*=h),a[c]=u.x+s,a[c+1]=u.y+n,a[c+2]=u.x-s,a[c+3]=u.y-n,e=u}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class op extends lr{constructor(t,e,i){const s=new np(t.width,t.height,e,i),n=new ur(B.WHITE);super(s,n),this.texture=t,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const t=this.geometry,{width:e,height:i}=this.shader.texture;this.autoResize&&(t.width!==e||t.height!==i)&&(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())}set texture(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once(\"update\",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(t)}destroy(t){this.shader.texture.off(\"update\",this.textureUpdated,this),super.destroy(t)}}const zs=10;class x0 extends op{constructor(t,e,i,s,n){super(B.WHITE,4,4),this._origWidth=t.orig.width,this._origHeight=t.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=e??t.defaultBorders?.left??zs,this._rightWidth=s??t.defaultBorders?.right??zs,this._topHeight=i??t.defaultBorders?.top??zs,this._bottomHeight=n??t.defaultBorders?.bottom??zs,this.texture=t}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer(\"aVertexPosition\").data}set vertices(t){this.geometry.getBuffer(\"aVertexPosition\").data=t}updateHorizontalVertices(){const t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){const t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width}_getMinScale(){const t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,i=this._topHeight+this._bottomHeight,s=this._height>i?1:this._height/i;return Math.min(e,s)}get width(){return this._width}set width(t){this._width=t,this._refresh()}get height(){return this._height}set height(t){this._height=t,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this._refresh()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this._refresh()}_refresh(){const t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;const i=1/this._origWidth,s=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=i*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-i*this._rightWidth,e[9]=e[11]=e[13]=e[15]=s*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-s*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class b0 extends lr{constructor(t=B.EMPTY,e,i,s,n){const a=new xs(e,i,s);a.getBuffer(\"aVertexPosition\").static=!1;const o=new ur(t);super(a,o,null,n),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer(\"aVertexPosition\").data}set vertices(t){this.geometry.getBuffer(\"aVertexPosition\").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer(\"aVertexPosition\").update(),super._render(t)}}class T0 extends lr{constructor(t,e,i=0){const s=new ap(t.height,e,i),n=new ur(t);i>0&&(t.baseTexture.wrapMode=Re.REPEAT),super(s,n),this.autoUpdate=!0}_render(t){const e=this.geometry;(this.autoUpdate||e._width!==this.shader.texture.height)&&(e._width=this.shader.texture.height,e.update()),super._render(t)}}class w0 extends kt{constructor(t=1500,e,i=16384,s=!1){super();const n=16384;i>n&&(i=n),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=i,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=H.NORMAL,this.autoResize=s,this.roundPixels=!0,this.baseTexture=null,this.setProperties(e),this._tintColor=new tt(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(t){t&&(this._properties[0]=\"vertices\"in t||\"scale\"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]=\"position\"in t?!!t.position:this._properties[1],this._properties[2]=\"rotation\"in t?!!t.rotation:this._properties[2],this._properties[3]=\"uvs\"in t?!!t.uvs:this._properties[3],this._properties[4]=\"tint\"in t||\"alpha\"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintColor.toRgbArray(this.tintRgb)}render(t){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once(\"update\",()=>this.onChildrenChange(0))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){const e=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}class Vu{constructor(t,e,i){this.geometry=new ze,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<t.length;++s){let n=t[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||V.FLOAT,offset:n.offset},e[s]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new pt(vd(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];o.offset=e,e+=o.size,this.dynamicStride+=o.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new pt(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];o.offset=s,s+=o.size,this.staticStride+=o.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new pt(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];t.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===V.UNSIGNED_BYTE,o.type,this.dynamicStride*4,o.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];t.addAttribute(o.attributeName,this.staticBuffer,0,o.type===V.UNSIGNED_BYTE,o.type,this.staticStride*4,o.offset*4)}}uploadDynamic(t,e,i){for(let s=0;s<this.dynamicProperties.length;s++){const n=this.dynamicProperties[s];n.uploadFunction(t,e,i,n.type===V.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let s=0;s<this.staticProperties.length;s++){const n=this.staticProperties[s];n.uploadFunction(t,e,i,n.type===V.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var E0=`varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}`,C0=`attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n`;class tl extends _s{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new et,this.properties=[{attributeName:\"aVertexPosition\",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:\"aPositionCoord\",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:\"aRotation\",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:\"aTextureCoord\",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:\"aColor\",size:1,type:V.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=de.from(C0,E0,{}),this.state=pe.for2d()}render(t){const e=t.children,i=t._maxSize,s=t._batchSize,n=this.renderer;let a=e.length;if(a===0)return;a>i&&!t.autoResize&&(a=i);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const h=e[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=bh(t.blendMode,l),n.state.set(this.state);const u=n.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=tt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<a;f+=s,p+=1){let m=a-f;m>s&&(m=s),p>=o.length&&o.push(this._generateOneMoreBuffer(t));const g=o[p];g.uploadDynamic(e,f,m);const y=t._bufferUpdateIDs[p]||0;d=d||g._updateID<y,d&&(g._updateID=t._updateID,g.uploadStatic(e,f,m)),n.geometry.bind(g.geometry),u.drawElements(u.TRIANGLES,m*6,u.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,s=t._batchSize,n=t._properties;for(let a=0;a<i;a+=s)e.push(new Vu(this.properties,n,s));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new Vu(this.properties,i,e)}uploadVertices(t,e,i,s,n,a){let o=0,h=0,l=0,u=0;for(let c=0;c<i;++c){const d=t[e+c],f=d._texture,p=d.scale.x,m=d.scale.y,g=f.trim,y=f.orig;g?(h=g.x-d.anchor.x*y.width,o=h+g.width,u=g.y-d.anchor.y*y.height,l=u+g.height):(o=y.width*(1-d.anchor.x),h=y.width*-d.anchor.x,l=y.height*(1-d.anchor.y),u=y.height*-d.anchor.y),s[a]=h*p,s[a+1]=u*m,s[a+n]=o*p,s[a+n+1]=u*m,s[a+n*2]=o*p,s[a+n*2+1]=l*m,s[a+n*3]=h*p,s[a+n*3+1]=l*m,a+=n*4}}uploadPosition(t,e,i,s,n,a){for(let o=0;o<i;o++){const h=t[e+o].position;s[a]=h.x,s[a+1]=h.y,s[a+n]=h.x,s[a+n+1]=h.y,s[a+n*2]=h.x,s[a+n*2+1]=h.y,s[a+n*3]=h.x,s[a+n*3+1]=h.y,a+=n*4}}uploadRotation(t,e,i,s,n,a){for(let o=0;o<i;o++){const h=t[e+o].rotation;s[a]=h,s[a+n]=h,s[a+n*2]=h,s[a+n*3]=h,a+=n*4}}uploadUvs(t,e,i,s,n,a){for(let o=0;o<i;++o){const h=t[e+o]._texture._uvs;h?(s[a]=h.x0,s[a+1]=h.y0,s[a+n]=h.x1,s[a+n+1]=h.y1,s[a+n*2]=h.x2,s[a+n*2+1]=h.y2,s[a+n*3]=h.x3,s[a+n*3+1]=h.y3,a+=n*4):(s[a]=0,s[a+1]=0,s[a+n]=0,s[a+n+1]=0,s[a+n*2]=0,s[a+n*2+1]=0,s[a+n*3]=0,s[a+n*3+1]=0,a+=n*4)}}uploadTint(t,e,i,s,n,a){for(let o=0;o<i;++o){const h=t[e+o],l=tt.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);s[a]=l,s[a+n]=l,s[a+n*2]=l,s[a+n*3]=l,a+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}tl.extension={name:\"particle\",type:F.RendererPlugin};k.add(tl);var bs=(r=>(r[r.LINEAR_VERTICAL=0]=\"LINEAR_VERTICAL\",r[r.LINEAR_HORIZONTAL=1]=\"LINEAR_HORIZONTAL\",r))(bs||{});const Ws={willReadFrequently:!0},Te=class G{static get experimentalLetterSpacingSupported(){let t=G._experimentalLetterSpacingSupported;if(t!==void 0){const e=N.ADAPTER.getCanvasRenderingContext2D().prototype;t=G._experimentalLetterSpacingSupported=\"letterSpacing\"in e||\"textLetterSpacing\"in e}return t}constructor(t,e,i,s,n,a,o,h,l){this.text=t,this.style=e,this.width=i,this.height=s,this.lines=n,this.lineWidths=a,this.lineHeight=o,this.maxLineWidth=h,this.fontProperties=l}static measureText(t,e,i,s=G._canvas){i=i??e.wordWrap;const n=e.toFontString(),a=G.measureFont(n);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const o=s.getContext(\"2d\",Ws);o.font=n;const h=(i?G.wordWrap(t,e,s):t).split(/(?:\\r\\n|\\r|\\n)/),l=new Array(h.length);let u=0;for(let p=0;p<h.length;p++){const m=G._measureText(h[p],e.letterSpacing,o);l[p]=m,u=Math.max(u,m)}let c=u+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const d=e.lineHeight||a.fontSize+e.strokeThickness;let f=Math.max(d,a.fontSize+e.strokeThickness*2)+e.leading+(h.length-1)*(d+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new G(t,e,c,f,h,l,d+e.leading,u,a)}static _measureText(t,e,i){let s=!1;G.experimentalLetterSpacingSupported&&(G.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,s=!0):(i.letterSpacing=\"0px\",i.textLetterSpacing=\"0px\"));let n=i.measureText(t).width;return n>0&&(s?n-=e:n+=(G.graphemeSegmenter(t).length-1)*e),n}static wordWrap(t,e,i=G._canvas){const s=i.getContext(\"2d\",Ws);let n=0,a=\"\",o=\"\";const h=Object.create(null),{letterSpacing:l,whiteSpace:u}=e,c=G.collapseSpaces(u),d=G.collapseNewlines(u);let f=!c;const p=e.wordWrapWidth+l,m=G.tokenize(t);for(let g=0;g<m.length;g++){let y=m[g];if(G.isNewline(y)){if(!d){o+=G.addLine(a),f=!c,a=\"\",n=0;continue}y=\" \"}if(c){const _=G.isBreakingSpace(y),v=G.isBreakingSpace(a[a.length-1]);if(_&&v)continue}const x=G.getFromCache(y,l,h,s);if(x>p)if(a!==\"\"&&(o+=G.addLine(a),a=\"\",n=0),G.canBreakWords(y,e.breakWords)){const _=G.wordWrapSplit(y);for(let v=0;v<_.length;v++){let T=_[v],S=T,w=1;for(;_[v+w];){const R=_[v+w];if(!G.canBreakChars(S,R,y,v,e.breakWords))T+=R;else break;S=R,w++}v+=w-1;const b=G.getFromCache(T,l,h,s);b+n>p&&(o+=G.addLine(a),f=!1,a=\"\",n=0),a+=T,n+=b}}else{a.length>0&&(o+=G.addLine(a),a=\"\",n=0);const _=g===m.length-1;o+=G.addLine(y,!_),f=!1,a=\"\",n=0}else x+n>p&&(f=!1,o+=G.addLine(a),a=\"\",n=0),(a.length>0||!G.isBreakingSpace(y)||f)&&(a+=y,n+=x)}return o+=G.addLine(a,!1),o}static addLine(t,e=!0){return t=G.trimRight(t),t=e?`${t}\n`:t,t}static getFromCache(t,e,i,s){let n=i[t];return typeof n!=\"number\"&&(n=G._measureText(t,e,s)+e,i[t]=n),n}static collapseSpaces(t){return t===\"normal\"||t===\"pre-line\"}static collapseNewlines(t){return t===\"normal\"}static trimRight(t){if(typeof t!=\"string\")return\"\";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!G.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!=\"string\"?!1:G._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!=\"string\"?!1:G._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let i=\"\";if(typeof t!=\"string\")return e;for(let s=0;s<t.length;s++){const n=t[s],a=t[s+1];if(G.isBreakingSpace(n,a)||G.isNewline(n)){i!==\"\"&&(e.push(i),i=\"\"),e.push(n);continue}i+=n}return i!==\"\"&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,s,n){return!0}static wordWrapSplit(t){return G.graphemeSegmenter(t)}static measureFont(t){if(G._fonts[t])return G._fonts[t];const e={ascent:0,descent:0,fontSize:0},i=G._canvas,s=G._context;s.font=t;const n=G.METRICS_STRING+G.BASELINE_SYMBOL,a=Math.ceil(s.measureText(n).width);let o=Math.ceil(s.measureText(G.BASELINE_SYMBOL).width);const h=Math.ceil(G.HEIGHT_MULTIPLIER*o);if(o=o*G.BASELINE_MULTIPLIER|0,a===0||h===0)return G._fonts[t]=e,e;i.width=a,i.height=h,s.fillStyle=\"#f00\",s.fillRect(0,0,a,h),s.font=t,s.textBaseline=\"alphabetic\",s.fillStyle=\"#000\",s.fillText(n,0,o);const l=s.getImageData(0,0,a,h).data,u=l.length,c=a*4;let d=0,f=0,p=!1;for(d=0;d<o;++d){for(let m=0;m<c;m+=4)if(l[f+m]!==255){p=!0;break}if(!p)f+=c;else break}for(e.ascent=o-d,f=u-c,p=!1,d=h;d>o;--d){for(let m=0;m<c;m+=4)if(l[f+m]!==255){p=!0;break}if(!p)f-=c;else break}return e.descent=d-o,e.fontSize=e.ascent+e.descent,G._fonts[t]=e,e}static clearMetrics(t=\"\"){t?delete G._fonts[t]:G._fonts={}}static get _canvas(){if(!G.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext(\"2d\",Ws)?.measureText)return G.__canvas=e,e;t=N.ADAPTER.createCanvas()}catch{t=N.ADAPTER.createCanvas()}t.width=t.height=10,G.__canvas=t}return G.__canvas}static get _context(){return G.__context||(G.__context=G._canvas.getContext(\"2d\",Ws)),G.__context}};Te.METRICS_STRING=\"|q\",Te.BASELINE_SYMBOL=\"M\",Te.BASELINE_MULTIPLIER=1.4,Te.HEIGHT_MULTIPLIER=2,Te.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter==\"function\"){const r=new Intl.Segmenter;return t=>[...r.segment(t)].map(e=>e.segment)}return r=>[...r]})(),Te.experimentalLetterSpacing=!1,Te._fonts={},Te._newlines=[10,13],Te._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Ue=Te;const S0=[\"serif\",\"sans-serif\",\"monospace\",\"cursive\",\"fantasy\",\"system-ui\"],hp=class Fr{constructor(t){this.styleID=0,this.reset(),qa(this,t,t)}clone(){const t={};return qa(t,this,Fr.defaultStyle),new Fr(t)}reset(){qa(this,Fr.defaultStyle,Fr.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Ya(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Ya(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){A0(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Ya(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize==\"number\"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(\",\"));for(let i=e.length-1;i>=0;i--){let s=e[i].trim();!/([\\\"\\'])[^\\'\\\"]+\\1/.test(s)&&!S0.includes(s)&&(s=`\"${s}\"`),e[i]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(\",\")}`}};hp.defaultStyle={align:\"left\",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:\"black\",dropShadowDistance:5,fill:\"black\",fillGradientType:bs.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:\"Arial\",fontSize:26,fontStyle:\"normal\",fontVariant:\"normal\",fontWeight:\"normal\",leading:0,letterSpacing:0,lineHeight:0,lineJoin:\"miter\",miterLimit:10,padding:0,stroke:\"black\",strokeThickness:0,textBaseline:\"alphabetic\",trim:!1,whiteSpace:\"pre\",wordWrap:!1,wordWrapWidth:100};let je=hp;function Ya(r){const t=tt.shared,e=i=>{const s=t.setValue(i);return s.alpha===1?s.toHex():s.toRgbaString()};return Array.isArray(r)?r.map(e):e(r)}function A0(r,t){if(!Array.isArray(r)||!Array.isArray(t)||r.length!==t.length)return!1;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0}function qa(r,t,e){for(const i in e)Array.isArray(t[i])?r[i]=t[i].slice():r[i]=t[i]}const P0={texture:!0,children:!1,baseTexture:!0},lp=class Zo extends qe{constructor(t,e,i){let s=!1;i||(i=N.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;const n=B.from(i);n.orig=new Y,n.trim=new Y,super(n),this._ownCanvas=s,this.canvas=i,this.context=i.getContext(\"2d\",{willReadFrequently:!0}),this._resolution=Zo.defaultResolution??N.RESOLUTION,this._autoResolution=Zo.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font=\"\",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ue.experimentalLetterSpacing}static set experimentalLetterSpacing(t){z(\"7.1.0\",\"Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing\"),Ue.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const i=this.context,s=Ue.measureText(this._text||\" \",this._style,this._style.wordWrap,this.canvas),n=s.width,a=s.height,o=s.lines,h=s.lineHeight,l=s.lineWidths,u=s.maxLineWidth,c=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,a)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;let d,f;const p=e.dropShadow?2:1;for(let m=0;m<p;++m){const g=e.dropShadow&&m===0,y=g?Math.ceil(Math.max(1,a)+e.padding*2):0,x=y*this._resolution;if(g){i.fillStyle=\"black\",i.strokeStyle=\"black\";const v=e.dropShadowColor,T=e.dropShadowBlur*this._resolution,S=e.dropShadowDistance*this._resolution;i.shadowColor=tt.shared.setValue(v).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=T,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*S,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*S+x}else i.fillStyle=this._generateFillStyle(e,o,s),i.strokeStyle=e.stroke,i.shadowColor=\"black\",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let _=(h-c.fontSize)/2;h-c.fontSize<0&&(_=0);for(let v=0;v<o.length;v++)d=e.strokeThickness/2,f=e.strokeThickness/2+v*h+c.ascent+_,e.align===\"right\"?d+=u-l[v]:e.align===\"center\"&&(d+=(u-l[v])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[v],d+e.padding,f+e.padding-y,!0),e.fill&&this.drawLetterSpacing(o[v],d+e.padding,f+e.padding-y)}this.updateTexture()}drawLetterSpacing(t,e,i,s=!1){const n=this._style.letterSpacing;let a=!1;if(Ue.experimentalLetterSpacingSupported&&(Ue.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,a=!0):(this.context.letterSpacing=\"0px\",this.context.textLetterSpacing=\"0px\")),n===0||a){s?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return}let o=e;const h=Ue.graphemeSegmenter(t);let l=this.context.measureText(t).width,u=0;for(let c=0;c<h.length;++c){const d=h[c];s?this.context.strokeText(d,o,i):this.context.fillText(d,o,i);let f=\"\";for(let p=c+1;p<h.length;++p)f+=h[p];u=this.context.measureText(f).width,o+=l-u+n,l=u}}updateTexture(){const t=this.canvas;if(this._style.trim){const a=Td(t);a.data&&(t.width=a.width,t.height=a.height,this.context.putImageData(a.data,0,0))}const e=this._texture,i=this._style,s=i.trim?0:i.padding,n=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),n.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){const s=t.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let n;const a=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,h=this.canvas.width/this._resolution-a-o*2,l=this.canvas.height/this._resolution-a-o*2,u=s.slice(),c=t.fillGradientStops.slice();if(!c.length){const d=u.length+1;for(let f=1;f<d;++f)c.push(f/d)}if(u.unshift(s[0]),c.unshift(0),u.push(s[s.length-1]),c.push(1),t.fillGradientType===bs.LINEAR_VERTICAL){n=this.context.createLinearGradient(h/2,o,h/2,l+o);const d=i.fontProperties.fontSize+t.strokeThickness;for(let f=0;f<e.length;f++){const p=i.lineHeight*(f-1)+d,m=i.lineHeight*f;let g=m;f>0&&p>m&&(g=(m+p)/2);const y=m+d,x=i.lineHeight*(f+1);let _=y;f+1<e.length&&x<y&&(_=(y+x)/2);const v=(_-g)/l;for(let T=0;T<u.length;T++){let S=0;typeof c[T]==\"number\"?S=c[T]:S=T/u.length;let w=Math.min(1,Math.max(0,g/l+S*v));w=Number(w.toFixed(5)),n.addColorStop(w,u[T])}}}else{n=this.context.createLinearGradient(o,l/2,h+o,l/2);const d=u.length+1;let f=1;for(let p=0;p<u.length;p++){let m;typeof c[p]==\"number\"?m=c[p]:m=f/d,n.addColorStop(m,u[p]),f++}}return n}destroy(t){typeof t==\"boolean\"&&(t={children:t}),t=Object.assign({},P0,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Ge(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Ge(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof je?this._style=t:this._style=new je(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??\"\"),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};lp.defaultAutoResolution=!0;let el=lp;class up{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function M0(r,t){let e=!1;if(r?._textures?.length){for(let i=0;i<r._textures.length;i++)if(r._textures[i]instanceof B){const s=r._textures[i].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function I0(r,t){if(r.baseTexture instanceof j){const e=r.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function R0(r,t){if(r._texture&&r._texture instanceof B){const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function D0(r,t){return t instanceof el?(t.updateText(!0),!0):!1}function F0(r,t){if(t instanceof je){const e=t.toFontString();return Ue.measureFont(e),!0}return!1}function B0(r,t){if(r instanceof el){t.includes(r.style)||t.push(r.style),t.includes(r)||t.push(r);const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function L0(r,t){return r instanceof je?(t.includes(r)||t.push(r),!0):!1}const cp=class dp{constructor(t){this.limiter=new up(dp.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(B0),this.registerFindHook(L0),this.registerFindHook(M0),this.registerFindHook(I0),this.registerFindHook(R0),this.registerUploadHook(D0),this.registerUploadHook(F0)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Mt.system.addOnce(this.tick,this,We.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)Mt.system.addOnce(this.tick,this,We.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof kt)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Mt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};cp.uploadsPerFrame=4;let Fn=cp;Object.defineProperties(N,{UPLOADS_PER_FRAME:{get(){return Fn.uploadsPerFrame},set(r){z(\"7.1.0\",\"settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame\"),Fn.uploadsPerFrame=r}}});function fp(r,t){return t instanceof j?(t._glTextures[r.CONTEXT_UID]||r.texture.bind(t),!0):!1}function O0(r,t){if(!(t instanceof Qh))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:i}=e;for(let s=0;s<i.length;s++){const{texture:n}=i[s].style;n&&fp(r,n.baseTexture)}return e.batchable||r.geometry.bind(e,t._resolveDirectShader(r)),!0}function N0(r,t){return r instanceof Qh?(t.push(r),!0):!1}class il extends Fn{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(N0),this.registerUploadHook(fp),this.registerUploadHook(O0)}}il.extension={name:\"prepare\",type:F.RendererSystem};k.add(il);class U0{constructor(t){this.maxMilliseconds=t,this.frameStart=0}beginFrame(){this.frameStart=Date.now()}allowedToUpload(){return Date.now()-this.frameStart<this.maxMilliseconds}}class Bn extends qe{constructor(t,e=!0){super(t[0]instanceof B?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Mt.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Mt.shared.add(this.update,this,We.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=this.animationSpeed*t,i=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=e/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let i=0;i<t.length;++i)e.push(B.from(t[i]));return new Bn(e)}static fromImages(t){const e=[];for(let i=0;i<t.length;++i)e.push(B.from(t[i]));return new Bn(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof B)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Mt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Mt.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const Tr=new Z;class rl extends qe{constructor(t,e=100,i=100){super(t),this.tileTransform=new dr,this._width=e,this._height=i,this.uvMatrix=this.texture.uvMatrix||new Qn(t),this.pluginName=\"tilingSprite\",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(t){this.tileTransform.scale.copyFrom(t)}get tilePosition(){return this.tileTransform.position}set tilePosition(t){this.tileTransform.position.copyFrom(t)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(t){const e=this._texture;!e||!e.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}_calculateBounds(){const t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,i=this._width*(1-this._anchor._x),s=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,i,s)}getLocalBounds(t){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Y),t=this._localBoundsRect),this._bounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Tr);const e=this._width,i=this._height,s=-e*this.anchor._x;if(Tr.x>=s&&Tr.x<s+e){const n=-i*this.anchor._y;if(Tr.y>=n&&Tr.y<n+i)return!0}return!1}destroy(t){super.destroy(t),this.tileTransform=null,this.uvMatrix=null}static from(t,e){const i=t instanceof B?t:B.from(t,e);return new rl(i,e.width,e.height)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}}var k0=`#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n`,G0=`#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n`,V0=`#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n`,Hu=`#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n`,H0=`#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n`;const js=new et;class sl extends _s{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Ph,this.state=pe.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=de.from(Hu,H0,e),this.shader=t.context.webGLVersion>1?de.from(G0,k0,e):de.from(Hu,V0,e)}render(t){const e=this.renderer,i=this.quad;let s=i.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,a=t.uvRespectAnchor?t.anchor.y:0;s=i.uvs,s[0]=s[6]=-n,s[1]=s[3]=-a,s[2]=s[4]=1-n,s[5]=s[7]=1-a,i.invalidate();const o=t._texture,h=o.baseTexture,l=h.alphaMode>0,u=t.tileTransform.localTransform,c=t.uvMatrix;let d=h.isPowerOfTwo&&o.frame.width===h.width&&o.frame.height===h.height;d&&(h._glTextures[e.CONTEXT_UID]?d=h.wrapMode!==Re.CLAMP:h.wrapMode===Re.CLAMP&&(h.wrapMode=Re.REPEAT));const f=d?this.simpleShader:this.shader,p=o.width,m=o.height,g=t._width,y=t._height;js.set(u.a*p/g,u.b*p/y,u.c*m/g,u.d*m/y,u.tx/g,u.ty/y),js.invert(),d?js.prepend(c.mapCoord):(f.uniforms.uMapCoord=c.mapCoord.toArray(!0),f.uniforms.uClampFrame=c.uClampFrame,f.uniforms.uClampOffset=c.uClampOffset),f.uniforms.uTransform=js.toArray(!0),f.uniforms.uColor=tt.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=o,e.shader.bind(f),e.geometry.bind(i),this.state.blendMode=bh(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}sl.extension={name:\"tilingSprite\",type:F.RendererPlugin};k.add(sl);const pp=class Br{constructor(t,e,i){this.linkedSheets=[],(t instanceof j||t instanceof B)&&(t={texture:t,data:e,resolutionFilename:i});const{texture:s,data:n,resolutionFilename:a=null,cachePrefix:o=\"\"}=t;this.cachePrefix=o,this._texture=s instanceof B?s:null,this.baseTexture=s instanceof j?s:this._texture.baseTexture,this.textures={},this.animations={},this.data=n;const h=this.baseTexture.resource;this.resolution=this._updateResolution(a||(h?h.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let i=De(t,null);return i===null&&(i=typeof e==\"number\"?e:parseFloat(e??\"1\")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Br.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const i=Br.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const s=this._frameKeys[e],n=this._frames[s],a=n.frame;if(a){let o=null,h=null;const l=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,u=new Y(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);n.rotated?o=new Y(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):o=new Y(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(h=new Y(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[s]=new B(this.baseTexture,o,u,h,n.rotated?2:0,n.anchor,n.borders),B.addToCache(this.textures[s],this.cachePrefix+s.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const s=t[e][i];this.animations[e].push(this.textures[s])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Br.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Br.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};pp.BATCH_SIZE=1e3;let Jo=pp;const X0=[\"jpg\",\"png\",\"jpeg\",\"avif\",\"webp\",\"s3tc\",\"s3tc_sRGB\",\"etc\",\"etc1\",\"pvrtc\",\"atc\",\"astc\",\"bptc\"];function mp(r,t,e){const i={};if(r.forEach(s=>{i[s]=t}),Object.keys(t.textures).forEach(s=>{i[`${t.cachePrefix}${s}`]=t.textures[s]}),!e){const s=bt.dirname(r[0]);t.linkedSheets.forEach((n,a)=>{Object.assign(i,mp([`${s}/${t.data.meta.related_multi_packs[a]}`],n,!0))})}return i}const gp={extension:F.Asset,cache:{test:r=>r instanceof Jo,getCacheableAssets:(r,t)=>mp(r,t,!1)},resolver:{test:r=>{const t=r.split(\"?\")[0].split(\".\"),e=t.pop(),i=t.pop();return e===\"json\"&&X0.includes(i)},parse:r=>{const t=r.split(\".\");return{resolution:parseFloat(N.RETINA_PREFIX.exec(r)?.[1]??\"1\"),format:t[t.length-2],src:r}}},loader:{name:\"spritesheetLoader\",extension:{type:F.LoadParser,priority:ee.Normal},async testParse(r,t){return bt.extname(t.src).toLowerCase()===\".json\"&&!!r.frames},async parse(r,t,e){const{texture:i,imageFilename:s,cachePrefix:n}=t?.data??{};let a=bt.dirname(t.src);a&&a.lastIndexOf(\"/\")!==a.length-1&&(a+=\"/\");let o;if(i&&i.baseTexture)o=i;else{const u=Dn(a+(s??r.meta.image),t.src);o=(await e.load([u]))[u]}const h=new Jo({texture:o.baseTexture,data:r,resolutionFilename:t.src,cachePrefix:n});await h.parse();const l=r?.meta?.related_multi_packs;if(Array.isArray(l)){const u=[];for(const d of l){if(typeof d!=\"string\")continue;let f=a+d;t.data?.ignoreMultiPack||(f=Dn(f,t.src),u.push(e.load({src:f,data:{ignoreMultiPack:!0}})))}const c=await Promise.all(u);h.linkedSheets=c,c.forEach(d=>{d.linkedSheets=[h].concat(h.linkedSheets.filter(f=>f!==d))})}return h},unload(r){r.destroy(!0)}}};k.add(gp);class os{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Hr{static test(t){return typeof t==\"string\"&&t.startsWith(\"info face=\")}static parse(t){const e=t.match(/^[a-z]+\\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in e){const a=e[n].match(/^[a-z]+/gm)[0],o=e[n].match(/[a-zA-Z]+=([^\\s\"']+|\"([^\"]*)\")/gm),h={};for(const l in o){const u=o[l].split(\"=\"),c=u[0],d=u[1].replace(/\"/gm,\"\"),f=parseFloat(d),p=isNaN(f)?d:f;h[c]=p}i[a].push(h)}const s=new os;return i.info.forEach(n=>s.info.push({face:n.face,size:parseInt(n.size,10)})),i.common.forEach(n=>s.common.push({lineHeight:parseInt(n.lineHeight,10)})),i.page.forEach(n=>s.page.push({id:parseInt(n.id,10),file:n.file})),i.char.forEach(n=>s.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),i.kerning.forEach(n=>s.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),i.distanceField.forEach(n=>s.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),s}}class Ln{static test(t){const e=t;return typeof t!=\"string\"&&\"getElementsByTagName\"in t&&e.getElementsByTagName(\"page\").length&&e.getElementsByTagName(\"info\")[0].getAttribute(\"face\")!==null}static parse(t){const e=new os,i=t.getElementsByTagName(\"info\"),s=t.getElementsByTagName(\"common\"),n=t.getElementsByTagName(\"page\"),a=t.getElementsByTagName(\"char\"),o=t.getElementsByTagName(\"kerning\"),h=t.getElementsByTagName(\"distanceField\");for(let l=0;l<i.length;l++)e.info.push({face:i[l].getAttribute(\"face\"),size:parseInt(i[l].getAttribute(\"size\"),10)});for(let l=0;l<s.length;l++)e.common.push({lineHeight:parseInt(s[l].getAttribute(\"lineHeight\"),10)});for(let l=0;l<n.length;l++)e.page.push({id:parseInt(n[l].getAttribute(\"id\"),10)||0,file:n[l].getAttribute(\"file\")});for(let l=0;l<a.length;l++){const u=a[l];e.char.push({id:parseInt(u.getAttribute(\"id\"),10),page:parseInt(u.getAttribute(\"page\"),10)||0,x:parseInt(u.getAttribute(\"x\"),10),y:parseInt(u.getAttribute(\"y\"),10),width:parseInt(u.getAttribute(\"width\"),10),height:parseInt(u.getAttribute(\"height\"),10),xoffset:parseInt(u.getAttribute(\"xoffset\"),10),yoffset:parseInt(u.getAttribute(\"yoffset\"),10),xadvance:parseInt(u.getAttribute(\"xadvance\"),10)})}for(let l=0;l<o.length;l++)e.kerning.push({first:parseInt(o[l].getAttribute(\"first\"),10),second:parseInt(o[l].getAttribute(\"second\"),10),amount:parseInt(o[l].getAttribute(\"amount\"),10)});for(let l=0;l<h.length;l++)e.distanceField.push({fieldType:h[l].getAttribute(\"fieldType\"),distanceRange:parseInt(h[l].getAttribute(\"distanceRange\"),10)});return e}}class On{static test(t){return typeof t==\"string\"&&t.includes(\"<font>\")?Ln.test(N.ADAPTER.parseXML(t)):!1}static parse(t){return Ln.parse(N.ADAPTER.parseXML(t))}}const Ka=[Hr,Ln,On];function _p(r){for(let t=0;t<Ka.length;t++)if(Ka[t].test(r))return Ka[t];return null}function $0(r,t,e,i,s,n){const a=e.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let o;const h=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,u=r.width/i-h-l*2,c=r.height/i-h-l*2,d=a.slice(),f=e.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(a[0]),f.unshift(0),d.push(a[a.length-1]),f.push(1),e.fillGradientType===bs.LINEAR_VERTICAL){o=t.createLinearGradient(u/2,l,u/2,c+l);let p=0;const m=(n.fontProperties.fontSize+e.strokeThickness)/c;for(let g=0;g<s.length;g++){const y=n.lineHeight*g;for(let x=0;x<d.length;x++){let _=0;typeof f[x]==\"number\"?_=f[x]:_=x/d.length;const v=y/c+_*m;let T=Math.max(p,v);T=Math.min(T,1),o.addColorStop(T,d[x]),p=T}}}else{o=t.createLinearGradient(l,c/2,u+l,c/2);const p=d.length+1;let m=1;for(let g=0;g<d.length;g++){let y;typeof f[g]==\"number\"?y=f[g]:y=m/p,o.addColorStop(y,d[g]),m++}}return o}function z0(r,t,e,i,s,n,a){const o=e.text,h=e.fontProperties;t.translate(i,s),t.scale(n,n);const l=a.strokeThickness/2,u=-(a.strokeThickness/2);if(t.font=a.toFontString(),t.lineWidth=a.strokeThickness,t.textBaseline=a.textBaseline,t.lineJoin=a.lineJoin,t.miterLimit=a.miterLimit,t.fillStyle=$0(r,t,a,n,[o],e),t.strokeStyle=a.stroke,a.dropShadow){const c=a.dropShadowColor,d=a.dropShadowBlur*n,f=a.dropShadowDistance*n;t.shadowColor=tt.shared.setValue(c).setAlpha(a.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(a.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(a.dropShadowAngle)*f}else t.shadowColor=\"black\",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;a.stroke&&a.strokeThickness&&t.strokeText(o,l,u+e.lineHeight-h.descent),a.fill&&t.fillText(o,l,u+e.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle=\"rgba(0, 0, 0, 0)\"}function cn(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0)}function yp(r){return Array.from?Array.from(r):r.split(\"\")}function W0(r){typeof r==\"string\"&&(r=[r]);const t=[];for(let e=0,i=r.length;e<i;e++){const s=r[e];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const n=s[0].charCodeAt(0),a=s[1].charCodeAt(0);if(a<n)throw new Error(\"[BitmapFont]: Invalid character range.\");for(let o=n,h=a;o<=h;o++)t.push(String.fromCharCode(o))}else t.push(...yp(s))}if(t.length===0)throw new Error(\"[BitmapFont]: Empty set when resolving characters.\");return t}const Ze=class we{constructor(t,e,i){const[s]=t.info,[n]=t.common,[a]=t.page,[o]=t.distanceField,h=De(a.file),l={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=n.lineHeight/h,this.chars={},this.pageTextures=l;for(let u=0;u<t.page.length;u++){const{id:c,file:d}=t.page[u];l[c]=e instanceof Array?e[u]:e[d],o?.fieldType&&o.fieldType!==\"none\"&&(l[c].baseTexture.alphaMode=Nt.NO_PREMULTIPLIED_ALPHA,l[c].baseTexture.mipmap=fe.OFF)}for(let u=0;u<t.char.length;u++){const{id:c,page:d}=t.char[u];let{x:f,y:p,width:m,height:g,xoffset:y,yoffset:x,xadvance:_}=t.char[u];f/=h,p/=h,m/=h,g/=h,y/=h,x/=h,_/=h;const v=new Y(f+l[d].frame.x/h,p+l[d].frame.y/h,m,g);this.chars[c]={xOffset:y,yOffset:x,xAdvance:_,kerning:{},texture:new B(l[d].baseTexture,v),page:d}}for(let u=0;u<t.kerning.length;u++){let{first:c,second:d,amount:f}=t.kerning[u];c/=h,d/=h,f/=h,this.chars[d]&&(this.chars[d].kerning[c]=f)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??\"none\"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let s;if(t instanceof os)s=t;else{const a=_p(t);if(!a)throw new Error(\"Unrecognized data format for font.\");s=a.parse(t)}e instanceof B&&(e=[e]);const n=new we(s,e,i);return we.available[n.font]=n,n}static uninstall(t){const e=we.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete we.available[t]}static from(t,e,i){if(!t)throw new Error(\"[BitmapFont] Property `name` is required.\");const{chars:s,padding:n,resolution:a,textureWidth:o,textureHeight:h,...l}=Object.assign({},we.defaultOptions,i),u=W0(s),c=e instanceof je?e:new je(e),d=o,f=new os;f.info[0]={face:c.fontFamily,size:c.fontSize},f.common[0]={lineHeight:c.fontSize};let p=0,m=0,g,y,x,_=0;const v=[];for(let S=0;S<u.length;S++){g||(g=N.ADAPTER.createCanvas(),g.width=o,g.height=h,y=g.getContext(\"2d\"),x=new j(g,{resolution:a,...l}),v.push(new B(x)),f.page.push({id:v.length-1,file:\"\"}));const w=u[S],b=Ue.measureText(w,c,!1,g),R=b.width,L=Math.ceil(b.height),I=Math.ceil((c.fontStyle===\"italic\"?2:1)*R);if(m>=h-L*a){if(m===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${w}')`);--S,g=null,y=null,x=null,m=0,p=0,_=0;continue}if(_=Math.max(L+b.fontProperties.descent,_),I*a+p>=d){if(p===0)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${w}')`);--S,m+=_*a,m=Math.ceil(m),p=0,_=0;continue}z0(g,y,b,p,m,a,c);const D=cn(b.text);f.char.push({id:D,page:v.length-1,x:p/a,y:m/a,width:I,height:L,xoffset:0,yoffset:0,xadvance:R-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),p+=(I+2*n)*a,p=Math.ceil(p)}if(!i?.skipKerning)for(let S=0,w=u.length;S<w;S++){const b=u[S];for(let R=0;R<w;R++){const L=u[R],I=y.measureText(b).width,D=y.measureText(L).width,C=y.measureText(b+L).width-(I+D);C&&f.kerning.push({first:cn(b),second:cn(L),amount:C})}}const T=new we(f,v,!0);return we.available[t]!==void 0&&we.uninstall(t),we.available[t]=T,T}};Ze.ALPHA=[[\"a\",\"z\"],[\"A\",\"Z\"],\" \"],Ze.NUMERIC=[[\"0\",\"9\"]],Ze.ALPHANUMERIC=[[\"a\",\"z\"],[\"A\",\"Z\"],[\"0\",\"9\"],\" \"],Ze.ASCII=[[\" \",\"~\"]],Ze.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Ze.ALPHANUMERIC},Ze.available={};let Ne=Ze;var j0=`// Pixi texture info\\r\nvarying vec2 vTextureCoord;\\r\nuniform sampler2D uSampler;\\r\n\\r\n// Tint\\r\nuniform vec4 uColor;\\r\n\\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\\r\nuniform float uFWidth;\\r\n\\r\nvoid main(void) {\\r\n\\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\\r\n\\r\n  // MSDF\\r\n  float median = texColor.r + texColor.g + texColor.b -\\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\\r\n                  max(texColor.r, max(texColor.g, texColor.b));\\r\n  // SDF\\r\n  median = min(median, texColor.a);\\r\n\\r\n  float screenPxDistance = uFWidth * (median - 0.5);\\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\\r\n  if (median < 0.01) {\\r\n    alpha = 0.0;\\r\n  } else if (median > 0.99) {\\r\n    alpha = 1.0;\\r\n  }\\r\n\\r\n  // Gamma correction for coverage-like alpha\\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\\r\n  float coverage = pow(uColor.a * alpha, gamma);  \\r\n\\r\n  // NPM Textures, NPM outputs\\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\\r\n}\\r\n`,Y0=`// Mesh material default fragment\\r\nattribute vec2 aVertexPosition;\\r\nattribute vec2 aTextureCoord;\\r\n\\r\nuniform mat3 projectionMatrix;\\r\nuniform mat3 translationMatrix;\\r\nuniform mat3 uTextureMatrix;\\r\n\\r\nvarying vec2 vTextureCoord;\\r\n\\r\nvoid main(void)\\r\n{\\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\\r\n\\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\\r\n}\\r\n`;const Xu=[],$u=[],zu=[],vp=class xp extends kt{constructor(t,e={}){super();const{align:i,tint:s,maxWidth:n,letterSpacing:a,fontName:o,fontSize:h}=Object.assign({},xp.styleDefaults,e);if(!Ne.available[o])throw new Error(`Missing BitmapFont \"${o}\"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new tt(s),this._font=void 0,this._fontName=o,this._fontSize=h,this.text=t,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=a,this._anchor=new le(()=>{this.dirty=!0},this,0,0),this._roundPixels=N.ROUND_PIXELS,this.dirty=!0,this._resolution=N.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=Ne.available[this._fontName],e=this.fontSize,i=e/t.size,s=new Z,n=[],a=[],o=[],h=this._text.replace(/(?:\\r\\n|\\r)/g,`\n`)||\" \",l=yp(h),u=this._maxWidth*t.size/e,c=t.distanceFieldType===\"none\"?Xu:$u;let d=null,f=0,p=0,m=0,g=-1,y=0,x=0,_=0,v=0;for(let I=0;I<l.length;I++){const D=l[I],C=cn(D);if(/(?:\\s)/.test(D)&&(g=I,y=f,v++),D===\"\\r\"||D===`\n`){a.push(f),o.push(-1),p=Math.max(p,f),++m,++x,s.x=0,s.y+=t.lineHeight,d=null,v=0;continue}const A=t.chars[C];if(!A)continue;d&&A.kerning[d]&&(s.x+=A.kerning[d]);const $=zu.pop()||{texture:B.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Z};$.texture=A.texture,$.line=m,$.charCode=C,$.position.x=Math.round(s.x+A.xOffset+this._letterSpacing/2),$.position.y=Math.round(s.y+A.yOffset),$.prevSpaces=v,n.push($),f=$.position.x+Math.max(A.xAdvance-A.xOffset,A.texture.orig.width),s.x+=A.xAdvance+this._letterSpacing,_=Math.max(_,A.yOffset+A.texture.height),d=C,g!==-1&&u>0&&s.x>u&&(++x,Mi(n,1+g-x,1+I-g),I=g,g=-1,a.push(y),o.push(n.length>0?n[n.length-1].prevSpaces:0),p=Math.max(p,y),m++,s.x=0,s.y+=t.lineHeight,d=null,v=0)}const T=l[l.length-1];T!==\"\\r\"&&T!==`\n`&&(/(?:\\s)/.test(T)&&(f=y),a.push(f),p=Math.max(p,f),o.push(-1));const S=[];for(let I=0;I<=m;I++){let D=0;this._align===\"right\"?D=p-a[I]:this._align===\"center\"?D=(p-a[I])/2:this._align===\"justify\"&&(D=o[I]<0?0:(p-a[I])/o[I]),S.push(D)}const w=n.length,b={},R=[],L=this._activePagesMeshData;c.push(...L);for(let I=0;I<w;I++){const D=n[I].texture,C=D.baseTexture.uid;if(!b[C]){let A=c.pop();if(!A){const q=new xs;let U,nt;t.distanceFieldType===\"none\"?(U=new ur(B.EMPTY),nt=H.NORMAL):(U=new ur(B.EMPTY,{program:Ie.from(Y0,j0),uniforms:{uFWidth:0}}),nt=H.NORMAL_NPM);const at=new lr(q,U);at.blendMode=nt,A={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:at,vertices:null,uvs:null,indices:null}}A.index=0,A.indexCount=0,A.vertexCount=0,A.uvsCount=0,A.total=0;const{_textureCache:$}=this;$[C]=$[C]||new B(D.baseTexture),A.mesh.texture=$[C],A.mesh.tint=this._tintColor.value,R.push(A),b[C]=A}b[C].total++}for(let I=0;I<L.length;I++)R.includes(L[I])||this.removeChild(L[I].mesh);for(let I=0;I<R.length;I++)R[I].mesh.parent!==this&&this.addChild(R[I].mesh);this._activePagesMeshData=R;for(const I in b){const D=b[I],C=D.total;if(!(D.indices?.length>6*C)||D.vertices.length<lr.BATCHABLE_SIZE*2)D.vertices=new Float32Array(4*2*C),D.uvs=new Float32Array(4*2*C),D.indices=new Uint16Array(6*C);else{const A=D.total,$=D.vertices;for(let q=A*4*2;q<$.length;q++)$[q]=0}D.mesh.size=6*C}for(let I=0;I<w;I++){const D=n[I];let C=D.position.x+S[D.line]*(this._align===\"justify\"?D.prevSpaces:1);this._roundPixels&&(C=Math.round(C));const A=C*i,$=D.position.y*i,q=D.texture,U=b[q.baseTexture.uid],nt=q.frame,at=q._uvs,P=U.index++;U.indices[P*6+0]=0+P*4,U.indices[P*6+1]=1+P*4,U.indices[P*6+2]=2+P*4,U.indices[P*6+3]=0+P*4,U.indices[P*6+4]=2+P*4,U.indices[P*6+5]=3+P*4,U.vertices[P*8+0]=A,U.vertices[P*8+1]=$,U.vertices[P*8+2]=A+nt.width*i,U.vertices[P*8+3]=$,U.vertices[P*8+4]=A+nt.width*i,U.vertices[P*8+5]=$+nt.height*i,U.vertices[P*8+6]=A,U.vertices[P*8+7]=$+nt.height*i,U.uvs[P*8+0]=at.x0,U.uvs[P*8+1]=at.y0,U.uvs[P*8+2]=at.x1,U.uvs[P*8+3]=at.y1,U.uvs[P*8+4]=at.x2,U.uvs[P*8+5]=at.y2,U.uvs[P*8+6]=at.x3,U.uvs[P*8+7]=at.y3}this._textWidth=p*i,this._textHeight=(s.y+t.lineHeight)*i;for(const I in b){const D=b[I];if(this.anchor.x!==0||this.anchor.y!==0){let q=0;const U=this._textWidth*this.anchor.x,nt=this._textHeight*this.anchor.y;for(let at=0;at<D.total;at++)D.vertices[q++]-=U,D.vertices[q++]-=nt,D.vertices[q++]-=U,D.vertices[q++]-=nt,D.vertices[q++]-=U,D.vertices[q++]-=nt,D.vertices[q++]-=U,D.vertices[q++]-=nt}this._maxLineHeight=_*i;const C=D.mesh.geometry.getBuffer(\"aVertexPosition\"),A=D.mesh.geometry.getBuffer(\"aTextureCoord\"),$=D.mesh.geometry.getIndex();C.data=D.vertices,A.data=D.uvs,$.data=D.indices,C.update(),A.update(),$.update()}for(let I=0;I<n.length;I++)zu.push(n[I]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:i,size:s}=Ne.available[this._fontName];if(i!==\"none\"){const{a:n,b:a,c:o,d:h}=this.worldTransform,l=Math.sqrt(n*n+a*a),u=Math.sqrt(o*o+h*h),c=(Math.abs(l)+Math.abs(u))/2,d=this.fontSize/s,f=t._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=c*e*d*f}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Ne.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont \"${this._fontName}\"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Ne.available[t])throw new Error(`Missing BitmapFont \"${t}\"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Ne.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t==\"number\"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??\"\"),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,i=Ne.available[this._fontName].distanceFieldType===\"none\"?Xu:$u;i.push(...this._activePagesMeshData);for(const s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],i.filter(s=>e[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=B.EMPTY});for(const s in e)e[s].destroy(),delete e[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};vp.styleDefaults={align:\"left\",tint:16777215,maxWidth:0,letterSpacing:0};let q0=vp;const K0=[\".xml\",\".fnt\"],bp={extension:{type:F.LoadParser,priority:ee.Normal},name:\"loadBitmapFont\",test(r){return K0.includes(bt.extname(r).toLowerCase())},async testParse(r){return Hr.test(r)||On.test(r)},async parse(r,t,e){const i=Hr.test(r)?Hr.parse(r):On.parse(r),{src:s}=t,{page:n}=i,a=[];for(let l=0;l<n.length;++l){const u=n[l].file;let c=bt.join(bt.dirname(s),u);c=Dn(c,s),a.push(c)}const o=await e.load(a),h=a.map(l=>o[l]);return Ne.install(i,h,!0)},async load(r,t){return(await N.ADAPTER.fetch(r)).text()},unload(r){r.destroy()}};k.add(bp);const Qo=class Yi extends je{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet=\"\",this.fontsDirty=!1}static from(t){return new Yi(Object.keys(Yi.defaultOptions).reduce((e,i)=>({...e,[i]:t[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Yi.availableFonts[t.originalUrl])}),this.fontFamily=\"Arial\",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:i}=Yi;if(i[t]){const s=i[t];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return N.ADAPTER.fetch(t).then(s=>s.blob()).then(async s=>new Promise((n,a)=>{const o=URL.createObjectURL(s),h=new FileReader;h.onload=()=>n([o,h.result]),h.onerror=a,h.readAsDataURL(s)})).then(async([s,n])=>{const a=Object.assign({family:bt.basename(t,bt.extname(t)),weight:\"normal\",style:\"normal\",display:\"auto\",src:s,dataSrc:n,refs:1,originalUrl:t,fontFace:null},e);i[t]=a,this._fonts.push(a),this.styleID++;const o=new FontFace(a.family,`url(${a.src})`,{weight:a.weight,style:a.style,display:a.display});a.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(i=>!this._overrides.includes(i));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(i=>this._overrides.includes(i));e.length>0&&(this._overrides=this._overrides.filter(i=>!e.includes(i)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,\"transform-origin: top left\",\"display: inline-block\",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?\"break-all\":\"break-word\"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,\"paint-order: stroke\"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(\";\")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}\n            @font-face {\n                font-family: \"${e.family}\";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style};\n                font-display: ${e.display};\n            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=_d(t)),typeof t==\"number\"?gd(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith(\"#\")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,\"0\"));const n=`${i}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${n} ${t}`}reset(){Object.assign(this,Yi.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=N.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn(\"[HTMLTextStyle] fillGradientStops is not supported by HTMLText\")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn(\"[HTMLTextStyle] fillGradientType is not supported by HTMLText\")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn(\"[HTMLTextStyle] miterLimit is not supported by HTMLText\")}get miterLimit(){return super.miterLimit}set trim(t){console.warn(\"[HTMLTextStyle] trim is not supported by HTMLText\")}get trim(){return super.trim}set textBaseline(t){console.warn(\"[HTMLTextStyle] textBaseline is not supported by HTMLText\")}get textBaseline(){return super.textBaseline}set leading(t){console.warn(\"[HTMLTextStyle] leading is not supported by HTMLText\")}get leading(){return super.leading}set lineJoin(t){console.warn(\"[HTMLTextStyle] lineJoin is not supported by HTMLText\")}get lineJoin(){return super.lineJoin}};Qo.availableFonts={},Qo.defaultOptions={align:\"left\",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:\"black\",dropShadowDistance:5,fill:\"black\",fontFamily:\"Arial\",fontSize:26,fontStyle:\"normal\",fontVariant:\"normal\",fontWeight:\"normal\",letterSpacing:0,lineHeight:0,padding:0,stroke:\"black\",strokeThickness:0,whiteSpace:\"normal\",wordWrap:!1,wordWrapWidth:100};let dn=Qo;const Lr=class qi extends qe{constructor(t=\"\",e={}){super(B.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const i=new Image,s=B.from(i,{scaleMode:N.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new Y,s.trim=new Y,this.texture=s;const n=\"http://www.w3.org/2000/svg\",a=\"http://www.w3.org/1999/xhtml\",o=document.createElementNS(n,\"svg\"),h=document.createElementNS(n,\"foreignObject\"),l=document.createElementNS(a,\"div\"),u=document.createElementNS(a,\"style\");h.setAttribute(\"width\",\"10000\"),h.setAttribute(\"height\",\"10000\"),h.style.overflow=\"hidden\",o.appendChild(h),this.maxWidth=qi.defaultMaxWidth,this.maxHeight=qi.defaultMaxHeight,this._domElement=l,this._styleElement=u,this._svgRoot=o,this._foreignObject=h,this._foreignObject.appendChild(u),this._foreignObject.appendChild(l),this._image=i,this._loadImage=new Image,this._autoResolution=qi.defaultAutoResolution,this._resolution=qi.defaultResolution??N.RESOLUTION,this.text=t,this.style=e}measureText(t){const{text:e,style:i,resolution:s}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(s)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const n=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:a,height:o}=n;(a>this.maxWidth||o>this.maxHeight)&&console.warn(\"[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.\");const h=Math.min(this.maxWidth,Math.ceil(a)),l=Math.min(this.maxHeight,Math.ceil(o));return this._svgRoot.setAttribute(\"width\",h.toString()),this._svgRoot.setAttribute(\"height\",l.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(s)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:h+i.padding*2,height:l+i.padding*2}}async updateText(t=!0){const{style:e,_image:i,_loadImage:s}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:n,height:a}=this.measureText();i.width=s.width=Math.ceil(Math.max(1,n)),i.height=s.height=Math.ceil(Math.max(1,a)),this._updateID++;const o=this._updateID;await new Promise(h=>{s.onload=async()=>{if(o<this._updateID){h();return}await e.onBeforeDraw(),i.src=s.src,s.onload=null,s.src=\"\",this.updateTexture(),h()};const l=new XMLSerializer().serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:i,resolution:s}=this,{padding:n}=t,{baseTexture:a}=e;e.trim.width=e._frame.width=i.width/s,e.trim.height=e._frame.height=i.height/s,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),a.setRealSize(i.width,i.height,s),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){typeof t==\"boolean\"&&(t={children:t}),t=Object.assign({},qi.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src=\"\",this._loadImage.onload=null,this._loadImage=e,this._image.src=\"\",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Ge(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Ge(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof dn?(this.ownsStyle=!1,this._style=t):t instanceof je?(console.warn(\"[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle\"),this.ownsStyle=!0,this._style=dn.from(t)):(this.ownsStyle=!0,this._style=new dn(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===\"\"||t===null||t===void 0?\" \":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,\"<br/>\").replace(/<hr>/gi,\"<hr/>\").replace(/&nbsp;/gi,\"&#160;\")}};Lr.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Lr.defaultMaxWidth=2024,Lr.defaultMaxHeight=2024,Lr.defaultAutoResolution=!0;let Z0=Lr;const J0=Object.freeze(Object.defineProperty({__proto__:null,ALPHA_MODES:Nt,AbstractMultiResource:Wh,AccessibilityManager:Yh,AlphaFilter:uf,AnimatedSprite:Bn,Application:qh,ArrayResource:rf,Assets:Ir,AssetsClass:Mf,Attribute:qr,BLEND_MODES:H,BUFFER_BITS:gn,BUFFER_TYPE:ue,BackgroundSystem:Zr,BaseImageResource:Fe,BasePrepare:Fn,BaseRenderTexture:Ch,BaseTexture:j,BatchDrawCall:Cn,BatchGeometry:wh,BatchRenderer:Qe,BatchShaderGenerator:Bd,BatchSystem:Eh,BatchTextureArray:Sn,BitmapFont:Ne,BitmapFontData:os,BitmapText:q0,BlobResource:Gf,BlurFilter:cf,BlurFilterPass:Mn,Bounds:es,BrowserAdapter:Rc,Buffer:pt,BufferResource:fs,BufferSystem:$h,CLEAR_MODES:ae,COLOR_MASK_BITS:Ic,Cache:ii,CanvasResource:sf,Circle:ps,Color:tt,ColorMatrixFilter:In,CompressedTextureResource:ni,Container:kt,ContextSystem:Jr,CountLimiter:up,CubeResource:af,DEG_TO_RAD:Sd,DRAW_MODES:oe,DisplacementFilter:df,DisplayObject:ct,ENV:ui,Ellipse:ms,EventBoundary:mf,EventSystem:Rn,ExtensionType:F,Extract:qf,FORMATS:M,FORMATS_TO_COMPONENTS:Hf,FXAAFilter:ff,FederatedDisplayObject:gf,FederatedEvent:fr,FederatedMouseEvent:is,FederatedPointerEvent:Yt,FederatedWheelEvent:Ri,FillStyle:vs,Filter:Ft,FilterState:Od,FilterSystem:Mh,Framebuffer:An,FramebufferSystem:Ih,GC_MODES:Vn,GLFramebuffer:Nd,GLProgram:Xd,GLTexture:an,GRAPHICS_CURVES:p0,GenerateTextureSystem:Oh,Geometry:ze,GeometrySystem:Rh,Graphics:Qh,GraphicsData:as,GraphicsGeometry:ep,HTMLText:Z0,HTMLTextStyle:dn,IGLUniformData:Pv,INSTALLED:En,INTERNAL_FORMATS:Ct,INTERNAL_FORMAT_TO_BYTES_PER_PIXEL:ss,ImageBitmapResource:Ci,ImageResource:Sh,LINE_CAP:Ve,LINE_JOIN:Xt,LineStyle:ra,LoaderParserPriority:ee,MASK_TYPES:yt,MIPMAP_MODES:fe,MSAA_QUALITY:mt,MaskData:kd,MaskSystem:Dh,Matrix:et,Mesh:lr,MeshBatchUvs:ip,MeshGeometry:xs,MeshMaterial:ur,MultisampleSystem:Xh,NineSlicePlane:x0,NoiseFilter:pf,ObjectRenderer:_s,ObjectRendererSystem:zh,ObservablePoint:le,PI_2:Kr,PRECISION:zt,ParticleContainer:w0,ParticleRenderer:tl,PlaneGeometry:np,PluginSystem:Bh,Point:Z,Polygon:si,Prepare:il,Program:Ie,ProjectionSystem:Lh,Quad:Ld,QuadUv:Ph,RAD_TO_DEG:Cd,RENDERER_TYPE:ch,Rectangle:Y,RenderTexture:di,RenderTexturePool:Ah,RenderTextureSystem:Nh,Renderer:ta,ResizePlugin:Kh,Resource:hr,RopeGeometry:ap,RoundedRectangle:gs,Runner:Wt,SAMPLER_TYPES:O,SCALE_MODES:Me,SHAPES:Pt,SVGResource:Pn,ScissorSystem:Hd,Shader:de,ShaderSystem:Uh,SimpleMesh:b0,SimplePlane:op,SimpleRope:T0,Sprite:qe,SpriteMaskFilter:Ud,Spritesheet:Jo,StartupSystem:Qr,State:pe,StateSystem:Kd,StencilSystem:Fh,SystemManager:Zd,TARGETS:Ai,TEXT_GRADIENT:bs,TYPES:V,TYPES_TO_BYTES_PER_COMPONENT:Wo,TYPES_TO_BYTES_PER_PIXEL:Xf,TemporaryDisplayObject:of,Text:el,TextFormat:Hr,TextMetrics:Ue,TextStyle:je,Texture:B,TextureGCSystem:ti,TextureMatrix:Qn,TextureSystem:kh,TextureUvs:Jn,Ticker:Mt,TickerPlugin:Vh,TilingSprite:rl,TilingSpriteRenderer:sl,TimeLimiter:U0,Transform:dr,TransformFeedback:jv,TransformFeedbackSystem:Gh,UPDATE_PRIORITY:We,UniformGroup:Qt,VERSION:Yv,VideoResource:jh,ViewSystem:ts,ViewableBuffer:wn,WRAP_MODES:Re,XMLFormat:Ln,XMLStringFormat:On,accessibleTarget:_f,autoDetectFormat:_p,autoDetectRenderer:tf,autoDetectResource:Th,cacheTextureArray:If,checkDataUrl:Bi,checkExtension:Ke,checkMaxIfStatementsInShader:Ed,convertToList:Kt,copySearchParams:Dn,createStringVariations:xf,createTexture:pr,createUBOElements:Wd,curves:hi,defaultFilterVertex:Hh,defaultVertex:ef,detectAvif:Df,detectCompressedTextures:kf,detectDefaults:Bf,detectMp4:Of,detectOgv:Nf,detectWebm:Lf,detectWebp:Ff,extensions:k,filters:Go,generateProgram:$d,generateUniformBufferSync:Yd,getFontFamilyName:wf,getTestContext:Id,getUBOData:jd,graphicsUtils:_0,groupD8:lt,isMobile:he,isSingleItem:rs,loadBitmapFont:bp,loadDDS:zf,loadImageBitmap:Sf,loadJson:bf,loadKTX:Wf,loadSVG:Af,loadTextures:ys,loadTxt:Tf,loadVideo:Pf,loadWebFont:Ef,parseDDS:Vf,parseKTX:$f,resolveCompressedTextureUrl:jf,resolveTextureUrl:Uf,settings:N,spritesheetAsset:gp,uniformParsers:Ii,unsafeEvalSupported:Fd,utils:Jy},Symbol.toStringTag,{value:\"Module\"}));window.PIXI=J0;var Q0=Object.defineProperty,gi=Math.pow,tb=(r,t,e)=>t in r?Q0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,E=(r,t,e)=>(tb(r,typeof t!=\"symbol\"?t+\"\":t,e),e),ut=(r,t,e)=>new Promise((i,s)=>{var n=h=>{try{o(e.next(h))}catch(l){s(l)}},a=h=>{try{o(e.throw(h))}catch(l){s(l)}},o=h=>h.done?i(h.value):Promise.resolve(h.value).then(n,a);o((e=e.apply(r,t)).next())});class nl{constructor(){this._breathParameters=[],this._currentTime=0}static create(){return new nl}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=this._currentTime*2*3.14159;for(let s=0;s<this._breathParameters.length;++s){const n=this._breathParameters[s];t.addParameterValueById(n.parameterId,n.offset+n.peak*Math.sin(i/n.cycle),n.weight)}}}class wr{constructor(t,e,i,s,n){this.parameterId=t??void 0,this.offset=e??0,this.peak=i??0,this.cycle=s??0,this.weight=n??0}}const Tp=class th{static create(t){return new th(t)}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){this._userTimeSeconds+=e;let i,s=0;switch(this._blinkingState){case 2:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,s>=1&&(s=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-s;break;case 3:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,s>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,s>=1&&(s=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=s;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case 0:default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1;break}th.CloseIfZero||(i=-i);for(let n=0;n<this._parameterIds.length;++n)t.setParameterValueById(this._parameterIds[n],i)}constructor(t){var e,i;this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=[],t!=null&&(this._parameterIds=(i=(e=t.getEyeBlinkParameters())==null?void 0:e.slice())!=null?i:this._parameterIds)}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}};Tp.CloseIfZero=!0;let eb=Tp;const ib=.001,Wu=.5;class al{static create(t){const e=new al;typeof t.FadeInTime==\"number\"&&(e._fadeTimeSeconds=t.FadeInTime,e._fadeTimeSeconds<=0&&(e._fadeTimeSeconds=Wu));const i=t.Groups,s=i.length;for(let n=0;n<s;++n){const a=i[n],o=a.length;let h=0;for(let l=0;l<o;++l){const u=a[l],c=new Nn;c.partId=u.Id;const d=u.Link;if(d){const f=d.length;for(let p=0;p<f;++p){const m=new Nn;m.partId=d[p],c.link.push(m)}}e._partGroups.push(c),++h}e._partGroupCounts.push(h)}return e}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let s=0;s<this._partGroupCounts.length;s++){const n=this._partGroupCounts[s];this.doFade(t,e,i,n),i+=n}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.length;++i){const s=this._partGroupCounts[i];for(let n=e;n<e+s;++n){this._partGroups[n].initialize(t);const a=this._partGroups[n].partIndex,o=this._partGroups[n].parameterIndex;if(!(a<0)){t.setPartOpacityByIndex(a,n==e?1:0),t.setParameterValueByIndex(o,n==e?1:0);for(let h=0;h<this._partGroups[n].link.length;++h)this._partGroups[n].link[h].initialize(t)}}e+=s}}copyPartOpacities(t){for(let e=0;e<this._partGroups.length;++e){const i=this._partGroups[e];if(i.link.length==0)continue;const s=this._partGroups[e].partIndex,n=t.getPartOpacityByIndex(s);for(let a=0;a<i.link.length;++a){const h=i.link[a].partIndex;h<0||t.setPartOpacityByIndex(h,n)}}}doFade(t,e,i,s){let n=-1,a=1;const o=.5,h=.15;for(let l=i;l<i+s;++l){const u=this._partGroups[l].partIndex,c=this._partGroups[l].parameterIndex;if(t.getParameterValueByIndex(c)>ib){if(n>=0)break;n=l,a=t.getPartOpacityByIndex(u),a+=e/this._fadeTimeSeconds,a>1&&(a=1)}}n<0&&(n=0,a=1);for(let l=i;l<i+s;++l){const u=this._partGroups[l].partIndex;if(n==l)t.setPartOpacityByIndex(u,a);else{let c=t.getPartOpacityByIndex(u),d;a<o?d=a*(o-1)/o+1:d=(1-a)*o/(1-o),(1-d)*(1-a)>h&&(d=1-h/(1-a)),c>d&&(c=d),t.setPartOpacityByIndex(u,c)}}}constructor(){this._fadeTimeSeconds=Wu,this._lastModel=void 0,this._partGroups=[],this._partGroupCounts=[]}}class Nn{constructor(t){this.parameterIndex=0,this.partIndex=0,this.partId=\"\",this.link=[],t!=null&&this.assignment(t)}assignment(t){return this.partId=t.partId,this.link=t.link.map(e=>e.clone()),this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new Nn;return t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=this.link.map(e=>e.clone()),t}}class X{constructor(t,e){this.x=t||0,this.y=e||0}add(t){const e=new X(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new X(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new X(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new X(t,t))}division(t){const e=new X(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new X(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}const wp=class fn{static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(t===0)return t;let e=t;const i=e<0;i&&(e=-e);let s;return e===1/0?s=1/0:(s=Math.exp(Math.log(e)/3),s=(e/(s*s)+2*s)/3),i?-s:s}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return t*180/Math.PI}static directionToRadian(t,e){const i=Math.atan2(e.y,e.x),s=Math.atan2(t.y,t.x);let n=i-s;for(;n<-Math.PI;)n+=Math.PI*2;for(;n>Math.PI;)n-=Math.PI*2;return n}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let s=this.radianToDegrees(i);return e.x-t.x>0&&(s=-s),s}static radianToDirection(t){const e=new X;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,i){return this.abs(t)<fn.Epsilon?this.abs(e)<fn.Epsilon?-i:-i/e:-(e+this.sqrt(e*e-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,e,i,s){if(this.sqrt(t)<fn.Epsilon)return this.range(this.quadraticEquation(e,i,s),0,1);const n=e/t,a=i/t,o=s/t,h=(3*a-n*n)/3,l=h/3,u=(2*n*n*n-9*n*a+27*o)/27,c=u/2,d=c*c+l*l*l,f=.5,p=f+.01;if(d<0){const _=-h/3,v=_*_*_,T=this.sqrt(v),S=-u/(2*T),w=this.range(S,-1,1),b=Math.acos(w),L=2*this.cbrt(T),I=L*this.cos(b/3)-n/3;if(this.abs(I-f)<p)return this.range(I,0,1);const D=L*this.cos((b+2*Math.PI)/3)-n/3;if(this.abs(D-f)<p)return this.range(D,0,1);const C=L*this.cos((b+4*Math.PI)/3)-n/3;return this.range(C,0,1)}if(d==0){let _;c<0?_=this.cbrt(-c):_=-this.cbrt(c);const v=2*_-n/3;if(this.abs(v-f)<p)return this.range(v,0,1);const T=-_-n/3;return this.range(T,0,1)}const m=this.sqrt(d),g=this.cbrt(m-c),y=this.cbrt(m+c),x=g-y-n/3;return this.range(x,0,1)}constructor(){}};wp.Epsilon=1e-5;let Q=wp;class Jt{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const s=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),n=4;for(let a=0;a<n;++a)for(let o=0;o<n;++o)for(let h=0;h<n;++h)s[o+a*4]+=t[h+a*4]*e[o+h*4];for(let a=0;a<16;++a)i[a]=s[a]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);Jt.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);Jt.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){Jt.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new Jt;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}class ol{initialize(t){this._model=t}drawModel(){this.getModel()!=null&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,s){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),s<0?s=0:s>1&&(s=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=i,this._modelColor.A=s}getModelColor(){return Object.assign({},this._modelColor)}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(t){this._useHighPrecisionMask=t}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._modelColor=new $t,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new Jt,this._mvpMatrix4x4.loadIdentity()}}var $e=(r=>(r[r.CubismBlendMode_Normal=0]=\"CubismBlendMode_Normal\",r[r.CubismBlendMode_Additive=1]=\"CubismBlendMode_Additive\",r[r.CubismBlendMode_Multiplicative=2]=\"CubismBlendMode_Multiplicative\",r))($e||{});class $t{constructor(t=1,e=1,i=1,s=1){this.R=t,this.G=e,this.B=i,this.A=s}}let ve=!1,Gi=!1,Vi;const Za={vertexOffset:0,vertexStep:2};class hs{static startUp(t){if(ve)return Er(\"CubismFramework.startUp() is already done.\"),ve;if(Live2DCubismCore._isStarted)return ve=!0,!0;if(Live2DCubismCore._isStarted=!0,Vi=t,Vi&&Live2DCubismCore.Logging.csmSetLogFunction(Vi.logFunction),ve=!0,ve){const e=Live2DCubismCore.Version.csmGetVersion(),i=(e&4278190080)>>24,s=(e&16711680)>>16,n=e&65535,a=e;Er(\"Live2D Cubism Core version: {0}.{1}.{2} ({3})\",(\"00\"+i).slice(-2),(\"00\"+s).slice(-2),(\"0000\"+n).slice(-4),a)}return Er(\"CubismFramework.startUp() is complete.\"),ve}static cleanUp(){ve=!1,Gi=!1,Vi=void 0}static initialize(t=0){if(!ve){Si(\"CubismFramework is not started.\");return}if(Gi){Si(\"CubismFramework.initialize() skipped, already initialized.\");return}Live2DCubismCore.Memory.initializeAmountOfMemory(t),Gi=!0,Er(\"CubismFramework.initialize() is complete.\")}static dispose(){if(!ve){Si(\"CubismFramework is not started.\");return}if(!Gi){Si(\"CubismFramework.dispose() skipped, not initialized.\");return}ol.staticRelease(),Gi=!1,Er(\"CubismFramework.dispose() is complete.\")}static isStarted(){return ve}static isInitialized(){return Gi}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return Vi!=null?Vi.loggingLevel:5}constructor(){}}var mr=(r=>(r[r.LogLevel_Verbose=0]=\"LogLevel_Verbose\",r[r.LogLevel_Debug=1]=\"LogLevel_Debug\",r[r.LogLevel_Info=2]=\"LogLevel_Info\",r[r.LogLevel_Warning=3]=\"LogLevel_Warning\",r[r.LogLevel_Error=4]=\"LogLevel_Error\",r[r.LogLevel_Off=5]=\"LogLevel_Off\",r))(mr||{});const Ji=typeof process<\"u\"?()=>{}:r=>console.assert(r);function ju(r,...t){sa.print(mr.LogLevel_Debug,\"[CSM][D]\"+r+`\n`,t)}function Er(r,...t){sa.print(mr.LogLevel_Info,\"[CSM][I]\"+r+`\n`,t)}function Si(r,...t){sa.print(mr.LogLevel_Warning,\"[CSM][W]\"+r+`\n`,t)}function Pe(r,...t){sa.print(mr.LogLevel_Error,\"[CSM][E]\"+r+`\n`,t)}class sa{static print(t,e,i){if(t<hs.getLoggingLevel())return;const s=hs.coreLogFunction;if(!s)return;const n=e.replace(/{(\\d+)}/g,(a,o)=>i[o]);s(n)}static dumpBytes(t,e,i){for(let s=0;s<i;s++)s%16==0&&s>0?this.print(t,`\n`):s%8==0&&s>0&&this.print(t,\"  \"),this.print(t,\"{0} \",[e[s]&255]);this.print(t,`\n`)}constructor(){}}class Yu{constructor(t=!1,e=new $t){this.isOverwritten=t,this.Color=e}}class qu{constructor(t=!1,e=new $t){this.isOverwritten=t,this.Color=e}}class rb{constructor(t=!1,e=!1){this.isOverwritten=t,this.isCulling=e}}class sb{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return this._model==null?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.length;for(let i=0;i<t;++i)i<e?this._savedParameters[i]=this._parameterValues[i]:this._savedParameters.push(this._parameterValues[i])}getMultiplyColor(t){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(t)?this._userMultiplyColors[t].Color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(t)?this._userScreenColors[t].Color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setMultiplyColorByRGBA(t,e,i,s,n=1){this._userMultiplyColors[t].Color.R=e,this._userMultiplyColors[t].Color.G=i,this._userMultiplyColors[t].Color.B=s,this._userMultiplyColors[t].Color.A=n}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setScreenColorByRGBA(t,e,i,s,n=1){this._userScreenColors[t].Color.R=e,this._userScreenColors[t].Color.G=i,this._userScreenColors[t].Color.B=s,this._userScreenColors[t].Color.A=n}getPartMultiplyColor(t){return this._userPartMultiplyColors[t].Color}getPartScreenColor(t){return this._userPartScreenColors[t].Color}setPartColor(t,e,i,s,n,a,o){if(a[t].Color.R=e,a[t].Color.G=i,a[t].Color.B=s,a[t].Color.A=n,a[t].isOverwritten)for(let h=0;h<this._partChildDrawables[t].length;++h){const l=this._partChildDrawables[t][h];o[l].Color.R=e,o[l].Color.G=i,o[l].Color.B=s,o[l].Color.A=n}}setPartMultiplyColorByTextureColor(t,e){this.setPartMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setPartMultiplyColorByRGBA(t,e,i,s,n){this.setPartColor(t,e,i,s,n,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(t,e){this.setPartScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setPartScreenColorByRGBA(t,e,i,s,n){this.setPartColor(t,e,i,s,n,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){this._isOverwrittenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){this._isOverwrittenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return this._userMultiplyColors[t].isOverwritten}getOverwriteFlagForDrawableScreenColors(t){return this._userScreenColors[t].isOverwritten}setOverwriteFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors[t].isOverwritten=e}setOverwriteFlagForDrawableScreenColors(t,e){this._userScreenColors[t].isOverwritten=e}getOverwriteColorForPartMultiplyColors(t){return this._userPartMultiplyColors[t].isOverwritten}getOverwriteColorForPartScreenColors(t){return this._userPartScreenColors[t].isOverwritten}setOverwriteColorForPartColors(t,e,i,s){i[t].isOverwritten=e;for(let n=0;n<this._partChildDrawables[t].length;++n){const a=this._partChildDrawables[t][n];s[a].isOverwritten=e,e&&(s[a].Color.R=i[t].Color.R,s[a].Color.G=i[t].Color.G,s[a].Color.B=i[t].Color.B,s[a].Color.A=i[t].Color.A)}}setOverwriteColorForPartMultiplyColors(t,e){this._userPartMultiplyColors[t].isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(t,e){this._userPartScreenColors[t].isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(t){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(t))return this._userCullings[t].isCulling;const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}setDrawableCulling(t,e){this._userCullings[t].isCulling=e}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(t){this._isOverwrittenCullings=t}getOverwriteFlagForDrawableCullings(t){return this._userCullings[t].isOverwritten}setOverwriteFlagForDrawableCullings(t,e){this._userCullings[t].isOverwritten=e}getModelOapcity(){return this._modelOpacity}setModelOapcity(t){this._modelOpacity=t}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds[e])return e;return t in this._notExistPartId?this._notExistPartId[t]:(e=i+this._notExistPartId.length,this._notExistPartId[t]=e,this._notExistPartOpacities[e]=0,e)}getPartId(t){return this._model.parts.ids[t]}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){if(t in this._notExistPartOpacities){this._notExistPartOpacities[t]=e;return}Ji(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return t in this._notExistPartOpacities?this._notExistPartOpacities[t]:(Ji(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds[e])return e;return t in this._notExistParameterId?this._notExistParameterId[t]:(e=this._model.parameters.count+Object.keys(this._notExistParameterId).length,this._notExistParameterId[t]=e,this._notExistParameterValues[e]=0,e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return t in this._notExistParameterValues?this._notExistParameterValues[t]:(Ji(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){if(t in this._notExistParameterValues){this._notExistParameterValues[t]=i==1?e:this._notExistParameterValues[t]*(1-i)+e*i;return}Ji(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=i==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i}setParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.setParameterValueByIndex(s,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.addParameterValueByIndex(s,e,i)}multiplyParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.multiplyParameterValueByIndex(s,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIds(){return this._drawableIds.slice()}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds[i]==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){return this._model.drawables.ids[t]}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const e=this._model.drawables.multiplyColors,i=t*4,s=new $t;return s.R=e[i],s.G=e[i+1],s.B=e[i+2],s.A=e[i+3],s}getDrawableScreenColor(t){const e=this._model.drawables.screenColors,i=t*4,s=new $t;return s.R=e[i],s.G=e[i+1],s.B=e[i+2],s.A=e[i+3],s}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?$e.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?$e.CubismBlendMode_Multiplicative:$e.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.length;t>e&&(t=e);for(let i=0;i<t;++i)this._parameterValues[i]=this._savedParameters[i]}initialize(){this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const e=this._model.parameters.ids,i=this._model.parameters.count;for(let s=0;s<i;++s)this._parameterIds.push(e[s])}const t=this._model.parts.count;{const e=this._model.parts.ids;for(let i=0;i<t;++i)this._partIds.push(e[i])}{const e=this._model.drawables.ids,i=this._model.drawables.count,s=new rb(!1,!1);for(let n=0;n<t;++n){const a=new $t(1,1,1,1),o=new $t(0,0,0,1),h=new qu(!1,a),l=new qu(!1,o);this._userPartMultiplyColors.push(h),this._userPartScreenColors.push(l),this._partChildDrawables.push([])}for(let n=0;n<i;++n){const a=new $t(1,1,1,1),o=new $t(0,0,0,1),h=new Yu(!1,a),l=new Yu(!1,o);this._drawableIds.push(e[n]),this._userMultiplyColors.push(h),this._userScreenColors.push(l),this._userCullings.push(s);const u=this.getDrawableParentPartIndex(n);u>=0&&this._partChildDrawables[u].push(n)}}}constructor(t){this._model=t,this._savedParameters=[],this._parameterIds=[],this._drawableIds=[],this._partIds=[],this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=[],this._userScreenColors=[],this._userCullings=[],this._userPartMultiplyColors=[],this._userPartScreenColors=[],this._partChildDrawables=[],this._notExistPartId={},this._notExistParameterId={},this._notExistParameterValues={},this._notExistPartOpacities={},this.initialize()}release(){this._model.release(),this._model=void 0}}class hl{static create(t,e){if(e&&!this.hasMocConsistency(t))throw new Error(\"Inconsistent MOC3.\");const i=Live2DCubismCore.Moc.fromArrayBuffer(t);if(i){const s=new hl(i);return s._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(i,t),s}throw new Error(\"Failed to CubismMoc.create().\")}createModel(){let t;const e=Live2DCubismCore.Model.fromMoc(this._moc);if(e)return t=new sb(e),++this._modelCount,t;throw new Error(\"Unknown error\")}deleteModel(t){t!=null&&--this._modelCount}constructor(t){this._moc=t,this._modelCount=0,this._mocVersion=0}release(){this._moc._release(),this._moc=void 0}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(t){return Live2DCubismCore.Moc.prototype.hasMocConsistency(t)===1}}class Ep{constructor(){this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=[]}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(i-this._offsetSeconds),e.setFadeInStartTime(i);const o=this.getDuration();e.getEndTime()<0&&e.setEndTime(o<=0?-1:e.getStartTime()+o)}let s=this._weight;const n=this._fadeInSeconds==0?1:Q.getEasingSine((i-e.getFadeInStartTime())/this._fadeInSeconds),a=this._fadeOutSeconds==0||e.getEndTime()<0?1:Q.getEasingSine((e.getEndTime()-i)/this._fadeOutSeconds);s=s*n*a,e.setState(i,s),Ji(0<=s&&s<=1),this.doUpdateParameters(t,i,s,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}setFinishedMotionHandler(t){this._onFinishedMotion=t}getFinishedMotionHandler(){return this._onFinishedMotion}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(t){}getModelOpacityValue(){return 1}}const Ku=1;class ll extends Ep{static create(t){const e=new ll;return e.parse(t),e}doUpdateParameters(t,e,i,s){for(let n=0;n<this._parameters.length;++n){const a=this._parameters[n];switch(a.blendType){case 0:{t.addParameterValueById(a.parameterId,a.value,i);break}case 1:{t.multiplyParameterValueById(a.parameterId,a.value,i);break}case 2:{t.setParameterValueById(a.parameterId,a.value,i);break}}}}parse(t){this.setFadeInTime(t.FadeInTime!=null?t.FadeInTime:Ku),this.setFadeOutTime(t.FadeOutTime!=null?t.FadeOutTime:Ku);const e=(t.Parameters||[]).length;for(let i=0;i<e;++i){const s=t.Parameters[i],n=s.Id,a=s.Value;let o;!s.Blend||s.Blend===\"Add\"?o=0:s.Blend===\"Multiply\"?o=1:s.Blend===\"Overwrite\"?o=2:o=0;const h={parameterId:n,blendType:o,value:a};this._parameters.push(h)}}constructor(){super(),this._parameters=[]}}var Un;(r=>{r.supportMoreMaskDivisions=!0,r.setOpacityFromMotion=!1})(Un||(Un={}));var Ee=(r=>(r[r.CubismMotionCurveTarget_Model=0]=\"CubismMotionCurveTarget_Model\",r[r.CubismMotionCurveTarget_Parameter=1]=\"CubismMotionCurveTarget_Parameter\",r[r.CubismMotionCurveTarget_PartOpacity=2]=\"CubismMotionCurveTarget_PartOpacity\",r))(Ee||{}),Ce=(r=>(r[r.CubismMotionSegmentType_Linear=0]=\"CubismMotionSegmentType_Linear\",r[r.CubismMotionSegmentType_Bezier=1]=\"CubismMotionSegmentType_Bezier\",r[r.CubismMotionSegmentType_Stepped=2]=\"CubismMotionSegmentType_Stepped\",r[r.CubismMotionSegmentType_InverseStepped=3]=\"CubismMotionSegmentType_InverseStepped\",r))(Ce||{});class Je{constructor(t=0,e=0){this.time=t,this.value=e}}class nb{constructor(){this.basePointIndex=0,this.segmentType=0}}class ab{constructor(){this.id=\"\",this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class ob{constructor(){this.fireTime=0,this.value=\"\"}}class hb{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=[],this.segments=[],this.points=[],this.events=[]}}class Cp{constructor(t){this._json=t}release(){this._json=void 0}getMotionDuration(){return this._json.Meta.Duration}isMotionLoop(){return this._json.Meta.Loop||!1}getEvaluationOptionFlag(t){return t==0?!!this._json.Meta.AreBeziersRestricted:!1}getMotionCurveCount(){return this._json.Meta.CurveCount}getMotionFps(){return this._json.Meta.Fps}getMotionTotalSegmentCount(){return this._json.Meta.TotalSegmentCount}getMotionTotalPointCount(){return this._json.Meta.TotalPointCount}getMotionFadeInTime(){return this._json.Meta.FadeInTime}getMotionFadeOutTime(){return this._json.Meta.FadeOutTime}getMotionCurveTarget(t){return this._json.Curves[t].Target}getMotionCurveId(t){return this._json.Curves[t].Id}getMotionCurveFadeInTime(t){return this._json.Curves[t].FadeInTime}getMotionCurveFadeOutTime(t){return this._json.Curves[t].FadeOutTime}getMotionCurveSegmentCount(t){return this._json.Curves[t].Segments.length}getMotionCurveSegment(t,e){return this._json.Curves[t].Segments[e]}getEventCount(){return this._json.Meta.UserDataCount||0}getTotalEventValueSize(){return this._json.Meta.TotalUserDataSize}getEventTime(t){return this._json.UserData[t].Time}getEventValue(t){return this._json.UserData[t].Value}}var Sp=(r=>(r[r.EvaluationOptionFlag_AreBeziersRistricted=0]=\"EvaluationOptionFlag_AreBeziersRistricted\",r))(Sp||{});const lb=\"EyeBlink\",ub=\"LipSync\",cb=\"Model\",db=\"Parameter\",fb=\"PartOpacity\",Ys=\"Opacity\",pb=!1;function qt(r,t,e){const i=new Je;return i.time=r.time+(t.time-r.time)*e,i.value=r.value+(t.value-r.value)*e,i}function mb(r,t){let e=(t-r[0].time)/(r[1].time-r[0].time);return e<0&&(e=0),r[0].value+(r[1].value-r[0].value)*e}function gb(r,t){let e=(t-r[0].time)/(r[3].time-r[0].time);e<0&&(e=0);const i=qt(r[0],r[1],e),s=qt(r[1],r[2],e),n=qt(r[2],r[3],e),a=qt(i,s,e),o=qt(s,n,e);return qt(a,o,e).value}function _b(r,t){const e=t,i=r[0].time,s=r[3].time,n=r[1].time,a=r[2].time,o=s-3*a+3*n-i,h=3*a-6*n+3*i,l=3*n-3*i,u=i-e,c=Q.cardanoAlgorithmForBezier(o,h,l,u),d=qt(r[0],r[1],c),f=qt(r[1],r[2],c),p=qt(r[2],r[3],c),m=qt(d,f,c),g=qt(f,p,c);return qt(m,g,c).value}function yb(r,t){return r[0].value}function vb(r,t){return r[1].value}function Ja(r,t,e){const i=r.curves[t];let s=-1;const n=i.baseSegmentIndex+i.segmentCount;let a=0;for(let h=i.baseSegmentIndex;h<n;++h)if(a=r.segments[h].basePointIndex+(r.segments[h].segmentType==Ce.CubismMotionSegmentType_Bezier?3:1),r.points[a].time>e){s=h;break}if(s==-1)return r.points[a].value;const o=r.segments[s];return o.evaluate(r.points.slice(o.basePointIndex),e)}class ul extends Ep{constructor(){super(),this._eyeBlinkParameterIds=[],this._lipSyncParameterIds=[],this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._modelOpacity=1}static create(t,e){const i=new ul;return i.parse(t),i._sourceFrameRate=i._motionData.fps,i._loopDurationSeconds=i._motionData.duration,i._onFinishedMotion=e,i}doUpdateParameters(t,e,i,s){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=lb),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=ub),this._modelCurveIdOpacity==null&&(this._modelCurveIdOpacity=Ys);let n=e-s.getStartTime();n<0&&(n=0);let a=Number.MAX_VALUE,o=Number.MAX_VALUE;const h=64;let l=0,u=0;this._eyeBlinkParameterIds.length>h&&ju(\"too many eye blink targets : {0}\",this._eyeBlinkParameterIds.length),this._lipSyncParameterIds.length>h&&ju(\"too many lip sync targets : {0}\",this._lipSyncParameterIds.length);const c=this._fadeInSeconds<=0?1:Q.getEasingSine((e-s.getFadeInStartTime())/this._fadeInSeconds),d=this._fadeOutSeconds<=0||s.getEndTime()<0?1:Q.getEasingSine((s.getEndTime()-e)/this._fadeOutSeconds);let f,p,m,g=n;if(this._isLoop)for(;g>this._motionData.duration;)g-=this._motionData.duration;const y=this._motionData.curves;for(p=0;p<this._motionData.curveCount&&y[p].type==Ee.CubismMotionCurveTarget_Model;++p)f=Ja(this._motionData,p,g),y[p].id==this._modelCurveIdEyeBlink?o=f:y[p].id==this._modelCurveIdLipSync?a=f:y[p].id==this._modelCurveIdOpacity&&(this._modelOpacity=f,t.setModelOapcity(this.getModelOpacityValue()));for(;p<this._motionData.curveCount&&y[p].type==Ee.CubismMotionCurveTarget_Parameter;++p){if(m=t.getParameterIndex(y[p].id),m==-1)continue;const x=t.getParameterValueByIndex(m);if(f=Ja(this._motionData,p,g),o!=Number.MAX_VALUE){for(let v=0;v<this._eyeBlinkParameterIds.length&&v<h;++v)if(this._eyeBlinkParameterIds[v]==y[p].id){f*=o,u|=1<<v;break}}if(a!=Number.MAX_VALUE){for(let v=0;v<this._lipSyncParameterIds.length&&v<h;++v)if(this._lipSyncParameterIds[v]==y[p].id){f+=a,l|=1<<v;break}}let _;if(y[p].fadeInTime<0&&y[p].fadeOutTime<0)_=x+(f-x)*i;else{let v,T;y[p].fadeInTime<0?v=c:v=y[p].fadeInTime==0?1:Q.getEasingSine((e-s.getFadeInStartTime())/y[p].fadeInTime),y[p].fadeOutTime<0?T=d:T=y[p].fadeOutTime==0||s.getEndTime()<0?1:Q.getEasingSine((s.getEndTime()-e)/y[p].fadeOutTime);const S=this._weight*v*T;_=x+(f-x)*S}t.setParameterValueByIndex(m,_,1)}{if(o!=Number.MAX_VALUE)for(let x=0;x<this._eyeBlinkParameterIds.length&&x<h;++x){const _=t.getParameterValueById(this._eyeBlinkParameterIds[x]);if(u>>x&1)continue;const v=_+(o-_)*i;t.setParameterValueById(this._eyeBlinkParameterIds[x],v)}if(a!=Number.MAX_VALUE)for(let x=0;x<this._lipSyncParameterIds.length&&x<h;++x){const _=t.getParameterValueById(this._lipSyncParameterIds[x]);if(l>>x&1)continue;const v=_+(a-_)*i;t.setParameterValueById(this._lipSyncParameterIds[x],v)}}for(;p<this._motionData.curveCount&&y[p].type==Ee.CubismMotionCurveTarget_PartOpacity;++p)if(f=Ja(this._motionData,p,g),Un.setOpacityFromMotion)t.setPartOpacityById(y[p].id,f);else{if(m=t.getParameterIndex(y[p].id),m==-1)continue;t.setParameterValueByIndex(m,f)}n>=this._motionData.duration&&(this._isLoop?(s.setStartTime(e),this._isLoopFadeIn&&s.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),s.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i[s].id){i[s].fadeInTime=e;return}}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i[s].id){i[s].fadeOutTime=e;return}}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e[i].id)return e[i].fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e[i].id)return e[i].fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}release(){this._motionData=void 0}parse(t){this._motionData=new hb;const e=new Cp(t);this._motionData.duration=e.getMotionDuration(),this._motionData.loop=e.isMotionLoop(),this._motionData.curveCount=e.getMotionCurveCount(),this._motionData.fps=e.getMotionFps(),this._motionData.eventCount=e.getEventCount();const i=e.getEvaluationOptionFlag(Sp.EvaluationOptionFlag_AreBeziersRistricted),s=e.getMotionFadeInTime(),n=e.getMotionFadeOutTime();s!==void 0?this._fadeInSeconds=s<0?1:s:this._fadeInSeconds=1,n!==void 0?this._fadeOutSeconds=n<0?1:n:this._fadeOutSeconds=1,this._motionData.curves=Array.from({length:this._motionData.curveCount}).map(()=>new ab),this._motionData.segments=Array.from({length:e.getMotionTotalSegmentCount()}).map(()=>new nb),this._motionData.events=Array.from({length:this._motionData.eventCount}).map(()=>new ob),this._motionData.points=[];let a=0,o=0;for(let h=0;h<this._motionData.curveCount;++h){const l=this._motionData.curves[h];switch(e.getMotionCurveTarget(h)){case cb:l.type=Ee.CubismMotionCurveTarget_Model;break;case db:l.type=Ee.CubismMotionCurveTarget_Parameter;break;case fb:l.type=Ee.CubismMotionCurveTarget_PartOpacity;break;default:Si('Warning : Unable to get segment type from Curve! The number of \"CurveCount\" may be incorrect!')}l.id=e.getMotionCurveId(h),l.baseSegmentIndex=o;const u=e.getMotionCurveFadeInTime(h),c=e.getMotionCurveFadeOutTime(h);l.fadeInTime=u!==void 0?u:-1,l.fadeOutTime=c!==void 0?c:-1;for(let d=0;d<e.getMotionCurveSegmentCount(h);){switch(d==0?(this._motionData.segments[o].basePointIndex=a,this._motionData.points[a]=new Je(e.getMotionCurveSegment(h,d),e.getMotionCurveSegment(h,d+1)),a+=1,d+=2):this._motionData.segments[o].basePointIndex=a-1,e.getMotionCurveSegment(h,d)){case Ce.CubismMotionSegmentType_Linear:{this._motionData.segments[o].segmentType=Ce.CubismMotionSegmentType_Linear,this._motionData.segments[o].evaluate=mb,this._motionData.points[a]=new Je(e.getMotionCurveSegment(h,d+1),e.getMotionCurveSegment(h,d+2)),a+=1,d+=3;break}case Ce.CubismMotionSegmentType_Bezier:{this._motionData.segments[o].segmentType=Ce.CubismMotionSegmentType_Bezier,i||pb?this._motionData.segments[o].evaluate=gb:this._motionData.segments[o].evaluate=_b,this._motionData.points[a]=new Je(e.getMotionCurveSegment(h,d+1),e.getMotionCurveSegment(h,d+2)),this._motionData.points[a+1]=new Je(e.getMotionCurveSegment(h,d+3),e.getMotionCurveSegment(h,d+4)),this._motionData.points[a+2]=new Je(e.getMotionCurveSegment(h,d+5),e.getMotionCurveSegment(h,d+6)),a+=3,d+=7;break}case Ce.CubismMotionSegmentType_Stepped:{this._motionData.segments[o].segmentType=Ce.CubismMotionSegmentType_Stepped,this._motionData.segments[o].evaluate=yb,this._motionData.points[a]=new Je(e.getMotionCurveSegment(h,d+1),e.getMotionCurveSegment(h,d+2)),a+=1,d+=3;break}case Ce.CubismMotionSegmentType_InverseStepped:{this._motionData.segments[o].segmentType=Ce.CubismMotionSegmentType_InverseStepped,this._motionData.segments[o].evaluate=vb,this._motionData.points[a]=new Je(e.getMotionCurveSegment(h,d+1),e.getMotionCurveSegment(h,d+2)),a+=1,d+=3;break}default:{Ji(0);break}}++l.segmentCount,++o}this._motionData.curves.push(l)}for(let h=0;h<e.getEventCount();++h)this._motionData.events[h].fireTime=e.getEventTime(h),this._motionData.events[h].value=e.getEventValue(h);e.release()}getFiredEvent(t,e){this._firedEventValues.length=0;for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events[i].fireTime>t&&this._motionData.events[i].fireTime<=e&&this._firedEventValues.push(this._motionData.events[i].value);return this._firedEventValues}isExistModelOpacity(){for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves[t];if(e.type==Ee.CubismMotionCurveTarget_Model&&e.id===Ys)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves[t];if(e.type==Ee.CubismMotionCurveTarget_Model&&e.id===Ys)return t}return-1}getModelOpacityId(t){if(t!=-1){const e=this._motionData.curves[t];if(e.type==Ee.CubismMotionCurveTarget_Model&&e.id===Ys)return e.id}}getModelOpacityValue(){return this._modelOpacity}}class xb{constructor(){this._autoDelete=!1,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&this._motion.release()}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}class Ap{constructor(){this._userTimeSeconds=0,this._eventCustomData=null,this._motions=[]}release(){for(let t=0;t<this._motions.length;++t)this._motions[t]&&this._motions[t].release();this._motions=void 0}startMotion(t,e,i){if(t==null)return bb;let s;for(let n=0;n<this._motions.length;++n)s=this._motions[n],s?.setFadeOut(s._motion.getFadeOutTime());return s=new xb,s._autoDelete=e,s._motion=t,this._motions.push(s),s._motionQueueEntryHandle}isFinished(){let t=0;for(;t<this._motions.length;){const e=this._motions[t];if(e==null){this._motions.splice(t,1);continue}if(e._motion==null){e.release(),this._motions.splice(t,1);continue}if(!e.isFinished())return!1;t++}return!0}isFinishedByHandle(t){for(let e=0;e<this._motions.length;e++){const i=this._motions[e];if(i!=null&&i._motionQueueEntryHandle==t&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=0;t<this._motions.length;t++){const e=this._motions[t];e?.release()}this._motions=[]}getCubismMotionQueueEntry(t){return this._motions.find(e=>e!=null&&e._motionQueueEntryHandle==t)}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1,s=0;for(;s<this._motions.length;){const n=this._motions[s];if(n==null){this._motions.splice(s,1);continue}const a=n._motion;if(a==null){n.release(),this._motions.splice(s,1);continue}a.updateParameters(t,n,e),i=!0;const o=a.getFiredEvent(n.getLastCheckEventSeconds()-n.getStartTime(),e-n.getStartTime());for(let h=0;h<o.length;++h)this._eventCallBack(this,o[h],this._eventCustomData);n.setLastCheckEventSeconds(e),n.isFinished()?(n.release(),this._motions.splice(s,1)):(n.isTriggeredFadeOut()&&n.startFadeOut(n.getFadeOutSeconds(),e),s++)}return i}}const bb=-1;var eh=(r=>(r[r.CubismPhysicsTargetType_Parameter=0]=\"CubismPhysicsTargetType_Parameter\",r))(eh||{}),Ti=(r=>(r[r.CubismPhysicsSource_X=0]=\"CubismPhysicsSource_X\",r[r.CubismPhysicsSource_Y=1]=\"CubismPhysicsSource_Y\",r[r.CubismPhysicsSource_Angle=2]=\"CubismPhysicsSource_Angle\",r))(Ti||{});class Tb{constructor(){this.initialPosition=new X(0,0),this.position=new X(0,0),this.lastPosition=new X(0,0),this.lastGravity=new X(0,0),this.force=new X(0,0),this.velocity=new X(0,0)}}class wb{constructor(){this.normalizationPosition={},this.normalizationAngle={}}}class Eb{constructor(){this.source={}}}class Cb{constructor(){this.destination={},this.translationScale=new X(0,0)}}class Sb{constructor(){this.settings=[],this.inputs=[],this.outputs=[],this.particles=[],this.gravity=new X(0,0),this.wind=new X(0,0),this.fps=0}}class Ab{constructor(t){this._json=t}release(){this._json=void 0}getGravity(){const t=new X(0,0);return t.x=this._json.Meta.EffectiveForces.Gravity.X,t.y=this._json.Meta.EffectiveForces.Gravity.Y,t}getWind(){const t=new X(0,0);return t.x=this._json.Meta.EffectiveForces.Wind.X,t.y=this._json.Meta.EffectiveForces.Wind.Y,t}getFps(){return this._json.Meta.Fps||0}getSubRigCount(){return this._json.Meta.PhysicsSettingCount}getTotalInputCount(){return this._json.Meta.TotalInputCount}getTotalOutputCount(){return this._json.Meta.TotalOutputCount}getVertexCount(){return this._json.Meta.VertexCount}getNormalizationPositionMinimumValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Minimum}getNormalizationPositionMaximumValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Maximum}getNormalizationPositionDefaultValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Default}getNormalizationAngleMinimumValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Minimum}getNormalizationAngleMaximumValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Maximum}getNormalizationAngleDefaultValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Default}getInputCount(t){return this._json.PhysicsSettings[t].Input.length}getInputWeight(t,e){return this._json.PhysicsSettings[t].Input[e].Weight}getInputReflect(t,e){return this._json.PhysicsSettings[t].Input[e].Reflect}getInputType(t,e){return this._json.PhysicsSettings[t].Input[e].Type}getInputSourceId(t,e){return this._json.PhysicsSettings[t].Input[e].Source.Id}getOutputCount(t){return this._json.PhysicsSettings[t].Output.length}getOutputVertexIndex(t,e){return this._json.PhysicsSettings[t].Output[e].VertexIndex}getOutputAngleScale(t,e){return this._json.PhysicsSettings[t].Output[e].Scale}getOutputWeight(t,e){return this._json.PhysicsSettings[t].Output[e].Weight}getOutputDestinationId(t,e){return this._json.PhysicsSettings[t].Output[e].Destination.Id}getOutputType(t,e){return this._json.PhysicsSettings[t].Output[e].Type}getOutputReflect(t,e){return this._json.PhysicsSettings[t].Output[e].Reflect}getParticleCount(t){return this._json.PhysicsSettings[t].Vertices.length}getParticleMobility(t,e){return this._json.PhysicsSettings[t].Vertices[e].Mobility}getParticleDelay(t,e){return this._json.PhysicsSettings[t].Vertices[e].Delay}getParticleAcceleration(t,e){return this._json.PhysicsSettings[t].Vertices[e].Acceleration}getParticleRadius(t,e){return this._json.PhysicsSettings[t].Vertices[e].Radius}getParticlePosition(t,e){const i=new X(0,0);return i.x=this._json.PhysicsSettings[t].Vertices[e].Position.X,i.y=this._json.PhysicsSettings[t].Vertices[e].Position.Y,i}}const Zu=\"X\",Ju=\"Y\",Qu=\"Angle\",Pb=5,ih=100,tc=.001,Mb=5;class cl{static create(t){const e=new cl;return e.parse(t),e._physicsRig.gravity.y=0,e}static delete(t){t?.release()}parse(t){this._physicsRig=new Sb;const e=new Ab(t);this._physicsRig.gravity=e.getGravity(),this._physicsRig.wind=e.getWind(),this._physicsRig.subRigCount=e.getSubRigCount(),this._physicsRig.fps=e.getFps(),this._currentRigOutputs=[],this._previousRigOutputs=[];let i=0,s=0,n=0;for(let a=0;a<this._physicsRig.subRigCount;++a){const o=new wb;o.normalizationPosition.minimum=e.getNormalizationPositionMinimumValue(a),o.normalizationPosition.maximum=e.getNormalizationPositionMaximumValue(a),o.normalizationPosition.defalut=e.getNormalizationPositionDefaultValue(a),o.normalizationAngle.minimum=e.getNormalizationAngleMinimumValue(a),o.normalizationAngle.maximum=e.getNormalizationAngleMaximumValue(a),o.normalizationAngle.defalut=e.getNormalizationAngleDefaultValue(a),o.inputCount=e.getInputCount(a),o.baseInputIndex=i,i+=o.inputCount;for(let u=0;u<o.inputCount;++u){const c=new Eb;switch(c.sourceParameterIndex=-1,c.weight=e.getInputWeight(a,u),c.reflect=e.getInputReflect(a,u),e.getInputType(a,u)){case Zu:c.type=Ti.CubismPhysicsSource_X,c.getNormalizedParameterValue=Rb;break;case Ju:c.type=Ti.CubismPhysicsSource_Y,c.getNormalizedParameterValue=Db;break;case Qu:c.type=Ti.CubismPhysicsSource_Angle,c.getNormalizedParameterValue=Fb;break}c.source.targetType=eh.CubismPhysicsTargetType_Parameter,c.source.id=e.getInputSourceId(a,u),this._physicsRig.inputs.push(c)}o.outputCount=e.getOutputCount(a),o.baseOutputIndex=s;const h=new ec,l=new ec;for(let u=0;u<o.outputCount;++u){h.outputs[u]=0,l.outputs[u]=0;let c=this._physicsRig.outputs[s+u];switch(c||(c=new Cb,this._physicsRig.outputs[s+u]=c),c.destinationParameterIndex=-1,c.vertexIndex=e.getOutputVertexIndex(a,u),c.angleScale=e.getOutputAngleScale(a,u),c.weight=e.getOutputWeight(a,u),c.destination.targetType=eh.CubismPhysicsTargetType_Parameter,c.destination.id=e.getOutputDestinationId(a,u),e.getOutputType(a,u)){case Zu:c.type=Ti.CubismPhysicsSource_X,c.getValue=Bb,c.getScale=kb;break;case Ju:c.type=Ti.CubismPhysicsSource_Y,c.getValue=Lb,c.getScale=Gb;break;case Qu:c.type=Ti.CubismPhysicsSource_Angle,c.getValue=Ob,c.getScale=Vb;break}c.reflect=e.getOutputReflect(a,u)}this._currentRigOutputs.push(h),this._previousRigOutputs.push(l),s+=o.outputCount,o.particleCount=e.getParticleCount(a),o.baseParticleIndex=n,n+=o.particleCount;for(let u=0;u<o.particleCount;++u){const c=new Tb;c.mobility=e.getParticleMobility(a,u),c.delay=e.getParticleDelay(a,u),c.acceleration=e.getParticleAcceleration(a,u),c.radius=e.getParticleRadius(a,u),c.position=e.getParticlePosition(a,u),this._physicsRig.particles.push(c)}this._physicsRig.settings.push(o)}this.initialize(),e.release()}stabilization(t){var e,i,s,n;let a,o,h,l;const u=new X;let c,d,f,p,m,g,y,x;m=t.getModel().parameters.values,g=t.getModel().parameters.maximumValues,y=t.getModel().parameters.minimumValues,x=t.getModel().parameters.defaultValues,((i=(e=this._parameterCaches)==null?void 0:e.length)!=null?i:0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),((n=(s=this._parameterInputCaches)==null?void 0:s.length)!=null?n:0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let _=0;_<t.getParameterCount();++_)this._parameterCaches[_]=m[_],this._parameterInputCaches[_]=m[_];for(let _=0;_<this._physicsRig.subRigCount;++_){a={angle:0},u.x=0,u.y=0,c=this._physicsRig.settings[_],d=this._physicsRig.inputs.slice(c.baseInputIndex),f=this._physicsRig.outputs.slice(c.baseOutputIndex),p=this._physicsRig.particles.slice(c.baseParticleIndex);for(let v=0;v<c.inputCount;++v)o=d[v].weight/ih,d[v].sourceParameterIndex==-1&&(d[v].sourceParameterIndex=t.getParameterIndex(d[v].source.id)),d[v].getNormalizedParameterValue(u,a,m[d[v].sourceParameterIndex],y[d[v].sourceParameterIndex],g[d[v].sourceParameterIndex],x[d[v].sourceParameterIndex],c.normalizationPosition,c.normalizationAngle,d[v].reflect,o),this._parameterCaches[d[v].sourceParameterIndex]=m[d[v].sourceParameterIndex];h=Q.degreesToRadian(-a.angle),u.x=u.x*Q.cos(h)-u.y*Q.sin(h),u.y=u.x*Q.sin(h)+u.y*Q.cos(h),Xb(p,c.particleCount,u,a.angle,this._options.wind,tc*c.normalizationPosition.maximum);for(let v=0;v<c.outputCount;++v){const T=f[v].vertexIndex;if(f[v].destinationParameterIndex==-1&&(f[v].destinationParameterIndex=t.getParameterIndex(f[v].destination.id)),T<1||T>=c.particleCount)continue;let S=new X;S=p[T].position.substract(p[T-1].position),l=f[v].getValue(S,p,T,f[v].reflect,this._options.gravity),this._currentRigOutputs[_].outputs[v]=l,this._previousRigOutputs[_].outputs[v]=l;const w=f[v].destinationParameterIndex,b=!Float32Array.prototype.slice&&\"subarray\"in Float32Array.prototype?JSON.parse(JSON.stringify(m.subarray(w))):m.slice(w);Qa(b,y[w],g[w],l,f[v]);for(let R=w,L=0;R<this._parameterCaches.length;R++,L++)m[R]=this._parameterCaches[R]=b[L]}}}evaluate(t,e){var i,s,n,a;let o,h,l,u;const c=new X;let d,f,p,m;if(0>=e)return;let g,y,x,_,v;if(this._currentRemainTime+=e,this._currentRemainTime>Mb&&(this._currentRemainTime=0),g=t.getModel().parameters.values,y=t.getModel().parameters.maximumValues,x=t.getModel().parameters.minimumValues,_=t.getModel().parameters.defaultValues,((s=(i=this._parameterCaches)==null?void 0:i.length)!=null?s:0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),((a=(n=this._parameterInputCaches)==null?void 0:n.length)!=null?a:0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let S=0;S<t.getParameterCount();++S)this._parameterInputCaches[S]=g[S]}for(this._physicsRig.fps>0?v=1/this._physicsRig.fps:v=e;this._currentRemainTime>=v;){for(let w=0;w<this._physicsRig.subRigCount;++w){d=this._physicsRig.settings[w],p=this._physicsRig.outputs.slice(d.baseOutputIndex);for(let b=0;b<d.outputCount;++b)this._previousRigOutputs[w].outputs[b]=this._currentRigOutputs[w].outputs[b]}const S=v/this._currentRemainTime;for(let w=0;w<t.getParameterCount();++w)this._parameterCaches[w]=this._parameterInputCaches[w]*(1-S)+g[w]*S,this._parameterInputCaches[w]=this._parameterCaches[w];for(let w=0;w<this._physicsRig.subRigCount;++w){o={angle:0},c.x=0,c.y=0,d=this._physicsRig.settings[w],f=this._physicsRig.inputs.slice(d.baseInputIndex),p=this._physicsRig.outputs.slice(d.baseOutputIndex),m=this._physicsRig.particles.slice(d.baseParticleIndex);for(let b=0;b<d.inputCount;++b)h=f[b].weight/ih,f[b].sourceParameterIndex==-1&&(f[b].sourceParameterIndex=t.getParameterIndex(f[b].source.id)),f[b].getNormalizedParameterValue(c,o,this._parameterCaches[f[b].sourceParameterIndex],x[f[b].sourceParameterIndex],y[f[b].sourceParameterIndex],_[f[b].sourceParameterIndex],d.normalizationPosition,d.normalizationAngle,f[b].reflect,h);l=Q.degreesToRadian(-o.angle),c.x=c.x*Q.cos(l)-c.y*Q.sin(l),c.y=c.x*Q.sin(l)+c.y*Q.cos(l),Hb(m,d.particleCount,c,o.angle,this._options.wind,tc*d.normalizationPosition.maximum,v,Pb);for(let b=0;b<d.outputCount;++b){const R=p[b].vertexIndex;if(p[b].destinationParameterIndex==-1&&(p[b].destinationParameterIndex=t.getParameterIndex(p[b].destination.id)),R<1||R>=d.particleCount)continue;const L=new X;L.x=m[R].position.x-m[R-1].position.x,L.y=m[R].position.y-m[R-1].position.y,u=p[b].getValue(L,m,R,p[b].reflect,this._options.gravity),this._currentRigOutputs[w].outputs[b]=u;const I=p[b].destinationParameterIndex,D=!Float32Array.prototype.slice&&\"subarray\"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(I))):this._parameterCaches.slice(I);Qa(D,x[I],y[I],u,p[b]);for(let C=I,A=0;C<this._parameterCaches.length;C++,A++)this._parameterCaches[C]=D[A]}}this._currentRemainTime-=v}const T=this._currentRemainTime/v;this.interpolate(t,T)}interpolate(t,e){let i,s,n,a,o;n=t.getModel().parameters.values,a=t.getModel().parameters.maximumValues,o=t.getModel().parameters.minimumValues;for(let h=0;h<this._physicsRig.subRigCount;++h){s=this._physicsRig.settings[h],i=this._physicsRig.outputs.slice(s.baseOutputIndex);for(let l=0;l<s.outputCount;++l){if(i[l].destinationParameterIndex==-1)continue;const u=i[l].destinationParameterIndex,c=!Float32Array.prototype.slice&&\"subarray\"in Float32Array.prototype?JSON.parse(JSON.stringify(n.subarray(u))):n.slice(u);Qa(c,o[u],a[u],this._previousRigOutputs[h].outputs[l]*(1-e)+this._currentRigOutputs[h].outputs[l]*e,i[l]);for(let d=u,f=0;d<n.length;d++,f++)n[d]=c[f]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._options=new Ib,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=[],this._previousRigOutputs=[],this._currentRemainTime=0}release(){this._physicsRig=void 0}initialize(){let t,e,i;for(let s=0;s<this._physicsRig.subRigCount;++s){e=this._physicsRig.settings[s],t=this._physicsRig.particles.slice(e.baseParticleIndex),t[0].initialPosition=new X(0,0),t[0].lastPosition=new X(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new X(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new X(0,0),t[0].force=new X(0,0);for(let n=1;n<e.particleCount;++n)i=new X(0,0),i.y=t[n].radius,t[n].initialPosition=new X(t[n-1].initialPosition.x+i.x,t[n-1].initialPosition.y+i.y),t[n].position=new X(t[n].initialPosition.x,t[n].initialPosition.y),t[n].lastPosition=new X(t[n].initialPosition.x,t[n].initialPosition.y),t[n].lastGravity=new X(0,-1),t[n].lastGravity.y*=-1,t[n].velocity=new X(0,0),t[n].force=new X(0,0)}}}class Ib{constructor(){this.gravity=new X(0,0),this.wind=new X(0,0)}}class ec{constructor(){this.outputs=[]}}function Rb(r,t,e,i,s,n,a,o,h,l){r.x+=dl(e,i,s,n,a.minimum,a.maximum,a.defalut,h)*l}function Db(r,t,e,i,s,n,a,o,h,l){r.y+=dl(e,i,s,n,a.minimum,a.maximum,a.defalut,h)*l}function Fb(r,t,e,i,s,n,a,o,h,l){t.angle+=dl(e,i,s,n,o.minimum,o.maximum,o.defalut,h)*l}function Bb(r,t,e,i,s){let n=r.x;return i&&(n*=-1),n}function Lb(r,t,e,i,s){let n=r.y;return i&&(n*=-1),n}function Ob(r,t,e,i,s){let n;return e>=2?s=t[e-1].position.substract(t[e-2].position):s=s.multiplyByScaler(-1),n=Q.directionToRadian(s,r),i&&(n*=-1),n}function Nb(r,t){return Math.abs(Math.max(r,t)-Math.min(r,t))}function Ub(r,t){return Math.min(r,t)+Nb(r,t)/2}function kb(r,t){return r.x}function Gb(r,t){return r.y}function Vb(r,t){return t}function Hb(r,t,e,i,s,n,a,o){let h,l,u,c,d=new X(0,0),f=new X(0,0),p=new X(0,0),m=new X(0,0);r[0].position=new X(e.x,e.y),h=Q.degreesToRadian(i),c=Q.radianToDirection(h),c.normalize();for(let g=1;g<t;++g)r[g].force=c.multiplyByScaler(r[g].acceleration).add(s),r[g].lastPosition=new X(r[g].position.x,r[g].position.y),l=r[g].delay*a*30,d=r[g].position.substract(r[g-1].position),u=Q.directionToRadian(r[g].lastGravity,c)/o,d.x=Q.cos(u)*d.x-d.y*Q.sin(u),d.y=Q.sin(u)*d.x+d.y*Q.cos(u),r[g].position=r[g-1].position.add(d),f=r[g].velocity.multiplyByScaler(l),p=r[g].force.multiplyByScaler(l).multiplyByScaler(l),r[g].position=r[g].position.add(f).add(p),m=r[g].position.substract(r[g-1].position),m.normalize(),r[g].position=r[g-1].position.add(m.multiplyByScaler(r[g].radius)),Q.abs(r[g].position.x)<n&&(r[g].position.x=0),l!=0&&(r[g].velocity=r[g].position.substract(r[g].lastPosition),r[g].velocity=r[g].velocity.divisionByScalar(l),r[g].velocity=r[g].velocity.multiplyByScaler(r[g].mobility)),r[g].force=new X(0,0),r[g].lastGravity=new X(c.x,c.y)}function Xb(r,t,e,i,s,n){let a,o,h=new X(0,0);r[0].position=new X(e.x,e.y),a=Q.degreesToRadian(i),o=Q.radianToDirection(a),o.normalize();for(let l=1;l<t;++l)r[l].force=o.multiplyByScaler(r[l].acceleration).add(s),r[l].lastPosition=new X(r[l].position.x,r[l].position.y),r[l].velocity=new X(0,0),h=r[l].force,h.normalize(),h=h.multiplyByScaler(r[l].radius),r[l].position=r[l-1].position.add(h),Q.abs(r[l].position.x)<n&&(r[l].position.x=0),r[l].force=new X(0,0),r[l].lastGravity=new X(o.x,o.y)}function Qa(r,t,e,i,s){let n,a,o;n=s.getScale(s.translationScale,s.angleScale),a=i*n,a<t?(a<s.valueBelowMinimum&&(s.valueBelowMinimum=a),a=t):a>e&&(a>s.valueExceededMaximum&&(s.valueExceededMaximum=a),a=e),o=s.weight/ih,o>=1||(a=r[0]*(1-o)+a*o),r[0]=a}function dl(r,t,e,i,s,n,a,o){let h=0;const l=Q.max(e,t);l<r&&(r=l);const u=Q.min(e,t);u>r&&(r=u);const c=Q.min(s,n),d=Q.max(s,n),f=a,p=Ub(u,l),m=r-p;switch(Math.sign(m)){case 1:{const g=d-f,y=l-p;y!=0&&(h=m*(g/y),h+=f);break}case-1:{const g=c-f,y=u-p;y!=0&&(h=m*(g/y),h+=f);break}case 0:{h=f;break}}return o?h:h*-1}class rh{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}}const qs=4,$b=36,zb=32,Wb=10;let _i,ke,kn;class ic{getChannelFlagAsColor(t){return this._channelColors[t]}getMaskRenderTexture(){if(this._maskTexture&&this._maskTexture.textures!=null)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures=[],this._maskColorBuffers=[];const t=this._clippingMaskBufferSize;for(let e=0;e<this._renderTextureCount;e++)this._maskColorBuffers.push(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers[e]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.push(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures[e]),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers[e],0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,kn),this._maskTexture=new jb(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,s=Number.MAX_VALUE,n=Number.MIN_VALUE,a=Number.MIN_VALUE;const o=e._clippedDrawableIndexList.length;for(let h=0;h<o;h++){const l=e._clippedDrawableIndexList[h],u=t.getDrawableVertexCount(l),c=t.getDrawableVertices(l);let d=Number.MAX_VALUE,f=Number.MAX_VALUE,p=-Number.MAX_VALUE,m=-Number.MAX_VALUE;const g=u*Za.vertexStep;for(let y=Za.vertexOffset;y<g;y+=Za.vertexStep){const x=c[y],_=c[y+1];x<d&&(d=x),x>p&&(p=x),_<f&&(f=_),_>m&&(m=_)}if(d!=Number.MAX_VALUE)if(d<i&&(i=d),f<s&&(s=f),p>n&&(n=p),m>a&&(a=m),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const y=n-i,x=a-s;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=s,e._allClippedDrawRect.width=y,e._allClippedDrawRect.height=x}}}constructor(){this._currentMaskRenderTexture=null,this._currentFrameNo=0,this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=[],this._clippingContextListForDraw=[],this._channelColors=[],this._tmpBoundsOnModel=new rh,this._tmpMatrix=new Jt,this._tmpMatrixForMask=new Jt,this._tmpMatrixForDraw=new Jt;let t=new $t;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.push(t),t=new $t,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.push(t),t=new $t,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.push(t),t=new $t,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.push(t)}release(){var t;const e=this;for(let i=0;i<this._clippingContextListForMask.length;i++)this._clippingContextListForMask[i]&&((t=this._clippingContextListForMask[i])==null||t.release());if(e._clippingContextListForMask=void 0,e._clippingContextListForDraw=void 0,this._maskTexture){for(let i=0;i<this._maskTexture.textures.length;i++)this.gl.deleteFramebuffer(this._maskTexture.textures[i]);this._maskTexture=void 0}if(e._channelColors=void 0,this._maskColorBuffers)for(let i=0;i<this._maskColorBuffers.length;i++)this.gl.deleteTexture(this._maskColorBuffers[i]);this._maskColorBuffers=void 0,this._maskRenderTextures=void 0,this._clearedFrameBufferflags=void 0}initialize(t,e,i,s,n){n%1!=0&&(Si(\"The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer.\"),n=~~n),n<1&&Si(\"The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1.\"),this._renderTextureCount=n<1?1:n,this._clearedFrameBufferflags=[];for(let a=0;a<e;a++){if(s[a]<=0){this._clippingContextListForDraw.push(null);continue}let o=this.findSameClip(i[a],s[a]);o==null&&(o=new Yb(this,i[a],s[a]),this._clippingContextListForMask.push(o)),o.addClippedDrawable(a),this._clippingContextListForDraw.push(o)}}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let s=0;s<this._clippingContextListForMask.length;s++){const n=this._clippingContextListForMask[s];this.calcClippedDrawTotalBounds(t,n),n._isUsing&&i++}if(i>0){this.setupLayoutBounds(e.isUsingHighPrecisionMask()?0:i),e.isUsingHighPrecisionMask()||(this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture()[0],e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._clearedFrameBufferflags||(this._clearedFrameBufferflags=[]);for(let s=0;s<this._renderTextureCount;s++)this._clearedFrameBufferflags[s]=!1;for(let s=0;s<this._clippingContextListForMask.length;s++){const n=this._clippingContextListForMask[s],a=n._allClippedDrawRect,o=n._layoutBounds,h=.05;let l=0,u=0;const c=this.getMaskRenderTexture()[n._bufferIndex];if(this._currentMaskRenderTexture!=c&&!e.isUsingHighPrecisionMask()&&(this._currentMaskRenderTexture=c,e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),e.isUsingHighPrecisionMask()){const d=t.getPixelsPerUnit(),f=n.getClippingManager()._clippingMaskBufferSize,p=o.width*f,m=o.height*f;this._tmpBoundsOnModel.setRect(a),this._tmpBoundsOnModel.width*d>p?(this._tmpBoundsOnModel.expand(a.width*h,0),l=o.width/this._tmpBoundsOnModel.width):l=d/p,this._tmpBoundsOnModel.height*d>m?(this._tmpBoundsOnModel.expand(0,a.height*h),u=o.height/this._tmpBoundsOnModel.height):u=d/m}else this._tmpBoundsOnModel.setRect(a),this._tmpBoundsOnModel.expand(a.width*h,a.height*h),l=o.width/this._tmpBoundsOnModel.width,u=o.height/this._tmpBoundsOnModel.height;if(this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(o.x,o.y),this._tmpMatrix.scaleRelative(l,u),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(o.x,o.y),this._tmpMatrix.scaleRelative(l,u),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),n._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),n._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray()),!e.isUsingHighPrecisionMask()){const d=n._clippingIdCount;for(let f=0;f<d;f++){const p=n._clippingIdList[f];t.getDrawableDynamicFlagVertexPositionsDidChange(p)&&(e.setIsCulling(t.getDrawableCulling(p)!=!1),this._clearedFrameBufferflags[n._bufferIndex]||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferflags[n._bufferIndex]=!0),e.setClippingContextBufferForMask(n),e.drawMesh(t.getDrawableTextureIndex(p),t.getDrawableVertexIndexCount(p),t.getDrawableVertexCount(p),t.getDrawableVertexIndices(p),t.getDrawableVertices(p),t.getDrawableVertexUvs(p),t.getMultiplyColor(p),t.getScreenColor(p),t.getDrawableOpacity(p),$e.CubismBlendMode_Normal,!1))}}}e.isUsingHighPrecisionMask()||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,kn),e.setClippingContextBufferForMask(null),this.gl.viewport(ke[0],ke[1],ke[2],ke[3]))}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.length;i++){const s=this._clippingContextListForMask[i],n=s._clippingIdCount;if(n!=e)continue;let a=0;for(let o=0;o<n;o++){const h=s._clippingIdList[o];for(let l=0;l<n;l++)if(t[l]==h){a++;break}}if(a==n)return s}return null}setupLayoutBounds(t){const e=this._renderTextureCount<=1?$b:zb*this._renderTextureCount;if(t<=0||t>e){t>e&&Pe(`not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let l=0;l<this._clippingContextListForMask.length;l++){const u=this._clippingContextListForMask[l];u._layoutChannelNo=0,u._layoutBounds.x=0,u._layoutBounds.y=0,u._layoutBounds.width=1,u._layoutBounds.height=1,u._bufferIndex=0}return}const i=this._renderTextureCount<=1?9:8;let s=t/this._renderTextureCount,n=t%this._renderTextureCount;s=~~s,n=~~n;let a=s/qs,o=s%qs;a=~~a,o=~~o;let h=0;for(let l=0;l<this._renderTextureCount;l++)for(let u=0;u<qs;u++){let c=a+(u<o?1:0);const d=o+1>=qs?0:o+1;if(c<i&&u==d&&(c+=l<n?1:0),c!=0)if(c==1){const f=this._clippingContextListForMask[h++];f._layoutChannelNo=u,f._layoutBounds.x=0,f._layoutBounds.y=0,f._layoutBounds.width=1,f._layoutBounds.height=1,f._bufferIndex=l}else if(c==2)for(let f=0;f<c;f++){let p=f%2;p=~~p;const m=this._clippingContextListForMask[h++];m._layoutChannelNo=u,m._layoutBounds.x=p*.5,m._layoutBounds.y=0,m._layoutBounds.width=.5,m._layoutBounds.height=1,m._bufferIndex=l}else if(c<=4)for(let f=0;f<c;f++){let p=f%2,m=f/2;p=~~p,m=~~m;const g=this._clippingContextListForMask[h++];g._layoutChannelNo=u,g._layoutBounds.x=p*.5,g._layoutBounds.y=m*.5,g._layoutBounds.width=.5,g._layoutBounds.height=.5,g._bufferIndex=l}else if(c<=i)for(let f=0;f<c;f++){let p=f%3,m=f/3;p=~~p,m=~~m;const g=this._clippingContextListForMask[h++];g._layoutChannelNo=u,g._layoutBounds.x=p/3,g._layoutBounds.y=m/3,g._layoutBounds.width=1/3,g._layoutBounds.height=1/3,g._bufferIndex=l}else if(Un.supportMoreMaskDivisions&&c<=16)for(let f=0;f<c;f++){let p=f%4,m=f/4;p=~~p,m=~~m;const g=this._clippingContextListForMask[h++];g._layoutChannelNo=u,g._layoutBounds.x=p/4,g._layoutBounds.y=m/4,g._layoutBounds.width=1/4,g._layoutBounds.height=1/4,g._bufferIndex=l}else{Pe(`not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let f=0;f<c;f++){const p=this._clippingContextListForMask[h++];p._layoutChannelNo=0,p._layoutBounds.x=0,p._layoutBounds.y=0,p._layoutBounds.width=1,p._layoutBounds.height=1,p._bufferIndex=0}}}}getColorBuffer(){return this._maskColorBuffers}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskCount(){return this._clippingContextListForMask.length}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}}class jb{constructor(t,e){this.frameNo=t,this.textures=e}}class Yb{constructor(t,e,i){this._isUsing=!1,this._owner=t,this._clippingIdList=e,this._clippingIdCount=i,this._allClippedDrawRect=new rh,this._layoutBounds=new rh,this._clippedDrawableIndexList=[],this._matrixForMask=new Jt,this._matrixForDraw=new Jt,this._bufferIndex=0}release(){const t=this;t._layoutBounds=void 0,t._allClippedDrawRect=void 0,t._clippedDrawableIndexList=void 0}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class qb{setGlEnable(t,e){e?this.gl.enable(t):this.gl.disable(t)}setGlEnableVertexAttribArray(t,e){e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)}save(){if(this.gl==null){Pe(`'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.`);return}this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(this.gl==null){Pe(`'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.`);return}this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(t){this.gl=t}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class rr{static getInstance(){return _i==null&&(_i=new rr),_i}static deleteInstance(){_i&&(_i.release(),_i=void 0)}constructor(){this._shaderSets=[]}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,i,s,n,a,o,h,l,u,c,d,f,p,m){f||Pe(\"NoPremultipliedAlpha is not allowed\"),this._shaderSets.length==0&&this.generateShaders();let g,y,x,_;const v=t.getClippingContextBufferForMask();if(v!=null){const T=this._shaderSets[0];this.gl.useProgram(T.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(T.samplerTexture0Location,0),o.vertex==null&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(T.attributePositionLocation),this.gl.vertexAttribPointer(T.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),o.uv==null&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(T.attributeTexCoordLocation),this.gl.vertexAttribPointer(T.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const S=v._layoutChannelNo,w=v.getClippingManager().getChannelFlagAsColor(S);this.gl.uniform4f(T.uniformChannelFlagLocation,w.R,w.G,w.B,w.A),this.gl.uniformMatrix4fv(T.uniformClipMatrixLocation,!1,v._matrixForMask.getArray());const b=v._layoutBounds;this.gl.uniform4f(T.uniformBaseColorLocation,b.x*2-1,b.y*2-1,b.getRight()*2-1,b.getBottom()*2-1),this.gl.uniform4f(T.uniformMultiplyColorLocation,c.R,c.G,c.B,c.A),this.gl.uniform4f(T.uniformScreenColorLocation,d.R,d.G,d.B,d.A),g=this.gl.ZERO,y=this.gl.ONE_MINUS_SRC_COLOR,x=this.gl.ZERO,_=this.gl.ONE_MINUS_SRC_ALPHA}else{const T=t.getClippingContextBufferForDraw(),w=T!=null?m?2:1:0;let b;switch(l){case $e.CubismBlendMode_Normal:default:b=this._shaderSets[1+w],g=this.gl.ONE,y=this.gl.ONE_MINUS_SRC_ALPHA,x=this.gl.ONE,_=this.gl.ONE_MINUS_SRC_ALPHA;break;case $e.CubismBlendMode_Additive:b=this._shaderSets[4+w],g=this.gl.ONE,y=this.gl.ONE,x=this.gl.ZERO,_=this.gl.ONE;break;case $e.CubismBlendMode_Multiplicative:b=this._shaderSets[7+w],g=this.gl.DST_COLOR,y=this.gl.ONE_MINUS_SRC_ALPHA,x=this.gl.ZERO,_=this.gl.ONE;break}if(this.gl.useProgram(b.shaderProgram),o.vertex==null&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(b.attributePositionLocation),this.gl.vertexAttribPointer(b.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),o.uv==null&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(b.attributeTexCoordLocation),this.gl.vertexAttribPointer(b.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),T!=null){this.gl.activeTexture(this.gl.TEXTURE1);const R=T.getClippingManager().getColorBuffer()[t.getClippingContextBufferForDraw()._bufferIndex];this.gl.bindTexture(this.gl.TEXTURE_2D,R),this.gl.uniform1i(b.samplerTexture1Location,1),this.gl.uniformMatrix4fv(b.uniformClipMatrixLocation,!1,T._matrixForDraw.getArray());const L=T._layoutChannelNo,I=T.getClippingManager().getChannelFlagAsColor(L);this.gl.uniform4f(b.uniformChannelFlagLocation,I.R,I.G,I.B,I.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(b.samplerTexture0Location,0),this.gl.uniformMatrix4fv(b.uniformMatrixLocation,!1,p.getArray()),this.gl.uniform4f(b.uniformBaseColorLocation,u.R,u.G,u.B,u.A),this.gl.uniform4f(b.uniformMultiplyColorLocation,c.R,c.G,c.B,c.A),this.gl.uniform4f(b.uniformScreenColorLocation,d.R,d.G,d.B,d.A)}o.index==null&&(o.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,o.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(g,y,x,_)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.length;t++)this.gl.deleteProgram(this._shaderSets[t].shaderProgram),this._shaderSets[t].shaderProgram=0;this._shaderSets=[]}generateShaders(){for(let t=0;t<Wb;t++)this._shaderSets.push({});this._shaderSets[0].shaderProgram=this.loadShaderProgram(Kb,Zb),this._shaderSets[1].shaderProgram=this.loadShaderProgram(Jb,Qb),this._shaderSets[2].shaderProgram=this.loadShaderProgram(rc,tT),this._shaderSets[3].shaderProgram=this.loadShaderProgram(rc,eT),this._shaderSets[4].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[5].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[6].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[7].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[8].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[9].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[0].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,\"a_position\"),this._shaderSets[0].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,\"a_texCoord\"),this._shaderSets[0].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,\"s_texture0\"),this._shaderSets[0].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,\"u_clipMatrix\"),this._shaderSets[0].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,\"u_channelFlag\"),this._shaderSets[0].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,\"u_baseColor\"),this._shaderSets[0].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,\"u_multiplyColor\"),this._shaderSets[0].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,\"u_screenColor\"),this._shaderSets[1].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,\"a_position\"),this._shaderSets[1].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,\"a_texCoord\"),this._shaderSets[1].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,\"s_texture0\"),this._shaderSets[1].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,\"u_matrix\"),this._shaderSets[1].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,\"u_baseColor\"),this._shaderSets[1].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,\"u_multiplyColor\"),this._shaderSets[1].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,\"u_screenColor\"),this._shaderSets[2].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,\"a_position\"),this._shaderSets[2].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,\"a_texCoord\"),this._shaderSets[2].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,\"s_texture0\"),this._shaderSets[2].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,\"s_texture1\"),this._shaderSets[2].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,\"u_matrix\"),this._shaderSets[2].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,\"u_clipMatrix\"),this._shaderSets[2].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,\"u_channelFlag\"),this._shaderSets[2].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,\"u_baseColor\"),this._shaderSets[2].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,\"u_multiplyColor\"),this._shaderSets[2].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,\"u_screenColor\"),this._shaderSets[3].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,\"a_position\"),this._shaderSets[3].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,\"a_texCoord\"),this._shaderSets[3].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,\"s_texture0\"),this._shaderSets[3].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,\"s_texture1\"),this._shaderSets[3].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,\"u_matrix\"),this._shaderSets[3].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,\"u_clipMatrix\"),this._shaderSets[3].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,\"u_channelFlag\"),this._shaderSets[3].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,\"u_baseColor\"),this._shaderSets[3].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,\"u_multiplyColor\"),this._shaderSets[3].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,\"u_screenColor\"),this._shaderSets[4].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,\"a_position\"),this._shaderSets[4].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,\"a_texCoord\"),this._shaderSets[4].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,\"s_texture0\"),this._shaderSets[4].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,\"u_matrix\"),this._shaderSets[4].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,\"u_baseColor\"),this._shaderSets[4].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,\"u_multiplyColor\"),this._shaderSets[4].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,\"u_screenColor\"),this._shaderSets[5].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,\"a_position\"),this._shaderSets[5].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,\"a_texCoord\"),this._shaderSets[5].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,\"s_texture0\"),this._shaderSets[5].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,\"s_texture1\"),this._shaderSets[5].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,\"u_matrix\"),this._shaderSets[5].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,\"u_clipMatrix\"),this._shaderSets[5].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,\"u_channelFlag\"),this._shaderSets[5].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,\"u_baseColor\"),this._shaderSets[5].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,\"u_multiplyColor\"),this._shaderSets[5].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,\"u_screenColor\"),this._shaderSets[6].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,\"a_position\"),this._shaderSets[6].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,\"a_texCoord\"),this._shaderSets[6].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,\"s_texture0\"),this._shaderSets[6].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,\"s_texture1\"),this._shaderSets[6].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,\"u_matrix\"),this._shaderSets[6].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,\"u_clipMatrix\"),this._shaderSets[6].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,\"u_channelFlag\"),this._shaderSets[6].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,\"u_baseColor\"),this._shaderSets[6].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,\"u_multiplyColor\"),this._shaderSets[6].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,\"u_screenColor\"),this._shaderSets[7].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,\"a_position\"),this._shaderSets[7].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,\"a_texCoord\"),this._shaderSets[7].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,\"s_texture0\"),this._shaderSets[7].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,\"u_matrix\"),this._shaderSets[7].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,\"u_baseColor\"),this._shaderSets[7].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,\"u_multiplyColor\"),this._shaderSets[7].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,\"u_screenColor\"),this._shaderSets[8].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,\"a_position\"),this._shaderSets[8].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,\"a_texCoord\"),this._shaderSets[8].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,\"s_texture0\"),this._shaderSets[8].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,\"s_texture1\"),this._shaderSets[8].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,\"u_matrix\"),this._shaderSets[8].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,\"u_clipMatrix\"),this._shaderSets[8].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,\"u_channelFlag\"),this._shaderSets[8].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,\"u_baseColor\"),this._shaderSets[8].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,\"u_multiplyColor\"),this._shaderSets[8].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,\"u_screenColor\"),this._shaderSets[9].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,\"a_position\"),this._shaderSets[9].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,\"a_texCoord\"),this._shaderSets[9].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,\"s_texture0\"),this._shaderSets[9].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,\"s_texture1\"),this._shaderSets[9].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,\"u_matrix\"),this._shaderSets[9].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,\"u_clipMatrix\"),this._shaderSets[9].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,\"u_channelFlag\"),this._shaderSets[9].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,\"u_baseColor\"),this._shaderSets[9].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,\"u_multiplyColor\"),this._shaderSets[9].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,\"u_screenColor\")}loadShaderProgram(t,e){const i=this.gl.createProgram(),s=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!s)return Pe(\"Vertex shader compile error!\"),0;const n=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return n?(this.gl.attachShader(i,s),this.gl.attachShader(i,n),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(s),this.gl.deleteShader(n),i):(Pe(\"Failed to link program: {0}\",i),this.gl.deleteShader(s),this.gl.deleteShader(n),i&&this.gl.deleteProgram(i),0)):(Pe(\"Vertex shader compile error!\"),0)}compileShaderSource(t,e){const i=e,s=this.gl.createShader(t);if(this.gl.shaderSource(s,i),this.gl.compileShader(s),!s){const a=this.gl.getShaderInfoLog(s);Pe(\"Shader compile log: {0} \",a)}return this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)?s:(this.gl.deleteShader(s),null)}setGl(t){this.gl=t}}const Kb=\"attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}\",Zb=\"precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}\",Jb=\"attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}\",rc=\"attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}\",Qb=\"precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}\",tT=\"precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}\",eT=\"precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}\";class Pp extends ol{initialize(t,e=1){t.isUsingMasking()&&(this._clippingManager=new ic,this._clippingManager.initialize(t,t.getDrawableCount(),t.getDrawableMasks(),t.getDrawableMaskCounts(),e));for(let i=t.getDrawableCount()-1;i>=0;i--)this._sortedDrawableIndexList[i]=0;super.initialize(t)}bindTexture(t,e){this._textures[t]=e}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){if(!this._model.isUsingMasking())return;const e=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=new ic,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts(),e)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new qb,this.firstDraw=!0,this._textures={},this._sortedDrawableIndexList=[],this._bufferData={vertex:null,uv:null,index:null}}release(){var t,e,i;const s=this;this._clippingManager.release(),s._clippingManager=void 0,(t=this.gl)==null||t.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,(e=this.gl)==null||e.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,(i=this.gl)==null||i.deleteBuffer(this._bufferData.index),this._bufferData.index=null,s._bufferData=void 0,s._textures=void 0}doDrawModel(){if(this.gl==null){Pe(`'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.`);return}this._clippingManager!=null&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const s=e[i];this._sortedDrawableIndexList[s]=i}for(let i=0;i<t;++i){const s=this._sortedDrawableIndexList[i];if(!this.getModel().getDrawableDynamicFlagIsVisible(s))continue;const n=this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw()[s]:null;if(n!=null&&this.isUsingHighPrecisionMask()){n._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,n.getClippingManager().getMaskRenderTexture()[n._bufferIndex]),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const a=n._clippingIdCount;for(let o=0;o<a;o++){const h=n._clippingIdList[o];this._model.getDrawableDynamicFlagVertexPositionsDidChange(h)&&(this.setIsCulling(this._model.getDrawableCulling(h)!=!1),this.setClippingContextBufferForMask(n),this.drawMesh(this.getModel().getDrawableTextureIndex(h),this.getModel().getDrawableVertexIndexCount(h),this.getModel().getDrawableVertexCount(h),this.getModel().getDrawableVertexIndices(h),this.getModel().getDrawableVertices(h),this.getModel().getDrawableVertexUvs(h),this.getModel().getMultiplyColor(h),this.getModel().getScreenColor(h),this.getModel().getDrawableOpacity(h),$e.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,kn),this.setClippingContextBufferForMask(null),this.gl.viewport(ke[0],ke[1],ke[2],ke[3]),this.preDraw()}this.setClippingContextBufferForDraw(n),this.setIsCulling(this.getModel().getDrawableCulling(s)),this.drawMesh(this.getModel().getDrawableTextureIndex(s),this.getModel().getDrawableVertexIndexCount(s),this.getModel().getDrawableVertexCount(s),this.getModel().getDrawableVertexIndices(s),this.getModel().getDrawableVertices(s),this.getModel().getDrawableVertexUvs(s),this.getModel().getMultiplyColor(s),this.getModel().getScreenColor(s),this.getModel().getDrawableOpacity(s),this.getModel().getDrawableBlendMode(s),this.getModel().getDrawableInvertedMaskBit(s))}}drawMesh(t,e,i,s,n,a,o,h,l,u,c){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const d=this.getModelColor();this.getClippingContextBufferForMask()==null&&(d.A*=l,this.isPremultipliedAlpha()&&(d.R*=d.A,d.G*=d.A,d.B*=d.A));let f=null;this._textures[t]!=null&&(f=this._textures[t]),rr.getInstance().setupShaderProgram(this,f,i,n,s,a,this._bufferData,l,u,d,o,h,this.isPremultipliedAlpha(),this.getMvpMatrix(),c),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){rr.deleteInstance()}setRenderState(t,e){kn=t,ke=e}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(const t of Object.entries(this._textures))this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(t){this.gl=t,this._clippingManager&&this._clippingManager.setGL(t),rr.getInstance().setGl(t),this._rendererProfile.setGl(t),this._extension=this.gl.getExtension(\"EXT_texture_filter_anisotropic\")||this.gl.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\")||this.gl.getExtension(\"MOZ_EXT_texture_filter_anisotropic\")}}ol.staticRelease=()=>{Pp.doStaticRelease()};class Mp{constructor(t){this.groups=t.Groups,this.hitAreas=t.HitAreas,this.layout=t.Layout,this.moc=t.FileReferences.Moc,this.expressions=t.FileReferences.Expressions,this.motions=t.FileReferences.Motions,this.textures=t.FileReferences.Textures,this.physics=t.FileReferences.Physics,this.pose=t.FileReferences.Pose}getEyeBlinkParameters(){var t,e;return(e=(t=this.groups)==null?void 0:t.find(i=>i.Name===\"EyeBlink\"))==null?void 0:e.Ids}getLipSyncParameters(){var t,e;return(e=(t=this.groups)==null?void 0:t.find(i=>i.Name===\"LipSync\"))==null?void 0:e.Ids}}const iT=\"ParamAngleX\",rT=\"ParamAngleY\",sT=\"ParamAngleZ\",nT=\"ParamEyeBallX\",aT=\"ParamEyeBallY\",oT=\"ParamMouthForm\",hT=\"ParamBodyAngleX\",lT=\"ParamBreath\",sc=2,nc=2,ac={motionFadingDuration:500,idleMotionFadingDuration:2e3},it={log(r,...t){},warn(r,...t){console.warn(`[${r}]`,...t)},error(r,...t){console.error(`[${r}]`,...t)}};function sh(r,t,e){return r<t?t:r>e?e:r}function uT(r,t){t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(i=>{i!==\"constructor\"&&Object.defineProperty(r.prototype,i,Object.getOwnPropertyDescriptor(e.prototype,i))})})}function cT(r){let t=r.lastIndexOf(\"/\");return t!=-1&&(r=r.slice(0,t)),t=r.lastIndexOf(\"/\"),t!==-1&&(r=r.slice(t+1)),r}function to(r,t){const e=r.indexOf(t);e!==-1&&r.splice(e,1)}class Ip extends Ye{constructor(t,e){super(),E(this,\"tag\"),E(this,\"settings\"),E(this,\"expressions\",[]),E(this,\"defaultExpression\"),E(this,\"currentExpression\"),E(this,\"reserveExpressionIndex\",-1),E(this,\"destroyed\",!1),this.settings=t,this.tag=`ExpressionManager(${t.name})`}init(){this.defaultExpression=this.createExpression({},void 0),this.currentExpression=this.defaultExpression,this.stopAllExpressions()}loadExpression(t){return ut(this,null,function*(){if(!this.definitions[t]){it.warn(this.tag,`Undefined expression at [${t}]`);return}if(this.expressions[t]===null){it.warn(this.tag,`Cannot set expression at [${t}] because it's already failed in loading.`);return}if(this.expressions[t])return this.expressions[t];const e=yield this._loadExpression(t);return this.expressions[t]=e,e})}_loadExpression(t){throw new Error(\"Not implemented.\")}setRandomExpression(){return ut(this,null,function*(){if(this.definitions.length){const t=[];for(let e=0;e<this.definitions.length;e++)this.expressions[e]!==null&&this.expressions[e]!==this.currentExpression&&e!==this.reserveExpressionIndex&&t.push(e);if(t.length){const e=Math.floor(Math.random()*t.length);return this.setExpression(e)}}return!1})}resetExpression(){this._setExpression(this.defaultExpression)}restoreExpression(){this._setExpression(this.currentExpression)}setExpression(t){return ut(this,null,function*(){if(typeof t!=\"number\"&&(t=this.getExpressionIndex(t)),!(t>-1&&t<this.definitions.length)||t===this.expressions.indexOf(this.currentExpression))return!1;this.reserveExpressionIndex=t;const e=yield this.loadExpression(t);return!e||this.reserveExpressionIndex!==t?!1:(this.reserveExpressionIndex=-1,this.currentExpression=e,this._setExpression(e),!0)})}update(t,e){return this.isFinished()?!1:this.updateParameters(t,e)}destroy(){this.destroyed=!0,this.emit(\"destroy\");const t=this;t.definitions=void 0,t.expressions=void 0}}const oc=.01,dT=40/7.5,fT=1/(.15*1e3);class pT{constructor(){E(this,\"targetX\",0),E(this,\"targetY\",0),E(this,\"x\",0),E(this,\"y\",0),E(this,\"vx\",0),E(this,\"vy\",0)}focus(t,e,i=!1){this.targetX=sh(t,-1,1),this.targetY=sh(e,-1,1),i&&(this.x=this.targetX,this.y=this.targetY)}update(t){const e=this.targetX-this.x,i=this.targetY-this.y;if(Math.abs(e)<oc&&Math.abs(i)<oc)return;const s=Math.sqrt(gi(e,2)+gi(i,2)),n=dT/(1e3/t);let a=n*(e/s)-this.vx,o=n*(i/s)-this.vy;const h=Math.sqrt(gi(a,2)+gi(o,2)),l=n*fT*t;h>l&&(a*=l/h,o*=l/h),this.vx+=a,this.vy+=o;const u=Math.sqrt(gi(this.vx,2)+gi(this.vy,2)),c=.5*(Math.sqrt(gi(l,2)+8*l*s)-l);u>c&&(this.vx*=c/u,this.vy*=c/u),this.x+=this.vx,this.y+=this.vy}}class fl{constructor(t){E(this,\"json\"),E(this,\"name\"),E(this,\"url\"),E(this,\"pose\"),E(this,\"physics\"),this.json=t;const e=t.url;if(typeof e!=\"string\")throw new TypeError(\"The `url` field in settings JSON must be defined as a string.\");this.url=e,this.name=cT(this.url)}resolveURL(t){return Kn.resolve(this.url,t)}replaceFiles(t){this.moc=t(this.moc,\"moc\"),this.pose!==void 0&&(this.pose=t(this.pose,\"pose\")),this.physics!==void 0&&(this.physics=t(this.physics,\"physics\"));for(let e=0;e<this.textures.length;e++)this.textures[e]=t(this.textures[e],`textures[${e}]`)}getDefinedFiles(){const t=[];return this.replaceFiles(e=>(t.push(e),e)),t}validateFiles(t){const e=(n,a)=>{const o=this.resolveURL(n);if(!t.includes(o)){if(a)throw new Error(`File \"${n}\" is defined in settings, but doesn't exist in given files`);return!1}return!0};return[this.moc,...this.textures].forEach(n=>e(n,!0)),this.getDefinedFiles().filter(n=>e(n,!1))}}var pn=(r=>(r[r.NONE=0]=\"NONE\",r[r.IDLE=1]=\"IDLE\",r[r.NORMAL=2]=\"NORMAL\",r[r.FORCE=3]=\"FORCE\",r))(pn||{});class mT{constructor(){E(this,\"tag\"),E(this,\"debug\",!1),E(this,\"currentPriority\",0),E(this,\"reservePriority\",0),E(this,\"currentGroup\"),E(this,\"currentIndex\"),E(this,\"reservedGroup\"),E(this,\"reservedIndex\"),E(this,\"reservedIdleGroup\"),E(this,\"reservedIdleIndex\")}reserve(t,e,i){if(i<=0)return it.log(this.tag,\"Cannot start a motion with MotionPriority.NONE.\"),!1;if(t===this.currentGroup&&e===this.currentIndex)return it.log(this.tag,\"Motion is already playing.\",this.dump(t,e)),!1;if(t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex)return it.log(this.tag,\"Motion is already reserved.\",this.dump(t,e)),!1;if(i===1){if(this.currentPriority!==0)return it.log(this.tag,\"Cannot start idle motion because another motion is playing.\",this.dump(t,e)),!1;if(this.reservedIdleGroup!==void 0)return it.log(this.tag,\"Cannot start idle motion because another idle motion has reserved.\",this.dump(t,e)),!1;this.setReservedIdle(t,e)}else{if(i<3){if(i<=this.currentPriority)return it.log(this.tag,\"Cannot start motion because another motion is playing as an equivalent or higher priority.\",this.dump(t,e)),!1;if(i<=this.reservePriority)return it.log(this.tag,\"Cannot start motion because another motion has reserved as an equivalent or higher priority.\",this.dump(t,e)),!1}this.setReserved(t,e,i)}return!0}start(t,e,i,s){if(s===1){if(this.setReservedIdle(void 0,void 0),this.currentPriority!==0)return it.log(this.tag,\"Cannot start idle motion because another motion is playing.\",this.dump(e,i)),!1}else{if(e!==this.reservedGroup||i!==this.reservedIndex)return it.log(this.tag,\"Cannot start motion because another motion has taken the place.\",this.dump(e,i)),!1;this.setReserved(void 0,void 0,0)}return t?(this.setCurrent(e,i,s),!0):!1}complete(){this.setCurrent(void 0,void 0,0)}setCurrent(t,e,i){this.currentPriority=i,this.currentGroup=t,this.currentIndex=e}setReserved(t,e,i){this.reservePriority=i,this.reservedGroup=t,this.reservedIndex=e}setReservedIdle(t,e){this.reservedIdleGroup=t,this.reservedIdleIndex=e}isActive(t,e){return t===this.currentGroup&&e===this.currentIndex||t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex}reset(){this.setCurrent(void 0,void 0,0),this.setReserved(void 0,void 0,0),this.setReservedIdle(void 0,void 0)}shouldRequestIdleMotion(){return this.currentGroup===void 0&&this.reservedIdleGroup===void 0}shouldOverrideExpression(){return!1}dump(t,e){if(this.debug){const i=[\"currentPriority\",\"reservePriority\",\"currentGroup\",\"currentIndex\",\"reservedGroup\",\"reservedIndex\",\"reservedIdleGroup\",\"reservedIdleIndex\"];return`\n<Requested> group = \"${t}\", index = ${e}\n`+i.map(s=>\"[\"+s+\"] \"+this[s]).join(`\n`)}return\"\"}}const gT=\"SoundManager\",sr=.5,Hi=new WeakMap,eo=new WeakMap,io=new WeakMap,ro=new WeakMap,so=new WeakMap;class Et{static get volume(){return this._volume}static set volume(t){this._volume=(t>1?1:t<0?0:t)||0,this.audios.forEach(e=>e.volume=this._volume)}static add(t,e,i,s){const n=new Audio(t);return n.volume=this._volume,n.preload=\"auto\",n.crossOrigin=s,Hi.set(n,{ended:()=>{this.dispose(n),e?.()},error:a=>{this.dispose(n),it.warn(gT,`Error occurred on \"${t}\"`,a.error),i?.(a.error)}}),n.addEventListener(\"ended\",Hi.get(n).ended),n.addEventListener(\"error\",Hi.get(n).error),this.audios.push(n),n}static play(t){return new Promise((e,i)=>{var s;(s=t.play())==null||s.catch(n=>{t.dispatchEvent(new ErrorEvent(\"error\",{error:n})),i(n)}),t.readyState===t.HAVE_ENOUGH_DATA?e():(eo.set(t,e),t.addEventListener(\"canplaythrough\",e))})}static addContext(t){const e=new AudioContext;return io.set(t,e),this.contexts.push(e),e}static addAnalyzer(t,e){const i=e.createMediaElementSource(t),s=e.createAnalyser();return s.fftSize=256,s.minDecibels=-90,s.maxDecibels=-10,s.smoothingTimeConstant=.85,i.connect(s),s.connect(e.destination),so.set(t,i),ro.set(t,s),this.analysers.push(s),s}static analyze(t){if(t!=null){const e=new Float32Array(t.fftSize);let i=0;t.getFloatTimeDomainData(e);for(const s of e)i+=s*s;return parseFloat(Math.sqrt(i/e.length*20).toFixed(1))}else return parseFloat(Math.random().toFixed(1))}static dispose(t){var e,i;t.pause(),t.removeEventListener(\"ended\",(e=Hi.get(t))==null?void 0:e.ended),t.removeEventListener(\"error\",(i=Hi.get(t))==null?void 0:i.error),t.removeEventListener(\"canplaythrough\",eo.get(t)),Hi.delete(t),eo.delete(t);const s=io.get(t);io.delete(t),s?.close();const n=ro.get(t);ro.delete(t),n?.disconnect();const a=so.get(t);so.delete(t),a?.disconnect(),t.removeAttribute(\"src\"),to(this.analysers,n),to(this.contexts,s),to(this.audios,t)}static destroy(){for(let t=this.contexts.length-1;t>=0;t--)this.contexts[t].close();for(let t=this.audios.length-1;t>=0;t--)this.dispose(this.audios[t])}}E(Et,\"audios\",[]);E(Et,\"analysers\",[]);E(Et,\"contexts\",[]);E(Et,\"_volume\",sr);var Rp=typeof global==\"object\"&&global&&global.Object===Object&&global,_T=typeof self==\"object\"&&self&&self.Object===Object&&self,fi=Rp||_T||Function(\"return this\")(),Gn=fi.Symbol,Dp=Object.prototype,yT=Dp.hasOwnProperty,vT=Dp.toString,Cr=Gn?Gn.toStringTag:void 0;function xT(r){var t=yT.call(r,Cr),e=r[Cr];try{r[Cr]=void 0;var i=!0}catch{}var s=vT.call(r);return i&&(t?r[Cr]=e:delete r[Cr]),s}var bT=Object.prototype,TT=bT.toString;function wT(r){return TT.call(r)}var ET=\"[object Null]\",CT=\"[object Undefined]\",hc=Gn?Gn.toStringTag:void 0;function Ts(r){return r==null?r===void 0?CT:ET:hc&&hc in Object(r)?xT(r):wT(r)}function pl(r){return r!=null&&typeof r==\"object\"}var ST=Array.isArray;function Fp(r){var t=typeof r;return r!=null&&(t==\"object\"||t==\"function\")}var AT=\"[object AsyncFunction]\",PT=\"[object Function]\",MT=\"[object GeneratorFunction]\",IT=\"[object Proxy]\";function Bp(r){if(!Fp(r))return!1;var t=Ts(r);return t==PT||t==MT||t==AT||t==IT}var no=fi[\"__core-js_shared__\"],lc=function(){var r=/[^.]+$/.exec(no&&no.keys&&no.keys.IE_PROTO||\"\");return r?\"Symbol(src)_1.\"+r:\"\"}();function RT(r){return!!lc&&lc in r}var DT=Function.prototype,FT=DT.toString;function Li(r){if(r!=null){try{return FT.call(r)}catch{}try{return r+\"\"}catch{}}return\"\"}var BT=/[\\\\^$.*+?()[\\]{}|]/g,LT=/^\\[object .+?Constructor\\]$/,OT=Function.prototype,NT=Object.prototype,UT=OT.toString,kT=NT.hasOwnProperty,GT=RegExp(\"^\"+UT.call(kT).replace(BT,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\");function VT(r){if(!Fp(r)||RT(r))return!1;var t=Bp(r)?GT:LT;return t.test(Li(r))}function HT(r,t){return r?.[t]}function ws(r,t){var e=HT(r,t);return VT(e)?e:void 0}var nh=ws(fi,\"WeakMap\");function XT(){}var $T=9007199254740991;function Lp(r){return typeof r==\"number\"&&r>-1&&r%1==0&&r<=$T}function zT(r){return r!=null&&Lp(r.length)&&!Bp(r)}var WT=Object.prototype;function Op(r){var t=r&&r.constructor,e=typeof t==\"function\"&&t.prototype||WT;return r===e}var jT=\"[object Arguments]\";function uc(r){return pl(r)&&Ts(r)==jT}var Np=Object.prototype,YT=Np.hasOwnProperty,qT=Np.propertyIsEnumerable,KT=uc(function(){return arguments}())?uc:function(r){return pl(r)&&YT.call(r,\"callee\")&&!qT.call(r,\"callee\")};const ZT=KT;function JT(){return!1}var Up=typeof He==\"object\"&&He&&!He.nodeType&&He,cc=Up&&typeof Xe==\"object\"&&Xe&&!Xe.nodeType&&Xe,QT=cc&&cc.exports===Up,dc=QT?fi.Buffer:void 0,tw=dc?dc.isBuffer:void 0,ew=tw||JT;const iw=ew;var rw=\"[object Arguments]\",sw=\"[object Array]\",nw=\"[object Boolean]\",aw=\"[object Date]\",ow=\"[object Error]\",hw=\"[object Function]\",lw=\"[object Map]\",uw=\"[object Number]\",cw=\"[object Object]\",dw=\"[object RegExp]\",fw=\"[object Set]\",pw=\"[object String]\",mw=\"[object WeakMap]\",gw=\"[object ArrayBuffer]\",_w=\"[object DataView]\",yw=\"[object Float32Array]\",vw=\"[object Float64Array]\",xw=\"[object Int8Array]\",bw=\"[object Int16Array]\",Tw=\"[object Int32Array]\",ww=\"[object Uint8Array]\",Ew=\"[object Uint8ClampedArray]\",Cw=\"[object Uint16Array]\",Sw=\"[object Uint32Array]\",ot={};ot[yw]=ot[vw]=ot[xw]=ot[bw]=ot[Tw]=ot[ww]=ot[Ew]=ot[Cw]=ot[Sw]=!0;ot[rw]=ot[sw]=ot[gw]=ot[nw]=ot[_w]=ot[aw]=ot[ow]=ot[hw]=ot[lw]=ot[uw]=ot[cw]=ot[dw]=ot[fw]=ot[pw]=ot[mw]=!1;function Aw(r){return pl(r)&&Lp(r.length)&&!!ot[Ts(r)]}function Pw(r){return function(t){return r(t)}}var kp=typeof He==\"object\"&&He&&!He.nodeType&&He,Xr=kp&&typeof Xe==\"object\"&&Xe&&!Xe.nodeType&&Xe,Mw=Xr&&Xr.exports===kp,ao=Mw&&Rp.process,fc=function(){try{var r=Xr&&Xr.require&&Xr.require(\"util\").types;return r||ao&&ao.binding&&ao.binding(\"util\")}catch{}}(),pc=fc&&fc.isTypedArray,Iw=pc?Pw(pc):Aw;const Rw=Iw;function Dw(r,t){return function(e){return r(t(e))}}var Fw=Dw(Object.keys,Object),Bw=Object.prototype,Lw=Bw.hasOwnProperty;function Ow(r){if(!Op(r))return Fw(r);var t=[];for(var e in Object(r))Lw.call(r,e)&&e!=\"constructor\"&&t.push(e);return t}var ah=ws(fi,\"Map\"),oh=ws(fi,\"DataView\"),hh=ws(fi,\"Promise\"),lh=ws(fi,\"Set\"),mc=\"[object Map]\",Nw=\"[object Object]\",gc=\"[object Promise]\",_c=\"[object Set]\",yc=\"[object WeakMap]\",vc=\"[object DataView]\",Uw=Li(oh),kw=Li(ah),Gw=Li(hh),Vw=Li(lh),Hw=Li(nh),wi=Ts;(oh&&wi(new oh(new ArrayBuffer(1)))!=vc||ah&&wi(new ah)!=mc||hh&&wi(hh.resolve())!=gc||lh&&wi(new lh)!=_c||nh&&wi(new nh)!=yc)&&(wi=function(r){var t=Ts(r),e=t==Nw?r.constructor:void 0,i=e?Li(e):\"\";if(i)switch(i){case Uw:return vc;case kw:return mc;case Gw:return gc;case Vw:return _c;case Hw:return yc}return t});const Xw=wi;var $w=\"[object Map]\",zw=\"[object Set]\",Ww=Object.prototype,jw=Ww.hasOwnProperty;function xc(r){if(r==null)return!0;if(zT(r)&&(ST(r)||typeof r==\"string\"||typeof r.splice==\"function\"||iw(r)||Rw(r)||ZT(r)))return!r.length;var t=Xw(r);if(t==$w||t==zw)return!r.size;if(Op(r))return!Ow(r).length;for(var e in r)if(jw.call(r,e))return!1;return!0}class ml extends Ye{constructor(t,e){super(),E(this,\"tag\"),E(this,\"settings\"),E(this,\"motionGroups\",{}),E(this,\"state\",new mT),E(this,\"currentAudio\"),E(this,\"currentAnalyzer\"),E(this,\"currentContext\"),E(this,\"playing\",!1),E(this,\"destroyed\",!1),this.settings=t,this.tag=`MotionManager(${t.name})`,this.state.tag=this.tag}init(t){t?.idleMotionGroup&&(this.groups.idle=t.idleMotionGroup),this.setupMotions(t),this.stopAllMotions()}setupMotions(t){for(const i of Object.keys(this.definitions))this.motionGroups[i]=[];let e;switch(t?.motionPreload){case\"NONE\":return;case\"ALL\":e=Object.keys(this.definitions);break;case\"IDLE\":default:e=[this.groups.idle];break}for(const i of e)if(this.definitions[i])for(let s=0;s<this.definitions[i].length;s++)this.loadMotion(i,s).then()}loadMotion(t,e){return ut(this,null,function*(){var i;if(!((i=this.definitions[t])!=null&&i[e])){it.warn(this.tag,`Undefined motion at \"${t}\"[${e}]`);return}if(this.motionGroups[t][e]===null){it.warn(this.tag,`Cannot start motion at \"${t}\"[${e}] because it's already failed in loading.`);return}if(this.motionGroups[t][e])return this.motionGroups[t][e];const s=yield this._loadMotion(t,e);if(!this.destroyed)return this.motionGroups[t][e]=s??null,s})}_loadMotion(t,e){throw new Error(\"Not implemented.\")}speak(t){return ut(this,arguments,function*(e,{volume:i=sr,expression:s,resetExpression:n=!0,crossOrigin:a,onFinish:o,onError:h}={}){let l,u,c;if(this.currentAudio&&!this.currentAudio.ended)return!1;let d;const f=e&&e.startsWith(\"data:\");if(e&&!f){const m=document.createElement(\"a\");m.href=e,e=m.href,d=e}else d=\"data:audio/\";const p=e;if(p)try{l=Et.add(p,(m=this)=>{console.log(\"Audio finished playing\"),o?.(),n&&s&&m.expressionManager&&m.expressionManager.resetExpression(),m.currentAudio=void 0},(m,g=this)=>{console.log(\"Error during audio playback:\",m),h?.(m),n&&s&&g.expressionManager&&g.expressionManager.resetExpression(),g.currentAudio=void 0},a),this.currentAudio=l,Et.volume=i,c=Et.addContext(this.currentAudio),this.currentContext=c,u=Et.addAnalyzer(this.currentAudio,this.currentContext),this.currentAnalyzer=u}catch(m){return it.warn(this.tag,\"Failed to create audio\",d,m),!1}if(l){let m=!0;if(yield Et.play(l).catch(y=>{it.warn(this.tag,\"Failed to play audio\",l.src,y),m=!1}),!m)return!1}return this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),s&&this.expressionManager&&this.expressionManager.setExpression(s),this.playing=!0,!0})}startMotion(t,e){return ut(this,arguments,function*(i,s,n=pn.NORMAL,{sound:a=void 0,volume:o=sr,expression:h=void 0,resetExpression:l=!0,crossOrigin:u,onFinish:c,onError:d}={}){var f;if(!this.state.reserve(i,s,n)||this.currentAudio&&!this.currentAudio.ended&&n!=pn.FORCE)return!1;const p=(f=this.definitions[i])==null?void 0:f[s];if(!p)return!1;this.currentAudio&&Et.dispose(this.currentAudio);let m,g,y,x;const _=a&&a.startsWith(\"data:\");if(a&&!_){const S=document.createElement(\"a\");S.href=a,a=S.href,x=a}else x=this.getSoundFile(p),x&&(x=this.settings.resolveURL(x));const v=x;if(v)try{m=Et.add(v,(S=this)=>{console.log(\"Audio finished playing\"),c?.(),l&&h&&S.expressionManager&&S.expressionManager.resetExpression(),S.currentAudio=void 0},(S,w=this)=>{console.log(\"Error during audio playback:\",S),d?.(S),l&&h&&w.expressionManager&&w.expressionManager.resetExpression(),w.currentAudio=void 0},u),this.currentAudio=m,Et.volume=o,y=Et.addContext(this.currentAudio),this.currentContext=y,g=Et.addAnalyzer(this.currentAudio,this.currentContext),this.currentAnalyzer=g}catch(S){it.warn(this.tag,\"Failed to create audio\",x,S)}const T=yield this.loadMotion(i,s);return m&&!xc(m.src)&&(yield Et.play(m).catch(w=>it.warn(this.tag,\"Failed to play audio\",m.src,w))),this.state.start(T,i,s,n)?(this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),it.log(this.tag,\"Start motion:\",this.getMotionName(p)),this.emit(\"motionStart\",i,s,m),h&&this.expressionManager&&this.state.shouldOverrideExpression()&&this.expressionManager.setExpression(h),this.playing=!0,this._startMotion(T),!0):(m&&!xc(m.src)&&(Et.dispose(m),this.currentAudio=void 0),!1)})}startRandomMotion(t,e){return ut(this,arguments,function*(i,s,{sound:n,volume:a=sr,expression:o,resetExpression:h=!0,crossOrigin:l,onFinish:u,onError:c}={}){const d=this.definitions[i];if(d?.length){const f=[];for(let p=0;p<d.length;p++)this.motionGroups[i][p]!==null&&!this.state.isActive(i,p)&&f.push(p);if(f.length){const p=f[Math.floor(Math.random()*f.length)];return this.startMotion(i,p,s,{sound:n,volume:a,expression:o,resetExpression:h,crossOrigin:l,onFinish:u,onError:c})}}return!1})}stopSpeaking(){this.currentAudio&&(Et.dispose(this.currentAudio),this.currentAudio=void 0)}stopAllMotions(){this._stopAllMotions(),this.state.reset(),this.stopSpeaking()}update(t,e){var i;return this.isFinished()&&(this.playing&&(this.playing=!1,this.emit(\"motionFinish\")),this.state.shouldOverrideExpression()&&((i=this.expressionManager)==null||i.restoreExpression()),this.state.complete(),this.state.shouldRequestIdleMotion()&&this.startRandomMotion(this.groups.idle,pn.IDLE)),this.updateParameters(t,e)}mouthSync(){return this.currentAnalyzer?Et.analyze(this.currentAnalyzer):0}destroy(){var t;this.destroyed=!0,this.emit(\"destroy\"),this.stopAllMotions(),(t=this.expressionManager)==null||t.destroy();const e=this;e.definitions=void 0,e.motionGroups=void 0}}const Yw={x:0,y:0,width:0,height:0};class qw extends Ye{constructor(){super(...arguments),E(this,\"focusController\",new pT),E(this,\"pose\"),E(this,\"physics\"),E(this,\"originalWidth\",0),E(this,\"originalHeight\",0),E(this,\"width\",0),E(this,\"height\",0),E(this,\"localTransform\",new et),E(this,\"drawingMatrix\",new et),E(this,\"hitAreas\",{}),E(this,\"textureFlipY\",!1),E(this,\"viewport\",[0,0,0,0]),E(this,\"destroyed\",!1)}init(){this.setupLayout(),this.setupHitAreas()}setupLayout(){const t=this,e=this.getSize();t.originalWidth=e[0],t.originalHeight=e[1];const i=Object.assign({width:sc,height:nc},this.getLayout());this.localTransform.scale(i.width/sc,i.height/nc),t.width=this.originalWidth*this.localTransform.a,t.height=this.originalHeight*this.localTransform.d;const s=i.x!==void 0&&i.x-i.width/2||i.centerX!==void 0&&i.centerX||i.left!==void 0&&i.left-i.width/2||i.right!==void 0&&i.right+i.width/2||0,n=i.y!==void 0&&i.y-i.height/2||i.centerY!==void 0&&i.centerY||i.top!==void 0&&i.top-i.height/2||i.bottom!==void 0&&i.bottom+i.height/2||0;this.localTransform.translate(this.width*s,-this.height*n)}setupHitAreas(){const t=this.getHitAreaDefs().filter(e=>e.index>=0);for(const e of t)this.hitAreas[e.name]=e}hitTest(t,e){return Object.keys(this.hitAreas).filter(i=>this.isHit(i,t,e))}isHit(t,e,i){if(!this.hitAreas[t])return!1;const s=this.hitAreas[t].index,n=this.getDrawableBounds(s,Yw);return n.x<=e&&e<=n.x+n.width&&n.y<=i&&i<=n.y+n.height}getDrawableBounds(t,e){const i=this.getDrawableVertices(t);let s=i[0],n=i[0],a=i[1],o=i[1];for(let h=0;h<i.length;h+=2){const l=i[h],u=i[h+1];s=Math.min(l,s),n=Math.max(l,n),a=Math.min(u,a),o=Math.max(u,o)}return e??(e={}),e.x=s,e.y=a,e.width=n-s,e.height=o-a,e}updateTransform(t){this.drawingMatrix.copyFrom(t).append(this.localTransform)}update(t,e){this.focusController.update(t)}destroy(){this.destroyed=!0,this.emit(\"destroy\"),this.motionManager.destroy(),this.motionManager=void 0}}const Kw=\"XHRLoader\";class bc extends Error{constructor(t,e,i,s=!1){super(t),this.url=e,this.status=i,this.aborted=s}}const ls=class Ut{static createXHR(t,e,i,s,n){const a=new XMLHttpRequest;if(Ut.allXhrSet.add(a),t){let o=Ut.xhrMap.get(t);o?o.add(a):(o=new Set([a]),Ut.xhrMap.set(t,o)),t.listeners(\"destroy\").includes(Ut.cancelXHRs)||t.once(\"destroy\",Ut.cancelXHRs)}return a.open(\"GET\",e),a.responseType=i,a.onload=()=>{(a.status===200||a.status===0)&&a.response?s(a.response):a.onerror()},a.onerror=()=>{it.warn(Kw,`Failed to load resource as ${a.responseType} (Status ${a.status}): ${e}`),n(new bc(\"Network error.\",e,a.status))},a.onabort=()=>n(new bc(\"Aborted.\",e,a.status,!0)),a.onloadend=()=>{var o;Ut.allXhrSet.delete(a),t&&((o=Ut.xhrMap.get(t))==null||o.delete(a))},a}static cancelXHRs(){var t;(t=Ut.xhrMap.get(this))==null||t.forEach(e=>{e.abort(),Ut.allXhrSet.delete(e)}),Ut.xhrMap.delete(this)}static release(){Ut.allXhrSet.forEach(t=>t.abort()),Ut.allXhrSet.clear(),Ut.xhrMap=new WeakMap}};E(ls,\"xhrMap\",new WeakMap);E(ls,\"allXhrSet\",new Set);E(ls,\"loader\",(r,t)=>new Promise((e,i)=>{ls.createXHR(r.target,r.settings?r.settings.resolveURL(r.url):r.url,r.type,n=>{r.result=n,e()},i).send()}));let Zw=ls;function Gp(r,t){let e=-1;return i(0);function i(s,n){if(n)return Promise.reject(n);if(s<=e)return Promise.reject(new Error(\"next() called multiple times\"));e=s;const a=r[s];if(!a)return Promise.resolve();try{return Promise.resolve(a(t,i.bind(null,s+1)))}catch(o){return Promise.reject(o)}}}class li{static load(t){return Gp(this.middlewares,t).then(()=>t.result)}}E(li,\"middlewares\",[Zw.loader]);function Jw(r,t={}){var e;const i={resourceOptions:{crossorigin:t.crossOrigin}};if(B.fromURL)return B.fromURL(r,i).catch(a=>{if(a instanceof Error)throw a;const o=new Error(\"Texture loading error\");throw o.event=a,o});i.resourceOptions.autoLoad=!1;const s=B.from(r,i);if(s.baseTexture.valid)return Promise.resolve(s);const n=s.baseTexture.resource;return(e=n._live2d_load)!=null||(n._live2d_load=new Promise((a,o)=>{const h=l=>{n.source.removeEventListener(\"error\",h);const u=new Error(\"Texture loading error\");u.event=l,o(u)};n.source.addEventListener(\"error\",h),n.load().then(()=>a(s)).catch(h)})),n._live2d_load}const Tc=\"Live2DFactory\",Vp=(r,t)=>ut(void 0,null,function*(){if(typeof r.source==\"string\"){const e=yield li.load({url:r.source,type:\"json\",target:r.live2dModel});e.url=r.source,r.source=e,r.live2dModel.emit(\"settingsJSONLoaded\",e)}return t()}),Hp=(r,t)=>ut(void 0,null,function*(){if(r.source instanceof fl)return r.settings=r.source,t();if(typeof r.source==\"object\"){const e=te.findRuntime(r.source);if(e){const i=e.createModelSettings(r.source);return r.settings=i,r.live2dModel.emit(\"settingsLoaded\",i),t()}}throw new TypeError(\"Unknown settings format.\")}),Xp=(r,t)=>{if(r.settings){const e=te.findRuntime(r.settings);if(e)return e.ready().then(t)}return t()},$p=(r,t)=>ut(void 0,null,function*(){yield t();const e=r.internalModel;if(e){const i=r.settings,s=te.findRuntime(i);if(s){const n=[];i.pose&&n.push(li.load({settings:i,url:i.pose,type:\"json\",target:e}).then(a=>{e.pose=s.createPose(e.coreModel,a),r.live2dModel.emit(\"poseLoaded\",e.pose)}).catch(a=>{r.live2dModel.emit(\"poseLoadError\",a),it.warn(Tc,\"Failed to load pose.\",a)})),i.physics&&n.push(li.load({settings:i,url:i.physics,type:\"json\",target:e}).then(a=>{e.physics=s.createPhysics(e.coreModel,a),r.live2dModel.emit(\"physicsLoaded\",e.physics)}).catch(a=>{r.live2dModel.emit(\"physicsLoadError\",a),it.warn(Tc,\"Failed to load physics.\",a)})),n.length&&(yield Promise.all(n))}}}),zp=(r,t)=>ut(void 0,null,function*(){if(r.settings){const e=r.live2dModel,i=Promise.all(r.settings.textures.map(s=>{const n=r.settings.resolveURL(s);return Jw(n,{crossOrigin:r.options.crossOrigin})}));if(i.catch(XT),yield t(),r.internalModel)e.internalModel=r.internalModel,e.emit(\"modelLoaded\",r.internalModel);else throw new TypeError(\"Missing internal model.\");e.textures=yield i,e.emit(\"textureLoaded\",e.textures)}else throw new TypeError(\"Missing settings.\")}),Wp=(r,t)=>ut(void 0,null,function*(){const e=r.settings;if(e instanceof fl){const i=te.findRuntime(e);if(!i)throw new TypeError(\"Unknown model settings.\");const s=yield li.load({settings:e,url:e.moc,type:\"arraybuffer\",target:r.live2dModel});if(!i.isValidMoc(s))throw new Error(\"Invalid moc data\");const n=i.createCoreModel(s);return r.internalModel=i.createInternalModel(n,e,r.options),t()}throw new TypeError(\"Missing settings.\")}),Bt=class Ki{static unzip(t,e){return ut(this,null,function*(){const i=yield Ki.getFilePaths(t),s=[];for(const a of e.getDefinedFiles()){const o=decodeURI(Kn.resolve(e.url,a));i.includes(o)&&s.push(o)}const n=yield Ki.getFiles(t,s);for(let a=0;a<n.length;a++){const o=s[a],h=n[a];Object.defineProperty(h,\"webkitRelativePath\",{value:o})}return n})}static createSettings(t){return ut(this,null,function*(){const i=(yield Ki.getFilePaths(t)).find(o=>o.endsWith(\"model.json\")||o.endsWith(\"model3.json\"));if(!i)throw new Error(\"Settings file not found\");const s=yield Ki.readText(t,i);if(!s)throw new Error(\"Empty settings file: \"+i);const n=JSON.parse(s);n.url=i;const a=Ki.live2dFactory.findRuntime(n);if(!a)throw new Error(\"Unknown settings JSON\");return a.createModelSettings(n)})}static zipReader(t,e){return ut(this,null,function*(){throw new Error(\"Not implemented\")})}static getFilePaths(t){return ut(this,null,function*(){throw new Error(\"Not implemented\")})}static getFiles(t,e){return ut(this,null,function*(){throw new Error(\"Not implemented\")})}static readText(t,e){return ut(this,null,function*(){throw new Error(\"Not implemented\")})}static releaseReader(t){}};E(Bt,\"live2dFactory\");E(Bt,\"ZIP_PROTOCOL\",\"zip://\");E(Bt,\"uid\",0);E(Bt,\"factory\",(r,t)=>ut(Bt,null,function*(){const e=r.source;let i,s,n;if(typeof e==\"string\"&&(e.endsWith(\".zip\")||e.startsWith(Bt.ZIP_PROTOCOL))?(e.startsWith(Bt.ZIP_PROTOCOL)?i=e.slice(Bt.ZIP_PROTOCOL.length):i=e,s=yield li.load({url:i,type:\"blob\",target:r.live2dModel})):Array.isArray(e)&&e.length===1&&e[0]instanceof File&&e[0].name.endsWith(\".zip\")&&(s=e[0],i=URL.createObjectURL(s),n=e.settings),s){if(!s.size)throw new Error(\"Empty zip file\");const a=yield Bt.zipReader(s,i);n||(n=yield Bt.createSettings(a)),n._objectURL=Bt.ZIP_PROTOCOL+Bt.uid+\"/\"+n.url;const o=yield Bt.unzip(a,n);o.settings=n,r.source=o,i.startsWith(\"blob:\")&&r.live2dModel.once(\"modelLoaded\",h=>{h.once(\"destroy\",function(){URL.revokeObjectURL(i)})}),Bt.releaseReader(a)}return t()}));let jp=Bt;const ne=class mn{static resolveURL(t,e){var i;const s=(i=mn.filesMap[t])==null?void 0:i[e];if(s===void 0)throw new Error(\"Cannot find this file from uploaded files: \"+e);return s}static upload(t,e){return ut(this,null,function*(){const i={};for(const s of e.getDefinedFiles()){const n=decodeURI(Kn.resolve(e.url,s)),a=t.find(o=>o.webkitRelativePath===n);a&&(i[s]=URL.createObjectURL(a))}mn.filesMap[e._objectURL]=i})}static createSettings(t){return ut(this,null,function*(){const e=t.find(o=>o.name.endsWith(\"model.json\")||o.name.endsWith(\"model3.json\"));if(!e)throw new TypeError(\"Settings file not found\");const i=yield mn.readText(e),s=JSON.parse(i);s.url=e.webkitRelativePath;const n=te.findRuntime(s);if(!n)throw new Error(\"Unknown settings JSON\");const a=n.createModelSettings(s);return a._objectURL=URL.createObjectURL(e),a})}static readText(t){return ut(this,null,function*(){return new Promise((e,i)=>{const s=new FileReader;s.onload=()=>e(s.result),s.onerror=i,s.readAsText(t,\"utf8\")})})}};E(ne,\"live2dFactory\");E(ne,\"filesMap\",{});E(ne,\"factory\",(r,t)=>ut(ne,null,function*(){if(Array.isArray(r.source)&&r.source[0]instanceof File){const e=r.source;let i=e.settings;if(!i)i=yield ne.createSettings(e);else if(!i._objectURL)throw new Error('\"_objectURL\" must be specified in ModelSettings');i.validateFiles(e.map(s=>encodeURI(s.webkitRelativePath))),yield ne.upload(e,i),i.resolveURL=function(s){return ne.resolveURL(this._objectURL,s)},r.source=i,r.live2dModel.once(\"modelLoaded\",s=>{s.once(\"destroy\",function(){const n=this.settings._objectURL;if(URL.revokeObjectURL(n),ne.filesMap[n])for(const a of Object.values(ne.filesMap[n]))URL.revokeObjectURL(a);delete ne.filesMap[n]})})}return t()}));let Yp=ne;const me=class Rt{static registerRuntime(t){Rt.runtimes.push(t),Rt.runtimes.sort((e,i)=>i.version-e.version)}static findRuntime(t){for(const e of Rt.runtimes)if(e.test(t))return e}static setupLive2DModel(t,e,i){return ut(this,null,function*(){const s=new Promise(o=>t.once(\"textureLoaded\",o)),n=new Promise(o=>t.once(\"modelLoaded\",o)),a=Promise.all([s,n]).then(()=>t.emit(\"ready\"));yield Gp(Rt.live2DModelMiddlewares,{live2dModel:t,source:e,options:i||{}}),yield a,t.emit(\"load\")})}static loadMotion(t,e,i){var s,n;const a=o=>t.emit(\"motionLoadError\",e,i,o);try{const o=(s=t.definitions[e])==null?void 0:s[i];if(!o)return Promise.resolve(void 0);t.listeners(\"destroy\").includes(Rt.releaseTasks)||t.once(\"destroy\",Rt.releaseTasks);let h=Rt.motionTasksMap.get(t);h||(h={},Rt.motionTasksMap.set(t,h));let l=h[e];l||(l=[],h[e]=l);const u=t.getMotionFile(o);return(n=l[i])!=null||(l[i]=li.load({url:u,settings:t.settings,type:t.motionDataType,target:t}).then(c=>{var d;const f=(d=Rt.motionTasksMap.get(t))==null?void 0:d[e];f&&delete f[i];const p=t.createMotion(c,e,o);return t.emit(\"motionLoaded\",e,i,p),p}).catch(c=>{it.warn(t.tag,`Failed to load motion: ${u}\n`,c),a(c)})),l[i]}catch(o){it.warn(t.tag,`Failed to load motion at \"${e}\"[${i}]\n`,o),a(o)}return Promise.resolve(void 0)}static loadExpression(t,e){var i;const s=n=>t.emit(\"expressionLoadError\",e,n);try{const n=t.definitions[e];if(!n)return Promise.resolve(void 0);t.listeners(\"destroy\").includes(Rt.releaseTasks)||t.once(\"destroy\",Rt.releaseTasks);let a=Rt.expressionTasksMap.get(t);a||(a=[],Rt.expressionTasksMap.set(t,a));const o=t.getExpressionFile(n);return(i=a[e])!=null||(a[e]=li.load({url:o,settings:t.settings,type:\"json\",target:t}).then(h=>{const l=Rt.expressionTasksMap.get(t);l&&delete l[e];const u=t.createExpression(h,n);return t.emit(\"expressionLoaded\",e,u),u}).catch(h=>{it.warn(t.tag,`Failed to load expression: ${o}\n`,h),s(h)})),a[e]}catch(n){it.warn(t.tag,`Failed to load expression at [${e}]\n`,n),s(n)}return Promise.resolve(void 0)}static releaseTasks(){this instanceof ml?Rt.motionTasksMap.delete(this):Rt.expressionTasksMap.delete(this)}};E(me,\"runtimes\",[]);E(me,\"urlToJSON\",Vp);E(me,\"jsonToSettings\",Hp);E(me,\"waitUntilReady\",Xp);E(me,\"setupOptionals\",$p);E(me,\"setupEssentials\",zp);E(me,\"createInternalModel\",Wp);E(me,\"live2DModelMiddlewares\",[jp.factory,Yp.factory,Vp,Hp,Xp,$p,zp,Wp]);E(me,\"motionTasksMap\",new WeakMap);E(me,\"expressionTasksMap\",new WeakMap);let te=me;ml.prototype._loadMotion=function(r,t){return te.loadMotion(this,r,t)};Ip.prototype._loadExpression=function(r){return te.loadExpression(this,r)};Yp.live2dFactory=te;jp.live2dFactory=te;const qp=class uh{constructor(t,{autoUpdate:e=!0,autoHitTest:i=!0,autoFocus:s=!0,autoInteract:n,ticker:a}={}){E(this,\"model\"),E(this,\"destroyed\",!1),E(this,\"_ticker\"),E(this,\"_autoUpdate\",!1),E(this,\"_autoHitTest\",!1),E(this,\"_autoFocus\",!1),a||(uh.defaultTicker?a=uh.defaultTicker:typeof PIXI<\"u\"&&(a=PIXI.Ticker.shared)),n!==void 0&&(i=n,s=n,it.warn(t.tag,\"options.autoInteract is deprecated since v0.5.0, use autoHitTest and autoFocus instead.\")),this.model=t,this.ticker=a,this.autoUpdate=e,this.autoHitTest=i,this.autoFocus=s,(i||s)&&(this.model.eventMode=\"static\")}get ticker(){return this._ticker}set ticker(t){var e;this._ticker&&this._ticker.remove(Ks,this),this._ticker=t,this._autoUpdate&&((e=this._ticker)==null||e.add(Ks,this))}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){var e;this.destroyed||(t?this._ticker?(this._ticker.add(Ks,this),this._autoUpdate=!0):it.warn(this.model.tag,\"No Ticker to be used for automatic updates. Either set option.ticker when creating Live2DModel, or expose PIXI to global scope (window.PIXI = PIXI).\"):((e=this._ticker)==null||e.remove(Ks,this),this._autoUpdate=!1))}get autoHitTest(){return this._autoHitTest}set autoHitTest(t){t!==this.autoHitTest&&(t?this.model.on(\"pointertap\",Ec,this):this.model.off(\"pointertap\",Ec,this),this._autoHitTest=t)}get autoFocus(){return this._autoFocus}set autoFocus(t){t!==this.autoFocus&&(t?this.model.on(\"globalpointermove\",Cc,this):this.model.off(\"globalpointermove\",Cc,this),this._autoFocus=t)}get autoInteract(){return this._autoHitTest&&this._autoFocus}set autoInteract(t){this.autoHitTest=t,this.autoFocus=t}onTickerUpdate(){const t=this.ticker.deltaMS;this.model.update(t)}onTap(t){this.model.tap(t.global.x,t.global.y)}onPointerMove(t){this.model.focus(t.global.x,t.global.y)}destroy(){this.autoFocus=!1,this.autoHitTest=!1,this.autoUpdate=!1,this.ticker=void 0,this.destroyed=!0}};E(qp,\"defaultTicker\");let wc=qp;function Ks(){this.onTickerUpdate()}function Ec(r){this.onTap(r)}function Cc(r){this.onPointerMove(r)}class Qw extends dr{}const jt=new Z,tE=new et;class eE extends kt{constructor(t){super(),E(this,\"tag\",\"Live2DModel(uninitialized)\"),E(this,\"internalModel\"),E(this,\"textures\",[]),E(this,\"transform\",new Qw),E(this,\"anchor\",new le(this.onAnchorChange,this,0,0)),E(this,\"glContextID\",-1),E(this,\"elapsedTime\",0),E(this,\"deltaTime\",0),E(this,\"automator\"),this.automator=new wc(this,t),this.once(\"modelLoaded\",()=>this.init(t))}static from(t,e){const i=new this(e);return te.setupLive2DModel(i,t,e).then(()=>i)}static fromSync(t,e){const i=new this(e);return te.setupLive2DModel(i,t,e).then(e?.onLoad).catch(e?.onError),i}static registerTicker(t){wc.defaultTicker=t.shared}init(t){this.tag=`Live2DModel(${this.internalModel.settings.name})`}onAnchorChange(){this.pivot.set(this.anchor.x*this.internalModel.width,this.anchor.y*this.internalModel.height)}motion(t,e,i,{sound:s=void 0,volume:n=sr,expression:a=void 0,resetExpression:o=!0,crossOrigin:h,onFinish:l,onError:u}={}){return e===void 0?this.internalModel.motionManager.startRandomMotion(t,i,{sound:s,volume:n,expression:a,resetExpression:o,crossOrigin:h,onFinish:l,onError:u}):this.internalModel.motionManager.startMotion(t,e,i,{sound:s,volume:n,expression:a,resetExpression:o,crossOrigin:h,onFinish:l,onError:u})}stopMotions(){return this.internalModel.motionManager.stopAllMotions()}speak(t,{volume:e=sr,expression:i,resetExpression:s=!0,crossOrigin:n,onFinish:a,onError:o}={}){return this.internalModel.motionManager.speak(t,{volume:e,expression:i,resetExpression:s,crossOrigin:n,onFinish:a,onError:o})}stopSpeaking(){return this.internalModel.motionManager.stopSpeaking()}expression(t){return this.internalModel.motionManager.expressionManager?t===void 0?this.internalModel.motionManager.expressionManager.setRandomExpression():this.internalModel.motionManager.expressionManager.setExpression(t):Promise.resolve(!1)}focus(t,e,i=!1){jt.x=t,jt.y=e,this.toModelPosition(jt,jt,!0);const s=jt.x/this.internalModel.originalWidth*2-1,n=jt.y/this.internalModel.originalHeight*2-1,a=Math.atan2(n,s);this.internalModel.focusController.focus(Math.cos(a),-Math.sin(a),i)}tap(t,e){const i=this.hitTest(t,e);i.length&&(it.log(this.tag,\"Hit\",i),this.emit(\"hit\",i))}hitTest(t,e){return jt.x=t,jt.y=e,this.toModelPosition(jt,jt),this.internalModel.hitTest(jt.x,jt.y)}toModelPosition(t,e=t.clone(),i){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.transform.worldTransform.applyInverse(t,e),this.internalModel.localTransform.applyInverse(e,e),e}containsPoint(t){return this.getBounds(!0).contains(t.x,t.y)}_calculateBounds(){this._bounds.addFrame(this.transform,0,0,this.internalModel.width,this.internalModel.height)}update(t){this.deltaTime+=t,this.elapsedTime+=t}_render(t){t.batch.reset(),t.geometry.reset(),t.shader.reset(),t.state.reset();let e=!1;this.glContextID!==t.CONTEXT_UID&&(this.glContextID=t.CONTEXT_UID,this.internalModel.updateWebGLContext(t.gl,this.glContextID),e=!0);for(let n=0;n<this.textures.length;n++){const a=this.textures[n];a.valid&&((e||!a.baseTexture._glTextures[this.glContextID])&&(t.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,this.internalModel.textureFlipY),t.texture.bind(a.baseTexture,0)),this.internalModel.bindTexture(n,a.baseTexture._glTextures[this.glContextID].texture),a.baseTexture.touched=t.textureGC.count)}const i=t.framebuffer.viewport;this.internalModel.viewport=[i.x,i.y,i.width,i.height],this.deltaTime&&(this.internalModel.update(this.deltaTime,this.elapsedTime),this.deltaTime=0);const s=tE.copyFrom(t.globalUniforms.uniforms.projectionMatrix).append(this.worldTransform);this.internalModel.updateTransform(s),this.internalModel.draw(t.gl),t.state.reset(),t.texture.reset()}destroy(t){this.emit(\"destroy\"),t?.texture&&this.textures.forEach(e=>e.destroy(t.baseTexture)),this.automator.destroy(),this.internalModel.destroy(),super.destroy(t)}}if(!window.Live2DCubismCore)throw new Error(\"Could not find Cubism 4 runtime. This plugin requires live2dcubismcore.js to be loaded.\");class iE extends Ip{constructor(t,e){var i;super(t,e),E(this,\"queueManager\",new Ap),E(this,\"definitions\"),this.definitions=(i=t.expressions)!=null?i:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(t){return this.definitions.findIndex(e=>e.Name===t)}getExpressionFile(t){return t.File}createExpression(t,e){return ll.create(t)}_setExpression(t){return this.queueManager.startMotion(t,!1,performance.now())}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.doUpdateMotion(t,e)}}class rE extends ml{constructor(t,e){var i;super(t,e),E(this,\"definitions\"),E(this,\"groups\",{idle:\"Idle\"}),E(this,\"motionDataType\",\"json\"),E(this,\"queueManager\",new Ap),E(this,\"expressionManager\"),E(this,\"eyeBlinkIds\"),E(this,\"lipSyncIds\",[\"ParamMouthOpenY\"]),this.definitions=(i=t.motions)!=null?i:{},this.eyeBlinkIds=t.getEyeBlinkParameters()||[];const s=t.getLipSyncParameters();s?.length&&(this.lipSyncIds=s),this.init(e)}init(t){super.init(t),this.settings.expressions&&(this.expressionManager=new iE(this.settings,t)),this.queueManager.setEventCallback((e,i,s)=>{this.emit(\"motion:\"+i)})}isFinished(){return this.queueManager.isFinished()}_startMotion(t,e){return t.setFinishedMotionHandler(e),this.queueManager.stopAllMotions(),this.queueManager.startMotion(t,!1,performance.now())}_stopAllMotions(){this.queueManager.stopAllMotions()}createMotion(t,e,i){const s=ul.create(t),n=new Cp(t),a=(e===this.groups.idle?ac.idleMotionFadingDuration:ac.motionFadingDuration)/1e3;return n.getMotionFadeInTime()===void 0&&s.setFadeInTime(i.FadeInTime>0?i.FadeInTime:a),n.getMotionFadeOutTime()===void 0&&s.setFadeOutTime(i.FadeOutTime>0?i.FadeOutTime:a),s.setEffectIds(this.eyeBlinkIds,this.lipSyncIds),s}getMotionFile(t){return t.File}getMotionName(t){return t.File}getSoundFile(t){return t.Sound}updateParameters(t,e){return this.queueManager.doUpdateMotion(t,e)}destroy(){super.destroy(),this.queueManager.release(),this.queueManager=void 0}}const Sc=new Jt;class sE extends qw{constructor(t,e,i){super(),E(this,\"settings\"),E(this,\"coreModel\"),E(this,\"motionManager\"),E(this,\"lipSync\",!0),E(this,\"breath\",nl.create()),E(this,\"eyeBlink\"),E(this,\"userData\"),E(this,\"renderer\",new Pp),E(this,\"idParamAngleX\",iT),E(this,\"idParamAngleY\",rT),E(this,\"idParamAngleZ\",sT),E(this,\"idParamEyeBallX\",nT),E(this,\"idParamEyeBallY\",aT),E(this,\"idParamBodyAngleX\",hT),E(this,\"idParamBreath\",lT),E(this,\"idParamMouthForm\",oT),E(this,\"pixelsPerUnit\",1),E(this,\"centeringTransform\",new et),this.coreModel=t,this.settings=e,this.motionManager=new rE(e,i),this.init()}init(){var t;super.init(),(t=this.settings.getEyeBlinkParameters())!=null&&t.length&&(this.eyeBlink=eb.create(this.settings)),this.breath.setParameters([new wr(this.idParamAngleX,0,15,6.5345,.5),new wr(this.idParamAngleY,0,8,3.5345,.5),new wr(this.idParamAngleZ,0,10,5.5345,.5),new wr(this.idParamBodyAngleX,0,4,15.5345,.5),new wr(this.idParamBreath,0,.5,3.2345,.5)]),this.renderer.initialize(this.coreModel),this.renderer.setIsPremultipliedAlpha(!0)}getSize(){return[this.coreModel.getModel().canvasinfo.CanvasWidth,this.coreModel.getModel().canvasinfo.CanvasHeight]}getLayout(){const t={};if(this.settings.layout)for(const[e,i]of Object.entries(this.settings.layout)){const s=e.charAt(0).toLowerCase()+e.slice(1);t[s]=i}return t}setupLayout(){super.setupLayout(),this.pixelsPerUnit=this.coreModel.getModel().canvasinfo.PixelsPerUnit,this.centeringTransform.scale(this.pixelsPerUnit,this.pixelsPerUnit).translate(this.originalWidth/2,this.originalHeight/2)}updateWebGLContext(t,e){this.renderer.firstDraw=!0,this.renderer._bufferData={vertex:null,uv:null,index:null},this.renderer.startUp(t),this.renderer._clippingManager&&(this.renderer._clippingManager._currentFrameNo=e,this.renderer._clippingManager._maskTexture=void 0,rr.getInstance()._shaderSets=[])}bindTexture(t,e){this.renderer.bindTexture(t,e)}getHitAreaDefs(){var t,e;return(e=(t=this.settings.hitAreas)==null?void 0:t.map(i=>({id:i.Id,name:i.Name,index:this.coreModel.getDrawableIndex(i.Id)})))!=null?e:[]}getDrawableIDs(){return this.coreModel.getDrawableIds()}getDrawableIndex(t){return this.coreModel.getDrawableIndex(t)}getDrawableVertices(t){if(typeof t==\"string\"&&(t=this.coreModel.getDrawableIndex(t),t===-1))throw new TypeError(\"Unable to find drawable ID: \"+t);const e=this.coreModel.getDrawableVertices(t).slice();for(let i=0;i<e.length;i+=2)e[i]=e[i]*this.pixelsPerUnit+this.originalWidth/2,e[i+1]=-e[i+1]*this.pixelsPerUnit+this.originalHeight/2;return e}updateTransform(t){this.drawingMatrix.copyFrom(this.centeringTransform).prepend(this.localTransform).prepend(t)}update(t,e){var i,s,n,a;super.update(t,e),t/=1e3,e/=1e3;const o=this.coreModel;this.emit(\"beforeMotionUpdate\");const h=this.motionManager.update(this.coreModel,e);if(this.emit(\"afterMotionUpdate\"),o.saveParameters(),(i=this.motionManager.expressionManager)==null||i.update(o,e),h||(s=this.eyeBlink)==null||s.updateParameters(o,t),this.updateFocus(),this.updateNaturalMovements(t*1e3,e*1e3),this.lipSync&&this.motionManager.currentAudio){let l=this.motionManager.mouthSync(),u=0;const c=1,d=1.2;l>0&&(u=.4),l=sh(l*d,u,c);for(let f=0;f<this.motionManager.lipSyncIds.length;++f)o.addParameterValueById(this.motionManager.lipSyncIds[f],l,.8)}(n=this.physics)==null||n.evaluate(o,t),(a=this.pose)==null||a.updateParameters(o,t),this.emit(\"beforeModelUpdate\"),o.update(),o.loadParameters()}updateFocus(){this.coreModel.addParameterValueById(this.idParamEyeBallX,this.focusController.x),this.coreModel.addParameterValueById(this.idParamEyeBallY,this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleX,this.focusController.x*30),this.coreModel.addParameterValueById(this.idParamAngleY,this.focusController.y*30),this.coreModel.addParameterValueById(this.idParamAngleZ,this.focusController.x*this.focusController.y*-30),this.coreModel.addParameterValueById(this.idParamBodyAngleX,this.focusController.x*10)}updateFacialEmotion(t){this.coreModel.addParameterValueById(this.idParamMouthForm,t)}updateNaturalMovements(t,e){var i;(i=this.breath)==null||i.updateParameters(this.coreModel,t/1e3)}draw(t){const e=this.drawingMatrix,i=Sc.getArray();i[0]=e.a,i[1]=e.b,i[4]=-e.c,i[5]=-e.d,i[12]=e.tx,i[13]=e.ty,this.renderer.setMvpMatrix(Sc),this.renderer.setRenderState(t.getParameter(t.FRAMEBUFFER_BINDING),this.viewport),this.renderer.drawModel()}destroy(){super.destroy(),this.renderer.release(),this.coreModel.release(),this.renderer=void 0,this.coreModel=void 0}}class nr extends fl{constructor(t){if(super(t),E(this,\"moc\"),E(this,\"textures\"),!nr.isValidJSON(t))throw new TypeError(\"Invalid JSON.\");Object.assign(this,new Mp(t))}static isValidJSON(t){var e;return!!t?.FileReferences&&typeof t.FileReferences.Moc==\"string\"&&((e=t.FileReferences.Textures)==null?void 0:e.length)>0&&t.FileReferences.Textures.every(i=>typeof i==\"string\")}replaceFiles(t){if(super.replaceFiles(t),this.motions)for(const[e,i]of Object.entries(this.motions))for(let s=0;s<i.length;s++)i[s].File=t(i[s].File,`motions.${e}[${s}].File`),i[s].Sound!==void 0&&(i[s].Sound=t(i[s].Sound,`motions.${e}[${s}].Sound`));if(this.expressions)for(let e=0;e<this.expressions.length;e++)this.expressions[e].File=t(this.expressions[e].File,`expressions[${e}].File`)}}uT(nr,[Mp]);let Zs,Ac=20;function nE(){return hs.isStarted()?Promise.resolve():(Zs??(Zs=new Promise((r,t)=>{function e(){try{aE(),r()}catch(i){if(Ac--,Ac<0){const s=new Error(\"Failed to start up Cubism 4 framework.\");s.cause=i,t(s);return}setTimeout(e,10)}}e()})),Zs)}function aE(r){r=Object.assign({logFunction:console.log,loggingLevel:mr.LogLevel_Verbose},r),hs.startUp(r),hs.initialize()}te.registerRuntime({version:4,ready:nE,test(r){return r instanceof nr||nr.isValidJSON(r)},isValidMoc(r){if(r.byteLength<4)return!1;const t=new Int8Array(r,0,4);return String.fromCharCode(...t)===\"MOC3\"},createModelSettings(r){return new nr(r)},createCoreModel(r,t){const e=hl.create(r,!!t?.checkMocConsistency);try{const i=e.createModel();return i.__moc=e,i}catch(i){try{e.release()}catch{}throw i}},createInternalModel(r,t,e){const i=new sE(r,t,e),s=r;return s.__moc&&(i.__moc=s.__moc,delete s.__moc,i.once(\"destroy\",oE)),i},createPhysics(r,t){return cl.create(t)},createPose(r,t){return al.create(t)}});function oE(){var r;(r=this.__moc)==null||r.release()}class hE{constructor(t){this.currentModel=null,this.currentModelUrl=\"\",this.app=t}async loadModel(t){this.currentModel&&(this.app.stage.removeChild(this.currentModel),this.currentModel.destroy(),this.currentModel=null),this.currentModelUrl=t;const e=await eE.from(t,{autoInteract:!1});this.currentModel=e,this.app.stage.addChild(e),this.fitModel(),this.playIdleMotion();const i=this.getMotionGroups(),s=this.getExpressions();return{motionGroups:i,expressions:s}}fitModel(){if(!this.currentModel)return;const t=this.currentModel,e=this.app.screen.width,i=this.app.screen.height,s=t.width/t.scale.x,n=t.height/t.scale.y;console.log(`[fitModel] screen: ${e}x${i}, model(original): ${s}x${n}, DPR: ${window.devicePixelRatio}`);const a=i*.8/n,o=e*.9/s,h=Math.min(a,o);t.scale.set(h,h),t.x=(e-s*h)/2,t.y=i-n*h}playIdleMotion(){if(!this.currentModel)return;const e=this.getMotionGroups().find(i=>i.toLowerCase().includes(\"idle\")||i.toLowerCase().includes(\"standby\"));if(e)try{this.currentModel.motion(e,0,1)}catch(i){console.warn(\"Failed to play idle motion:\",i)}}async playMotion(t,e=0,i=2){if(!this.currentModel)throw new Error(\"No model loaded\");await this.currentModel.motion(t,e,i)}async setExpression(t){if(!this.currentModel)throw new Error(\"No model loaded\");await this.currentModel.expression(t)}getMotionGroups(){if(!this.currentModel)return[];const e=this.currentModel.internalModel?.settings;if(!e)return[];const i=e.motions;return i?Object.keys(i):[]}getExpressions(){if(!this.currentModel)return[];const e=this.currentModel.internalModel?.settings;if(!e)return[];const i=e.expressions;return!i||!Array.isArray(i)?[]:i.map(s=>s.Name||s.name||\"unknown\")}getModel(){return this.currentModel}getModelUrl(){return this.currentModelUrl}onResize(){this.fitModel()}}function Ot(r){const t={id:cE(),timestamp:Date.now(),event:r},e=JSON.stringify(t);window.ReactNativeWebView?.postMessage&&window.ReactNativeWebView.postMessage(e),console.log(\"[Bridge] sendEvent:\",r.type,e)}function lE(r,t){window.dispatchRNCommand=e=>{console.log(\"[Bridge] received command:\",e.type),uE(e,r,t)},console.log(\"[Bridge] initialized\")}async function uE(r,t,e){try{switch(r.type){case\"SET_MODEL\":{const{modelUrl:i}=r.payload;try{const{motionGroups:s,expressions:n}=await t.loadModel(i);Ot({type:\"MODEL_LOADED\",payload:{modelUrl:i,motionGroups:s,expressions:n}})}catch(s){const n=s instanceof Error?s.message:String(s);Ot({type:\"MODEL_ERROR\",payload:{error:n,modelUrl:i}})}break}case\"PLAY_MOTION\":{const{group:i,index:s,priority:n}=r.payload;try{await t.playMotion(i,s??0,n??2),Ot({type:\"MOTION_FINISHED\",payload:{group:i,index:s??0}})}catch(a){const o=a instanceof Error?a.message:String(a);console.error(\"[Bridge] PLAY_MOTION error:\",o),Ot({type:\"MOTION_ERROR\",payload:{error:o,group:i,index:s??0}})}break}case\"SET_EXPRESSION\":{const{expressionId:i}=r.payload;try{await t.setExpression(i)}catch(s){const n=s instanceof Error?s.message:String(s);console.error(\"[Bridge] SET_EXPRESSION error:\",n,\"expressionId:\",i)}break}case\"START_LIP_SYNC\":{const{audioUrl:i,duration:s}=r.payload;await e.startLipSync(i,s);break}case\"STOP_LIP_SYNC\":{e.stopLipSync();break}default:console.warn(\"[Bridge] Unknown command:\",r.type)}}catch(i){console.error(\"[Bridge] Command handling error:\",i)}}function cE(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}class dE{constructor(t){this.simulationTimer=null,this.simulationFrame=null,this.isActive=!1,this.modelManager=t}async startLipSync(t,e){this.stopLipSync(),this.isActive=!0;const i=this.modelManager.getModel();if(!i){console.warn(\"LipSync: No model loaded\"),this.isActive=!1,Ot({type:\"LIP_SYNC_FINISHED\"});return}if(t)try{await i.speak(t,{onFinish:()=>{this.isActive=!1,Ot({type:\"LIP_SYNC_FINISHED\"})},onError:s=>{console.error(\"LipSync speak error:\",s),this.isActive=!1,Ot({type:\"LIP_SYNC_FINISHED\"})}})}catch(s){console.error(\"LipSync: Failed to start speak:\",s),this.isActive=!1,Ot({type:\"LIP_SYNC_FINISHED\"})}else{const s=(e||10)*1e3,n=performance.now(),a=()=>{if(!this.isActive)return;const o=this.modelManager.getModel();if(!o){this.isActive=!1,Ot({type:\"LIP_SYNC_FINISHED\"});return}const h=performance.now()-n;if(h>=s){this.setMouthOpenY(o,0),this.isActive=!1,Ot({type:\"LIP_SYNC_FINISHED\"});return}const l=6+Math.sin(h*.003)*2,u=Math.abs(Math.sin(h/1e3*l*Math.PI));this.setMouthOpenY(o,u),this.simulationFrame=requestAnimationFrame(a)};this.simulationFrame=requestAnimationFrame(a),this.simulationTimer=window.setTimeout(()=>{this.isActive&&(this.stopLipSync(),Ot({type:\"LIP_SYNC_FINISHED\"}))},s+100)}}stopLipSync(){this.isActive=!1,this.simulationFrame!==null&&(cancelAnimationFrame(this.simulationFrame),this.simulationFrame=null),this.simulationTimer!==null&&(clearTimeout(this.simulationTimer),this.simulationTimer=null);const t=this.modelManager.getModel();t&&this.setMouthOpenY(t,0)}setMouthOpenY(t,e){try{const i=t.internalModel?.coreModel;if(i){const s=i._model?.parameters?.ids?.indexOf(\"ParamMouthOpenY\");s!==void 0&&s>=0?i._model.parameters.values[s]=e:i.setParameterValueById?.(\"ParamMouthOpenY\",e)}}catch{}}}const oo={DEFAULT_MODEL_URL:\"https://cdn.jsdelivr.net/gh/guansss/pixi-live2d-display@master/test/assets/haru/haru_greeter_t03.model3.json\",CUBISM_CORE_URL:\"https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js\",BACKGROUND_COLOR:\"transparent\",DEFAULT_SCALE:.3};function Pc(){let r=window.innerWidth,t=window.innerHeight;return(!r||!t)&&(r=document.documentElement.clientWidth||screen.width,t=document.documentElement.clientHeight||screen.height),r||(r=375),t||(t=300),{width:r,height:t}}async function fE(){console.log(\"[Live2D Viewer] Initializing...\");const{width:r,height:t}=Pc();console.log(`[Live2D Viewer] Viewport: ${r}x${t}, DPR: ${window.devicePixelRatio}`);const e=new qh({view:document.getElementById(\"canvas\"),width:r,height:t,backgroundAlpha:0,resolution:window.devicePixelRatio||1,autoDensity:!0,antialias:!0}),i=new hE(e),s=new dE(i);lE(i,s);const n=()=>{const{width:a,height:o}=Pc();e.renderer.resize(a,o),i.onResize()};if(window.addEventListener(\"resize\",n),Ot({type:\"READY\"}),window.__readySent=!0,console.log(\"[Live2D Viewer] READY event sent\"),!window.__cubismCoreLoaded){console.error(\"[Live2D Viewer] Cubism Core not loaded, skipping model load\"),Ot({type:\"MODEL_ERROR\",payload:{error:\"Cubism Core SDK failed to load from CDN\",modelUrl:oo.DEFAULT_MODEL_URL}});return}try{const a=oo.DEFAULT_MODEL_URL;console.log(\"[Live2D Viewer] Loading default model:\",a);const{motionGroups:o,expressions:h}=await i.loadModel(a);setTimeout(n,100),Ot({type:\"MODEL_LOADED\",payload:{modelUrl:a,motionGroups:o,expressions:h}}),console.log(\"[Live2D Viewer] Model loaded successfully\"),console.log(\"  Motion groups:\",o),console.log(\"  Expressions:\",h)}catch(a){const o=a instanceof Error?a.message:String(a);console.error(\"[Live2D Viewer] Failed to load model:\",o),Ot({type:\"MODEL_ERROR\",payload:{error:o,modelUrl:oo.DEFAULT_MODEL_URL}})}}function Mc(){fE().catch(r=>{console.error(\"[Live2D Viewer] Fatal error in main():\",r);try{window.ReactNativeWebView?.postMessage&&(window.ReactNativeWebView.postMessage(JSON.stringify({id:`evt_fallback_${Date.now()}`,timestamp:Date.now(),event:{type:\"READY\"}})),window.ReactNativeWebView.postMessage(JSON.stringify({id:`evt_error_${Date.now()}`,timestamp:Date.now(),event:{type:\"MODEL_ERROR\",payload:{error:r instanceof Error?r.message:String(r)}}})))}catch{}})}document.readyState===\"loading\"?document.addEventListener(\"DOMContentLoaded\",Mc):Mc()});export default pE();</script>\n  </head>\n  <body>\n    <canvas id=\"canvas\"></canvas>\n    <!-- Safety net: if module fails to load/execute, send READY after timeout -->\n    <script>\n      setTimeout(function() {\n        if (!window.__readySent && window.ReactNativeWebView) {\n          console.warn('[Live2D Viewer] Safety net: sending fallback READY');\n          window.ReactNativeWebView.postMessage(JSON.stringify({\n            id: 'evt_fallback_ready',\n            timestamp: Date.now(),\n            event: { type: 'READY' }\n          }));\n          window.ReactNativeWebView.postMessage(JSON.stringify({\n            id: 'evt_fallback_error',\n            timestamp: Date.now(),\n            event: { type: 'MODEL_ERROR', payload: { error: 'Module script failed to execute' } }\n          }));\n        }\n      }, 5000);\n    </script>\n  </body>\n</html>\n";
